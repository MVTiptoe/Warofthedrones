import{r as e,a as t,R as r,V as n,S as a,B as i,U as o,M as s,b as l,I as u,D as c,c as f,H as d,F as h,d as p,L as v,e as g,f as m,g as y,h as b,i as w,j as x,k as S,C as U,l as _,m as k,n as T,o as M,p as C,q as E,T as F,s as A,t as R,P as I,u as D,v as P,O,W as B,w as L,x as G,y as z,z as j,A as W,E as N,G as V,J as H,K as q,N as X,Q as $,X as Y,Y as Z,Z as K,_ as Q,$ as J,a0 as ee,a1 as te,a2 as re}from"./vendor-I9-Q_5Qr.js";import{c as ne}from"./utils-B6tTjOLc.js";import{u as ae,a as ie,e as oe,b as se,c as le,d as ue}from"./fiber-Df7GEbeL.js";var ce={},fe=e;ce.createRoot=fe.createRoot,ce.hydrateRoot=fe.hydrateRoot;const de=[];function he(e,t,r=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;const n=e.length;if(t.length!==n)return!1;for(let a=0;a<n;a++)if(!r(e[a],t[a]))return!1;return!0}function pe(e,t=null,r=!1,n={}){null===t&&(t=[e]);for(const o of de)if(he(t,o.keys,o.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return n.lifespan&&n.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,n.lifespan)),o.response;if(!r)throw o.promise}const a={keys:t,equal:n.equal,remove:()=>{const e=de.indexOf(a);-1!==e&&de.splice(e,1)},promise:(i=e,"object"==typeof i&&"function"==typeof i.then?e:e(...t)).then((e=>{a.response=e,n.lifespan&&n.lifespan>0&&(a.timeout=setTimeout(a.remove,n.lifespan))})).catch((e=>a.error=e))};var i;if(de.push(a),!r)throw a.promise}const ve=(e,t,r)=>pe(e,t,!1,r),ge=(e,t,r)=>{pe(e,t,!0,r)},me=e=>{if(void 0===e||0===e.length)de.splice(0,de.length);else{const t=de.find((t=>he(e,t.keys,t.equal)));t&&t.remove()}};function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ye.apply(null,arguments)}const be=e=>(t,r,n)=>{const a=n.subscribe;n.subscribe=(e,t,r)=>{let i=e;if(t){const a=(null==r?void 0:r.equalityFn)||Object.is;let o=e(n.getState());i=r=>{const n=e(r);if(!a(o,n)){const e=o;t(o=n,e)}},(null==r?void 0:r.fireImmediately)&&t(o,o)}return a(i)};return e(t,r,n)},we=t.createContext(null);function xe({map:e,children:r,onChange:n,domElement:a}){const i=e.map((e=>e.name+e.keys)).join("-"),o=t.useMemo((()=>ne(be((()=>e.reduce(((e,t)=>({...e,[t.name]:!1})),{}))))),[i]),s=t.useMemo((()=>[o.subscribe,o.getState,o]),[i]),l=o.setState;return t.useEffect((()=>{const t=e.map((({name:e,keys:t,up:r})=>({keys:t,up:r,fn:t=>{l({[e]:t}),n&&n(e,t,s[1]())}}))).reduce(((e,{keys:t,fn:r,up:n=!0})=>(t.forEach((t=>e[t]={fn:r,pressed:!1,up:n})),e)),{}),r=({key:e,code:r})=>{const n=t[e]||t[r];if(!n)return;const{fn:a,pressed:i,up:o}=n;n.pressed=!0,!o&&i||a(!0)},i=({key:e,code:r})=>{const n=t[e]||t[r];if(!n)return;const{fn:a,up:i}=n;n.pressed=!1,i&&a(!1)},o=a||window;return o.addEventListener("keydown",r,{passive:!0}),o.addEventListener("keyup",i,{passive:!0}),()=>{o.removeEventListener("keydown",r),o.removeEventListener("keyup",i)}}),[a,i]),t.createElement(we.Provider,{value:s,children:r})}function Se(e){const[r,n,a]=t.useContext(we);return[r,n]}const Ue=(()=>parseInt(r.replace(/\D+/g,"")))();var _e=Uint8Array,ke=Uint16Array,Te=Uint32Array,Me=new _e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ce=new _e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ee=new _e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fe=function(e,t){for(var r=new ke(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new Te(r[30]);for(n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return[r,a]},Ae=Fe(Me,2),Re=Ae[0],Ie=Ae[1];Re[28]=258,Ie[258]=28;for(var De=Fe(Ce,0)[0],Pe=new ke(32768),Oe=0;Oe<32768;++Oe){var Be=(43690&Oe)>>>1|(21845&Oe)<<1;Be=(61680&(Be=(52428&Be)>>>2|(13107&Be)<<2))>>>4|(3855&Be)<<4,Pe[Oe]=((65280&Be)>>>8|(255&Be)<<8)>>>1}var Le=function(e,t,r){for(var n=e.length,a=0,i=new ke(t);a<n;++a)++i[e[a]-1];var o,s=new ke(t);for(a=0;a<t;++a)s[a]=s[a-1]+i[a-1]<<1;if(r){o=new ke(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],c=t-e[a],f=s[e[a]-1]++<<c,d=f|(1<<c)-1;f<=d;++f)o[Pe[f]>>>l]=u}else for(o=new ke(n),a=0;a<n;++a)e[a]&&(o[a]=Pe[s[e[a]-1]++]>>>15-e[a]);return o},Ge=new _e(288);for(Oe=0;Oe<144;++Oe)Ge[Oe]=8;for(Oe=144;Oe<256;++Oe)Ge[Oe]=9;for(Oe=256;Oe<280;++Oe)Ge[Oe]=7;for(Oe=280;Oe<288;++Oe)Ge[Oe]=8;var ze=new _e(32);for(Oe=0;Oe<32;++Oe)ze[Oe]=5;var je=Le(Ge,9,1),We=Le(ze,5,1),Ne=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Ve=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},He=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},qe=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new _e(0);var a=!t||r,i=!r||r.i;r||(r={}),t||(t=new _e(3*n));var o,s=function(e){var r=t.length;if(e>r){var n=new _e(Math.max(2*r,e));n.set(t),t=n}},l=r.f||0,u=r.p||0,c=r.b||0,f=r.l,d=r.d,h=r.m,p=r.n,v=8*n;do{if(!f){r.f=l=Ve(e,u,1);var g=Ve(e,u+1,3);if(u+=3,!g){var m=e[(C=((o=u)/8|0)+(7&o&&1)+4)-4]|e[C-3]<<8,y=C+m;if(y>n){if(i)throw"unexpected EOF";break}a&&s(c+m),t.set(e.subarray(C,y),c),r.b=c+=m,r.p=u=8*y;continue}if(1==g)f=je,d=We,h=9,p=5;else{if(2!=g)throw"invalid block type";var b=Ve(e,u,31)+257,w=Ve(e,u+10,15)+4,x=b+Ve(e,u+5,31)+1;u+=14;for(var S=new _e(x),U=new _e(19),_=0;_<w;++_)U[Ee[_]]=Ve(e,u+3*_,7);u+=3*w;var k=Ne(U),T=(1<<k)-1,M=Le(U,k,1);for(_=0;_<x;){var C,E=M[Ve(e,u,T)];if(u+=15&E,(C=E>>>4)<16)S[_++]=C;else{var F=0,A=0;for(16==C?(A=3+Ve(e,u,3),u+=2,F=S[_-1]):17==C?(A=3+Ve(e,u,7),u+=3):18==C&&(A=11+Ve(e,u,127),u+=7);A--;)S[_++]=F}}var R=S.subarray(0,b),I=S.subarray(b);h=Ne(R),p=Ne(I),f=Le(R,h,1),d=Le(I,p,1)}if(u>v){if(i)throw"unexpected EOF";break}}a&&s(c+131072);for(var D=(1<<h)-1,P=(1<<p)-1,O=u;;O=u){var B=(F=f[He(e,u)&D])>>>4;if((u+=15&F)>v){if(i)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(B<256)t[c++]=B;else{if(256==B){O=u,f=null;break}var L=B-254;if(B>264){var G=Me[_=B-257];L=Ve(e,u,(1<<G)-1)+Re[_],u+=G}var z=d[He(e,u)&P],j=z>>>4;if(!z)throw"invalid distance";u+=15&z;I=De[j];if(j>3){G=Ce[j];I+=He(e,u)&(1<<G)-1,u+=G}if(u>v){if(i)throw"unexpected EOF";break}a&&s(c+131072);for(var W=c+L;c<W;c+=4)t[c]=t[c-I],t[c+1]=t[c+1-I],t[c+2]=t[c+2-I],t[c+3]=t[c+3-I];c=W}}r.l=f,r.p=O,r.b=c,f&&(l=1,r.m=h,r.d=d,r.n=p)}while(!l);return c==t.length?t:function(e,t,r){(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof ke?ke:e instanceof Te?Te:_e)(r-t);return n.set(e.subarray(t,r)),n}(t,0,c)},Xe=new _e(0);function $e(e,t){return qe((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var Ye="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ye.decode(Xe,{stream:!0})}catch(Kr){}var Ze=Object.defineProperty,Ke=(e,t,r)=>(((e,t,r)=>{t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const Qe=(()=>{const e={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n},up:{value:new n(0,1,0)}},vertexShader:"\n      uniform vec3 sunPosition;\n      uniform float rayleigh;\n      uniform float turbidity;\n      uniform float mieCoefficient;\n      uniform vec3 up;\n\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      // constants for atmospheric scattering\n      const float e = 2.71828182845904523536028747135266249775724709369995957;\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      // wavelength of used primaries, according to preetham\n      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n      // mie stuff\n      // K coefficient for the primaries\n      const float v = 4.0;\n      const vec3 K = vec3( 0.686, 0.678, 0.666 );\n      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n      // earth shadow hack\n      // cutoffAngle = pi / 1.95;\n      const float cutoffAngle = 1.6110731556870734;\n      const float steepness = 1.5;\n      const float EE = 1000.0;\n\n      float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n      }\n\n      vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n      }\n\n      void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        gl_Position.z = gl_Position.w; // set z to camera.far\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n      // extinction (absorbtion + out scattering)\n      // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n      // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n      }\n    ",fragmentShader:`\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      uniform float mieDirectionalG;\n      uniform vec3 up;\n\n      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n      // constants for atmospheric scattering\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      const float n = 1.0003; // refractive index of air\n      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n      // optical length at zenith for molecules\n      const float rayleighZenithLength = 8.4E3;\n      const float mieZenithLength = 1.25E3;\n      // 66 arc seconds -> degrees, and the cosine of that\n      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n      // 3.0 / ( 16.0 * pi )\n      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n      // 1.0 / ( 4.0 * pi )\n      const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n      float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n      }\n\n      float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n      }\n\n      void main() {\n\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n\n      // optical length\n      // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n      // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n      // in scattering\n        float cosTheta = dot( direction, vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n      // nightsky\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n      // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n      #include <tonemapping_fragment>\n      #include <${Ue>=154?"colorspace_fragment":"encodings_fragment"}>\n\n      }\n    `},t=new a({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:o.clone(e.uniforms),side:i,depthWrite:!1});class r extends s{constructor(){super(new l(1,1,1),t)}}return Ke(r,"SkyShader",e),Ke(r,"material",t),r})();class Je extends s{constructor(e,t){var r,n;const i=(o=e)&&o.isCubeTexture;var o;const s=(null!=(n=i?null==(r=e.image[0])?void 0:r.width:e.image.width)?n:1024)/4,l=Math.floor(Math.log2(s)),f=Math.pow(2,l),d=[i?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(f,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*f),`#define CUBEUV_MAX_MIP ${l}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${Ue>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new u(1,16),new a({uniforms:h,fragmentShader:d,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:c}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class et extends f{constructor(e){super(e),this.type=d}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},r=function(e,t,r){t=t||1024;let n=e.pos,a=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=s.indexOf("\n"))&&i<t&&n<e.byteLength;)o+=s,i+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<a&&(e.pos+=i+a+1,o+s.slice(0,a))},n=function(e,t,r,n){const a=e[t+3],i=Math.pow(2,a-128)/255;r[n+0]=e[t+0]*i,r[n+1]=e[t+1]*i,r[n+2]=e[t+2]*i,r[n+3]=1},a=function(e,t,r,n){const a=e[t+3],i=Math.pow(2,a-128)/255;r[n+0]=p.toHalfFloat(Math.min(e[t+0]*i,65504)),r[n+1]=p.toHalfFloat(Math.min(e[t+1]*i,65504)),r[n+2]=p.toHalfFloat(Math.min(e[t+2]*i,65504)),r[n+3]=p.toHalfFloat(1)},i=new Uint8Array(e);i.pos=0;const o=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,u;for((e.pos>=e.byteLength||!(l=r(e)))&&t(1,"no header found"),(u=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),s.valid|=1,s.programtype=u[1],s.string+=l+"\n";l=r(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((u=l.match(n))&&(s.gamma=parseFloat(u[1])),(u=l.match(a))&&(s.exposure=parseFloat(u[1])),(u=l.match(i))&&(s.valid|=2,s.format=u[1]),(u=l.match(o))&&(s.valid|=4,s.height=parseInt(u[1],10),s.width=parseInt(u[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid||t(3,"missing format specifier"),4&s.valid||t(3,"missing image size specifier"),s}(i),s=o.width,l=o.height,u=function(e,r,n){const a=r;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);a!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const i=new Uint8Array(4*r*n);i.length||t(4,"unable to allocate buffer space");let o=0,s=0;const l=4*a,u=new Uint8Array(4),c=new Uint8Array(l);let f=n;for(;f>0&&s<e.byteLength;){s+4>e.byteLength&&t(1),u[0]=e[s++],u[1]=e[s++],u[2]=e[s++],u[3]=e[s++],2==u[0]&&2==u[1]&&(u[2]<<8|u[3])==a||t(3,"bad rgbe scanline format");let r,n=0;for(;n<l&&s<e.byteLength;){r=e[s++];const a=r>128;if(a&&(r-=128),(0===r||n+r>l)&&t(3,"bad scanline data"),a){const t=e[s++];for(let e=0;e<r;e++)c[n++]=t}else c.set(e.subarray(s,s+r),n),n+=r,s+=r}const d=a;for(let e=0;e<d;e++){let t=0;i[o]=c[e+t],t+=a,i[o+1]=c[e+t],t+=a,i[o+2]=c[e+t],t+=a,i[o+3]=c[e+t],o+=4}f--}return i}(i.subarray(i.pos),s,l);let c,f,v;switch(this.type){case h:v=u.length/4;const e=new Float32Array(4*v);for(let r=0;r<v;r++)n(u,4*r,e,4*r);c=e,f=h;break;case d:v=u.length/4;const t=new Uint16Array(4*v);for(let r=0;r<v;r++)a(u,4*r,t,4*r);c=t,f=d;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:s,height:l,data:c,header:o.string,gamma:o.gamma,exposure:o.exposure,type:f}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,(function(e,r){switch(e.type){case h:case d:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=v,e.magFilter=v,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,n)}}const tt=Ue>=152;class rt extends f{constructor(e){super(e),this.type=d}parse(e){const t=65536,r=14,n=65537,a=16384,i=Math.pow(2.7182818,2.2);const o={l:0,c:0,lc:0};function s(e,t,r,n,a){for(;r<e;)t=t<<8|q(n,a),r+=8;r-=e,o.l=t>>r&(1<<e)-1,o.c=t,o.lc=r}const l=new Array(59);function u(e,t,r,a,i,u,c){for(var f=r,d=0,h=0;i<=u;i++){if(f.value-r.value>a)return!1;s(6,d,h,e,f);var p=o.l;if(d=o.c,h=o.lc,c[i]=p,63==p){if(f.value-r.value>a)throw"Something wrong with hufUnpackEncTable";s(8,d,h,e,f);var v=o.l+6;if(d=o.c,h=o.lc,i+v>u+1)throw"Something wrong with hufUnpackEncTable";for(;v--;)c[i++]=0;i--}else if(p>=59){if(i+(v=p-59+2)>u+1)throw"Something wrong with hufUnpackEncTable";for(;v--;)c[i++]=0;i--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<n;++t)l[e[t]]+=1;var r=0;for(t=58;t>0;--t){var a=r+l[t]>>1;l[t]=r,r=a}for(t=0;t<n;++t){var i=e[t];i>0&&(e[t]=i|l[i]++<<6)}}(c)}function c(e){return 63&e}function f(e){return e>>6}const v={c:0,lc:0};function y(e,t,r,n){e=e<<8|q(r,n),t+=8,v.c=e,v.lc=t}const b={c:0,lc:0};function w(e,t,r,n,a,i,o,s,l,u){if(e==t){n<8&&(y(r,n,a,o),r=v.c,n=v.lc);var c=r>>(n-=8);c=new Uint8Array([c])[0];if(l.value+c>u)return!1;for(var f=s[l.value-1];c-- >0;)s[l.value++]=f}else{if(!(l.value<u))return!1;s[l.value++]=e}b.c=r,b.lc=n}function x(e){return 65535&e}function S(e){var t=x(e);return t>32767?t-65536:t}const U={a:0,b:0};function _(e,t){var r=S(e),n=S(t),a=r+(1&n)+(n>>1),i=a,o=a-n;U.a=i,U.b=o}function k(e,t){var r=x(e),n=x(t),a=r-(n>>1)&65535,i=n+a-32768&65535;U.a=i,U.b=a}function T(e,t,r,n,a,i,o){for(var s,l=o<16384,u=r>a?a:r,c=1;c<=u;)c<<=1;for(s=c>>=1,c>>=1;c>=1;){for(var f,d,h,p,v=0,g=v+i*(a-s),m=i*c,y=i*s,b=n*c,w=n*s;v<=g;v+=y){for(var x=v,S=v+n*(r-s);x<=S;x+=w){var T=x+b,M=(C=x+m)+b;l?(_(e[x+t],e[C+t]),f=U.a,h=U.b,_(e[T+t],e[M+t]),d=U.a,p=U.b,_(f,d),e[x+t]=U.a,e[T+t]=U.b,_(h,p),e[C+t]=U.a,e[M+t]=U.b):(k(e[x+t],e[C+t]),f=U.a,h=U.b,k(e[T+t],e[M+t]),d=U.a,p=U.b,k(f,d),e[x+t]=U.a,e[T+t]=U.b,k(h,p),e[C+t]=U.a,e[M+t]=U.b)}if(r&c){var C=x+m;l?_(e[x+t],e[C+t]):k(e[x+t],e[C+t]),f=U.a,e[C+t]=U.b,e[x+t]=f}}if(a&c)for(x=v,S=v+n*(r-s);x<=S;x+=w){T=x+b;l?_(e[x+t],e[T+t]):k(e[x+t],e[T+t]),f=U.a,e[T+t]=U.b,e[x+t]=f}s=c,c>>=1}return v}function M(e,t,i,o,s,l){var d=i.value,h=H(t,i),p=H(t,i);i.value+=4;var g=H(t,i);if(i.value+=4,h<0||h>=n||p<0||p>=n)throw"Something wrong with HUF_ENCSIZE";var m=new Array(n),x=new Array(a);if(function(e){for(var t=0;t<a;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(x),u(e,0,i,o-(i.value-d),h,p,m),g>8*(o-(i.value-d)))throw"Something wrong with hufUncompress";!function(e,t,n,a){for(;t<=n;t++){var i=f(e[t]),o=c(e[t]);if(i>>o)throw"Invalid table entry";if(o>r){if((d=a[i>>o-r]).len)throw"Invalid table entry";if(d.lit++,d.p){var s=d.p;d.p=new Array(d.lit);for(var l=0;l<d.lit-1;++l)d.p[l]=s[l]}else d.p=new Array(1);d.p[d.lit-1]=t}else if(o){var u=0;for(l=1<<r-o;l>0;l--){var d;if((d=a[(i<<r-o)+u]).len||d.p)throw"Invalid table entry";d.len=o,d.lit=t,u++}}}}(m,h,p,x),function(e,t,n,a,i,o,s,l,u,d){for(var h=0,p=0,g=l,m=Math.trunc(i.value+(o+7)/8);i.value<m;)for(y(h,p,n,i),h=v.c,p=v.lc;p>=r;)if((_=t[h>>p-r&16383]).len)p-=_.len,w(_.lit,s,h,p,n,0,i,u,d,g),h=b.c,p=b.lc;else{if(!_.p)throw"hufDecode issues";var x;for(x=0;x<_.lit;x++){for(var S=c(e[_.p[x]]);p<S&&i.value<m;)y(h,p,n,i),h=v.c,p=v.lc;if(p>=S&&f(e[_.p[x]])==(h>>p-S&(1<<S)-1)){p-=S,w(_.p[x],s,h,p,n,0,i,u,d,g),h=b.c,p=b.lc;break}}if(x==_.lit)throw"hufDecode issues"}var U=8-o&7;for(h>>=U,p-=U;p>0;){var _;if(!(_=t[h<<r-p&16383]).len)throw"hufDecode issues";p-=_.len,w(_.lit,s,h,p,n,0,i,u,d,g),h=b.c,p=b.lc}}(m,x,e,0,i,g,p,l,s,{value:0})}function C(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function E(e,t){for(var r=0,n=Math.floor((e.length+1)/2),a=0,i=e.length-1;!(a>i||(t[a++]=e[r++],a>i));)t[a++]=e[n++]}function F(e){for(var t=e.byteLength,r=new Array,n=0,a=new DataView(e);t>0;){var i=a.getInt8(n++);if(i<0){t-=(s=-i)+1;for(var o=0;o<s;o++)r.push(a.getUint8(n++))}else{var s=i;t-=2;var l=a.getUint8(n++);for(o=0;o<s+1;o++)r.push(l)}}return r}function A(e,t,r){for(var n,a=1;a<64;)65280==(n=t[e.value])?a=64:n>>8==255?a+=255&n:(r[a]=n,a++),e.value++}function R(e,t){t[0]=K(e[0]),t[1]=K(e[1]),t[2]=K(e[5]),t[3]=K(e[6]),t[4]=K(e[14]),t[5]=K(e[15]),t[6]=K(e[27]),t[7]=K(e[28]),t[8]=K(e[2]),t[9]=K(e[4]),t[10]=K(e[7]),t[11]=K(e[13]),t[12]=K(e[16]),t[13]=K(e[26]),t[14]=K(e[29]),t[15]=K(e[42]),t[16]=K(e[3]),t[17]=K(e[8]),t[18]=K(e[12]),t[19]=K(e[17]),t[20]=K(e[25]),t[21]=K(e[30]),t[22]=K(e[41]),t[23]=K(e[43]),t[24]=K(e[9]),t[25]=K(e[11]),t[26]=K(e[18]),t[27]=K(e[24]),t[28]=K(e[31]),t[29]=K(e[40]),t[30]=K(e[44]),t[31]=K(e[53]),t[32]=K(e[10]),t[33]=K(e[19]),t[34]=K(e[23]),t[35]=K(e[32]),t[36]=K(e[39]),t[37]=K(e[45]),t[38]=K(e[52]),t[39]=K(e[54]),t[40]=K(e[20]),t[41]=K(e[22]),t[42]=K(e[33]),t[43]=K(e[38]),t[44]=K(e[46]),t[45]=K(e[51]),t[46]=K(e[55]),t[47]=K(e[60]),t[48]=K(e[21]),t[49]=K(e[34]),t[50]=K(e[37]),t[51]=K(e[47]),t[52]=K(e[50]),t[53]=K(e[56]),t[54]=K(e[59]),t[55]=K(e[61]),t[56]=K(e[35]),t[57]=K(e[36]),t[58]=K(e[48]),t[59]=K(e[49]),t[60]=K(e[57]),t[61]=K(e[58]),t[62]=K(e[62]),t[63]=K(e[63])}function I(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),s=.5*Math.cos(1.374445625);for(var l=new Array(4),u=new Array(4),c=new Array(4),f=new Array(4),d=0;d<8;++d){var h=8*d;l[0]=n*e[h+2],l[1]=o*e[h+2],l[2]=n*e[h+6],l[3]=o*e[h+6],u[0]=r*e[h+1]+a*e[h+3]+i*e[h+5]+s*e[h+7],u[1]=a*e[h+1]-s*e[h+3]-r*e[h+5]-i*e[h+7],u[2]=i*e[h+1]-r*e[h+3]+s*e[h+5]+a*e[h+7],u[3]=s*e[h+1]-i*e[h+3]+a*e[h+5]-r*e[h+7],c[0]=t*(e[h+0]+e[h+4]),c[3]=t*(e[h+0]-e[h+4]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],f[0]=c[0]+c[1],f[1]=c[3]+c[2],f[2]=c[3]-c[2],f[3]=c[0]-c[1],e[h+0]=f[0]+u[0],e[h+1]=f[1]+u[1],e[h+2]=f[2]+u[2],e[h+3]=f[3]+u[3],e[h+4]=f[3]-u[3],e[h+5]=f[2]-u[2],e[h+6]=f[1]-u[1],e[h+7]=f[0]-u[0]}for(var p=0;p<8;++p)l[0]=n*e[16+p],l[1]=o*e[16+p],l[2]=n*e[48+p],l[3]=o*e[48+p],u[0]=r*e[8+p]+a*e[24+p]+i*e[40+p]+s*e[56+p],u[1]=a*e[8+p]-s*e[24+p]-r*e[40+p]-i*e[56+p],u[2]=i*e[8+p]-r*e[24+p]+s*e[40+p]+a*e[56+p],u[3]=s*e[8+p]-i*e[24+p]+a*e[40+p]-r*e[56+p],c[0]=t*(e[p]+e[32+p]),c[3]=t*(e[p]-e[32+p]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],f[0]=c[0]+c[1],f[1]=c[3]+c[2],f[2]=c[3]-c[2],f[3]=c[0]-c[1],e[0+p]=f[0]+u[0],e[8+p]=f[1]+u[1],e[16+p]=f[2]+u[2],e[24+p]=f[3]+u[3],e[32+p]=f[3]-u[3],e[40+p]=f[2]-u[2],e[48+p]=f[1]-u[1],e[56+p]=f[0]-u[0]}function D(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],a=e[2][t];e[0][t]=r+1.5747*a,e[1][t]=r-.1873*n-.4682*a,e[2][t]=r+1.8556*n}}function P(e,t,r){for(var n=0;n<64;++n)t[r+n]=p.toHalfFloat(O(e[n]))}function O(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(i,Math.abs(e)-1)}function B(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function L(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(F(t)),n=new Uint8Array(r.length);return C(r),E(r,n),new DataView(n.buffer)}function G(e){var t=$e(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return C(t),E(t,r),new DataView(r.buffer)}function z(e){for(var r=e.viewer,n={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),o=0,s=new Array(e.channels),l=0;l<e.channels;l++)s[l]={},s[l].start=o,s[l].end=s[l].start,s[l].nx=e.width,s[l].ny=e.lines,s[l].size=e.type,o+=s[l].nx*s[l].ny*s[l].size;var u=Q(r,n),c=Q(r,n);if(c>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(u<=c)for(l=0;l<c-u+1;l++)i[l+u]=X(r,n);var f=new Uint16Array(t),d=function(e,r){for(var n=0,a=0;a<t;++a)(0==a||e[a>>3]&1<<(7&a))&&(r[n++]=a);for(var i=n-1;n<t;)r[n++]=0;return i}(i,f),h=H(r,n);M(e.array,r,n,h,a,o);for(l=0;l<e.channels;++l)for(var p=s[l],v=0;v<s[l].size;++v)T(a,p.start+v,p.nx,p.size,p.ny,p.nx*p.size,d);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(f,a,o);for(var g=0,m=new Uint8Array(a.buffer.byteLength),y=0;y<e.lines;y++)for(var b=0;b<e.channels;b++){var w=(p=s[b]).nx*p.size,x=new Uint8Array(a.buffer,2*p.end,2*w);m.set(x,g),g+=2*w,p.end+=w}return new DataView(m.buffer)}function j(e){var t=$e(e.array.slice(e.offset.value,e.offset.value+e.size));const r=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(r):new Uint32Array(r);let a=0,i=0;const o=new Array(4);for(let s=0;s<e.lines;s++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let a=0;a<e.width;++a){r+=t[o[0]++]<<8|t[o[1]++],n[i]=r,i++}break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let a=0;a<e.width;++a){r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,n[i]=r,i++}}}return new DataView(n.buffer)}function W(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:$(t,r),unknownUncompressedSize:$(t,r),unknownCompressedSize:$(t,r),acCompressedSize:$(t,r),dcCompressedSize:$(t,r),rleCompressedSize:$(t,r),rleUncompressedSize:$(t,r),rleRawSize:$(t,r),totalAcUncompressedCount:$(t,r),totalDcUncompressedCount:$(t,r),acCompression:$(t,r)};if(a.version<2)throw"EXRLoader.parse: "+ae.compression+" version "+a.version+" is unsupported";for(var i=new Array,o=Q(t,r)-2;o>0;){var s=N(t.buffer,r),l=X(t,r),u=l>>2&3,c=new Int8Array([(l>>4)-1])[0],f=X(t,r);i.push({name:s,index:c,type:f,compression:u}),o-=s.length+3}for(var d=ae.channels,h=new Array(e.channels),p=0;p<e.channels;++p){var v=h[p]={},g=d[p];v.name=g.name,v.compression=0,v.decoded=!1,v.type=g.pixelType,v.pLinear=g.pLinear,v.width=e.width,v.height=e.lines}for(var m={idx:new Array(3)},y=0;y<e.channels;++y)for(v=h[y],p=0;p<i.length;++p){var b=i[p];v.name==b.name&&(v.compression=b.compression,b.index>=0&&(m.idx[b.index]=y),v.offset=y)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var w=new Uint16Array(a.totalAcUncompressedCount);M(e.array,t,r,a.acCompressedSize,w,a.totalAcUncompressedCount);break;case 1:var x=$e(e.array.slice(r.value,r.value+a.totalAcUncompressedCount));w=new Uint16Array(x.buffer);r.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var S={array:e.array,offset:r,size:a.dcCompressedSize},U=new Uint16Array(G(S).buffer);r.value+=a.dcCompressedSize}if(a.rleRawSize>0){var _=F((x=$e(e.array.slice(r.value,r.value+a.rleCompressedSize))).buffer);r.value+=a.rleCompressedSize}var k=0,T=new Array(h.length);for(p=0;p<T.length;++p)T[p]=new Array;for(var C=0;C<e.lines;++C)for(var E=0;E<h.length;++E)T[E].push(k),k+=h[E].width*e.type*2;!function(e,t,r,n,a,i){var o=new DataView(i.buffer),s=r[e.idx[0]].width,l=r[e.idx[0]].height,u=Math.floor(s/8),c=Math.ceil(s/8),f=Math.ceil(l/8),d=s-8*(c-1),h=l-8*(f-1),p={value:0},v=new Array(3),g=new Array(3),m=new Array(3),y=new Array(3),b=new Array(3);for(let M=0;M<3;++M)b[M]=t[e.idx[M]],v[M]=M<1?0:v[M-1]+c*f,g[M]=new Float32Array(64),m[M]=new Uint16Array(64),y[M]=new Uint16Array(64*c);for(let M=0;M<f;++M){var w=8;M==f-1&&(w=h);var x=8;for(let e=0;e<c;++e){e==c-1&&(x=d);for(let e=0;e<3;++e)m[e].fill(0),m[e][0]=a[v[e]++],A(p,n,m[e]),R(m[e],g[e]),I(g[e]);D(g);for(let t=0;t<3;++t)P(g[t],y[t],64*e)}let t=0;for(let n=0;n<3;++n){const a=r[e.idx[n]].type;for(let e=8*M;e<8*M+w;++e){t=b[n][e];for(let r=0;r<u;++r){const i=64*r+8*(7&e);o.setUint16(t+0*a,y[n][i+0],!0),o.setUint16(t+2*a,y[n][i+1],!0),o.setUint16(t+4*a,y[n][i+2],!0),o.setUint16(t+6*a,y[n][i+3],!0),o.setUint16(t+8*a,y[n][i+4],!0),o.setUint16(t+10*a,y[n][i+5],!0),o.setUint16(t+12*a,y[n][i+6],!0),o.setUint16(t+14*a,y[n][i+7],!0),t+=16*a}}if(u!=c)for(let e=8*M;e<8*M+w;++e){const t=b[n][e]+8*u*2*a,r=64*u+8*(7&e);for(let e=0;e<x;++e)o.setUint16(t+2*e*a,y[n][r+e],!0)}}}for(var S=new Uint16Array(s),U=(o=new DataView(i.buffer),0);U<3;++U){r[e.idx[U]].decoded=!0;var _=r[e.idx[U]].type;if(2==r[U].type)for(var k=0;k<l;++k){const e=b[U][k];for(var T=0;T<s;++T)S[T]=o.getUint16(e+2*T*_,!0);for(T=0;T<s;++T)o.setFloat32(e+2*T*_,K(S[T]),!0)}}}(m,T,h,w,U,n);for(p=0;p<h.length;++p){if(!(v=h[p]).decoded){if(2!==v.compression)throw"EXRLoader.parse: unsupported channel compression";var O=0,B=0;for(C=0;C<e.lines;++C){for(var L=T[p][O],z=0;z<v.width;++z){for(var j=0;j<2*v.type;++j)n[L++]=_[B+j*v.width*v.height];B++}O++}}}return new DataView(n.buffer)}function N(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var a=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,a}function V(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function H(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function q(e,t){var r=e[t.value];return t.value=t.value+1,r}function X(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}const $=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function Y(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function Z(e,t){return p.toHalfFloat(Y(e,t))}function K(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function Q(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function J(e,t){return K(Q(e,t))}function ee(e,t,r,n,a){return"string"===n||"stringvector"===n||"iccProfile"===n?function(e,t,r){var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,n}(t,r,a):"chlist"===n?function(e,t,r,n){for(var a=r.value,i=[];r.value<a+n-1;){var o=N(t,r),s=V(e,r),l=X(e,r);r.value+=3;var u=V(e,r),c=V(e,r);i.push({name:o,pixelType:s,pLinear:l,xSampling:u,ySampling:c})}return r.value+=1,i}(e,t,r,a):"chromaticities"===n?function(e,t){return{redX:Y(e,t),redY:Y(e,t),greenX:Y(e,t),greenY:Y(e,t),blueX:Y(e,t),blueY:Y(e,t),whiteX:Y(e,t),whiteY:Y(e,t)}}(e,r):"compression"===n?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][X(e,t)]}(e,r):"box2i"===n?function(e,t){return{xMin:H(e,t),yMin:H(e,t),xMax:H(e,t),yMax:H(e,t)}}(e,r):"lineOrder"===n?function(e,t){return["INCREASING_Y"][X(e,t)]}(e,r):"float"===n?Y(e,r):"v2f"===n?function(e,t){return[Y(e,t),Y(e,t)]}(e,r):"v3f"===n?function(e,t){return[Y(e,t),Y(e,t),Y(e,t)]}(e,r):"int"===n?V(e,r):"rational"===n?function(e,t){return[V(e,t),H(e,t)]}(e,r):"timecode"===n?function(e,t){return[H(e,t),H(e,t)]}(e,r):"preview"===n?(r.value+=a,"skipped"):void(r.value+=a)}const te=new DataView(e),re=new Uint8Array(e),ne={value:0},ae=function(e,t,r){const n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);const a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},r.value=8;for(var i=!0;i;){var o=N(t,r);if(0==o)i=!1;else{var s=ee(e,t,r,N(t,r),H(e,r));void 0===s||(n[o]=s)}}if(-5&a)throw"THREE.EXRLoader: provided file is currently unsupported.";return n}(te,e,ne),ie=function(e,t,r,n,a){const i={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[tt?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=B;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=L;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=G;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=G;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=z;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=j;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=W;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=W;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(a){case h:i.getter=J,i.inputSize=2;break;case d:i.getter=Q,i.inputSize=2}else{if(2!=i.type)throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";switch(a){case h:i.getter=Y,i.inputSize=4;break;case d:i.getter=Z,i.inputSize=4}}i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var o=0;o<i.blockCount;o++)$(t,n);i.outputChannels=3==i.channels?4:i.channels;const s=i.width*i.height*i.outputChannels;switch(a){case h:i.byteArray=new Float32Array(s),i.channels<i.outputChannels&&i.byteArray.fill(1,0,s);break;case d:i.byteArray=new Uint16Array(s),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,s)}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?i.format=g:i.format=m,tt?i.colorSpace="srgb-linear":i.encoding=3e3,i}(ae,te,re,ne,this.type),oe={value:0},se={R:0,G:1,B:2,A:3,Y:0};for(let d=0;d<ie.height/ie.scanlineBlockSize;d++){const e=H(te,ne);ie.size=H(te,ne),ie.lines=e+ie.scanlineBlockSize>ie.height?ie.height-e:ie.scanlineBlockSize;const t=ie.size<ie.lines*ie.bytesPerLine?ie.uncompress(ie):B(ie);ne.value+=ie.size;for(let r=0;r<ie.scanlineBlockSize;r++){const e=r+d*ie.scanlineBlockSize;if(e>=ie.height)break;for(let n=0;n<ie.channels;n++){const a=se[ae.channels[n].name];for(let i=0;i<ie.width;i++){oe.value=(r*(ie.channels*ie.width)+n*ie.width+i)*ie.inputSize;const o=(ie.height-1-e)*(ie.width*ie.outputChannels)+i*ie.outputChannels+a;ie.byteArray[o]=ie.getter(t,oe)}}}}return{header:ae,width:ie.width,height:ie.height,data:ie.byteArray,format:ie.format,[tt?"colorSpace":"encoding"]:ie[tt?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,(function(e,r){tt?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=v,e.magFilter=v,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)}),r,n)}}function nt(){var e=Object.create(null);function t(n,a){var i=n.id,o=n.name,s=n.dependencies;void 0===s&&(s=[]);var l=n.init;void 0===l&&(l=function(){});var u=n.getTransferables;if(void 0===u&&(u=null),!e[i])try{s=s.map((function(r){return r&&r.isWorkerModule&&(t(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),l=r("<"+o+">.init",l),u&&(u=r("<"+o+">.getTransferables",u));var c=null;"function"==typeof l&&(c=l.apply(void 0,s)),e[i]={id:i,value:c,getTransferables:u},a(c)}catch(f){!f||f.noLog,a(f)}}function r(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(a){}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var n=r.data,a=n.messageId,i=n.action,o=n.data;try{"registerModule"===i&&t(o,(function(e){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===i&&function(t,r){var n,a=t.id,i=t.args;e[a]&&"function"==typeof e[a].value||r(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var o=(n=e[a]).value.apply(n,i);o&&"function"==typeof o.then?o.then(s,(function(e){return r(e instanceof Error?e:new Error(""+e))})):s(o)}catch(l){r(l)}function s(t){try{var n=e[a].getTransferables&&e[a].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(l){r(l)}}}(o,(function(e,t){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:e},t||void 0)}))}catch(s){postMessage({messageId:a,success:!1,error:s.stack})}}))}var at=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){}return at=function(){return e},e},it=0,ot=0,st=!1,lt=Object.create(null),ut=Object.create(null),ct=Object.create(null);function ft(e){if(!(e&&"function"==typeof e.init||st))throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,n=e.getTransferables,a=e.workerId,i=function(e){var t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then((function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var r=e.dependencies,n=e.init;r=Array.isArray(r)?r.map((function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e})):[];var a=Promise.all(r).then((function(e){return n.apply(null,e)}));return t._getInitResult=function(){return a},a},t}(e);null==a&&(a="#default");var o="workerModule"+ ++it,s=e.name||o,l=null;function u(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!at())return i.apply(void 0,e);if(!l){l=ht(a,"registerModule",u.workerModuleData);var r=function(){l=null,ut[a].delete(r)};(ut[a]||(ut[a]=new Set)).add(r)}return l.then((function(t){if(t.isCallable)return ht(a,"callModule",{id:o,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!=typeof e||e.workerModuleData||(st=!0,e=ft({workerId:a,name:"<"+s+"> function dependency: "+e.name,init:"function(){return (\n"+dt(e)+"\n)}"}),st=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),u.workerModuleData={isWorkerModule:!0,id:o,name:s,dependencies:t,init:dt(r),getTransferables:n&&dt(n)},u.onMainThread=i,u}function dt(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function ht(e,t,r){return new Promise((function(n,a){var i=++ot;ct[i]=function(e){e.success?n(e.result):a(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=lt[e];if(!t){var r=dt(nt);(t=lt[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=ct[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete ct[r],n(t)}}return t}(e).postMessage({messageId:i,action:t,data:r})}))}function pt(){var e=function(e){function t(e,t,r,n,a,i,o,s,l,u){var c=1-l;u.x=c*c*c*e+3*c*c*l*r+3*c*l*l*a+l*l*l*o,u.y=c*c*c*t+3*c*c*l*n+3*c*l*l*i+l*l*l*s}function r(e,t){for(var r,n,a,i,o,s=/([MLQCZ])([^MLQCZ]*)/g;r=s.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(r[1]){case"M":i=n=l[0],o=a=l[1];break;case"L":l[0]===i&&l[1]===o||t("L",i,o,i=l[0],o=l[1]);break;case"Q":t("Q",i,o,i=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",i,o,i=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":i===n&&o===a||t("L",i,o,n,a)}}}function n(e,n,a){void 0===a&&(a=16);var i={x:0,y:0};r(e,(function(e,r,o,s,l,u,c,f,d){switch(e){case"L":n(r,o,s,l);break;case"Q":for(var h=r,p=o,v=1;v<a;v++)b=o,w=c,x=l,_=void 0,_=1-(S=v/(a-1)),(U=i).x=_*_*r+2*_*S*u+S*S*s,U.y=_*_*b+2*_*S*w+S*S*x,n(h,p,i.x,i.y),h=i.x,p=i.y;break;case"C":for(var g=r,m=o,y=1;y<a;y++)t(r,o,u,c,f,d,s,l,y/(a-1),i),n(g,m,i.x,i.y),g=i.x,m=i.y}var b,w,x,S,U,_}))}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(e,t){var r=e.getContext?e.getContext("webgl",o):e,n=i.get(r);if(!n){let e=function(e){var t=s[e];if(!t&&!(t=s[e]=r.getExtension(e)))throw new Error(e+" not supported");return t},t=function(e,t){var n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n},o=function(n,i,o,s){if(!l[n]){var u={},c={},f=r.createProgram();r.attachShader(f,t(i,r.VERTEX_SHADER)),r.attachShader(f,t(o,r.FRAGMENT_SHADER)),r.linkProgram(f),l[n]={program:f,transaction:function(t){r.useProgram(f),t({setUniform:function(e,t){for(var n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];var i=c[t]||(c[t]=r.getUniformLocation(f,t));r["uniform"+e].apply(r,[i].concat(n))},setAttribute:function(t,n,i,o,s){var l=u[t];l||(l=u[t]={buf:r.createBuffer(),loc:r.getAttribLocation(f,t),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,n,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),a?r.vertexAttribDivisor(l.loc,o):e("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),s!==l.data&&(r.bufferData(r.ARRAY_BUFFER,s,i),l.data=s)}})}}}l[n].transaction(s)},d=function(e,t){c++;try{r.activeTexture(r.TEXTURE0+c);var n=u[e];n||(n=u[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,n),t(n,c)}finally{c--}},h=function(e,t,n){var a=r.createFramebuffer();f.push(a),r.bindFramebuffer(r.FRAMEBUFFER,a),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{n(a)}finally{r.deleteFramebuffer(a),r.bindFramebuffer(r.FRAMEBUFFER,f[--f.length-1]||null)}},p=function(){s={},l={},u={},c=-1,f.length=0};var a="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,s={},l={},u={},c=-1,f=[];r.canvas.addEventListener("webglcontextlost",(function(e){p(),e.preventDefault()}),!1),i.set(r,n={gl:r,isWebGL2:a,getExtension:e,withProgram:o,withTexture:d,withTextureFramebuffer:h,handleContextLoss:p})}t(n)}function l(e,t,r,n,i,o,l,u){void 0===l&&(l=15),void 0===u&&(u=null),s(e,(function(e){var s=e.gl,c=e.withProgram;(0,e.withTexture)("copy",(function(e,f){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i,o,0,s.RGBA,s.UNSIGNED_BYTE,t),c("copy",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",(function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,s.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",f),s.bindFramebuffer(s.FRAMEBUFFER,u||null),s.disable(s.BLEND),s.colorMask(8&l,4&l,2&l,1&l),s.viewport(r,n,i,o),s.scissor(r,n,i,o),s.drawArrays(s.TRIANGLES,0,3)}))}))}))}var u=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:l,resizeWebGLCanvasWithoutClearing:function(e,t,r){var n=e.width,a=e.height;s(e,(function(i){var o=i.gl,s=new Uint8Array(n*a*4);o.readPixels(0,0,n,a,o.RGBA,o.UNSIGNED_BYTE,s),e.width=t,e.height=r,l(o,s,0,0,n,a)}))}});function c(e,t,r,a,i,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=a[2]-a[0],u=a[3]-a[1],c=[];n(r,(function(e,t,r,n){c.push({x1:e,y1:t,x2:r,y2:n,minX:Math.min(e,r),minY:Math.min(t,n),maxX:Math.max(e,r),maxY:Math.max(t,n)})})),c.sort((function(e,t){return e.maxX-t.maxX}));for(var f=0;f<e;f++)for(var d=0;d<t;d++){var p=g(a[0]+l*(f+.5)/e,a[1]+u*(d+.5)/t),v=Math.pow(1-Math.abs(p)/i,o)/2;p<0&&(v=1-v),v=Math.max(0,Math.min(255,Math.round(255*v))),s[d*e+f]=v}return s;function g(e,t){for(var r=1/0,n=1/0,a=c.length;a--;){var i=c[a];if(i.maxX+n<=e)break;if(e+n>i.minX&&t-n<i.maxY&&t+n>i.minY){var o=h(e,t,i.x1,i.y1,i.x2,i.y2);o<r&&(r=o,n=Math.sqrt(r))}}return function(e,t){for(var r=0,n=c.length;n--;){var a=c[n];if(a.maxX<=e)break;a.y1>t!=a.y2>t&&e<(a.x2-a.x1)*(t-a.y1)/(a.y2-a.y1)+a.x1&&(r+=a.y1<a.y2?1:-1)}return 0!==r}(e,t)&&(n=-n),n}}function f(e,t,r,n,a,i,o,s,l,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),d(e,t,r,n,a,i,o,null,s,l,u)}function d(e,t,r,n,a,i,o,s,u,f,d){void 0===i&&(i=1),void 0===u&&(u=0),void 0===f&&(f=0),void 0===d&&(d=0);for(var h=c(e,t,r,n,a,i),p=new Uint8Array(4*h.length),v=0;v<h.length;v++)p[4*v+d]=h[v];l(o,p,u,f,e,t,1<<3-d,s)}function h(e,t,r,n,a,i){var o=a-r,s=i-n,l=o*o+s*s,u=l?Math.max(0,Math.min(1,((e-r)*o+(t-n)*s)/l)):0,c=e-(r+u*o),f=t-(n+u*s);return c*c+f*f}var p=Object.freeze({__proto__:null,generate:c,generateIntoCanvas:f,generateIntoFramebuffer:d}),v=new Float32Array([0,0,2,0,0,2]),g=null,m=!1,y={},b=new WeakMap;function w(e){if(!m&&!_(e))throw new Error("WebGL generation not supported")}function x(e,t,r,n,a,i,o){if(void 0===i&&(i=1),void 0===o&&(o=null),!o&&!(o=g)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw new Error("OffscreenCanvas or DOM canvas not supported");o=g=l.getContext("webgl",{depth:!1})}w(o);var u=new Uint8Array(e*t*4);s(o,(function(o){var s=o.gl,l=o.withTexture,c=o.withTextureFramebuffer;l("readable",(function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),c(o,l,(function(o){U(e,t,r,n,a,i,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,u)}))}))}));for(var c=new Uint8Array(e*t),f=0,d=0;f<u.length;f+=4)c[d++]=u[f];return c}function S(e,t,r,n,a,i,o,s,l,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),U(e,t,r,n,a,i,o,null,s,l,u)}function U(e,t,r,i,o,l,u,c,f,d,h){void 0===l&&(l=1),void 0===f&&(f=0),void 0===d&&(d=0),void 0===h&&(h=0),w(u);var p=[];n(r,(function(e,t,r,n){p.push(e,t,r,n)})),p=new Float32Array(p),s(u,(function(r){var n=r.gl,s=r.isWebGL2,u=r.getExtension,g=r.withProgram,m=r.withTexture,y=r.withTextureFramebuffer,b=r.handleContextLoss;if(m("rawDistances",(function(r,m){e===r._lastWidth&&t===r._lastHeight||n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r._lastWidth=e,r._lastHeight=t,0,n.RGBA,n.UNSIGNED_BYTE,null),g("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",(function(a){var c=a.setAttribute,f=a.setUniform,d=!s&&u("ANGLE_instanced_arrays"),h=!s&&u("EXT_blend_minmax");c("aUV",2,n.STATIC_DRAW,0,v),c("aLineSegment",4,n.DYNAMIC_DRAW,1,p),f.apply(void 0,["4f","uGlyphBounds"].concat(i)),f("1f","uMaxDistance",o),f("1f","uExponent",l),y(r,m,(function(r){n.enable(n.BLEND),n.colorMask(!0,!0,!0,!0),n.viewport(0,0,e,t),n.scissor(0,0,e,t),n.blendFunc(n.ONE,n.ONE),n.blendEquationSeparate(n.FUNC_ADD,s?n.MAX:h.MAX_EXT),n.clear(n.COLOR_BUFFER_BIT),s?n.drawArraysInstanced(n.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(n.TRIANGLES,0,3,p.length/4)}))})),g("post",a,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",(function(r){r.setAttribute("aUV",2,n.STATIC_DRAW,0,v),r.setUniform("1i","tex",m),n.bindFramebuffer(n.FRAMEBUFFER,c),n.disable(n.BLEND),n.colorMask(0===h,1===h,2===h,3===h),n.viewport(f,d,e,t),n.scissor(f,d,e,t),n.drawArrays(n.TRIANGLES,0,3)}))})),n.isContextLost())throw b(),new Error("webgl context lost")}))}function _(e){var t=e&&e!==g?e.canvas||e:y,r=b.get(t);if(void 0===r){m=!0;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=x(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);r=a&&n.length===a.length&&a.every((function(e,t){return e===n[t]})),r||"bad trial run results"}catch(i){r=!1,i.message}m=!1,b.set(t,r)}return r}var k=Object.freeze({__proto__:null,generate:x,generateIntoCanvas:S,generateIntoFramebuffer:U,isSupported:_});return e.forEachPathCommand=r,e.generate=function(e,t,r,n,a,i){void 0===a&&(a=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===i&&(i=1);try{return x.apply(k,arguments)}catch(Kr){return c.apply(p,arguments)}},e.generateIntoCanvas=function(e,t,r,n,a,i,o,s,l,u){void 0===a&&(a=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0);try{return S.apply(k,arguments)}catch(Kr){return f.apply(p,arguments)}},e.javascript=p,e.pathToLineSegments=n,e.webgl=k,e.webglUtils=u,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const vt=/\bvoid\s+main\s*\(\s*\)\s*{/g;function gt(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let r=x[t];return r?gt(r):e}))}const mt=[];for(let Qr=0;Qr<256;Qr++)mt[Qr]=(Qr<16?"0":"")+Qr.toString(16);const yt=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},bt=Date.now(),wt=new WeakMap,xt=new Map;let St=1e10;function Ut(e,t){const r=function(e){const t=JSON.stringify(e,kt);let r=Mt.get(t);null==r&&Mt.set(t,r=++Tt);return r}
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/(t);let n=wt.get(e);if(n||wt.set(e,n=Object.create(null)),n[r])return new n[r];const a=`_onBeforeCompile${r}`,i=function(n,i){e.onBeforeCompile.call(this,n,i);const o=this.customProgramCacheKey()+"|"+n.vertexShader+"|"+n.fragmentShader;let s=xt[o];if(!s){const e=function(e,{vertexShader:t,fragmentShader:r},n,a){let{vertexDefs:i,vertexMainIntro:o,vertexMainOutro:s,vertexTransform:l,fragmentDefs:u,fragmentMainIntro:c,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:p}=n;i=i||"",o=o||"",s=s||"",u=u||"",c=c||"",f=f||"",(l||h)&&(t=gt(t));(d||h)&&(r=gt(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(h){let e=h({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(d){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(t=>(e.push(t),""))),f=`${d}\n${e.join("\n")}\n${f}`}if(p){const e=`\nuniform float ${p};\n`;i=e+i,u=e+u}l&&(i=`${i}\nvoid troikaVertexTransform${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,o=`\ntroika_position_${a} = vec3(position);\ntroika_normal_${a} = vec3(normal);\ntroika_uv_${a} = vec2(uv);\ntroikaVertexTransform${a}(troika_position_${a}, troika_normal_${a}, troika_uv_${a});\n${o}\n`,t=(t=`vec3 troika_position_${a};\nvec3 troika_normal_${a};\nvec2 troika_uv_${a};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,((e,t,r,n)=>/\battribute\s+vec[23]\s+$/.test(n.substr(0,r))?t:`troika_${t}_${a}`)),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${a}`)));return t=_t(t,a,i,o,s),r=_t(r,a,u,c,f),{vertexShader:t,fragmentShader:r}}(this,n,t,r);s=xt[o]=e}n.vertexShader=s.vertexShader,n.fragmentShader=s.fragmentShader,yt(n.uniforms,this.uniforms),t.timeUniform&&(n.uniforms[t.timeUniform]={get value(){return Date.now()-bt}}),this[a]&&this[a](n)},s=function(){return l(t.chained?e:e.clone())},l=function(n){const a=Object.create(n,u);return Object.defineProperty(a,"baseMaterial",{value:e}),Object.defineProperty(a,"id",{value:St++}),a.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(mt[255&e]+mt[e>>8&255]+mt[e>>16&255]+mt[e>>24&255]+"-"+mt[255&t]+mt[t>>8&255]+"-"+mt[t>>16&15|64]+mt[t>>24&255]+"-"+mt[63&r|128]+mt[r>>8&255]+"-"+mt[r>>16&255]+mt[r>>24&255]+mt[255&n]+mt[n>>8&255]+mt[n>>16&255]+mt[n>>24&255]).toUpperCase()}(),a.uniforms=yt({},n.uniforms,t.uniforms),a.defines=yt({},n.defines,t.defines),a.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",a.extensions=yt({},n.extensions,t.extensions),a._listeners=void 0,a},u={constructor:{value:s},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){const t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+r}},onBeforeCompile:{get:()=>i,set(e){this[a]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(yt(this.extensions,t.extensions),yt(this.defines,t.defines),yt(this.uniforms,o.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return l(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let r=this._depthMaterial;return r||(r=this._depthMaterial=Ut(e.isDerivedMaterial?e.getDepthMaterial():new b({depthPacking:w}),t),r.defines.IS_DEPTH_MATERIAL="",r.uniforms=this.uniforms),r}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let r=this._distanceMaterial;return r||(r=this._distanceMaterial=Ut(e.isDerivedMaterial?e.getDistanceMaterial():new y,t),r.defines.IS_DISTANCE_MATERIAL="",r.uniforms=this.uniforms),r}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}};return n[r]=s,new s}function _t(e,t,r,n,a){return(n||a||r)&&(e=e.replace(vt,`\n${r}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${n}\n  troikaOrigMain${t}();\n  ${a}\n}`),e}function kt(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let Tt=0;const Mt=new Map;const Ct=ft({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var a=4;r.readUshort(n,a),a+=2,r.readUshort(n,a),a+=2;var i=r.readUint(n,a);a+=4;for(var o=[],s=0;s<i;s++){var l=r.readUint(n,a);a+=4,o.push(t._readFont(n,l))}return o}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,a=r;n.readFixed(e,r),r+=4;var i=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:e,_offset:a},l={},u=0;u<i;u++){var c=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var f=n.readUint(e,r);r+=4;var d=n.readUint(e,r);r+=4,l[c]={offset:f,length:d}}for(u=0;u<o.length;u++){var h=o[u];l[h]&&(s[h.trim()]=t[h.trim()].parse(e,l[h].offset,l[h].length,s))}return s},_tabOffset:function(e,r,n){for(var a=t._bin,i=a.readUshort(e,n+4),o=n+12,s=0;s<i;s++){var l=a.readASCII(e,o,4);o+=4,a.readUint(e,o),o+=4;var u=a.readUint(e,o);if(o+=4,a.readUint(e,o),o+=4,l==r)return u}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,n){for(var a=[],i=0;i<n;i++)a.push(t._bin.readUshort(e,r+2*i));return a},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n},readUnicode:function(e,t,r){for(var n="",a=0;a<r;a++){var i=e[t++]<<8|e[t++];n+=String.fromCharCode(i)}return n},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,n){var a=t._bin._tdec;return a&&0==r&&n==e.length?a.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(e[t+a]);return n},readASCIIArray:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(String.fromCharCode(e[t+a]));return n},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,n,a,i){var o=t._bin,s={},l=r;o.readFixed(e,r),r+=4;var u=o.readUshort(e,r);r+=2;var c=o.readUshort(e,r);r+=2;var f=o.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+u),s.featureList=t._lctf.readFeatureList(e,l+c),s.lookupList=t._lctf.readLookupList(e,l+f,i),s},t._lctf.readLookupList=function(e,r,n){var a=t._bin,i=r,o=[],s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=a.readUshort(e,r);r+=2;var c=t._lctf.readLookupTable(e,i+u,n);o.push(c)}return o},t._lctf.readLookupTable=function(e,r,n){var a=t._bin,i=r,o={tabs:[]};o.ltype=a.readUshort(e,r),r+=2,o.flag=a.readUshort(e,r),r+=2;var s=a.readUshort(e,r);r+=2;for(var l=o.ltype,u=0;u<s;u++){var c=a.readUshort(e,r);r+=2;var f=n(e,l,i+c,o);o.tabs.push(f)}return o},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)e>>>r&1&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,a=[],i=n.readUshort(e,r);if(r+=2,1==i){var o=n.readUshort(e,r);r+=2;var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++)a.push(o+l),a.push(o+l),a.push(n.readUshort(e,r)),r+=2}if(2==i){var u=n.readUshort(e,r);for(r+=2,l=0;l<u;l++)a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2}return a},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],a=e[r+1];if(e[r+2],n<=t&&t<=a)return r}return-1},t._lctf.readCoverage=function(e,r){var n=t._bin,a={};a.fmt=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);return r+=2,1==a.fmt&&(a.tab=n.readUshorts(e,r,i)),2==a.fmt&&(a.tab=n.readUshorts(e,r,3*i)),a},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var a=t._lctf.getInterval(n,r);if(-1!=a)return n[a+2]+(r-n[a])}return-1},t._lctf.readFeatureList=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2;var c=t._lctf.readFeatureTable(e,a+u);c.tag=l.trim(),i.push(c)}return i},t._lctf.readFeatureTable=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2,o>0&&(i.featureParams=a+o);var s=n.readUshort(e,r);r+=2,i.tab=[];for(var l=0;l<s;l++)i.tab.push(n.readUshort(e,r+2*l));return i},t._lctf.readScriptList=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2,i[l.trim()]=t._lctf.readScriptTable(e,a+u)}return i},t._lctf.readScriptTable=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2,o>0&&(i.default=t._lctf.readLangSysTable(e,a+o));var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var u=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2,i[u.trim()]=t._lctf.readLangSysTable(e,a+c)}return i},t._lctf.readLangSysTable=function(e,r){var n=t._bin,a={};n.readUshort(e,r),r+=2,a.reqFeature=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);return r+=2,a.features=n.readUshorts(e,r,i),a},t.CFF={},t.CFF.parse=function(e,r,n){var a=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var i=[];r=t.CFF.readIndex(e,r,i);for(var o=[],s=0;s<i.length-1;s++)o.push(a.readASCII(e,r+i[s],i[s+1]-i[s]));r+=i[i.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var u=[];for(s=0;s<l.length-1;s++)u.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var c=u[0],f=[];r=t.CFF.readIndex(e,r,f);var d=[];for(s=0;s<f.length-1;s++)d.push(a.readASCII(e,r+f[s],f[s+1]-f[s]));if(r+=f[f.length-1],t.CFF.readSubrs(e,r,c),c.CharStrings){r=c.CharStrings,f=[],r=t.CFF.readIndex(e,r,f);var h=[];for(s=0;s<f.length-1;s++)h.push(a.readBytes(e,r+f[s],f[s+1]-f[s]));c.CharStrings=h}if(c.ROS){r=c.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),c.FDArray=[],s=0;s<p.length-1;s++){var v=t.CFF.readDict(e,r+p[s],r+p[s+1]);t.CFF._readFDict(e,v,d),c.FDArray.push(v)}r+=p[p.length-1],r=c.FDSelect,c.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var m=a.readUshort(e,r);for(r+=2,s=0;s<m+1;s++)c.FDSelect.push(a.readUshort(e,r),e[r+2]),r+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(e,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(e,c.charset,c.CharStrings.length)),t.CFF._readFDict(e,c,d),c},t.CFF._readFDict=function(e,r,n){var a;for(var i in r.Private&&(a=r.Private[1],r.Private=t.CFF.readDict(e,a,a+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,a+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(i)&&(r[i]=n[r[i]-426+35])},t.CFF.readSubrs=function(e,r,n){var a=t._bin,i=[];r=t.CFF.readIndex(e,r,i);var o,s=i.length;o=s<1240?107:s<33900?1131:32768,n.Bias=o,n.Subrs=[];for(var l=0;l<i.length-1;l++)n.Subrs.push(a.readBytes(e,r+i[l],i[l+1]-i[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var a=[".notdef"],i=e[r];if(r++,0!=i)throw"error: unknown encoding format: "+i;var o=e[r];r++;for(var s=0;s<o;s++)a.push(e[r+s]);return a},t.CFF.readCharset=function(e,r,n){var a=t._bin,i=[".notdef"],o=e[r];if(r++,0==o)for(var s=0;s<n;s++){var l=a.readUshort(e,r);r+=2,i.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;i.length<n;){l=a.readUshort(e,r),r+=2;var u=0;for(1==o?(u=e[r],r++):(u=a.readUshort(e,r),r+=2),s=0;s<=u;s++)i.push(l),l++}}return i},t.CFF.readIndex=function(e,r,n){var a=t._bin,i=a.readUshort(e,r)+1,o=e[r+=2];if(r++,1==o)for(var s=0;s<i;s++)n.push(e[r+s]);else if(2==o)for(s=0;s<i;s++)n.push(a.readUshort(e,r+2*s));else if(3==o)for(s=0;s<i;s++)n.push(16777215&a.readUint(e,r+3*s-1));else if(1!=i)throw"unsupported offset size: "+o+", count: "+i;return(r+=i*o)-1},t.CFF.getCharString=function(e,r,n){var a=t._bin,i=e[r],o=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,u=null;i<=20&&(l=i,s=1),12==i&&(l=100*i+o,s=2),21<=i&&i<=27&&(l=i,s=1),28==i&&(u=a.readShort(e,r+1),s=3),29<=i&&i<=31&&(l=i,s=1),32<=i&&i<=246&&(u=i-139,s=1),247<=i&&i<=250&&(u=256*(i-247)+o+108,s=2),251<=i&&i<=254&&(u=256*-(i-251)-o-108,s=2),255==i&&(u=a.readInt(e,r+1)/65535,s=5),n.val=null!=u?u:"o"+l,n.size=s},t.CFF.readCharString=function(e,r,n){for(var a=r+n,i=t._bin,o=[];r<a;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,c=null,f=null;s<=20&&(c=s,u=1),12==s&&(c=100*s+l,u=2),19!=s&&20!=s||(c=s,u=2),21<=s&&s<=27&&(c=s,u=1),28==s&&(f=i.readShort(e,r+1),u=3),29<=s&&s<=31&&(c=s,u=1),32<=s&&s<=246&&(f=s-139,u=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,u=2),255==s&&(f=i.readInt(e,r+1)/65535,u=5),o.push(null!=f?f:"o"+c),r+=u}return o},t.CFF.readDict=function(e,r,n){for(var a=t._bin,i={},o=[];r<n;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,c=null,f=null;if(28==s&&(f=a.readShort(e,r+1),u=3),29==s&&(f=a.readInt(e,r+1),u=5),32<=s&&s<=246&&(f=s-139,u=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,u=2),255==s)throw f=a.readInt(e,r+1)/65535,u=5,"unknown number";if(30==s){var d=[];for(u=1;;){var h=e[r+u];u++;var p=h>>4,v=15&h;if(15!=p&&d.push(p),15!=v&&d.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)g+=m[d[y]];f=parseFloat(g)}s<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,12==s&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),null!=c?(i[c]=1==o.length?o[0]:o,o=[]):o.push(f),r+=u}return i},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var a=t._bin,i={};a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2;var s=[];i.tables=[];for(var l=0;l<o;l++){var u=a.readUshort(e,r);r+=2;var c=a.readUshort(e,r);r+=2;var f=a.readUint(e,r);r+=4;var d="p"+u+"e"+c,h=s.indexOf(f);if(-1==h){var p;h=i.tables.length,s.push(f);var v=a.readUshort(e,f);0==v?p=t.cmap.parse0(e,f):4==v?p=t.cmap.parse4(e,f):6==v?p=t.cmap.parse6(e,f):12==v&&(p=t.cmap.parse12(e,f)),i.tables.push(p)}if(null!=i[d])throw"multiple tables for one platform+encoding";i[d]=h}return i},t.cmap.parse0=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,a.map=[];for(var o=0;o<i-6;o++)a.map.push(e[r+o]);return a},t.cmap.parse4=function(e,r){var n=t._bin,a=r,i={};i.format=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;var l=s/2;i.searchRange=n.readUshort(e,r),r+=2,i.entrySelector=n.readUshort(e,r),r+=2,i.rangeShift=n.readUshort(e,r),r+=2,i.endCount=n.readUshorts(e,r,l),r+=2*l,r+=2,i.startCount=n.readUshorts(e,r,l),r+=2*l,i.idDelta=[];for(var u=0;u<l;u++)i.idDelta.push(n.readShort(e,r)),r+=2;for(i.idRangeOffset=n.readUshorts(e,r,l),r+=2*l,i.glyphIdArray=[];r<a+o;)i.glyphIdArray.push(n.readUshort(e,r)),r+=2;return i},t.cmap.parse6=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,a.firstCode=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2,a.glyphIdArray=[];for(var o=0;o<i;o++)a.glyphIdArray.push(n.readUshort(e,r)),r+=2;return a},t.cmap.parse12=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,r+=2,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var i=n.readUint(e,r);r+=4,a.groups=[];for(var o=0;o<i;o++){var s=r+12*o,l=n.readUint(e,s+0),u=n.readUint(e,s+4),c=n.readUint(e,s+8);a.groups.push([l,u,c])}return a},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var a=[],i=0;i<n.maxp.numGlyphs;i++)a.push(null);return a},t.glyf._parseGlyf=function(e,r){var n=t._bin,a=e._data,i=t._tabOffset(a,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var o={};if(o.noc=n.readShort(a,i),i+=2,o.xMin=n.readShort(a,i),i+=2,o.yMin=n.readShort(a,i),i+=2,o.xMax=n.readShort(a,i),i+=2,o.yMax=n.readShort(a,i),i+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(n.readUshort(a,i)),i+=2;var l=n.readUshort(a,i);if(i+=2,a.length-i<l)return null;o.instructions=n.readBytes(a,i,l),i+=l;var u=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<u;s++){var c=a[i];if(i++,o.flags.push(c),8&c){var f=a[i];i++;for(var d=0;d<f;d++)o.flags.push(c),s++}}for(o.xs=[],s=0;s<u;s++){var h=!!(2&o.flags[s]),p=!!(16&o.flags[s]);h?(o.xs.push(p?a[i]:-a[i]),i++):p?o.xs.push(0):(o.xs.push(n.readShort(a,i)),i+=2)}for(o.ys=[],s=0;s<u;s++)h=!!(4&o.flags[s]),p=!!(32&o.flags[s]),h?(o.ys.push(p?a[i]:-a[i]),i++):p?o.ys.push(0):(o.ys.push(n.readShort(a,i)),i+=2);var v=0,g=0;for(s=0;s<u;s++)v+=o.xs[s],g+=o.ys[s],o.xs[s]=v,o.ys[s]=g}else{var m;o.parts=[];do{m=n.readUshort(a,i),i+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(y),y.glyphIndex=n.readUshort(a,i),i+=2,1&m){var b=n.readShort(a,i);i+=2;var w=n.readShort(a,i);i+=2}else b=n.readInt8(a,i),i++,w=n.readInt8(a,i),i++;2&m?(y.m.tx=b,y.m.ty=w):(y.p1=b,y.p2=w),8&m?(y.m.a=y.m.d=n.readF2dot14(a,i),i+=2):64&m?(y.m.a=n.readF2dot14(a,i),i+=2,y.m.d=n.readF2dot14(a,i),i+=2):128&m&&(y.m.a=n.readF2dot14(a,i),i+=2,y.m.b=n.readF2dot14(a,i),i+=2,y.m.c=n.readF2dot14(a,i),i+=2,y.m.d=n.readF2dot14(a,i),i+=2)}while(32&m);if(256&m){var x=n.readUshort(a,i);for(i+=2,o.instr=[],s=0;s<x;s++)o.instr.push(a[i]),i++}}return o},t.GDEF={},t.GDEF.parse=function(e,r,n,a){var i=r;r+=4;var o=t._bin.readUshort(e,r);return{glyphClassDef:0===o?null:t._lctf.readClassDef(e,i+o)}},t.GPOS={},t.GPOS.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GPOS.subt)},t.GPOS.subt=function(e,r,n,a){var i=t._bin,o=n,s={};if(s.fmt=i.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&s.fmt<=2){var l=i.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,l+o)}if(1==r&&1==s.fmt){var u=i.readUshort(e,n);n+=2,0!=u&&(s.pos=t.GPOS.readValueRecord(e,n,u))}else if(2==r&&s.fmt>=1&&s.fmt<=2){u=i.readUshort(e,n),n+=2;var c=i.readUshort(e,n);n+=2;var f=t._lctf.numOfOnes(u),d=t._lctf.numOfOnes(c);if(1==s.fmt){s.pairsets=[];var h=i.readUshort(e,n);n+=2;for(var p=0;p<h;p++){var v=o+i.readUshort(e,n);n+=2;var g=i.readUshort(e,v);v+=2;for(var m=[],y=0;y<g;y++){var b=i.readUshort(e,v);v+=2,0!=u&&(k=t.GPOS.readValueRecord(e,v,u),v+=2*f),0!=c&&(T=t.GPOS.readValueRecord(e,v,c),v+=2*d),m.push({gid2:b,val1:k,val2:T})}s.pairsets.push(m)}}if(2==s.fmt){var w=i.readUshort(e,n);n+=2;var x=i.readUshort(e,n);n+=2;var S=i.readUshort(e,n);n+=2;var U=i.readUshort(e,n);for(n+=2,s.classDef1=t._lctf.readClassDef(e,o+w),s.classDef2=t._lctf.readClassDef(e,o+x),s.matrix=[],p=0;p<S;p++){var _=[];for(y=0;y<U;y++){var k=null,T=null;0!=u&&(k=t.GPOS.readValueRecord(e,n,u),n+=2*f),0!=c&&(T=t.GPOS.readValueRecord(e,n,c),n+=2*d),_.push({val1:k,val2:T})}s.matrix.push(_)}}}else if(4==r&&1==s.fmt)s.markCoverage=t._lctf.readCoverage(e,i.readUshort(e,n)+o),s.baseCoverage=t._lctf.readCoverage(e,i.readUshort(e,n+2)+o),s.markClassCount=i.readUshort(e,n+4),s.markArray=t.GPOS.readMarkArray(e,i.readUshort(e,n+6)+o),s.baseArray=t.GPOS.readBaseArray(e,i.readUshort(e,n+8)+o,s.markClassCount);else if(6==r&&1==s.fmt)s.mark1Coverage=t._lctf.readCoverage(e,i.readUshort(e,n)+o),s.mark2Coverage=t._lctf.readCoverage(e,i.readUshort(e,n+2)+o),s.markClassCount=i.readUshort(e,n+4),s.mark1Array=t.GPOS.readMarkArray(e,i.readUshort(e,n+6)+o),s.mark2Array=t.GPOS.readBaseArray(e,i.readUshort(e,n+8)+o,s.markClassCount);else if(9==r&&1==s.fmt){var M=i.readUshort(e,n);n+=2;var C=i.readUint(e,n);if(n+=4,9==a.ltype)a.ltype=M;else if(a.ltype!=M)throw"invalid extension substitution";return t.GPOS.subt(e,a.ltype,o+C)}return s},t.GPOS.readValueRecord=function(e,r,n){var a=t._bin,i=[];return i.push(1&n?a.readShort(e,r):0),r+=1&n?2:0,i.push(2&n?a.readShort(e,r):0),r+=2&n?2:0,i.push(4&n?a.readShort(e,r):0),r+=4&n?2:0,i.push(8&n?a.readShort(e,r):0),r+=8&n?2:0,i},t.GPOS.readBaseArray=function(e,r,n){var a=t._bin,i=[],o=r,s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){for(var u=[],c=0;c<n;c++)u.push(t.GPOS.readAnchorRecord(e,o+a.readUshort(e,r))),r+=2;i.push(u)}return i},t.GPOS.readMarkArray=function(e,r){var n=t._bin,a=[],i=r,o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=t.GPOS.readAnchorRecord(e,n.readUshort(e,r+2)+i);l.markClass=n.readUshort(e,r),a.push(l),r+=4}return a},t.GPOS.readAnchorRecord=function(e,r){var n=t._bin,a={};return a.fmt=n.readUshort(e,r),a.x=n.readShort(e,r+2),a.y=n.readShort(e,r+4),a},t.GSUB={},t.GSUB.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GSUB.subt)},t.GSUB.subt=function(e,r,n,a){var i=t._bin,o=n,s={};if(s.fmt=i.readUshort(e,n),n+=2,1!=r&&2!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||2==r||4==r||5==r&&s.fmt<=2||6==r&&s.fmt<=2){var l=i.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,o+l)}if(1==r&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=i.readShort(e,n),n+=2;else if(2==s.fmt){var u=i.readUshort(e,n);n+=2,s.newg=i.readUshorts(e,n,u),n+=2*s.newg.length}}else if(2==r&&1==s.fmt){u=i.readUshort(e,n),n+=2,s.seqs=[];for(var c=0;c<u;c++){var f=i.readUshort(e,n)+o;n+=2;var d=i.readUshort(e,f);s.seqs.push(i.readUshorts(e,f+2,d))}}else if(4==r)for(s.vals=[],u=i.readUshort(e,n),n+=2,c=0;c<u;c++){var h=i.readUshort(e,n);n+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+h))}else if(5==r&&2==s.fmt){if(2==s.fmt){var p=i.readUshort(e,n);n+=2,s.cDef=t._lctf.readClassDef(e,o+p),s.scset=[];var v=i.readUshort(e,n);for(n+=2,c=0;c<v;c++){var g=i.readUshort(e,n);n+=2,s.scset.push(0==g?null:t.GSUB.readSubClassSet(e,o+g))}}}else if(6==r&&3==s.fmt){if(3==s.fmt){for(c=0;c<3;c++){u=i.readUshort(e,n),n+=2;for(var m=[],y=0;y<u;y++)m.push(t._lctf.readCoverage(e,o+i.readUshort(e,n+2*y)));n+=2*u,0==c&&(s.backCvg=m),1==c&&(s.inptCvg=m),2==c&&(s.ahedCvg=m)}u=i.readUshort(e,n),n+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,n,u)}}else if(7==r&&1==s.fmt){var b=i.readUshort(e,n);n+=2;var w=i.readUint(e,n);if(n+=4,9==a.ltype)a.ltype=b;else if(a.ltype!=b)throw"invalid extension substitution";return t.GSUB.subt(e,a.ltype,o+w)}return s},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,a=r,i=[],o=n(e,r);r+=2;for(var s=0;s<o;s++){var l=n(e,r);r+=2,i.push(t.GSUB.readSubClassRule(e,a+l))}return i},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,a={},i=n(e,r),o=n(e,r+=2);r+=2,a.input=[];for(var s=0;s<i-1;s++)a.input.push(n(e,r)),r+=2;return a.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,o),a},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var a=t._bin.readUshort,i=[],o=0;o<n;o++)i.push(a(e,r),a(e,r+2)),r+=4;return i},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2,i.push(t.GSUB.readChainSubClassRule(e,a+l))}return i},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,a={},i=["backtrack","input","lookahead"],o=0;o<i.length;o++){var s=n.readUshort(e,r);r+=2,1==o&&s--,a[i[o]]=n.readUshorts(e,r,s),r+=2*a[i[o]].length}return s=n.readUshort(e,r),r+=2,a.subst=n.readUshorts(e,r,2*s),r+=2*a.subst.length,a},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2,i.push(t.GSUB.readLigature(e,a+l))}return i},t.GSUB.readLigature=function(e,r){var n=t._bin,a={chain:[]};a.nglyph=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2;for(var o=0;o<i-1;o++)a.chain.push(n.readUshort(e,r)),r+=2;return a},t.head={},t.head.parse=function(e,r,n){var a=t._bin,i={};return a.readFixed(e,r),r+=4,i.fontRevision=a.readFixed(e,r),r+=4,a.readUint(e,r),r+=4,a.readUint(e,r),r+=4,i.flags=a.readUshort(e,r),r+=2,i.unitsPerEm=a.readUshort(e,r),r+=2,i.created=a.readUint64(e,r),r+=8,i.modified=a.readUint64(e,r),r+=8,i.xMin=a.readShort(e,r),r+=2,i.yMin=a.readShort(e,r),r+=2,i.xMax=a.readShort(e,r),r+=2,i.yMax=a.readShort(e,r),r+=2,i.macStyle=a.readUshort(e,r),r+=2,i.lowestRecPPEM=a.readUshort(e,r),r+=2,i.fontDirectionHint=a.readShort(e,r),r+=2,i.indexToLocFormat=a.readShort(e,r),r+=2,i.glyphDataFormat=a.readShort(e,r),r+=2,i},t.hhea={},t.hhea.parse=function(e,r,n){var a=t._bin,i={};return a.readFixed(e,r),r+=4,i.ascender=a.readShort(e,r),r+=2,i.descender=a.readShort(e,r),r+=2,i.lineGap=a.readShort(e,r),r+=2,i.advanceWidthMax=a.readUshort(e,r),r+=2,i.minLeftSideBearing=a.readShort(e,r),r+=2,i.minRightSideBearing=a.readShort(e,r),r+=2,i.xMaxExtent=a.readShort(e,r),r+=2,i.caretSlopeRise=a.readShort(e,r),r+=2,i.caretSlopeRun=a.readShort(e,r),r+=2,i.caretOffset=a.readShort(e,r),r+=2,r+=8,i.metricDataFormat=a.readShort(e,r),r+=2,i.numberOfHMetrics=a.readUshort(e,r),r+=2,i},t.hmtx={},t.hmtx.parse=function(e,r,n,a){for(var i=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<a.maxp.numGlyphs;u++)u<a.hhea.numberOfHMetrics&&(s=i.readUshort(e,r),r+=2,l=i.readShort(e,r),r+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(e,r,n,a){var i=t._bin,o=i.readUshort(e,r);if(r+=2,1==o)return t.kern.parseV1(e,r-2,n,a);var s=i.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){r+=2,n=i.readUshort(e,r),r+=2;var c=i.readUshort(e,r);r+=2;var f=c>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,n,a){var i=t._bin;i.readFixed(e,r),r+=4;var o=i.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){i.readUint(e,r),r+=4;var u=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2;var c=u>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,n){var a=t._bin,i=-1,o=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2;for(var s=0;s<o;s++){var l=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var c=a.readShort(e,r);r+=2,l!=i&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var f=n.rval[n.rval.length-1];f.glyph2.push(u),f.vals.push(c),i=l}return r},t.loca={},t.loca.parse=function(e,r,n,a){var i=t._bin,o=[],s=a.head.indexToLocFormat,l=a.maxp.numGlyphs+1;if(0==s)for(var u=0;u<l;u++)o.push(i.readUshort(e,r+(u<<1))<<1);if(1==s)for(u=0;u<l;u++)o.push(i.readUint(e,r+(u<<2)));return o},t.maxp={},t.maxp.parse=function(e,r,n){var a=t._bin,i={},o=a.readUint(e,r);return r+=4,i.numGlyphs=a.readUshort(e,r),r+=2,65536==o&&(i.maxPoints=a.readUshort(e,r),r+=2,i.maxContours=a.readUshort(e,r),r+=2,i.maxCompositePoints=a.readUshort(e,r),r+=2,i.maxCompositeContours=a.readUshort(e,r),r+=2,i.maxZones=a.readUshort(e,r),r+=2,i.maxTwilightPoints=a.readUshort(e,r),r+=2,i.maxStorage=a.readUshort(e,r),r+=2,i.maxFunctionDefs=a.readUshort(e,r),r+=2,i.maxInstructionDefs=a.readUshort(e,r),r+=2,i.maxStackElements=a.readUshort(e,r),r+=2,i.maxSizeOfInstructions=a.readUshort(e,r),r+=2,i.maxComponentElements=a.readUshort(e,r),r+=2,i.maxComponentDepth=a.readUshort(e,r),r+=2),i},t.name={},t.name.parse=function(e,r,n){var a=t._bin,i={};a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2,a.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=r+=2,c=0;c<o;c++){var f=a.readUshort(e,r);r+=2;var d=a.readUshort(e,r);r+=2;var h=a.readUshort(e,r);r+=2;var p=a.readUshort(e,r);r+=2;var v=a.readUshort(e,r);r+=2;var g=a.readUshort(e,r);r+=2;var m,y=l[p],b=u+12*o+g;if(0==f)m=a.readUnicode(e,b,v/2);else if(3==f&&0==d)m=a.readUnicode(e,b,v/2);else if(0==d)m=a.readASCII(e,b,v);else if(1==d)m=a.readUnicode(e,b,v/2);else if(3==d)m=a.readUnicode(e,b,v/2);else{if(1!=f)throw"unknown encoding "+d+", platformID: "+f;m=a.readASCII(e,b,v)}var w="p"+f+","+h.toString(16);null==i[w]&&(i[w]={}),i[w][void 0!==y?y:p]=m,i[w]._lang=h}for(var x in i)if(null!=i[x].postScriptName&&1033==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName&&0==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName&&3084==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName)return i[x];for(var x in i){s=x;break}return i[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var a=t._bin.readUshort(e,r);r+=2;var i={};if(0==a)t["OS/2"].version0(e,r,i);else if(1==a)t["OS/2"].version1(e,r,i);else if(2==a||3==a||4==a)t["OS/2"].version2(e,r,i);else{if(5!=a)throw"unknown OS/2 table version: "+a;t["OS/2"].version5(e,r,i)}return i},t["OS/2"].version0=function(e,r,n){var a=t._bin;return n.xAvgCharWidth=a.readShort(e,r),r+=2,n.usWeightClass=a.readUshort(e,r),r+=2,n.usWidthClass=a.readUshort(e,r),r+=2,n.fsType=a.readUshort(e,r),r+=2,n.ySubscriptXSize=a.readShort(e,r),r+=2,n.ySubscriptYSize=a.readShort(e,r),r+=2,n.ySubscriptXOffset=a.readShort(e,r),r+=2,n.ySubscriptYOffset=a.readShort(e,r),r+=2,n.ySuperscriptXSize=a.readShort(e,r),r+=2,n.ySuperscriptYSize=a.readShort(e,r),r+=2,n.ySuperscriptXOffset=a.readShort(e,r),r+=2,n.ySuperscriptYOffset=a.readShort(e,r),r+=2,n.yStrikeoutSize=a.readShort(e,r),r+=2,n.yStrikeoutPosition=a.readShort(e,r),r+=2,n.sFamilyClass=a.readShort(e,r),r+=2,n.panose=a.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=a.readUint(e,r),r+=4,n.ulUnicodeRange2=a.readUint(e,r),r+=4,n.ulUnicodeRange3=a.readUint(e,r),r+=4,n.ulUnicodeRange4=a.readUint(e,r),r+=4,n.achVendID=[a.readInt8(e,r),a.readInt8(e,r+1),a.readInt8(e,r+2),a.readInt8(e,r+3)],r+=4,n.fsSelection=a.readUshort(e,r),r+=2,n.usFirstCharIndex=a.readUshort(e,r),r+=2,n.usLastCharIndex=a.readUshort(e,r),r+=2,n.sTypoAscender=a.readShort(e,r),r+=2,n.sTypoDescender=a.readShort(e,r),r+=2,n.sTypoLineGap=a.readShort(e,r),r+=2,n.usWinAscent=a.readUshort(e,r),r+=2,n.usWinDescent=a.readUshort(e,r),r+2},t["OS/2"].version1=function(e,r,n){var a=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=a.readUint(e,r),r+=4,n.ulCodePageRange2=a.readUint(e,r),r+4},t["OS/2"].version2=function(e,r,n){var a=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=a.readShort(e,r),r+=2,n.sCapHeight=a.readShort(e,r),r+=2,n.usDefault=a.readUshort(e,r),r+=2,n.usBreak=a.readUshort(e,r),r+=2,n.usMaxContext=a.readUshort(e,r),r+2},t["OS/2"].version5=function(e,r,n){var a=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=a.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=a.readUshort(e,r),r+2},t.post={},t.post.parse=function(e,r,n){var a=t._bin,i={};return i.version=a.readFixed(e,r),r+=4,i.italicAngle=a.readFixed(e,r),r+=4,i.underlinePosition=a.readShort(e,r),r+=2,i.underlineThickness=a.readShort(e,r),r+=2,i},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var a=r.tables[n];if(0==a.format)return t>=a.map.length?0:a.map[t];if(4==a.format){for(var i=-1,o=0;o<a.endCount.length;o++)if(t<=a.endCount[o]){i=o;break}return-1==i||a.startCount[i]>t?0:65535&(0!=a.idRangeOffset[i]?a.glyphIdArray[t-a.startCount[i]+(a.idRangeOffset[i]>>1)-(a.idRangeOffset.length-i)]:t+a.idDelta[i])}if(12==a.format){if(t>a.groups[a.groups.length-1][1])return 0;for(o=0;o<a.groups.length;o++){var s=a.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var a=e.SVG.entries[r];return null==a?n:("string"==typeof a&&(a=t.SVG.toPath(a),e.SVG.entries[r]=a),a)}if(e.CFF){var i={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=r;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],i,o,s,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var a=r.glyf[e];null==a&&(a=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=a&&(a.noc>-1?t.U._simpleGlyph(a,n):t.U._compoGlyph(a,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var a=0==n?0:e.endPts[n-1]+1,i=e.endPts[n],o=a;o<=i;o++){var s=o==a?i:o-1,l=o==i?a:o+1,u=1&e.flags[o],c=1&e.flags[s],f=1&e.flags[l],d=e.xs[o],h=e.ys[o];if(o==a)if(u){if(!c){t.U.P.moveTo(r,d,h);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else c?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+d)/2,(e.ys[s]+h)/2);u?c&&t.U.P.lineTo(r,d,h):f?t.U.P.qcurveTo(r,d,h,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,h,(d+e.xs[l])/2,(h+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var a=0;a<e.parts.length;a++){var i={cmds:[],crds:[]},o=e.parts[a];t.U._drawGlyf(o.glyphIndex,r,i);for(var s=o.m,l=0;l<i.crds.length;l+=2){var u=i.crds[l],c=i.crds[l+1];n.crds.push(u*s.a+c*s.b+s.tx),n.crds.push(u*s.c+c*s.d+s.ty)}for(l=0;l<i.cmds.length;l++)n.cmds.push(i.cmds[l])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return-1==n?0:r[n+2]},t.U._applySubs=function(e,r,n,a){for(var i=e.length-r-1,o=0;o<n.tabs.length;o++)if(null!=n.tabs[o]){var s,l=n.tabs[o];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[r])))if(1==n.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(4==n.ltype)for(var u=l.vals[s],c=0;c<u.length;c++){var f=u[c],d=f.chain.length;if(!(d>i)){for(var h=!0,p=0,v=0;v<d;v++){for(;-1==e[r+p+(1+v)];)p++;f.chain[v]!=e[r+p+(1+v)]&&(h=!1)}if(h){for(e[r]=f.nglyph,v=0;v<d+p;v++)e[r+v+1]=-1;break}}}else if(5==n.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),m=l.cDef[g+2],y=l.scset[m],b=0;b<y.length;b++){var w=y[b],x=w.input;if(!(x.length>i)){for(h=!0,v=0;v<x.length;v++){var S=t._lctf.getInterval(l.cDef,e[r+1+v]);if(-1==g&&l.cDef[S+2]!=x[v]){h=!1;break}}if(h){var U=w.substLookupRecords;for(c=0;c<U.length;c+=2)U[c],U[c+1]}}}else if(6==n.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,r))continue;if(!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var _=l.lookupRec;for(b=0;b<_.length;b+=2){g=_[b];var k=a[_[b+1]];t.U._applySubs(e,r+g,k,a)}}}},t.U._glsCovered=function(e,r,n){for(var a=0;a<r.length;a++)if(-1==t._lctf.coverageIndex(r[a],e[n+a]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var a={cmds:[],crds:[]},i=0,o=0;o<r.length;o++){var s=r[o];if(-1!=s){for(var l=o<r.length-1&&-1!=r[o+1]?r[o+1]:0,u=t.U.glyphToPath(e,s),c=0;c<u.crds.length;c+=2)a.crds.push(u.crds[c]+i),a.crds.push(u.crds[c+1]);for(n&&a.cmds.push(n),c=0;c<u.cmds.length;c++)a.cmds.push(u.cmds[c]);n&&a.cmds.push("X"),i+=e.hmtx.aWidth[s],o<r.length-1&&(i+=t.U.getPairAdjustment(e,s,l))}}return a},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,a,i,o){e.cmds.push("C"),e.crds.push(t,r,n,a,i,o)},t.U.P.qcurveTo=function(e,t,r,n,a){e.cmds.push("Q"),e.crds.push(t,r,n,a)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,a,i){for(var o=r.stack,s=r.nStems,l=r.haveWidth,u=r.width,c=r.open,f=0,d=r.x,h=r.y,p=0,v=0,g=0,m=0,y=0,b=0,w=0,x=0,S=0,U=0,_={val:0,size:0};f<e.length;){t.CFF.getCharString(e,f,_);var k=_.val;if(f+=_.size,"o1"==k||"o18"==k)o.length%2!=0&&!l&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==k||"o23"==k)o.length%2!=0&&!l&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==k)o.length>1&&!l&&(u=o.shift()+a.nominalWidthX,l=!0),c&&t.U.P.closePath(i),h+=o.pop(),t.U.P.moveTo(i,d,h),c=!0;else if("o5"==k)for(;o.length>0;)d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h);else if("o6"==k||"o7"==k)for(var T=o.length,M="o6"==k,C=0;C<T;C++){var E=o.shift();M?d+=E:h+=E,M=!M,t.U.P.lineTo(i,d,h)}else if("o8"==k||"o24"==k){T=o.length;for(var F=0;F+6<=T;)p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h),F+=6;"o24"==k&&(d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h))}else{if("o11"==k)break;if("o1234"==k||"o1235"==k||"o1236"==k||"o1237"==k)"o1234"==k&&(v=h,g=(p=d+o.shift())+o.shift(),U=m=v+o.shift(),b=m,x=h,d=(w=(y=(S=g+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,U),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1235"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),S=g+o.shift(),U=m+o.shift(),y=S+o.shift(),b=U+o.shift(),w=y+o.shift(),x=b+o.shift(),d=w+o.shift(),h=x+o.shift(),o.shift(),t.U.P.curveTo(i,p,v,g,m,S,U),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1236"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),U=m=v+o.shift(),b=m,w=(y=(S=g+o.shift())+o.shift())+o.shift(),x=b+o.shift(),d=w+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,U),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1237"==k&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),S=g+o.shift(),U=m+o.shift(),y=S+o.shift(),b=U+o.shift(),w=y+o.shift(),x=b+o.shift(),Math.abs(w-d)>Math.abs(x-h)?d=w+o.shift():h=x+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,U),t.U.P.curveTo(i,y,b,w,x,d,h));else if("o14"==k){if(o.length>0&&!l&&(u=o.shift()+n.nominalWidthX,l=!0),4==o.length){var A=o.shift(),R=o.shift(),I=o.shift(),D=o.shift(),P=t.CFF.glyphBySE(n,I),O=t.CFF.glyphBySE(n,D);t.U._drawCFF(n.CharStrings[P],r,n,a,i),r.x=A,r.y=R,t.U._drawCFF(n.CharStrings[O],r,n,a,i)}c&&(t.U.P.closePath(i),c=!1)}else if("o19"==k||"o20"==k)o.length%2!=0&&!l&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,f+=s+7>>3;else if("o21"==k)o.length>2&&!l&&(u=o.shift()+a.nominalWidthX,l=!0),h+=o.pop(),d+=o.pop(),c&&t.U.P.closePath(i),t.U.P.moveTo(i,d,h),c=!0;else if("o22"==k)o.length>1&&!l&&(u=o.shift()+a.nominalWidthX,l=!0),d+=o.pop(),c&&t.U.P.closePath(i),t.U.P.moveTo(i,d,h),c=!0;else if("o25"==k){for(;o.length>6;)d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h);p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h)}else if("o26"==k)for(o.length%2&&(d+=o.shift());o.length>0;)p=d,v=h+o.shift(),d=g=p+o.shift(),h=(m=v+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h);else if("o27"==k)for(o.length%2&&(h+=o.shift());o.length>0;)v=h,g=(p=d+o.shift())+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m,t.U.P.curveTo(i,p,v,g,m,d,h);else if("o10"==k||"o29"==k){var B="o10"==k?a:n;if(0==o.length);else{var L=o.pop(),G=B.Subrs[L+B.Bias];r.x=d,r.y=h,r.nStems=s,r.haveWidth=l,r.width=u,r.open=c,t.U._drawCFF(G,r,n,a,i),d=r.x,h=r.y,s=r.nStems,l=r.haveWidth,u=r.width,c=r.open}}else if("o30"==k||"o31"==k){var z=o.length,j=(F=0,"o31"==k);for(F+=z-(T=-3&z);F<T;)j?(v=h,g=(p=d+o.shift())+o.shift(),h=(m=v+o.shift())+o.shift(),T-F==5?(d=g+o.shift(),F++):d=g,j=!1):(p=d,v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),T-F==5?(h=m+o.shift(),F++):h=m,j=!0),t.U.P.curveTo(i,p,v,g,m,d,h),F+=4}else{if("o"==(k+"").charAt(0))throw k;o.push(k)}}}r.x=d,r.y=h,r.nStems=s,r.haveWidth=l,r.width=u,r.open=c};var r=t,n={Typr:r};return e.Typr=r,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/},function(){return function(e){var t=Uint8Array,r=Uint16Array,n=Uint32Array,a=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var a=new r(31),i=0;i<31;++i)a[i]=t+=1<<e[i-1];var o=new n(a[30]);for(i=1;i<30;++i)for(var s=a[i];s<a[i+1];++s)o[s]=s-a[i]<<5|i;return[a,o]},l=s(a,2),u=l[0],c=l[1];u[28]=258,c[258]=28;for(var f=s(i,0)[0],d=new r(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(e,t,n){for(var a=e.length,i=0,o=new r(t);i<a;++i)++o[e[i]-1];var s,l=new r(t);for(i=0;i<t;++i)l[i]=l[i-1]+o[i-1]<<1;s=new r(1<<t);var u=15-t;for(i=0;i<a;++i)if(e[i])for(var c=i<<4|e[i],f=t-e[i],h=l[e[i]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)s[d[h]>>>u]=c;return s},g=new t(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var m=new t(32);for(h=0;h<32;++h)m[h]=5;var y=v(g,9),b=v(m,5),w=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},x=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},S=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},U=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(e,t,r){var n=new Error(t||U[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,_),!r)throw n;return n},k=new t(0),T="undefined"!=typeof TextDecoder&&new TextDecoder;try{T.decode(k,{stream:!0})}catch(M){}return e.convert_streams=function(e){var s=new DataView(e),l=0;function c(){var e=s.getUint16(l);return l+=2,e}function d(){var e=s.getUint32(l);return l+=4,e}function h(e){R.setUint16(I,e),I+=2}function p(e){R.setUint32(I,e),I+=4}for(var g={signature:d(),flavor:d(),length:d(),numTables:c(),reserved:c(),totalSfntSize:d(),majorVersion:c(),minorVersion:c(),metaOffset:d(),metaLength:d(),metaOrigLength:d(),privOffset:d(),privLength:d()},m=0;Math.pow(2,m)<=g.numTables;)m++;m--;for(var U=16*Math.pow(2,m),k=16*g.numTables-U,T=12,M=[],C=0;C<g.numTables;C++)M.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),T+=16;var E,F=new Uint8Array(12+16*M.length+M.reduce((function(e,t){return e+t.origLength+4}),0)),A=F.buffer,R=new DataView(A),I=0;return p(g.flavor),h(g.numTables),h(U),h(m),h(k),M.forEach((function(e){p(e.tag),p(e.origChecksum),p(T),p(e.origLength),e.outOffset=T,(T+=e.origLength)%4!=0&&(T+=4-T%4)})),M.forEach((function(s){var l=e.slice(s.offset,s.offset+s.compLength);if(s.compLength!=s.origLength){var c=new Uint8Array(s.origLength);(function(e,s,l){var c=e.length;if(!c||l&&!l.l&&c<5)return s||new t(0);var d=!s||l,h=!l||l.i;l||(l={}),s||(s=new t(3*c));var p,g=function(e){var r=s.length;if(e>r){var n=new t(Math.max(2*r,e));n.set(s),s=n}},m=l.f||0,U=l.p||0,k=l.b||0,T=l.l,M=l.d,C=l.m,E=l.n,F=8*c;do{if(!T){l.f=m=x(e,U,1);var A=x(e,U+1,3);if(U+=3,!A){var R=e[(N=((p=U)/8|0)+(7&p&&1)+4)-4]|e[N-3]<<8,I=N+R;if(I>c){h&&_(0);break}d&&g(k+R),s.set(e.subarray(N,I),k),l.b=k+=R,l.p=U=8*I;continue}if(1==A)T=y,M=b,C=9,E=5;else if(2==A){var D=x(e,U,31)+257,P=x(e,U+10,15)+4,O=D+x(e,U+5,31)+1;U+=14;for(var B=new t(O),L=new t(19),G=0;G<P;++G)L[o[G]]=x(e,U+3*G,7);U+=3*P;var z=w(L),j=(1<<z)-1,W=v(L,z);for(G=0;G<O;){var N,V=W[x(e,U,j)];if(U+=15&V,(N=V>>>4)<16)B[G++]=N;else{var H=0,q=0;for(16==N?(q=3+x(e,U,3),U+=2,H=B[G-1]):17==N?(q=3+x(e,U,7),U+=3):18==N&&(q=11+x(e,U,127),U+=7);q--;)B[G++]=H}}var X=B.subarray(0,D),$=B.subarray(D);C=w(X),E=w($),T=v(X,C),M=v($,E)}else _(1);if(U>F){h&&_(0);break}}d&&g(k+131072);for(var Y=(1<<C)-1,Z=(1<<E)-1,K=U;;K=U){var Q=(H=T[S(e,U)&Y])>>>4;if((U+=15&H)>F){h&&_(0);break}if(H||_(2),Q<256)s[k++]=Q;else{if(256==Q){K=U,T=null;break}var J=Q-254;if(Q>264){var ee=a[G=Q-257];J=x(e,U,(1<<ee)-1)+u[G],U+=ee}var te=M[S(e,U)&Z],re=te>>>4;if(te||_(3),U+=15&te,$=f[re],re>3&&(ee=i[re],$+=S(e,U)&(1<<ee)-1,U+=ee),U>F){h&&_(0);break}d&&g(k+131072);for(var ne=k+J;k<ne;k+=4)s[k]=s[k-$],s[k+1]=s[k+1-$],s[k+2]=s[k+2-$],s[k+3]=s[k+3-$];k=ne}}l.l=T,l.p=K,l.b=k,T&&(m=1,l.m=C,l.d=M,l.n=E)}while(!m);k==s.length||function(e,a,i){(null==i||i>e.length)&&(i=e.length);var o=new(e instanceof r?r:e instanceof n?n:t)(i-0);o.set(e.subarray(0,i))}(s,0,k)})(new Uint8Array(l,2),c)}else c=new Uint8Array(l);F.set(c,s.outOffset);var d=0;(T=s.outOffset+s.origLength)%4!=0&&(d=4-T%4),F.set(new Uint8Array(d).buffer,s.outOffset+s.origLength),E=T+d})),A.slice(0,E)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const r={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let a;function i(e){if(!a){const e={R:2,L:1,D:4,C:16,U:32,T:8};a=new Map;for(let t in n){let r=0;n[t].split(",").forEach((n=>{let[i,o]=n.split("+");i=parseInt(i,36),o=o?parseInt(o,36):0,a.set(r+=i,e[t]);for(let s=o;s--;)a.set(++r,e[t])}))}}return a.get(e)||32}const o=[null,"isol","init","fina","medi"];function s(e){const t=new Uint8Array(e.length);let r=32,n=1,a=-1;for(let o=0;o<e.length;o++){const s=e.codePointAt(o);let l=0|i(s),u=1;8&l||(21&r?22&l?(u=3,1!==n&&3!==n||t[a]++):33&l&&(2!==n&&4!==n||t[a]--):34&r&&(2!==n&&4!==n||t[a]--),n=t[o]=u,r=l,a=o,s>65535&&o++)}return t}function l(t,r){const n=t.GDEF&&t.GDEF.glyphClassDef;return n?e.U._getGlyphClass(r,n):0}function u(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}function c(t){const n=Object.create(null),a=t["OS/2"],i=t.hhea,c=t.head.unitsPerEm,f=u(a&&a.sTypoAscender,i&&i.ascender,c),d={unitsPerEm:c,ascender:f,descender:u(a&&a.sTypoDescender,i&&i.descender,0),capHeight:u(a&&a.sCapHeight,f),xHeight:u(a&&a.sxHeight,f),lineGap:u(a&&a.sTypoLineGap,i&&i.lineGap),supportsCodePoint:r=>e.U.codeToGlyph(t,r)>0,forEachGlyph(a,i,u,c){let f=0;const h=1/d.unitsPerEm*i,p=function(t,r){const n=[];for(let i=0;i<r.length;i++){const a=r.codePointAt(i);a>65535&&i++,n.push(e.U.codeToGlyph(t,a))}const a=t.GSUB;if(a){const{lookupList:t,featureList:i}=a;let l;const u=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,c=[];i.forEach((a=>{if(u.test(a.tag))for(let i=0;i<a.tab.length;i++){if(c[a.tab[i]])continue;c[a.tab[i]]=!0;const u=t[a.tab[i]],f=/^(isol|init|fina|medi)$/.test(a.tag);f&&!l&&(l=s(r));for(let r=0;r<n.length;r++)l&&f&&o[l[r]]!==a.tag||e.U._applySubs(n,r,u,t)}}))}return n}(t,a);let v=0;const g=function(t,r){const n=new Int16Array(3*r.length);let a=0;for(;a<r.length;a++){const u=r[a];if(-1===u)continue;n[3*a+2]=t.hmtx.aWidth[u];const c=t.GPOS;if(c){const f=c.lookupList;for(let c=0;c<f.length;c++){const d=f[c];for(let c=0;c<d.tabs.length;c++){const f=d.tabs[c];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(f.coverage,u)&&f.pos){s(f.pos,a);break}}else if(2===d.ltype){let t=null,n=i();if(-1!==n){const i=e._lctf.coverageIndex(f.coverage,r[n]);if(-1!==i){if(1===f.fmt){const e=f.pairsets[i];for(let r=0;r<e.length;r++)e[r].gid2===u&&(t=e[r])}else if(2===f.fmt){const a=e.U._getGlyphClass(r[n],f.classDef1),i=e.U._getGlyphClass(u,f.classDef2);t=f.matrix[a][i]}if(t){t.val1&&s(t.val1,n),t.val2&&s(t.val2,a);break}}}}else if(4===d.ltype){const t=e._lctf.coverageIndex(f.markCoverage,u);if(-1!==t){const s=i(o),l=-1===s?-1:e._lctf.coverageIndex(f.baseCoverage,r[s]);if(-1!==l){const e=f.markArray[t],r=f.baseArray[l][e.markClass];n[3*a]=r.x-e.x+n[3*s]-n[3*s+2],n[3*a+1]=r.y-e.y+n[3*s+1];break}}}else if(6===d.ltype){const o=e._lctf.coverageIndex(f.mark1Coverage,u);if(-1!==o){const s=i();if(-1!==s){const i=r[s];if(3===l(t,i)){const t=e._lctf.coverageIndex(f.mark2Coverage,i);if(-1!==t){const e=f.mark1Array[o],r=f.mark2Array[t][e.markClass];n[3*a]=r.x-e.x+n[3*s]-n[3*s+2],n[3*a+1]=r.y-e.y+n[3*s+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=i();if(-1!==e){const a=t.kern.glyph1.indexOf(r[e]);if(-1!==a){const r=t.kern.rval[a].glyph2.indexOf(u);-1!==r&&(n[3*e+2]+=t.kern.rval[a].vals[r])}}}}return n;function i(e){for(let t=a-1;t>=0;t--)if(-1!==r[t]&&(!e||e(r[t])))return t;return-1}function o(e){return 1===l(t,e)}function s(e,t){for(let r=0;r<3;r++)n[3*t+r]+=e[r]||0}}(t,p);return p.forEach(((o,s)=>{if(-1!==o){let a=n[o];if(!a){const{cmds:i,crds:s}=e.U.glyphToPath(t,o);let l,u,c,f,d="",h=0;for(let e=0,t=i.length;e<t;e++){const t=r[i[e]];d+=i[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+s[h++]}if(s.length){l=u=1/0,c=f=-1/0;for(let e=0,t=s.length;e<t;e+=2){let t=s[e],r=s[e+1];t<l&&(l=t),r<u&&(u=r),t>c&&(c=t),r>f&&(f=r)}}else l=c=u=f=0;a=n[o]={index:o,advanceWidth:t.hmtx.aWidth[o],xMin:l,yMin:u,xMax:c,yMax:f,path:d}}c.call(null,a,f+g[3*s]*h,g[3*s+1]*h,v),f+=g[3*s+2]*h,u&&(f+=u*i)}v+=a.codePointAt(v)>65535?2:1})),f}};return d}return function(r){const n=new Uint8Array(r,0,4),a=e._bin.readASCII(n,0,4);if("wOFF"===a)r=t(r);else if("wOF2"===a)throw new Error("woff2 fonts not supported");return c(e.parse(r)[0])}}],init:(e,t,r)=>r(e(),t())});
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/const Et=ft({name:"FontResolver",dependencies:[function(e,t){const r=Object.create(null),n=Object.create(null);function a(t,a){let i=r[t];i?a(i):n[t]?n[t].push(a):(n[t]=[a],function(t,r){const n=e=>{};try{const a=new XMLHttpRequest;a.open("get",t,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status>=400)new Error(a.statusText);else if(a.status>0)try{const n=e(a.response);n.src=t,r(n)}catch(Kr){}},a.onerror=n,a.send()}catch(a){}}(t,(e=>{e.src=t,r[t]=e,n[t].forEach((t=>t(e))),delete n[t]})))}return function(e,n,{lang:i,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:u}={}){const c=new Uint8Array(e.length),f=[];e.length||v();const d=new Map,h=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),o&&!Array.isArray(o)&&(o=[o]),(o=o.slice().filter((e=>!e.lang||e.lang.test(i))).reverse()).length){const t=1,n=2;let i=0;!function s(l=0){for(let u=l,p=e.length;u<p;u++){const l=e.codePointAt(u);if(i===t&&f[c[u-1]].supportsCodePoint(l)||u>0&&/\s/.test(e[u]))c[u]=c[u-1],i===n&&(h[h.length-1][1]=u);else for(let e=c[u],p=o.length;e<=p;e++)if(e===p){(i===n?h[h.length-1]:h[h.length]=[u,u])[1]=u,i=n}else{c[u]=e;const{src:n,unicodeRange:h}=o[e];if(!h||g(l,h)){const e=r[n];if(!e)return void a(n,(()=>{s(u)}));if(e.supportsCodePoint(l)){let r=d.get(e);"number"!=typeof r&&(r=f.length,f.push(e),d.set(e,r)),c[u]=r,i=t;break}}}l>65535&&u+1<p&&(c[u+1]=c[u],u++,i===n&&(h[h.length-1][1]=u))}p()}()}else h.push([0,e.length-1]),p();function p(){if(h.length){const r=h.map((t=>e.substring(t[0],t[1]+1))).join("\n");t.getFontsForString(r,{lang:i||void 0,style:s,weight:l,dataUrl:u}).then((({fontUrls:e,chars:t})=>{const r=f.length;let n=0;h.forEach((e=>{for(let a=0,i=e[1]-e[0];a<=i;a++)c[e[0]+a]=t[n++]+r;n++}));let i=0;e.forEach(((t,n)=>{a(t,(t=>{f[n+r]=t,++i===e.length&&v()}))}))}))}else v()}function v(){n({chars:c,fonts:f})}function g(e,t){for(let r=0;r<t.length;r++){const[n,a=n]=t[r];if(n<=e&&e<=a)return!0}return!1}}},Ct,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&!!(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach((function(t,r){e.push((+r).toString(36)+":"+t.toString(36))})),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach((function(e){var r=e.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))}))};var r=Math.pow(2,8),n=r-1,a=~n;function i(e,t){var r=e&n,a=t.codePointAt(r/6|0);return!!((a=(a||48)-48)&1<<r%6)}function o(e,t){!function(e,t){var r;(r=e,r.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(e){return e.split("-").map((function(e){return parseInt(e.trim(),16)}))}))).forEach((function(e){var r=e[0],n=e[1];void 0===n&&(n=r),t(r,n)}))}(e,(function(e,r){for(var n=e;n<=r;n++)t(n)}))}var s={},l={},u=new WeakMap,c="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(e){var r=u.get(e);return r||(r=new t,o(e.ranges,(function(e){return r.add(e)})),u.set(e,r)),r}var d,h=new Map;function p(e,t,r){return e[t]?t:e[r]?r:function(e){for(var t in e)return t}(e)}function v(e,t){var r=t;if(!e.includes(r)){r=1/0;for(var n=0;n<e.length;n++)Math.abs(e[n]-t)<Math.abs(r-t)&&(r=e[n])}return r}function g(e){return d||(d=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(e){d.add(e)}))),d.has(e)}return e.CodePointSet=t,e.clearCache=function(){s={},l={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var n,o=t.lang;void 0===o&&(o=new RegExp("\\p{Script=Hangul}","u").test(n=e)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(n)?"ja":"en");var u=t.category;void 0===u&&(u="sans-serif");var d=t.style;void 0===d&&(d="normal");var m=t.weight;void 0===m&&(m=400);var y=(t.dataUrl||c).replace(/\/$/g,""),b=new Map,w=new Uint8Array(e.length),x={},S={},U=new Array(e.length),_=new Map,k=!1;function T(e){var t=h.get(e);return t||(t=fetch(y+"/"+e).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then((function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]}))})).catch((function(t){if(y!==c)return k||(k=!0),y=c,h.delete(e),T(e);throw t})),h.set(e,t)),t}for(var M=function(t){var n=e.codePointAt(t),i=function(e){var t,n=(t=e,t&a).toString(16),i=function(e){return(e&a)+r-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+n+"-"+i+".json"}(n);U[t]=i,s[i]||_.has(i)||_.set(i,T(i).then((function(e){s[i]=e}))),n>65535&&(t++,C=t)},C=0;C<e.length;C++)M(C);return Promise.all(_.values()).then((function(){_.clear();for(var t=function(t){var n=e.codePointAt(t),a=null,u=s[U[t]],c=void 0;for(var f in u){var d=S[f];if(void 0===d&&(d=S[f]=new RegExp(f).test(o||"en")),d){for(var h in c=f,u[f])if(i(n,u[f][h])){a=h;break}break}}if(!a)e:for(var p in u)if(p!==c)for(var v in u[p])if(i(n,u[p][v])){a=v;break e}a||(a="latin"),U[t]=a,l[a]||_.has(a)||_.set(a,T("font-meta/"+a+".json").then((function(e){l[a]=e}))),n>65535&&(t++,r=t)},r=0;r<e.length;r++)t(r);return Promise.all(_.values())})).then((function(){for(var t,r=null,n=0;n<e.length;n++){var a=e.codePointAt(n);if(r&&(g(a)||f(r).has(a)))w[n]=w[n-1];else{r=l[U[n]];var i=x[r.id];if(!i){var o=r.typeforms,s=p(o,u,"sans-serif"),c=p(o[s],d,"normal"),h=v(null===(t=o[s])||void 0===t?void 0:t[c],m);i=x[r.id]=y+"/font-files/"+r.id+"/"+s+"."+c+"."+h+".woff"}var S=b.get(i);null==S&&(S=b.size,b.set(i,S)),w[n]=S}a>65535&&(n++,w[n]=w[n-1])}return{fontUrls:Array.from(b.keys()),chars:w}}))},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())});const Ft=()=>(self.performance||Date).now(),At=pt();let Rt;const It=[];let Dt=0;function Pt(){const e=Ft();for(;It.length&&Ft()-e<5;)It.shift()();Dt=It.length?setTimeout(Pt,0):0}const Ot=(...e)=>new Promise(((t,r)=>{It.push((()=>{const n=Ft();try{At.webgl.generateIntoCanvas(...e),t({timing:Ft()-n})}catch(a){r(a)}})),Dt||(Dt=setTimeout(Pt,0))})),Bt=4,Lt=2e3,Gt={};let zt=0;function jt(e,t,r,n,a,i,o,s,l,u){const c="TroikaTextSDFGenerator_JS_"+zt++%Bt;let f=Gt[c];return f||(f=Gt[c]={workerModule:ft({name:c,workerId:c,dependencies:[pt,Ft],init(e,t){const r=e().javascript.generate;return function(...e){const n=t();return{textureData:r(...e),timing:t()-n}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(e,t,r,n,a,i).then((({textureData:r,timing:n})=>{const a=Ft(),i=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)i[4*e+u]=r[e];return At.webglUtils.renderImageData(o,i,s,l,e,t,1<<3-u),n+=Ft()-a,0==--f.requests&&(f.idleTimer=setTimeout((()=>{!function(e){ut[e]&&ut[e].forEach((function(e){e()})),lt[e]&&(lt[e].terminate(),delete lt[e])}(c)}),Lt)),{timing:n}}))}const Wt=At.webglUtils.resizeWebGLCanvasWithoutClearing,Nt={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Vt=new U;function Ht(){return(self.performance||Date).now()}const qt=Object.create(null);function Xt(e,t){e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);const r=Ht(),n=[];if(e.font&&n.push({label:"user",src:Zt(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||Nt.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||Nt.unicodeFontsURL,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let n=e.colorRanges[r];"number"!=typeof n&&(n=Vt.set(n).getHex()),t[r]=n}e.colorRanges=t}Object.freeze(e);const{textureWidth:a,sdfExponent:i}=Nt,{sdfGlyphSize:o}=e,s=a/o*4;let l=qt[o];if(!l){const e=document.createElement("canvas");e.width=a,e.height=256*o/s,l=qt[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:e,sdfTexture:new F(e,void 0,void 0,void 0,v,v),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",(t=>{t.preventDefault(),e.contextLost=!0})),t.addEventListener("webglcontextrestored",(t=>{e.contextLost=!1;const r=[];e.glyphsByFont.forEach((t=>{t.forEach((t=>{r.push($t(t,e,!0))}))})),Promise.all(r).then((()=>{Kt(e),e.sdfTexture.needsUpdate=!0}))}))}(l)}const{sdfTexture:u,sdfCanvas:c}=l;Jt(e).then((n=>{const{glyphIds:f,glyphFontIndices:d,fontData:h,glyphPositions:p,fontSize:v,timings:g}=n,m=[],y=new Float32Array(4*f.length);let b=0,w=0;const x=Ht(),S=h.map((e=>{let t=l.glyphsByFont.get(e.src);return t||l.glyphsByFont.set(e.src,t=new Map),t}));f.forEach(((e,t)=>{const r=d[t],{src:a,unitsPerEm:i}=h[r];let s=S[r].get(e);if(!s){const{path:t,pathBounds:i}=n.glyphData[a][e],u=Math.max(i[2]-i[0],i[3]-i[1])/o*(Nt.sdfMargin*o+.5),c=l.glyphCount++,f=[i[0]-u,i[1]-u,i[2]+u,i[3]+u];S[r].set(e,s={path:t,atlasIndex:c,sdfViewBox:f}),m.push(s)}const{sdfViewBox:u}=s,c=p[w++],g=p[w++],x=v/i;y[b++]=c+u[0]*x,y[b++]=g+u[1]*x,y[b++]=c+u[2]*x,y[b++]=g+u[3]*x,f[t]=s.atlasIndex})),g.quads=(g.quads||0)+(Ht()-x);const U=Ht();g.sdf={};const _=c.height,k=Math.ceil(l.glyphCount/s),T=Math.pow(2,Math.ceil(Math.log2(k*o)));T>_&&(Wt(c,a,T),u.dispose()),Promise.all(m.map((t=>$t(t,l,e.gpuAccelerateSDF).then((({timing:e})=>{g.sdf[t.atlasIndex]=e}))))).then((()=>{m.length&&!l.contextLost&&(Kt(l),u.needsUpdate=!0),g.sdfTotal=Ht()-U,g.total=Ht()-r,t(Object.freeze({parameters:e,sdfTexture:u,sdfGlyphSize:o,sdfExponent:i,glyphBounds:y,glyphAtlasIndices:f,glyphColors:n.glyphColors,caretPositions:n.caretPositions,chunkedBounds:n.chunkedBounds,ascender:n.ascender,descender:n.descender,lineHeight:n.lineHeight,capHeight:n.capHeight,xHeight:n.xHeight,topBaseline:n.topBaseline,blockBounds:n.blockBounds,visibleBounds:n.visibleBounds,timings:n.timings}))}))})),Promise.resolve().then((()=>{var e;l.contextLost||(e=c)._warm||(At.webgl.isSupported(e),e._warm=!0)}))}function $t({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:n,sdfCanvas:a,contextLost:i},o){if(i)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=Nt,u=Math.max(r[2]-r[0],r[3]-r[1]),c=Math.floor(t/4);return function(e,t,r,n,a,i,o,s,l,u,c=!0){return c?Ot(e,t,r,n,a,i,o,s,l,u).then(null,(c=>(Rt||(Rt=!0),jt(e,t,r,n,a,i,o,s,l,u)))):jt(e,t,r,n,a,i,o,s,l,u)}(n,n,e,r,u,l,a,c%(s/n)*n,Math.floor(c/(s/n))*n,t%4,o)}let Yt;function Zt(e){return Yt||(Yt="undefined"==typeof document?{}:document.createElement("a")),Yt.href=e,Yt.href}function Kt(e){if("function"!=typeof createImageBitmap){const{sdfCanvas:t,sdfTexture:r}=e,{width:n,height:a}=t,i=e.sdfCanvas.getContext("webgl");let o=r.image.data;o&&o.length===n*a*4||(o=new Uint8Array(n*a*4),r.image={width:n,height:a,data:o},r.flipY=!1,r.isDataTexture=!0),i.readPixels(0,0,n,a,i.RGBA,i.UNSIGNED_BYTE,o)}}const Qt=ft({name:"Typesetter",dependencies:[function(e,t){const r=1/0,n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",i=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:o="",font:f,lang:d,sdfGlyphSize:h=64,fontSize:p=400,fontWeight:v=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:y="normal",maxWidth:b=r,direction:w,textAlign:x="left",textIndent:S=0,whiteSpace:U="normal",overflowWrap:_="normal",anchorX:k=0,anchorY:T=0,metricsOnly:M=!1,unicodeFontsURL:C,preResolvedFonts:E=null,includeCaretPositions:F=!1,chunkedBoundsSize:A=8192,colorRanges:R=null},I){const D=u(),P={fontLoad:0,typesetting:0};o.indexOf("\r")>-1&&(o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,m=+m,b=+b,y=y||"normal",S=+S,function({text:t,lang:r,fonts:n,style:a,weight:i,preResolvedFonts:o,unicodeFontsURL:s},l){const u=({chars:e,fonts:t})=>{let r,n;const a=[];for(let i=0;i<e.length;i++)e[i]!==n?(n=e[i],a.push(r={start:i,end:i,fontObj:t[e[i]]})):r.end=i;l(a)};o?u(o):e(t,u,{lang:r,fonts:n,style:a,weight:i,unicodeFontsURL:s})}({text:o,lang:d,style:g,weight:v,fonts:"string"==typeof f?[{src:f}]:f,unicodeFontsURL:C,preResolvedFonts:E},(e=>{P.fontLoad=u()-D;const f=isFinite(b);let d=null,h=null,v=null,g=null,C=null,E=null,O=null,B=null,L=0,G=0,z="nowrap"!==U;const j=new Map,W=u();let N=S,V=0,H=new c;const q=[H];e.forEach((e=>{const{fontObj:t}=e,{ascender:r,descender:s,unitsPerEm:l,lineGap:u,capHeight:d,xHeight:h}=t;let v=j.get(t);if(!v){const e=p/l,n="normal"===y?(r-s+u)*e:y*p,a=(n-(r-s)*e)/2,i=Math.min(n,(r-s)*e),o=(r+s)/2*e+i/2;v={index:j.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:r*e,descender:s*e,capHeight:d*e,xHeight:h*e,lineHeight:n,baseline:-a-r*e,caretTop:o,caretBottom:o-i},j.set(t,v)}const{fontSizeMult:g}=v,w=o.slice(e.start,e.end+1);let x,U;t.forEachGlyph(w,p,m,((t,r,s,l)=>{r+=V,l+=e.start,x=r,U=t;const u=o.charAt(l),d=t.advanceWidth*g,h=H.count;let y;if("isEmpty"in t||(t.isWhitespace=!!u&&new RegExp(a).test(u),t.canBreakAfter=!!u&&i.test(u),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||n.test(u)),t.isWhitespace||t.isEmpty||G++,z&&f&&!t.isWhitespace&&r+d+N>b&&h){if(H.glyphAt(h-1).glyphObj.canBreakAfter)y=new c,N=-r;else for(let e=h;e--;){if(0===e&&"break-word"===_){y=new c,N=-r;break}if(H.glyphAt(e).glyphObj.canBreakAfter){y=H.splitAt(e+1);const t=y.glyphAt(0).x;N-=t;for(let e=y.count;e--;)y.glyphAt(e).x-=t;break}}y&&(H.isSoftWrapped=!0,H=y,q.push(H),L=b)}let w=H.glyphAt(H.count);w.glyphObj=t,w.x=r+N,w.y=s,w.width=d,w.charIndex=l,w.fontData=v,"\n"===u&&(H=new c,q.push(H),N=-(r+d+m*p)+S)})),V=x+U.advanceWidth*g+m*p}));let X=0;q.forEach((e=>{let t=!0;for(let r=e.count;r--;){const n=e.glyphAt(r);t&&!n.glyphObj.isWhitespace&&(e.width=n.x+n.width,e.width>L&&(L=e.width),t=!1);let{lineHeight:a,capHeight:i,xHeight:o,baseline:s}=n.fontData;a>e.lineHeight&&(e.lineHeight=a);const l=s-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+i),e.ex=Math.max(e.ex,e.baseline+o)}e.baseline-=X,e.cap-=X,e.ex-=X,X+=e.lineHeight}));let $=0,Y=0;if(k&&("number"==typeof k?$=-k:"string"==typeof k&&($=-L*("left"===k?0:"center"===k?.5:"right"===k?1:s(k)))),T&&("number"==typeof T?Y=-T:"string"==typeof T&&(Y="top"===T?0:"top-baseline"===T?-q[0].baseline:"top-cap"===T?-q[0].cap:"top-ex"===T?-q[0].ex:"middle"===T?X/2:"bottom"===T?X:"bottom-baseline"===T?-q[q.length-1].baseline:s(T)*X)),!M){const e=t.getEmbeddingLevels(o,w);d=new Uint16Array(G),h=new Uint8Array(G),v=new Float32Array(2*G),g={},O=[r,r,-1/0,-1/0],B=[],F&&(E=new Float32Array(4*o.length)),R&&(C=new Uint8Array(3*G));let n,a,i=0,s=-1,u=-1;if(q.forEach(((c,f)=>{let{count:p,width:m}=c;if(p>0){let f=0;for(let e=p;e--&&c.glyphAt(e).glyphObj.isWhitespace;)f++;let y=0,b=0;if("center"===x)y=(L-m)/2;else if("right"===x)y=L-m;else if("justify"===x&&c.isSoftWrapped){let e=0;for(let t=p-f;t--;)c.glyphAt(t).glyphObj.isWhitespace&&e++;b=(L-m)/e}if(b||y){let e=0;for(let t=0;t<p;t++){let r=c.glyphAt(t);const n=r.glyphObj;r.x+=y+e,0!==b&&n.isWhitespace&&t<p-f&&(e+=b,r.width+=b)}}const w=t.getReorderSegments(o,e,c.glyphAt(0).charIndex,c.glyphAt(c.count-1).charIndex);for(let e=0;e<w.length;e++){const[t,r]=w[e];let n=1/0,a=-1/0;for(let e=0;e<p;e++)if(c.glyphAt(e).charIndex>=t){let t=e,i=e;for(;i<p;i++){let e=c.glyphAt(i);if(e.charIndex>r)break;i<p-f&&(n=Math.min(n,e.x),a=Math.max(a,e.x+e.width))}for(let e=t;e<i;e++){const t=c.glyphAt(e);t.x=a-(t.x+t.width-n)}break}}let S;const U=e=>S=e;for(let m=0;m<p;m++){const f=c.glyphAt(m);S=f.glyphObj;const p=S.index,y=1&e.levels[f.charIndex];if(y){const e=t.getMirroredCharacter(o[f.charIndex]);e&&f.fontData.fontObj.forEachGlyph(e,0,0,U)}if(F){const{charIndex:e,fontData:t}=f,r=f.x+$,n=f.x+f.width+$;E[4*e]=y?n:r,E[4*e+1]=y?r:n,E[4*e+2]=c.baseline+t.caretBottom+Y,E[4*e+3]=c.baseline+t.caretTop+Y;const a=e-s;a>1&&l(E,s,a),s=e}if(R){const{charIndex:e}=f;for(;e>u;)u++,R.hasOwnProperty(u)&&(a=R[u])}if(!S.isWhitespace&&!S.isEmpty){const e=i++,{fontSizeMult:t,src:o,index:s}=f.fontData,l=g[o]||(g[o]={});l[p]||(l[p]={path:S.path,pathBounds:[S.xMin,S.yMin,S.xMax,S.yMax]});const u=f.x+$,m=f.y+c.baseline+Y;v[2*e]=u,v[2*e+1]=m;const y=u+S.xMin*t,b=m+S.yMin*t,w=u+S.xMax*t,x=m+S.yMax*t;y<O[0]&&(O[0]=y),b<O[1]&&(O[1]=b),w>O[2]&&(O[2]=w),x>O[3]&&(O[3]=x),e%A==0&&(n={start:e,end:e,rect:[r,r,-1/0,-1/0]},B.push(n)),n.end++;const U=n.rect;if(y<U[0]&&(U[0]=y),b<U[1]&&(U[1]=b),w>U[2]&&(U[2]=w),x>U[3]&&(U[3]=x),d[e]=p,h[e]=s,R){const t=3*e;C[t]=a>>16&255,C[t+1]=a>>8&255,C[t+2]=255&a}}}}})),E){const e=o.length-s;e>1&&l(E,s,e)}}const Z=[];j.forEach((({index:e,src:t,unitsPerEm:r,ascender:n,descender:a,lineHeight:i,capHeight:o,xHeight:s})=>{Z[e]={src:t,unitsPerEm:r,ascender:n,descender:a,lineHeight:i,capHeight:o,xHeight:s}})),P.typesetting=u()-W,I({glyphIds:d,glyphFontIndices:h,glyphPositions:v,glyphData:g,fontData:Z,caretPositions:E,glyphColors:C,chunkedBounds:B,fontSize:p,topBaseline:Y+q[0].baseline,blockBounds:[$,Y-X,$+L,Y],visibleBounds:O,timings:P})}))}function s(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function l(e,t,r){const n=e[4*t],a=e[4*t+1],i=e[4*t+2],o=e[4*t+3],s=(a-n)/r;for(let l=0;l<r;l++){const r=4*(t+l);e[r]=n+s*l,e[r+1]=n+s*(l+1),e[r+2]=i,e[r+3]=o}}function u(){return(self.performance||Date).now()}function c(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return c.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(e){let t=c.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new c;return t.data=this.data.splice(e*f.length),t}},c.flyweight=f.reduce(((e,t,r,n)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*f.length+r]},set(e){this.data[this.index*f.length+r]=e}}),e)),{data:null,index:0}),{typeset:o,measure:function(e,t){o({...e,metricsOnly:!0},(e=>{const[r,n,a,i]=e.blockBounds;t({width:a-r,height:i-n})}))}}},Et,function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(t).forEach((function(e,t){r[e]=1<<t+1,n[r[e]]=e})),Object.freeze(r);var a=r.LRI|r.RLI|r.FSI,i=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,s=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,l=r.S|r.WS|r.B|a|r.PDI|s,u=null;function c(e){return function(){if(!u){u=new Map;var e=function(e){if(t.hasOwnProperty(e)){var n=0;t[e].split(",").forEach((function(t){var a=t.split("+"),i=a[0],o=a[1];i=parseInt(i,36),o=o?parseInt(o,36):0,u.set(n+=i,r[e]);for(var s=0;s<o;s++)u.set(++n,r[e])}))}};for(var n in t)e(n)}}(),u.get(e.codePointAt(0))||r.L}var f,d,h,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",v="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(e,t){var r,n=0,a=new Map,i=t&&new Map;return e.split(",").forEach((function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(r);else{r=o;var l=o.split(">"),u=l[0],c=l[1];u=String.fromCodePoint(n+=parseInt(u,36)),c=String.fromCodePoint(n+=parseInt(c,36)),a.set(u,c),t&&i.set(c,u)}})),{map:a,reverseMap:i}}function m(){if(!f){var e=g(p,!0),t=e.map,r=e.reverseMap;f=t,d=r,h=g(v,!1).map}}function y(e){return m(),f.get(e)||null}function b(e){return m(),d.get(e)||null}function w(e){return m(),h.get(e)||null}var x=r.L,S=r.R,U=r.EN,_=r.ES,k=r.ET,T=r.AN,M=r.CS,C=r.B,E=r.S,F=r.ON,A=r.BN,R=r.NSM,I=r.AL,D=r.LRO,P=r.RLO,O=r.LRE,B=r.RLE,L=r.PDF,G=r.LRI,z=r.RLI,j=r.FSI,W=r.PDI;var N;function V(e){return function(){if(!N){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach((function(e,r){t.set(r,e)})),N=t}}(),N.get(e)||null}function H(e,t,r,n){var a=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(a-1,null==n?a-1:+n);var i=[];return t.paragraphs.forEach((function(a){var o=Math.max(r,a.start),s=Math.min(n,a.end);if(o<s){for(var u=t.levels.slice(o,s+1),f=s;f>=o&&c(e[f])&l;f--)u[f]=a.level;for(var d=a.level,h=1/0,p=0;p<u.length;p++){var v=u[p];v>d&&(d=v),v<h&&(h=1|v)}for(var g=d;g>=h;g--)for(var m=0;m<u.length;m++)if(u[m]>=g){for(var y=m;m+1<u.length&&u[m+1]>=g;)m++;m>y&&i.push([y+o,m+o])}}})),i}function q(e,t,r,n){for(var a=H(e,t,r,n),i=[],o=0;o<e.length;o++)i[o]=o;return a.forEach((function(e){for(var t=e[0],r=e[1],n=i.slice(t,r+1),a=n.length;a--;)i[r-a]=n[a]})),i}return e.closingToOpeningBracket=b,e.getBidiCharType=c,e.getBidiCharTypeName=function(e){return n[c(e)]},e.getCanonicalBracket=w,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),n=0;n<e.length;n++)r[n]=c(e[n]);var u=new Map;function f(e,t){var n=r[e];r[e]=t,u.set(n,u.get(n)-1),n&o&&u.set(o,u.get(o)-1),u.set(t,(u.get(t)||0)+1),t&o&&u.set(o,(u.get(o)||0)+1)}for(var d=new Uint8Array(e.length),h=new Map,p=[],v=null,g=0;g<e.length;g++)v||p.push(v={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:jt(g,!1)}),r[g]&C&&(v.end=g,v=null);for(var m=B|O|P|D|a|W|L|C,N=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},H=0;H<p.length;H++){var q=[{_level:(v=p[H]).level,_override:0,_isolate:0}],X=void 0,$=0,Y=0,Z=0;u.clear();for(var K=v.start;K<=v.end;K++){var Q=r[K];if(X=q[q.length-1],u.set(Q,(u.get(Q)||0)+1),Q&o&&u.set(o,(u.get(o)||0)+1),Q&m)if(Q&(B|O)){d[K]=X._level;var J=(Q===B?V:N)(X._level);J<=125&&!$&&!Y?q.push({_level:J,_override:0,_isolate:0}):$||Y++}else if(Q&(P|D)){d[K]=X._level;var ee=(Q===P?V:N)(X._level);ee<=125&&!$&&!Y?q.push({_level:ee,_override:Q&P?S:x,_isolate:0}):$||Y++}else if(Q&a){Q&j&&(Q=1===jt(K+1,!0)?z:G),d[K]=X._level,X._override&&f(K,X._override);var te=(Q===z?V:N)(X._level);te<=125&&0===$&&0===Y?(Z++,q.push({_level:te,_override:0,_isolate:1,_isolInitIndex:K})):$++}else if(Q&W){if($>0)$--;else if(Z>0){for(Y=0;!q[q.length-1]._isolate;)q.pop();var re=q[q.length-1]._isolInitIndex;null!=re&&(h.set(re,K),h.set(K,re)),q.pop(),Z--}X=q[q.length-1],d[K]=X._level,X._override&&f(K,X._override)}else Q&L?(0===$&&(Y>0?Y--:!X._isolate&&q.length>1&&(q.pop(),X=q[q.length-1])),d[K]=X._level):Q&C&&(d[K]=v.level);else d[K]=X._level,X._override&&Q!==A&&f(K,X._override)}for(var ne=[],ae=null,ie=v.start;ie<=v.end;ie++){var oe=r[ie];if(!(oe&s)){var se=d[ie],le=oe&a,ue=oe===W;ae&&se===ae._level?(ae._end=ie,ae._endsWithIsolInit=le):ne.push(ae={_start:ie,_end:ie,_level:se,_startsWithPDI:ue,_endsWithIsolInit:le})}}for(var ce=[],fe=0;fe<ne.length;fe++){var de=ne[fe];if(!de._startsWithPDI||de._startsWithPDI&&!h.has(de._start)){for(var he=[ae=de],pe=void 0;ae&&ae._endsWithIsolInit&&null!=(pe=h.get(ae._end));)for(var ve=fe+1;ve<ne.length;ve++)if(ne[ve]._start===pe){he.push(ae=ne[ve]);break}for(var ge=[],me=0;me<he.length;me++)for(var ye=he[me],be=ye._start;be<=ye._end;be++)ge.push(be);for(var we=d[ge[0]],xe=v.level,Se=ge[0]-1;Se>=0;Se--)if(!(r[Se]&s)){xe=d[Se];break}var Ue=ge[ge.length-1],_e=d[Ue],ke=v.level;if(!(r[Ue]&a))for(var Te=Ue+1;Te<=v.end;Te++)if(!(r[Te]&s)){ke=d[Te];break}ce.push({_seqIndices:ge,_sosType:Math.max(xe,we)%2?S:x,_eosType:Math.max(ke,_e)%2?S:x})}}for(var Me=0;Me<ce.length;Me++){var Ce=ce[Me],Ee=Ce._seqIndices,Fe=Ce._sosType,Ae=Ce._eosType,Re=1&d[Ee[0]]?S:x;if(u.get(R))for(var Ie=0;Ie<Ee.length;Ie++){var De=Ee[Ie];if(r[De]&R){for(var Pe=Fe,Oe=Ie-1;Oe>=0;Oe--)if(!(r[Ee[Oe]]&s)){Pe=r[Ee[Oe]];break}f(De,Pe&(a|W)?F:Pe)}}if(u.get(U))for(var Be=0;Be<Ee.length;Be++){var Le=Ee[Be];if(r[Le]&U)for(var Ge=Be-1;Ge>=-1;Ge--){var ze=-1===Ge?Fe:r[Ee[Ge]];if(ze&i){ze===I&&f(Le,T);break}}}if(u.get(I))for(var je=0;je<Ee.length;je++){var We=Ee[je];r[We]&I&&f(We,S)}if(u.get(_)||u.get(M))for(var Ne=1;Ne<Ee.length-1;Ne++){var Ve=Ee[Ne];if(r[Ve]&(_|M)){for(var He=0,qe=0,Xe=Ne-1;Xe>=0&&(He=r[Ee[Xe]])&s;Xe--);for(var $e=Ne+1;$e<Ee.length&&(qe=r[Ee[$e]])&s;$e++);He===qe&&(r[Ve]===_?He===U:He&(U|T))&&f(Ve,He)}}if(u.get(U))for(var Ye=0;Ye<Ee.length;Ye++){var Ze=Ee[Ye];if(r[Ze]&U){for(var Ke=Ye-1;Ke>=0&&r[Ee[Ke]]&(k|s);Ke--)f(Ee[Ke],U);for(Ye++;Ye<Ee.length&&r[Ee[Ye]]&(k|s|U);Ye++)r[Ee[Ye]]!==U&&f(Ee[Ye],U)}}if(u.get(k)||u.get(_)||u.get(M))for(var Qe=0;Qe<Ee.length;Qe++){var Je=Ee[Qe];if(r[Je]&(k|_|M)){f(Je,F);for(var et=Qe-1;et>=0&&r[Ee[et]]&s;et--)f(Ee[et],F);for(var tt=Qe+1;tt<Ee.length&&r[Ee[tt]]&s;tt++)f(Ee[tt],F)}}if(u.get(U))for(var rt=0,nt=Fe;rt<Ee.length;rt++){var at=Ee[rt],it=r[at];it&U?nt===x&&f(at,x):it&i&&(nt=it)}if(u.get(o)){for(var ot=S|U|T,st=ot|x,lt=[],ut=[],ct=0;ct<Ee.length;ct++)if(r[Ee[ct]]&o){var ft=e[Ee[ct]],dt=void 0;if(null!==y(ft)){if(!(ut.length<63))break;ut.push({char:ft,seqIndex:ct})}else if(null!==(dt=b(ft)))for(var ht=ut.length-1;ht>=0;ht--){var pt=ut[ht].char;if(pt===dt||pt===b(w(ft))||y(w(pt))===ft){lt.push([ut[ht].seqIndex,ct]),ut.length=ht;break}}}lt.sort((function(e,t){return e[0]-t[0]}));for(var vt=0;vt<lt.length;vt++){for(var gt=lt[vt],mt=gt[0],yt=gt[1],bt=!1,wt=0,xt=mt+1;xt<yt;xt++){var St=Ee[xt];if(r[St]&st){bt=!0;var Ut=r[St]&ot?S:x;if(Ut===Re){wt=Ut;break}}}if(bt&&!wt){wt=Fe;for(var _t=mt-1;_t>=0;_t--){var kt=Ee[_t];if(r[kt]&st){var Tt=r[kt]&ot?S:x;wt=Tt!==Re?Tt:Re;break}}}if(wt){if(r[Ee[mt]]=r[Ee[yt]]=wt,wt!==Re)for(var Mt=mt+1;Mt<Ee.length;Mt++)if(!(r[Ee[Mt]]&s)){c(e[Ee[Mt]])&R&&(r[Ee[Mt]]=wt);break}if(wt!==Re)for(var Ct=yt+1;Ct<Ee.length;Ct++)if(!(r[Ee[Ct]]&s)){c(e[Ee[Ct]])&R&&(r[Ee[Ct]]=wt);break}}}for(var Et=0;Et<Ee.length;Et++)if(r[Ee[Et]]&o){for(var Ft=Et,At=Et,Rt=Fe,It=Et-1;It>=0;It--){if(!(r[Ee[It]]&s)){Rt=r[Ee[It]]&ot?S:x;break}Ft=It}for(var Dt=Ae,Pt=Et+1;Pt<Ee.length;Pt++){if(!(r[Ee[Pt]]&(o|s))){Dt=r[Ee[Pt]]&ot?S:x;break}At=Pt}for(var Ot=Ft;Ot<=At;Ot++)r[Ee[Ot]]=Rt===Dt?Rt:Re;Et=At}}}for(var Bt=v.start;Bt<=v.end;Bt++){var Lt=d[Bt],Gt=r[Bt];if(1&Lt?Gt&(x|U|T)&&d[Bt]++:Gt&S?d[Bt]++:Gt&(T|U)&&(d[Bt]+=2),Gt&s&&(d[Bt]=0===Bt?v.level:d[Bt-1]),Bt===v.end||c(e[Bt])&(E|C))for(var zt=Bt;zt>=0&&c(e[zt])&l;zt--)d[zt]=v.level}}return{levels:d,paragraphs:p};function jt(t,n){for(var i=t;i<e.length;i++){var o=r[i];if(o&(S|I))return 1;if(o&(C|x)||n&&o===W)return 0;if(o&a){var s=Wt(i);i=-1===s?e.length:s}}return 0}function Wt(t){for(var n=1,i=t+1;i<e.length;i++){var o=r[i];if(o&C)break;if(o&W){if(0==--n)return i}else o&a&&n++}return-1}},e.getMirroredCharacter=V,e.getMirroredCharactersMap=function(e,t,r,n){var a=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(a-1,null==n?a-1:+n);for(var i=new Map,o=r;o<=n;o++)if(1&t[o]){var s=V(e[o]);null!==s&&i.set(o,s)}return i},e.getReorderSegments=H,e.getReorderedIndices=q,e.getReorderedString=function(e,t,r,n){var a=q(e,t,r,n),i=[].concat(e);return a.forEach((function(r,n){i[n]=(1&t.levels[r]?V(e[r]):null)||e[r]})),i.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}],init:(e,t,r)=>e(t,r())}),Jt=ft({name:"Typesetter",dependencies:[Qt],init:e=>function(t){return new Promise((r=>{e.typeset(t,r)}))},getTransferables(e){const t=[];for(let r in e)e[r]&&e[r].buffer&&t.push(e[r].buffer);return t}});Jt.onMainThread;const er={};const tr="aTroikaGlyphIndex";class rr extends T{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new M,this.boundingBox=new C}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=er[e];return t||(t=er[e]=new I(1,1,e,e).translate(.5,.5,0)),t}(e);["position","normal","uv"].forEach((e=>{this.attributes[e]=t.attributes[e].clone()})),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,n,a){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(tr,t,1),this.updateAttributeData("aTroikaGlyphColor",a,3),this._blockBounds=r,this._chunkedBounds=n,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:r}=this;if(t){const{PI:n,floor:a,min:i,max:o,sin:s,cos:l}=Math,u=n/2,c=2*n,f=Math.abs(t),d=e[0]/f,h=e[2]/f,p=a((d+u)/c)!==a((h+u)/c)?-f:i(s(d)*f,s(h)*f),v=a((d-u)/c)!==a((h-u)/c)?f:o(s(d)*f,s(h)*f),g=a((d+n)/c)!==a((h+n)/c)?2*f:o(f-l(d)*f,f-l(h)*f);r.min.set(p,e[1],t<0?-g:0),r.max.set(v,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(tr).count,r=this._chunkedBounds;if(r)for(let n=r.length;n--;){t=r[n].end;let a=r[n].rect;if(a[1]<e.w&&a[3]>e.y&&a[0]<e.z&&a[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){const n=this.getAttribute(e);t?n&&n.array.length===t.length?(n.array.set(t),n.needsUpdate=!0):(this.setAttribute(e,new E(t,r)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const nr=new S({color:16777215,side:c,transparent:!0}),ar=8421504,ir=new _,or=new n,sr=new n,lr=[],ur=new n,cr="+x+y";function fr(e){return Array.isArray(e)?e[0]:e}let dr=()=>{const e=new s(new I(1,1),nr);return dr=()=>e,e},hr=()=>{const e=new s(new I(1,1,32,1),nr);return hr=()=>e,e};const pr={type:"syncstart"},vr={type:"synccomplete"},gr=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],mr=gr.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let yr=class extends s{constructor(){super(new rr,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=ar,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=cr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(pr),Xt({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},(t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{r.forEach((e=>e&&e()))}))),this.dispatchEvent(vr),e&&e()}))))}onBeforeRender(e,t,r,n,a,i){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return function(e){const t=Ut(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new k},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new R(0,0,0,0)},uTroikaClipRect:{value:new R(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new k},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new U},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new A},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(vt,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=nr.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",(function r(){t.removeEventListener("dispose",r),e.dispose()}))),this.hasOutline()){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",(function r(){e.removeEventListener("dispose",r),t.dispose()}))),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return fr(this.material).getDepthMaterial()}get customDistanceMaterial(){return fr(this.material).getDistanceMaterial()}_prepareForRender(e){const t=e.isTextOutlineMaterial,r=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:e,blockBounds:a}=n;r.uTroikaSDFTexture.value=e,r.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),r.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,r.uTroikaSDFExponent.value=n.sdfExponent,r.uTroikaTotalBounds.value.fromArray(a),r.uTroikaUseGlyphColors.value=!t&&!!n.glyphColors;let i,o,s,l=0,u=0,c=0,f=0,d=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:r,outlineBlur:n,outlineOpacity:a}=this;l=this._parsePercent(e)||0,u=Math.max(0,this._parsePercent(n)||0),i=a,f=this._parsePercent(t)||0,d=this._parsePercent(r)||0}else c=Math.max(0,this._parsePercent(this.strokeWidth)||0),c&&(s=this.strokeColor,r.uTroikaStrokeColor.value.set(null==s?ar:s),o=this.strokeOpacity,null==o&&(o=1)),i=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(f,d),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=c,r.uTroikaStrokeOpacity.value=o,r.uTroikaFillOpacity.value=null==i?1:i,r.uTroikaCurveRadius.value=this.curveRadius||0;let h=this.clipRect;if(h&&Array.isArray(h)&&4===h.length)r.uTroikaClipRect.value.fromArray(h);else{const e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(a[0]-e,a[1]-e,a[2]+e,a[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const a=t?this.outlineColor||0:this.color;if(null==a)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new U;a===t._input&&"object"!=typeof a||t.set(t._input=a)}let i=this.orientation||cr;if(i!==e._orientation){let t=r.uTroikaOrient.value;i=i.replace(/[^-+xyz]/g,"");let n=i!==cr&&i.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,e,r,a,i]=n;or.set(0,0,0)[r]="-"===e?1:-1,sr.set(0,0,0)[i]="-"===a?-1:1,ir.lookAt(ur,or.cross(sr),sr),t.setFromMatrix4(ir)}else t.identity();e._orientation=i}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new k){t.copy(e);const r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new k){return or.copy(e),this.localPositionToTextCoords(this.worldToLocal(or),t)}raycast(e,t){const{textRenderInfo:r,curveRadius:n}=this;if(r){const a=r.blockBounds,i=n?hr():dr(),o=i.geometry,{position:s,uv:l}=o.attributes;for(let e=0;e<l.count;e++){let t=a[0]+l.getX(e)*(a[2]-a[0]);const r=a[1]+l.getY(e)*(a[3]-a[1]);let i=0;n&&(i=n-Math.cos(t/n)*n,t=Math.sin(t/n)*n),s.setXYZ(e,t,r,i)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,i.matrixWorld=this.matrixWorld,i.material.side=this.material.side,lr.length=0,i.raycast(e,lr);for(let e=0;e<lr.length;e++)lr[e].object=this,t.push(lr[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,mr.forEach((t=>{this[t]=e[t]})),this}clone(){return(new this.constructor).copy(this)}};gr.forEach((e=>{const t="_private_"+e;Object.defineProperty(yr.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})})),new C,new U;const br=t.forwardRef((({sdfGlyphSize:e=64,anchorX:r="center",anchorY:n="middle",font:a,fontSize:i=1,children:o,characters:s,onSync:l,...u},c)=>{const f=ae((({invalidate:e})=>e)),[d]=t.useState((()=>new yr)),[h,p]=t.useMemo((()=>{const e=[];let r="";return t.Children.forEach(o,(t=>{"string"==typeof t||"number"==typeof t?r+=t:e.push(t)})),[e,r]}),[o]);return ve((()=>new Promise((e=>function({font:e,characters:t,sdfGlyphSize:r},n){Xt({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},n)}({font:a,characters:s},e)))),["troika-text",a,s]),t.useLayoutEffect((()=>{d.sync((()=>{f(),l&&l(d)}))})),t.useEffect((()=>()=>d.dispose()),[d]),t.createElement("primitive",ye({object:d,ref:c,font:a,text:p,anchorX:r,anchorY:n,fontSize:i,sdfGlyphSize:e},u),h)})),wr=(e,t,r)=>{let n;switch(e){case q:n=new Uint8ClampedArray(t*r*4);break;case d:n=new Uint16Array(t*r*4);break;case H:n=new Uint32Array(t*r*4);break;case V:n=new Int8Array(t*r*4);break;case N:n=new Int16Array(t*r*4);break;case W:n=new Int32Array(t*r*4);break;case h:n=new Float32Array(t*r*4);break;default:throw new Error("Unsupported data type")}return n};let xr;class Sr{constructor(e){var t,r,n,a,i,o,l,u,c,f,p,m,y,b,w,x;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Kr){throw this._renderer.setRenderTarget(null),Kr}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const U={format:g,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(r=e.renderTargetOptions)||void 0===r?void 0:r.anisotropy:1,generateMipmaps:void 0!==(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps)&&(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.generateMipmaps),magFilter:void 0!==(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.magFilter)?null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter:v,minFilter:void 0!==(null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.minFilter:v,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.samples:void 0,wrapS:void 0!==(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapS)?null===(m=e.renderTargetOptions)||void 0===m?void 0:m.wrapS:D,wrapT:void 0!==(null===(y=e.renderTargetOptions)||void 0===y?void 0:y.wrapT)?null===(b=e.renderTargetOptions)||void 0===b?void 0:b.wrapT:D};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Sr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new P,this._camera=new O,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,r,n)=>{if(void 0!==xr)return xr;const a=new B(1,1,n);t.setRenderTarget(a);const i=new s(new I,new S({color:16777215}));t.render(i,r),t.setRenderTarget(null);const o=wr(e,a.width,a.height);return t.readRenderTargetPixels(a,0,0,a.width,a.height,o),a.dispose(),i.geometry.dispose(),i.material.dispose(),xr=0!==o[0],xr})(this._type,this._renderer,this._camera,U)){let e;if(this._type===d)e=this._renderer.extensions.has("EXT_color_buffer_float")?h:void 0;void 0!==e?this._type=e:this._supportsReadPixels=!1}this._quad=new s(new I,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new B(this.width,this.height,U),this._renderTarget.texture.mapping=void 0!==(null===(w=e.renderTargetOptions)||void 0===w?void 0:w.mapping)?null===(x=e.renderTargetOptions)||void 0===x?void 0:x.mapping:L}static instantiateRenderer(){const e=new G;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=wr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new z(this.toArray(),this.width,this.height,g,this._type,(null==e?void 0:e.mapping)||L,(null==e?void 0:e.wrapS)||D,(null==e?void 0:e.wrapT)||D,(null==e?void 0:e.magFilter)||v,(null==e?void 0:e.minFilter)||v,(null==e?void 0:e.anisotropy)||1,j);return t.generateMipmaps=void 0!==(null==e?void 0:e.generateMipmaps)&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof a&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof F&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof F&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Ur extends a{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:a,gainMapMax:i,maxDisplayBoost:o,hdrCapacityMin:s,hdrCapacityMax:l,sdr:u,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:u},gainMap:{value:c},gamma:{value:new n(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new n).fromArray(t)},offsetSdr:{value:(new n).fromArray(r)},gainMapMin:{value:(new n).fromArray(a)},gainMapMax:{value:(new n).fromArray(i)},weightFactor:{value:(Math.log2(o)-s)/(l-s)}},blending:Q,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=s,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class _r extends Error{}class kr extends Error{}const Tr=(e,t,r)=>{const n=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(n)return n[1];const a=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(a){const e=a[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map((e=>e.replace(/<\/?rdf:li>/g,""))):a[1].trim()}if(void 0!==r)return r;throw new Error(`Can't find ${t} in gainmap metadata`)};class Mr{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,r)=>{this.options.debug;const n=new DataView(e.buffer);if(65496!==n.getUint16(0))return void r(new Error("Not a valid jpeg"));const a=n.byteLength;let i,o=2,s=0;for(;o<a;){if(++s>250)return void r(new Error(`Found no marker after ${s} loops 😵`));if(255!==n.getUint8(o))return void r(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${n.getUint8(o).toString(16)}`));if(i=n.getUint8(o+1),226===i){const e=o+4;if(1297106432===n.getUint32(e)){const a=e+4;let i;if(18761===n.getUint16(a))i=!1;else{if(19789!==n.getUint16(a))return void r(new Error("No valid endianness marker found in TIFF header"));i=!0}if(42!==n.getUint16(a+2,!i))return void r(new Error("Not valid TIFF data! (no 0x002A marker)"));const o=n.getUint32(a+4,!i);if(o<8)return void r(new Error("Not valid TIFF data! (First offset less than 8)"));const s=a+o,l=n.getUint16(s,!i),u=s+2;let c=0;for(let e=u;e<u+12*l;e+=12)45057===n.getUint16(e,!i)&&(c=n.getUint32(e+8,!i));const f=s+2+12*l+4,d=[];for(let e=f;e<f+16*c;e+=16){const t={MPType:n.getUint32(e,!i),size:n.getUint32(e+4,!i),dataOffset:n.getUint32(e+8,!i),dependantImages:n.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=a+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){const e=new Blob([n]),r=[];for(const t of d){if(t.isFII&&!this.options.extractFII)continue;const n=e.slice(t.start,t.end+1,"image/jpeg");r.push(n)}t(r)}}}o+=2+n.getUint16(o+2)}}))}}const Cr=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let r=t.indexOf("<x:xmpmeta");for(;-1!==r;){const e=t.indexOf("x:xmpmeta>",r),n=t.slice(r,e+10);try{const e=Tr(n,"hdrgm:GainMapMin","0"),t=Tr(n,"hdrgm:GainMapMax"),r=Tr(n,"hdrgm:Gamma","1"),a=Tr(n,"hdrgm:OffsetSDR","0.015625"),i=Tr(n,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(n),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(n);if(!l)throw new Error("Incomplete gainmap metadata");const u=l[1];return{gainMapMin:Array.isArray(e)?e.map((e=>parseFloat(e))):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map((e=>parseFloat(e))):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map((e=>parseFloat(e))):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(a)?a.map((e=>parseFloat(e))):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetHdr:Array.isArray(i)?i.map((e=>parseFloat(e))):[parseFloat(i),parseFloat(i),parseFloat(i)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(u)}}catch(Kr){}r=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new kr("Gain map XMP metadata not found");const r=new Mr({extractFII:!0,extractNonFII:!0}),n=await r.extract(e);if(2!==n.length)throw new _r("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:t}},Er=e=>new Promise(((t,r)=>{const n=document.createElement("img");n.onload=()=>{t(n)},n.onerror=e=>{r(e)},n.src=URL.createObjectURL(e)}));class Fr extends ${constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new Y}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer;const e=new Ur({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new F,sdr:new F});return new Sr({width:16,height:16,type:d,colorSpace:j,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,n){const a=n?new Blob([n],{type:"image/jpeg"}):void 0,i=new Blob([r],{type:"image/jpeg"});let o,s,l=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([a?Er(a):Promise.resolve(void 0),Er(i)]);s=e[0],o=e[1],l=!0}else{const e=await Promise.all([a?createImageBitmap(a,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(i,{imageOrientation:"flipY"})]);s=e[0],o=e[1]}const u=new F(s||new ImageData(2,2),L,D,D,v,Z,g,q,1,j);u.flipY=l,u.needsUpdate=!0;const c=new F(o,L,D,D,v,Z,g,q,1,K);c.flipY=l,c.needsUpdate=!0,e.width=o.width,e.height=o.height,e.material.gainMap=u,e.material.sdr=c,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Ar extends Fr{load([e,t,r],n,a,i){const o=this.prepareQuadRenderer();let s,l,u;const c=async()=>{if(s&&l&&u){try{await this.render(o,u,s,l)}catch(a){return this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof i&&i(a),void o.disposeOnDemandRenderer()}"function"==typeof n&&n(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),o.disposeOnDemandRenderer()}};let f=!0,d=0,h=0,p=!0,v=0,g=0,m=!0,y=0,b=0;const w=()=>{if("function"==typeof a){a(new ProgressEvent("progress",{lengthComputable:f&&p&&m,loaded:h+g+b,total:d+v+y}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);const x=new X(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(e,(async e=>{if("string"==typeof e)throw new Error("Invalid sdr buffer");s=e,await c()}),(e=>{f=e.lengthComputable,h=e.loaded,d=e.total,w()}),(t=>{this.manager.itemError(e),"function"==typeof i&&i(t)}));const S=new X(this._internalLoadingManager);S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(t,(async e=>{if("string"==typeof e)throw new Error("Invalid gainmap buffer");l=e,await c()}),(e=>{p=e.lengthComputable,g=e.loaded,v=e.total,w()}),(e=>{this.manager.itemError(t),"function"==typeof i&&i(e)}));const U=new X(this._internalLoadingManager);return U.setRequestHeader(this.requestHeader),U.setPath(this.path),U.setWithCredentials(this.withCredentials),U.load(r,(async e=>{if("string"!=typeof e)throw new Error("Invalid metadata string");u=JSON.parse(e),await c()}),(e=>{m=e.lengthComputable,b=e.loaded,y=e.total,w()}),(e=>{this.manager.itemError(r),"function"==typeof i&&i(e)})),o}}class Rr extends Fr{load(e,t,r,n){const a=this.prepareQuadRenderer(),i=new X(this._internalLoadingManager);return i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setPath(this.path),i.setWithCredentials(this.withCredentials),this.manager.itemStart(e),i.load(e,(async r=>{if("string"==typeof r)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const i=new Uint8Array(r);let o,s,l;try{const e=await Cr(i);o=e.sdr,s=e.gainMap,l=e.metadata}catch(Kr){if(!(Kr instanceof kr||Kr instanceof _r))throw Kr;l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},o=i}try{await this.render(a,l,o,s)}catch(u){return this.manager.itemError(e),"function"==typeof n&&n(u),void a.disposeOnDemandRenderer()}"function"==typeof t&&t(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()}),r,(t=>{this.manager.itemError(e),"function"==typeof n&&n(t)})),a}}const Ir={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Dr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Pr=e=>Array.isArray(e),Or=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Br({files:e=Or,path:r="",preset:n,encoding:a,extensions:i}={}){let o=null,s=!1;n&&(zr(n),e=Ir[n],r=Dr),s=Pr(e);const{extension:l,isCubemap:u}=jr(e);if(o=Wr(l),!o)throw new Error("useEnvironment: Unrecognized file extension: "+e);const c=ae((e=>e.gl));t.useLayoutEffect((()=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||c.domElement.addEventListener("webglcontextlost",(function(){ie.clear(o,s?[e]:e)}),{once:!0})}),[e,c.domElement]);const f=ie(o,s?[e]:e,(e=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||e.setRenderer(c),null==e.setPath||e.setPath(r),i&&i(e)}));let d=s?f[0]:f;var h;"jpg"!==l&&"jpeg"!==l&&"webp"!==l||(d=null==(h=d.renderTarget)?void 0:h.texture);return d.mapping=u?J:ee,"colorSpace"in d?d.colorSpace=(null!=a?a:u)?"srgb":"srgb-linear":d.encoding=(null!=a?a:u)?3001:3e3,d}const Lr={files:Or,path:"",preset:void 0,extensions:void 0};Br.preload=e=>{const t={...Lr,...e};let{files:r,path:n=""}=t;const{preset:a,extensions:i}=t;a&&(zr(a),r=Ir[a],n=Dr);const{extension:o}=jr(r);if("webp"===o||"jpg"===o||"jpeg"===o)throw new Error("useEnvironment: Preloading gainmaps is not supported");const s=Wr(o);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+r);ie.preload(s,Pr(r)?[r]:r,(e=>{null==e.setPath||e.setPath(n),i&&i(e)}))};const Gr={files:Or,preset:void 0};function zr(e){if(!(e in Ir))throw new Error("Preset must be one of: "+Object.keys(Ir).join(", "))}function jr(e){var t;const r=Pr(e)&&6===e.length,n=Pr(e)&&3===e.length&&e.some((e=>e.endsWith("json"))),a=Pr(e)?e[0]:e;return{extension:r?"cube":n?"webp":a.startsWith("data:application/exr")?"exr":a.startsWith("data:application/hdr")?"hdr":a.startsWith("data:image/jpeg")?"jpg":null==(t=a.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:n}}function Wr(e){return"cube"===e?te:"hdr"===e?et:"exr"===e?rt:"jpg"===e||"jpeg"===e?Rr:"webp"===e?Ar:null}Br.clear=e=>{const t={...Gr,...e};let{files:r}=t;const{preset:n}=t;n&&(zr(n),r=Ir[n]);const{extension:a}=jr(r),i=Wr(a);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+r);ie.clear(i,Pr(r)?[r]:r)};function Nr(e,t,r,n,a={}){var i,o,s,l;a={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...a};const u=(e=>{return(t=e).current&&t.current.isScene?e.current:e;var t})(t||r),c=u.background,f=u.environment,d={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:null!==(i=null==(o=u.backgroundRotation)||null==o.clone?void 0:o.clone())&&void 0!==i?i:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:null!==(s=null==(l=u.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==s?s:[0,0,0]};return"only"!==e&&(u.environment=n),e&&(u.background=n),ue(u,a),()=>{"only"!==e&&(u.environment=f),e&&(u.background=c),ue(u,d)}}function Vr({scene:e,background:r=!1,map:n,...a}){const i=ae((e=>e.scene));return t.useLayoutEffect((()=>{if(n)return Nr(r,e,i,n,a)})),null}function Hr({background:e=!1,scene:r,blur:n,backgroundBlurriness:a,backgroundIntensity:i,backgroundRotation:o,environmentIntensity:s,environmentRotation:l,...u}){const c=Br(u),f=ae((e=>e.scene));return t.useLayoutEffect((()=>Nr(e,r,f,c,{backgroundBlurriness:null!=n?n:a,backgroundIntensity:i,backgroundRotation:o,environmentIntensity:s,environmentRotation:l}))),t.useEffect((()=>()=>{c.dispose()}),[c]),null}function qr({children:e,near:r=.1,far:n=1e3,resolution:a=256,frames:i=1,map:o,background:s=!1,blur:l,backgroundBlurriness:u,backgroundIntensity:c,backgroundRotation:f,environmentIntensity:h,environmentRotation:p,scene:v,files:g,path:m,preset:y,extensions:b}){const w=ae((e=>e.gl)),x=ae((e=>e.scene)),S=t.useRef(null),[U]=t.useState((()=>new P)),_=t.useMemo((()=>{const e=new re(a);return e.texture.type=d,e}),[a]);t.useEffect((()=>()=>{_.dispose()}),[_]),t.useLayoutEffect((()=>{if(1===i){const e=w.autoClear;w.autoClear=!0,S.current.update(w,U),w.autoClear=e}return Nr(s,v,x,_.texture,{backgroundBlurriness:null!=l?l:u,backgroundIntensity:c,backgroundRotation:f,environmentIntensity:h,environmentRotation:p})}),[e,U,_.texture,v,x,s,i,w]);let k=1;return se((()=>{if(i===1/0||k<i){const e=w.autoClear;w.autoClear=!0,S.current.update(w,U),w.autoClear=e,k++}})),t.createElement(t.Fragment,null,le(t.createElement(t.Fragment,null,e,t.createElement("cubeCamera",{ref:S,args:[r,n,_]}),g||y?t.createElement(Hr,{background:!0,files:g,preset:y,path:m,extensions:b}):o?t.createElement(Vr,{background:!0,map:o,extensions:b}):null),U))}function Xr(e){var r,n,a,i;const o=Br(e),s=e.map||o;t.useMemo((()=>oe({GroundProjectedEnvImpl:Je})),[]),t.useEffect((()=>()=>{o.dispose()}),[o]);const l=t.useMemo((()=>[s]),[s]),u=null==(r=e.ground)?void 0:r.height,c=null==(n=e.ground)?void 0:n.radius,f=null!==(a=null==(i=e.ground)?void 0:i.scale)&&void 0!==a?a:1e3;return t.createElement(t.Fragment,null,t.createElement(Vr,ye({},e,{map:s})),t.createElement("groundProjectedEnvImpl",{args:l,scale:f,height:u,radius:c}))}function $r(e){return e.ground?t.createElement(Xr,e):e.map?t.createElement(Vr,e):e.children?t.createElement(qr,e):t.createElement(Hr,e)}function Yr(e,t,r=new n){const a=Math.PI*(e-.5),i=2*Math.PI*(t-.5);return r.x=Math.cos(i),r.y=Math.sin(a),r.z=Math.sin(i),r}const Zr=t.forwardRef((({inclination:e=.6,azimuth:r=.1,distance:a=1e3,mieCoefficient:i=.005,mieDirectionalG:o=.8,rayleigh:s=.5,turbidity:l=10,sunPosition:u=Yr(e,r),...c},f)=>{const d=t.useMemo((()=>(new n).setScalar(a)),[a]),[h]=t.useState((()=>new Qe));return t.createElement("primitive",ye({object:h,ref:f,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":o,"material-uniforms-rayleigh-value":s,"material-uniforms-sunPosition-value":u,"material-uniforms-turbidity-value":l,scale:d},c))}));export{$r as E,xe as K,Zr as S,br as T,ce as a,me as c,ge as p,ve as s,Se as u};
