{"version":3,"file":"index-IaYM6-T7.js","sources":["../../src/utils/MapStore.js","../../src/components/maps/terrain/OriginalTerrain.jsx","../../src/components/Terrain.jsx","../../src/components/Road.jsx","../../src/components/maps/objects/OriginalEnvironmentObjects.jsx","../../src/utils/GameContext.jsx","../../src/components/KeyboardControls.jsx","../../src/components/player/PlayerController.jsx","../../src/utils/VehicleHealthSystem.jsx","../../src/utils/WeaponPhysics.jsx","../../src/components/effects/Explosion.jsx","../../src/components/effects/ExplosionsManager.jsx","../../src/components/effects/DamageIndicator.jsx","../../src/components/effects/ShotgunMuzzleFlash.jsx","../../src/components/effects/ShotgunEffectsManager.jsx","../../src/components/drones/Grenadier.jsx","../../src/components/drones/Kamikaze.jsx","../../src/components/drones/Bomber.jsx","../../src/components/DroneSwitcher.jsx","../../src/components/vehicles/TankVehicles.jsx","../../src/components/vehicles/IFVVehicles.jsx","../../src/components/vehicles/TruckVehicles.jsx","../../src/components/vehicles/CarVehicles.jsx","../../src/components/vehicles/index.js","../../src/components/vehicles/withVehicleHealth.jsx","../../src/components/vehicles/enhancedVehicles.js","../../src/components/VehiclesOnRoad.jsx","../../src/components/VehicleSelector.jsx","../../src/components/maps/OriginalMap.jsx","../../src/components/maps/terrain/DesertTerrain.jsx","../../src/components/maps/objects/DesertEnvironmentObjects.jsx","../../src/components/maps/DesertMap.jsx","../../src/components/MapContainer.jsx","../../src/components/Scene.jsx","../../src/components/DroneSelector.jsx","../../src/components/ui/VehicleHealthHUD.jsx","../../src/components/ui/ControlsList.jsx","../../src/components/DroneHUDs.jsx","../../src/components/MapSelector.jsx","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["import { create } from 'zustand';\r\n\r\n// Map store for managing different map types\r\nexport const useMapStore = create((set) => ({\r\n    currentMapType: 'original', // Default to original map\r\n    mapData: {\r\n        original: {\r\n            name: 'Original Map',\r\n            terrainSize: 2000,\r\n            type: 'grassland',\r\n            loaded: false\r\n        },\r\n        desert: {\r\n            name: 'Desert Map',\r\n            terrainSize: 2000,\r\n            type: 'desert',\r\n            loaded: false\r\n        }\r\n    },\r\n    // Function to switch maps - completely changes the rendered map\r\n    setMapType: (mapType) => set({\r\n        currentMapType: mapType,\r\n        // Reset other state if needed during map change\r\n        mapData: state => ({\r\n            ...state.mapData,\r\n            [mapType]: {\r\n                ...state.mapData[mapType],\r\n                loaded: true\r\n            }\r\n        })\r\n    })\r\n})); ","import React, { useMemo, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\n\r\n// Constants for original terrain configuration\r\nexport const ORIGINAL_TERRAIN_SIZE = 2000; // 2000m x 2000m\r\nconst CHUNK_SIZE = 205; // Increased from 200 to add slight overlap\r\nconst OVERLAP_FACTOR = 5; // 5 units of overlap between chunks\r\n\r\nexport default function OriginalTerrain() {\r\n    // Calculate chunks count\r\n    const terrainSize = ORIGINAL_TERRAIN_SIZE;\r\n    const chunksCount = useMemo(() => {\r\n        const count = Math.ceil(terrainSize / (CHUNK_SIZE - OVERLAP_FACTOR));\r\n        return { x: count, z: count };\r\n    }, [terrainSize]);\r\n\r\n    const SEGMENTS = 200; // Segment resolution for the entire terrain\r\n    const segmentsPerChunk = useMemo(() => ({\r\n        x: Math.floor(SEGMENTS / chunksCount.x),\r\n        z: Math.floor(SEGMENTS / chunksCount.z)\r\n    }), [chunksCount]);\r\n\r\n    // Create the terrain geometry\r\n    const planeGeometry = useMemo(() => {\r\n        return new THREE.PlaneGeometry(CHUNK_SIZE, CHUNK_SIZE, segmentsPerChunk.x, segmentsPerChunk.z);\r\n    }, [segmentsPerChunk]);\r\n\r\n    // Green, grassy material for original terrain\r\n    const planeMaterial = useMemo(() => {\r\n        return new THREE.MeshStandardMaterial({\r\n            color: '#4d7f38', // Green color for the ground\r\n            roughness: 0.8,\r\n            metalness: 0.1,\r\n            flatShading: false // Disable for smoother appearance\r\n        });\r\n    }, []);\r\n\r\n    // Use instanced mesh for efficient rendering of multiple chunks\r\n    const instancedMeshRef = useRef();\r\n    const tempObject = useMemo(() => new THREE.Object3D(), []);\r\n\r\n    // Create the chunks based on the terrain size\r\n    const chunks = useMemo(() => {\r\n        const result = [];\r\n        const halfSize = terrainSize / 2;\r\n        const chunkOffset = (CHUNK_SIZE - OVERLAP_FACTOR) / 2;\r\n\r\n        for (let x = 0; x < chunksCount.x; x++) {\r\n            for (let z = 0; z < chunksCount.z; z++) {\r\n                result.push({\r\n                    position: [\r\n                        -halfSize + x * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset,\r\n                        0,\r\n                        -halfSize + z * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset\r\n                    ],\r\n                    rotation: [-Math.PI / 2, 0, 0] // Rotate to make it horizontal\r\n                });\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }, [terrainSize, chunksCount]);\r\n\r\n    // Setup the instanced mesh on the first render\r\n    useFrame(() => {\r\n        if (instancedMeshRef.current) {\r\n            chunks.forEach((chunk, i) => {\r\n                const [x, y, z] = chunk.position;\r\n                const [rx, ry, rz] = chunk.rotation;\r\n\r\n                tempObject.position.set(x, y, z);\r\n                tempObject.rotation.set(rx, ry, rz);\r\n                tempObject.updateMatrix();\r\n\r\n                instancedMeshRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n\r\n            instancedMeshRef.current.instanceMatrix.needsUpdate = true;\r\n\r\n            // Only need to run this once to set up the instances\r\n            return null;\r\n        }\r\n    }, [chunks]);\r\n\r\n    return (\r\n        <instancedMesh\r\n            ref={instancedMeshRef}\r\n            args={[planeGeometry, planeMaterial, chunks.length]}\r\n            receiveShadow\r\n        />\r\n    );\r\n} ","import React, { useMemo, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { useMapStore } from '../utils/MapStore';\r\n\r\n// Constants for terrain configuration\r\nexport const ORIGINAL_TERRAIN_SIZE = 2000; // 2000m x 2000m\r\n// Half width map will use the same height but half the width\r\nexport const HALF_WIDTH_TERRAIN_SIZE = { width: ORIGINAL_TERRAIN_SIZE / 2, height: ORIGINAL_TERRAIN_SIZE };\r\n// Desert map will use the same dimensions as the original map\r\nexport const DESERT_TERRAIN_SIZE = { width: ORIGINAL_TERRAIN_SIZE, height: ORIGINAL_TERRAIN_SIZE };\r\n\r\nconst CHUNK_SIZE = 205; // Increased from 200 to add slight overlap\r\nconst OVERLAP_FACTOR = 5; // 5 units of overlap between chunks\r\n\r\nexport default function Terrain() {\r\n    // Get current map type from the store\r\n    const { currentMapType } = useMapStore();\r\n\r\n    // Determine terrain size based on current map type\r\n    const terrainSize = useMemo(() => {\r\n        if (currentMapType === 'half-width') {\r\n            return HALF_WIDTH_TERRAIN_SIZE;\r\n        } else if (currentMapType === 'desert') {\r\n            return DESERT_TERRAIN_SIZE;\r\n        }\r\n        return { width: ORIGINAL_TERRAIN_SIZE, height: ORIGINAL_TERRAIN_SIZE };\r\n    }, [currentMapType]);\r\n\r\n    // Calculate chunks count\r\n    const chunksCount = useMemo(() => {\r\n        if (currentMapType === 'half-width') {\r\n            return {\r\n                x: Math.ceil(terrainSize.width / (CHUNK_SIZE - OVERLAP_FACTOR)),\r\n                z: Math.ceil(terrainSize.height / (CHUNK_SIZE - OVERLAP_FACTOR))\r\n            };\r\n        }\r\n        const count = Math.ceil(ORIGINAL_TERRAIN_SIZE / (CHUNK_SIZE - OVERLAP_FACTOR));\r\n        return { x: count, z: count };\r\n    }, [currentMapType, terrainSize]);\r\n\r\n    const SEGMENTS = 200; // Segment resolution for the entire terrain\r\n    const segmentsPerChunk = useMemo(() => ({\r\n        x: Math.floor(SEGMENTS / chunksCount.x),\r\n        z: Math.floor(SEGMENTS / chunksCount.z)\r\n    }), [chunksCount]);\r\n\r\n    // Create the terrain using instanced rendering for performance\r\n    // Use a single geometry and material for the entire terrain\r\n    const planeGeometry = useMemo(() => {\r\n        return new THREE.PlaneGeometry(CHUNK_SIZE, CHUNK_SIZE, segmentsPerChunk.x, segmentsPerChunk.z);\r\n    }, [segmentsPerChunk]);\r\n\r\n    // Use a simple material with optimized settings\r\n    const planeMaterial = useMemo(() => {\r\n        let color, roughness, metalness;\r\n\r\n        // Set material properties based on map type\r\n        if (currentMapType === 'desert') {\r\n            color = '#DEB887'; // Sandy color for desert\r\n            roughness = 0.9;\r\n            metalness = 0.05;\r\n        } else {\r\n            color = '#4d7f38'; // Green color for the ground\r\n            roughness = 0.8;\r\n            metalness = 0.1;\r\n        }\r\n\r\n        return new THREE.MeshStandardMaterial({\r\n            color: color,\r\n            roughness: roughness,\r\n            metalness: metalness,\r\n            flatShading: false // Disable for smoother appearance\r\n        });\r\n    }, [currentMapType]);\r\n\r\n    // Use instanced mesh for efficient rendering of multiple chunks\r\n    const instancedMeshRef = useRef();\r\n    const tempObject = useMemo(() => new THREE.Object3D(), []);\r\n\r\n    // Create the chunks based on the terrain size\r\n    const chunks = useMemo(() => {\r\n        const result = [];\r\n\r\n        if (currentMapType === 'half-width') {\r\n            const halfWidth = terrainSize.width / 2;\r\n            const halfHeight = terrainSize.height / 2;\r\n            const chunkOffset = (CHUNK_SIZE - OVERLAP_FACTOR) / 2;\r\n\r\n            for (let x = 0; x < chunksCount.x; x++) {\r\n                for (let z = 0; z < chunksCount.z; z++) {\r\n                    result.push({\r\n                        position: [\r\n                            -halfWidth + x * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset,\r\n                            0,\r\n                            -halfHeight + z * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset\r\n                        ],\r\n                        rotation: [-Math.PI / 2, 0, 0] // Rotate to make it horizontal\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            const halfSize = terrainSize.width / 2;\r\n            const chunkOffset = (CHUNK_SIZE - OVERLAP_FACTOR) / 2;\r\n\r\n            for (let x = 0; x < chunksCount.x; x++) {\r\n                for (let z = 0; z < chunksCount.z; z++) {\r\n                    result.push({\r\n                        position: [\r\n                            -halfSize + x * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset,\r\n                            0,\r\n                            -halfSize + z * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset\r\n                        ],\r\n                        rotation: [-Math.PI / 2, 0, 0] // Rotate to make it horizontal\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }, [currentMapType, terrainSize, chunksCount]);\r\n\r\n    // Setup the instanced mesh on the first render\r\n    useFrame(() => {\r\n        if (instancedMeshRef.current) {\r\n            chunks.forEach((chunk, i) => {\r\n                const [x, y, z] = chunk.position;\r\n                const [rx, ry, rz] = chunk.rotation;\r\n\r\n                tempObject.position.set(x, y, z);\r\n                tempObject.rotation.set(rx, ry, rz);\r\n                tempObject.updateMatrix();\r\n\r\n                instancedMeshRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n\r\n            instancedMeshRef.current.instanceMatrix.needsUpdate = true;\r\n\r\n            // Only need to run this once to set up the instances\r\n            return null;\r\n        }\r\n    }, [chunks]);\r\n\r\n    return (\r\n        <>\r\n            {/* Use an instanced mesh for all chunks */}\r\n            <instancedMesh\r\n                ref={instancedMeshRef}\r\n                args={[planeGeometry, planeMaterial, chunks.length]}\r\n            />\r\n        </>\r\n    );\r\n} ","import React, { useMemo } from 'react';\r\nimport * as THREE from 'three';\r\nimport { ORIGINAL_TERRAIN_SIZE, HALF_WIDTH_TERRAIN_SIZE } from './Terrain';\r\nimport { useMapStore } from '../utils/MapStore';\r\n\r\n// Road constants\r\nexport const ROAD_WIDTH = 88;\r\nexport const ROAD_EXTENSION = 8;\r\nexport const TOTAL_ROAD_WIDTH = ROAD_WIDTH + (ROAD_EXTENSION * 2); // Total width including extensions\r\nexport const ROAD_SPACING = 300; // Space between the two parallel roads (increased from 200 to 300, 50% more)\r\nexport const LANE_WIDTH = ROAD_WIDTH / 4; // Now 4 lanes per road\r\nexport const LANE_MARKER_WIDTH = 0.75; // Increased from 0.5 (1.5x width)\r\nexport const LANE_MARKER_LENGTH = 5;\r\nexport const LANE_MARKER_GAP = 10;\r\nexport const ROAD_HEIGHT = 0.5; // Increased from 0.11 to prevent z-fighting\r\nexport const ROADSIDE_STRIPE_WIDTH = 9; // Width of brown stripes alongside the road (increased from 6 to 9, 1.5x wider)\r\n\r\nexport default function Road({ mapType = 'original' }) {\r\n    // Get current map type from store\r\n    const { currentMapType } = useMapStore();\r\n\r\n    // Get the terrain size based on the current map type\r\n    const terrainSize = useMemo(() => {\r\n        if (mapType === 'half-width') {\r\n            return HALF_WIDTH_TERRAIN_SIZE;\r\n        }\r\n        return { width: ORIGINAL_TERRAIN_SIZE, height: ORIGINAL_TERRAIN_SIZE };\r\n    }, [mapType]);\r\n\r\n    // Create the road shape with a plane along the X axis (now wider with extensions)\r\n    const roadGeometry = useMemo(() => {\r\n        return new THREE.PlaneGeometry(terrainSize.width, ROAD_WIDTH, 1, 1);\r\n    }, [terrainSize]);\r\n\r\n    // Create the road extension geometry\r\n    const roadExtensionGeometry = useMemo(() => {\r\n        return new THREE.PlaneGeometry(terrainSize.width, ROAD_EXTENSION, 1, 1);\r\n    }, [terrainSize]);\r\n\r\n    // Create asphalt color based on map type\r\n    const asphaltColor = useMemo(() => {\r\n        return mapType === 'desert' ? '#444444' : '#333333'; // Slightly lighter for desert\r\n    }, [mapType]);\r\n\r\n    // Create the asphalt material\r\n    const asphaltMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: asphaltColor,\r\n            roughness: 0.7,\r\n            metalness: 0.1,\r\n            polygonOffset: true,\r\n            polygonOffsetFactor: -1,\r\n            polygonOffsetUnits: 1\r\n        }),\r\n        [asphaltColor]\r\n    );\r\n\r\n    // Create the center line material (yellow)\r\n    const centerLineMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#FFCC00',\r\n            roughness: 0.5,\r\n            metalness: 0.1,\r\n            polygonOffset: true,\r\n            polygonOffsetFactor: -2,\r\n            polygonOffsetUnits: 1\r\n        }),\r\n        []\r\n    );\r\n\r\n    // Create the side line material (white)\r\n    const sideLineMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#FFFFFF',\r\n            roughness: 0.5,\r\n            metalness: 0.1,\r\n            polygonOffset: true,\r\n            polygonOffsetFactor: -2,\r\n            polygonOffsetUnits: 1\r\n        }),\r\n        []\r\n    );\r\n\r\n    // Create the roadside stripe material (based on map type)\r\n    const roadstripeColor = useMemo(() => {\r\n        return mapType === 'desert' ? '#A67F4E' : '#8B5A2B'; // More orange-toned for desert\r\n    }, [mapType]);\r\n\r\n    // Create the roadside stripe material\r\n    const roadsideStripeMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: roadstripeColor,\r\n            roughness: 0.85,\r\n            metalness: 0.02,\r\n            polygonOffset: true,\r\n            polygonOffsetFactor: -1.5,\r\n            polygonOffsetUnits: 1\r\n        }),\r\n        [roadstripeColor]\r\n    );\r\n\r\n    // Create the lane markers (dashed lines)\r\n    const laneMarkers = useMemo(() => {\r\n        const markers = [];\r\n        const roadLength = terrainSize.width;\r\n        const totalMarkers = Math.floor(roadLength / (LANE_MARKER_LENGTH + LANE_MARKER_GAP));\r\n        const startOffset = -roadLength / 2;\r\n\r\n        for (let i = 0; i < totalMarkers; i++) {\r\n            const markerPosition = startOffset + (i * (LANE_MARKER_LENGTH + LANE_MARKER_GAP)) + LANE_MARKER_LENGTH / 2;\r\n            markers.push({\r\n                position: markerPosition\r\n            });\r\n        }\r\n\r\n        return markers;\r\n    }, [terrainSize]);\r\n\r\n    // Component to render a single road with all its markings\r\n    const SingleRoad = ({ zPosition }) => (\r\n        <group position={[0, ROAD_HEIGHT, zPosition]}>\r\n            {/* Main road surface */}\r\n            <mesh\r\n                geometry={roadGeometry}\r\n                material={asphaltMaterial}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            />\r\n\r\n            {/* Left road extension */}\r\n            <mesh\r\n                position={[0, 0, -ROAD_WIDTH / 2 - ROAD_EXTENSION / 2]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <primitive object={roadExtensionGeometry} />\r\n                <primitive object={asphaltMaterial} />\r\n            </mesh>\r\n\r\n            {/* Right road extension */}\r\n            <mesh\r\n                position={[0, 0, ROAD_WIDTH / 2 + ROAD_EXTENSION / 2]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <primitive object={roadExtensionGeometry} />\r\n                <primitive object={asphaltMaterial} />\r\n            </mesh>\r\n\r\n            {/* Left brown stripe */}\r\n            <mesh\r\n                position={[0, 0.01, -TOTAL_ROAD_WIDTH / 2 - ROADSIDE_STRIPE_WIDTH / 2]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <planeGeometry args={[terrainSize.width, ROADSIDE_STRIPE_WIDTH]} />\r\n                <primitive object={roadsideStripeMaterial} />\r\n            </mesh>\r\n\r\n            {/* Right brown stripe */}\r\n            <mesh\r\n                position={[0, 0.01, TOTAL_ROAD_WIDTH / 2 + ROADSIDE_STRIPE_WIDTH / 2]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <planeGeometry args={[terrainSize.width, ROADSIDE_STRIPE_WIDTH]} />\r\n                <primitive object={roadsideStripeMaterial} />\r\n            </mesh>\r\n\r\n            {/* Center line (solid yellow) */}\r\n            <mesh\r\n                position={[0, 0.02, 0]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <planeGeometry args={[terrainSize.width, LANE_MARKER_WIDTH]} />\r\n                <primitive object={centerLineMaterial} />\r\n            </mesh>\r\n\r\n            {/* Left edge line (solid white) */}\r\n            <mesh\r\n                position={[0, 0.02, -ROAD_WIDTH / 2 + 0.5]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <planeGeometry args={[terrainSize.width, LANE_MARKER_WIDTH]} />\r\n                <primitive object={sideLineMaterial} />\r\n            </mesh>\r\n\r\n            {/* Right edge line (solid white) */}\r\n            <mesh\r\n                position={[0, 0.02, ROAD_WIDTH / 2 - 0.5]}\r\n                rotation={[-Math.PI / 2, 0, 0]}\r\n            >\r\n                <planeGeometry args={[terrainSize.width, LANE_MARKER_WIDTH]} />\r\n                <primitive object={sideLineMaterial} />\r\n            </mesh>\r\n\r\n            {/* Lane markers (dashed white lines) between lanes */}\r\n            {/* Left side - between outer and inner lane */}\r\n            {laneMarkers.map((marker, index) => (\r\n                <mesh\r\n                    key={`left-outer-${index}`}\r\n                    position={[marker.position, 0.02, -ROAD_WIDTH / 4]}\r\n                    rotation={[-Math.PI / 2, 0, 0]}\r\n                >\r\n                    <planeGeometry args={[LANE_MARKER_LENGTH, LANE_MARKER_WIDTH]} />\r\n                    <primitive object={sideLineMaterial} />\r\n                </mesh>\r\n            ))}\r\n\r\n            {/* Right side - between outer and inner lane */}\r\n            {laneMarkers.map((marker, index) => (\r\n                <mesh\r\n                    key={`right-outer-${index}`}\r\n                    position={[marker.position, 0.02, ROAD_WIDTH / 4]}\r\n                    rotation={[-Math.PI / 2, 0, 0]}\r\n                >\r\n                    <planeGeometry args={[LANE_MARKER_LENGTH, LANE_MARKER_WIDTH]} />\r\n                    <primitive object={sideLineMaterial} />\r\n                </mesh>\r\n            ))}\r\n        </group>\r\n    );\r\n\r\n    return (\r\n        <>\r\n            {/* Upper road */}\r\n            <SingleRoad zPosition={ROAD_SPACING / 2} />\r\n\r\n            {/* Lower road */}\r\n            <SingleRoad zPosition={-ROAD_SPACING / 2} />\r\n        </>\r\n    );\r\n} ","import React, { useMemo, useRef, useEffect } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport { ORIGINAL_TERRAIN_SIZE } from '../terrain/OriginalTerrain';\r\n\r\n// Constants for original environment objects\r\nconst ROAD_WIDTH = 140;\r\nconst ROAD_SPACING = 300;\r\nconst MIN_SCALE = 1.2;\r\nconst MAX_SCALE = 1.8;\r\n\r\n// Tree type definitions\r\nconst TREE_TYPES = {\r\n    PINE: 'pine',\r\n    OAK: 'oak',\r\n    PALM: 'palm',\r\n    BIRCH: 'birch'\r\n};\r\n\r\n// Spatial hash grid for efficient object placement\r\nclass SpatialHashGrid {\r\n    constructor(bounds, dimensions) {\r\n        this.bounds = bounds;\r\n        this.dimensions = dimensions;\r\n        this.cells = {};\r\n    }\r\n\r\n    // Calculate the cell coordinates for a position\r\n    getCell(position) {\r\n        const { min, max } = this.bounds;\r\n        const cellX = Math.floor((position.x - min.x) / (max.x - min.x) * this.dimensions.x);\r\n        const cellZ = Math.floor((position.z - min.z) / (max.z - min.z) * this.dimensions.z);\r\n        return { x: cellX, z: cellZ };\r\n    }\r\n\r\n    // Get cell key for hashing\r\n    getCellKey(cell) {\r\n        return `${cell.x},${cell.z}`;\r\n    }\r\n\r\n    // Add object to grid\r\n    insert(position, object) {\r\n        const cell = this.getCell(position);\r\n        const key = this.getCellKey(cell);\r\n\r\n        if (!this.cells[key]) {\r\n            this.cells[key] = [];\r\n        }\r\n        this.cells[key].push({ position, object });\r\n    }\r\n\r\n    // Find objects near a position\r\n    query(position, radius) {\r\n        const result = [];\r\n        const center = this.getCell(position);\r\n\r\n        // Calculate how many cells we need to check based on radius\r\n        const cellRadius = Math.ceil(radius / Math.min(\r\n            (this.bounds.max.x - this.bounds.min.x) / this.dimensions.x,\r\n            (this.bounds.max.z - this.bounds.min.z) / this.dimensions.z\r\n        ));\r\n\r\n        // Check all cells within cell radius\r\n        for (let x = -cellRadius; x <= cellRadius; x++) {\r\n            for (let z = -cellRadius; z <= cellRadius; z++) {\r\n                const cell = { x: center.x + x, z: center.z + z };\r\n                const key = this.getCellKey(cell);\r\n\r\n                if (this.cells[key]) {\r\n                    for (const item of this.cells[key]) {\r\n                        const dx = item.position.x - position.x;\r\n                        const dz = item.position.z - position.z;\r\n                        const distance = Math.sqrt(dx * dx + dz * dz);\r\n\r\n                        if (distance <= radius) {\r\n                            result.push(item.object);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n// Generate a deterministic random number based on seed\r\nfunction seededRandom(seed) {\r\n    const x = Math.sin(seed) * 10000;\r\n    return x - Math.floor(x);\r\n}\r\n\r\n// Generate original environment objects with a focus on lush forests\r\nexport default function OriginalEnvironmentObjects() {\r\n    const terrainSize = ORIGINAL_TERRAIN_SIZE;\r\n    const seed = 12345; // Seed for deterministic generation\r\n\r\n    // Setup spatial grid\r\n    const halfWidth = terrainSize / 2;\r\n    const halfHeight = terrainSize / 2;\r\n\r\n    // Use a fixed seed for deterministic generation\r\n    const { trees, rocks, bushes, largeBush } = useMemo(() => {\r\n        // Initialize spatial hash grid for position checking\r\n        const bounds = {\r\n            min: { x: -halfWidth, z: -halfHeight },\r\n            max: { x: halfWidth, z: halfHeight }\r\n        };\r\n        const grid = new SpatialHashGrid(bounds, { x: 20, z: 20 });\r\n\r\n        // Check if a position is on the road\r\n        const isOnRoad = (x, z) => {\r\n            return (\r\n                Math.abs(z - ROAD_SPACING / 2) < ROAD_WIDTH / 2 ||\r\n                Math.abs(z + ROAD_SPACING / 2) < ROAD_WIDTH / 2\r\n            );\r\n        };\r\n\r\n        // Generate fixed positions for each object type with spatial constraints\r\n        const trees = { pine: [], oak: [], palm: [], birch: [] };\r\n        const rocks = [];\r\n        const bushes = [];\r\n\r\n        // Minimum required distance between objects to avoid overlapping\r\n        const MIN_DISTANCE = 12;\r\n\r\n        // Function to check if position is valid (not on road, not too close to other objects)\r\n        const isPositionValid = (x, z, radius) => {\r\n            if (isOnRoad(x, z)) return false;\r\n\r\n            // Add a safety margin around roads\r\n            const roadMargin = 10;\r\n            if (\r\n                Math.abs(z - ROAD_SPACING / 2) < (ROAD_WIDTH / 2) + roadMargin ||\r\n                Math.abs(z + ROAD_SPACING / 2) < (ROAD_WIDTH / 2) + roadMargin\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            // Check spatial grid for nearby objects\r\n            const pos = { x, z };\r\n            const nearby = grid.query(pos, radius);\r\n            return nearby.length === 0;\r\n        };\r\n\r\n        // Function to add an object at a valid position with deterministic randomness\r\n        const addObject = (collection, objectType, baseIndex, count, minDistance) => {\r\n            for (let i = 0; i < count; i++) {\r\n                const seedValue = seed + baseIndex + i;\r\n\r\n                // Use deterministic random values\r\n                const randX = seededRandom(seedValue * 1.1);\r\n                const randZ = seededRandom(seedValue * 2.3);\r\n                const randScale = seededRandom(seedValue * 3.7);\r\n                const randRotation = seededRandom(seedValue * 4.5);\r\n                const randType = Math.floor(seededRandom(seedValue * 5.9) * 4);\r\n\r\n                // Calculate position using deterministic randomness\r\n                const x = randX * terrainSize - halfWidth;\r\n                const z = randZ * terrainSize - halfHeight;\r\n\r\n                // Skip if position is invalid (deterministic skipping)\r\n                if (!isPositionValid(x, z, minDistance)) continue;\r\n\r\n                // Create object with properties\r\n                const scale = MIN_SCALE + randScale * (MAX_SCALE - MIN_SCALE);\r\n                const rotation = randRotation * Math.PI * 2;\r\n                const position = new THREE.Vector3(x, 0, z);\r\n\r\n                const object = {\r\n                    position: [x, 0, z],\r\n                    scale,\r\n                    rotation,\r\n                    type: randType\r\n                };\r\n\r\n                // Add to collection based on object type\r\n                if (objectType === 'tree') {\r\n                    const treeTypeName = Object.values(TREE_TYPES)[randType];\r\n                    trees[treeTypeName].push(object);\r\n                } else if (objectType === 'rock') {\r\n                    rocks.push(object);\r\n                } else if (objectType === 'bush') {\r\n                    bushes.push(object);\r\n                }\r\n\r\n                // Insert into spatial grid\r\n                grid.insert({ x, z }, object);\r\n            }\r\n        };\r\n\r\n        // Setup original environment with plenty of trees and vegetation\r\n        const treeCount = 600;\r\n        const rockCount = 150;\r\n        const bushCount = 300;\r\n\r\n        // Generate fixed number of objects with deterministic positioning\r\n        addObject(trees, 'tree', 0, treeCount, MIN_DISTANCE);\r\n        addObject(rocks, 'rock', 10000, rockCount, MIN_DISTANCE / 3);\r\n        addObject(bushes, 'bush', 20000, bushCount, MIN_DISTANCE / 3);\r\n\r\n        // Special large bush positioning (deterministic based on seed)\r\n        const specialSeed = seed * 9876;\r\n        const specialX = seededRandom(specialSeed) * terrainSize - halfWidth;\r\n        const specialZ = seededRandom(specialSeed + 100) * terrainSize - halfHeight;\r\n\r\n        let largeBush = null;\r\n        if (!isOnRoad(specialX, specialZ)) {\r\n            largeBush = {\r\n                position: [specialX, 0, specialZ],\r\n                scale: 4.0,\r\n                rotation: seededRandom(specialSeed + 200) * Math.PI * 2\r\n            };\r\n        }\r\n\r\n        return { trees, rocks, bushes, largeBush };\r\n    }, [halfWidth, halfHeight, terrainSize]);\r\n\r\n    const { camera } = useThree();\r\n\r\n    // References to our instanced meshes\r\n    const treeRefs = {\r\n        pine: { trunk: useRef(), foliage: useRef() },\r\n        oak: { trunk: useRef(), foliage: useRef() },\r\n        palm: { trunk: useRef(), foliage: useRef() },\r\n        birch: { trunk: useRef(), foliage: useRef() }\r\n    };\r\n\r\n    const rocksRef = useRef();\r\n    const bushesRef = useRef();\r\n    const largeBushRef = useRef();\r\n\r\n    // Create a frustum for culling\r\n    const frustum = useMemo(() => new THREE.Frustum(), []);\r\n    const projScreenMatrix = useMemo(() => new THREE.Matrix4(), []);\r\n    const tempObject = useMemo(() => new THREE.Object3D(), []);\r\n\r\n    // Materials for original environment - lush green colors\r\n    const treeMaterials = useMemo(() => ({\r\n        pine: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#8B4513',\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#2E8B57',\r\n                roughness: 0.7,\r\n                flatShading: true\r\n            })\r\n        },\r\n        oak: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#654321',\r\n                roughness: 0.9,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#228B22',\r\n                roughness: 0.6,\r\n                flatShading: true\r\n            })\r\n        },\r\n        palm: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#A0522D',\r\n                roughness: 0.7,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#32CD32',\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            })\r\n        },\r\n        birch: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#F5F5DC',\r\n                roughness: 0.6,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#ADFF2F',\r\n                roughness: 0.7,\r\n                flatShading: true\r\n            })\r\n        }\r\n    }), []);\r\n\r\n    const rockMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#7D7D7D',\r\n            roughness: 1.0,\r\n            flatShading: true\r\n        }),\r\n        []);\r\n\r\n    const bushMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#3A5F0B',\r\n            roughness: 0.7,\r\n            flatShading: true\r\n        }),\r\n        []);\r\n\r\n    // Create optimized geometries\r\n    const rockGeometry = useMemo(() => new THREE.IcosahedronGeometry(1, 0), []);\r\n    const bushGeometry = useMemo(() => new THREE.SphereGeometry(2, 6, 4), []);\r\n\r\n    // Tree dimension presets\r\n    const treeDimensions = useMemo(() => ({\r\n        pine: {\r\n            trunkHeight: 4.8,\r\n            trunkRadius: 0.75,\r\n            foliageOffset: 4.8\r\n        },\r\n        oak: {\r\n            trunkHeight: 4.5,\r\n            trunkRadius: 0.975,\r\n            foliageOffset: 3\r\n        },\r\n        palm: {\r\n            trunkHeight: 7.5,\r\n            trunkRadius: 0.525,\r\n            foliageOffset: 7.5\r\n        },\r\n        birch: {\r\n            trunkHeight: 6.75,\r\n            trunkRadius: 0.4875,\r\n            foliageOffset: 4.5\r\n        }\r\n    }), []);\r\n\r\n    // Create simplified LOD geometries\r\n    const treeGeometries = useMemo(() => {\r\n        // Create high detail geometries\r\n        const highDetail = {\r\n            pine: {\r\n                trunk: new THREE.CylinderGeometry(0.6, 0.75, 4.8, 8, 3),\r\n                foliage: new THREE.ConeGeometry(3, 9.6, 8, 4)\r\n            },\r\n            oak: {\r\n                trunk: new THREE.CylinderGeometry(0.9, 1.05, 4.5, 10, 4),\r\n                foliage: new THREE.SphereGeometry(3.75, 12, 10)\r\n            },\r\n            palm: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.6, 7.5, 8, 5),\r\n                foliage: new THREE.DodecahedronGeometry(3.75, 1)\r\n            },\r\n            birch: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.53, 6.75, 9, 4),\r\n                foliage: new THREE.OctahedronGeometry(3, 2)\r\n            }\r\n        };\r\n\r\n        // Create low detail geometries\r\n        const lowDetail = {\r\n            pine: {\r\n                trunk: new THREE.CylinderGeometry(0.6, 0.75, 4.8, 4, 1),\r\n                foliage: new THREE.ConeGeometry(3, 9.6, 5, 1)\r\n            },\r\n            oak: {\r\n                trunk: new THREE.CylinderGeometry(0.9, 1.05, 4.5, 6, 1),\r\n                foliage: new THREE.SphereGeometry(3.75, 6, 4)\r\n            },\r\n            palm: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.6, 7.5, 4, 1),\r\n                foliage: new THREE.DodecahedronGeometry(3.75, 0)\r\n            },\r\n            birch: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.53, 6.75, 5, 1),\r\n                foliage: new THREE.OctahedronGeometry(3, 0)\r\n            }\r\n        };\r\n\r\n        return { highDetail, lowDetail };\r\n    }, []);\r\n\r\n    // Setup instanced mesh matrices\r\n    useEffect(() => {\r\n        // Setup trees for each type with proper positioning\r\n        Object.entries(trees).forEach(([treeType, positions]) => {\r\n            if (!positions.length) return;\r\n\r\n            const {\r\n                trunkHeight,\r\n                trunkRadius,\r\n                foliageOffset\r\n            } = treeDimensions[treeType];\r\n\r\n            // Setup trunk matrices\r\n            const trunkRef = treeRefs[treeType].trunk;\r\n            if (trunkRef.current && positions.length > 0) {\r\n                positions.forEach((tree, i) => {\r\n                    const [x, y, z] = tree.position;\r\n                    const scale = tree.scale;\r\n\r\n                    const scaledTrunkHeight = trunkHeight * scale;\r\n                    const trunkY = scaledTrunkHeight / 2;\r\n\r\n                    tempObject.position.set(x, trunkY, z);\r\n                    tempObject.rotation.set(0, tree.rotation, 0);\r\n                    tempObject.scale.set(scale, scale, scale);\r\n                    tempObject.updateMatrix();\r\n\r\n                    trunkRef.current.setMatrixAt(i, tempObject.matrix);\r\n                });\r\n                trunkRef.current.instanceMatrix.needsUpdate = true;\r\n                trunkRef.current.computeBoundingSphere();\r\n                if (trunkRef.current.boundingSphere) {\r\n                    trunkRef.current.boundingSphere.radius *= 1.5;\r\n                }\r\n            }\r\n\r\n            // Setup foliage matrices\r\n            const foliageRef = treeRefs[treeType].foliage;\r\n            if (foliageRef.current && positions.length > 0) {\r\n                positions.forEach((tree, i) => {\r\n                    const [x, y, z] = tree.position;\r\n                    const scale = tree.scale;\r\n\r\n                    // Scale foliage position\r\n                    const scaledFoliageOffset = foliageOffset * scale;\r\n\r\n                    // Determine foliage position based on tree type\r\n                    let foliageY;\r\n                    switch (treeType) {\r\n                        case 'pine':\r\n                            foliageY = scaledFoliageOffset + (4.8 * scale);\r\n                            break;\r\n                        case 'birch':\r\n                            foliageY = scaledFoliageOffset + (2.25 * scale);\r\n                            break;\r\n                        case 'oak':\r\n                        case 'palm':\r\n                        default:\r\n                            foliageY = scaledFoliageOffset + (1.5 * scale);\r\n                    }\r\n\r\n                    tempObject.position.set(x, foliageY, z);\r\n                    tempObject.rotation.set(0, tree.rotation, 0);\r\n                    tempObject.scale.setScalar(scale);\r\n                    tempObject.updateMatrix();\r\n\r\n                    foliageRef.current.setMatrixAt(i, tempObject.matrix);\r\n                });\r\n                foliageRef.current.instanceMatrix.needsUpdate = true;\r\n                foliageRef.current.computeBoundingSphere();\r\n                if (foliageRef.current.boundingSphere) {\r\n                    foliageRef.current.boundingSphere.radius *= 1.5;\r\n                }\r\n            }\r\n        });\r\n\r\n        // Setup rocks\r\n        if (rocksRef.current && rocks.length > 0) {\r\n            rocks.forEach((rock, i) => {\r\n                const [x, y, z] = rock.position;\r\n                const scale = rock.scale;\r\n                const objectY = 0.5 * scale;\r\n\r\n                tempObject.position.set(x, objectY, z);\r\n                tempObject.rotation.set(0, rock.rotation, 0);\r\n                tempObject.scale.setScalar(scale);\r\n                tempObject.updateMatrix();\r\n\r\n                rocksRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n            rocksRef.current.instanceMatrix.needsUpdate = true;\r\n            rocksRef.current.computeBoundingSphere();\r\n            if (rocksRef.current.boundingSphere) {\r\n                rocksRef.current.boundingSphere.radius *= 1.5;\r\n            }\r\n        }\r\n\r\n        // Setup bushes\r\n        if (bushesRef.current && bushes.length > 0) {\r\n            bushes.forEach((bush, i) => {\r\n                const [x, y, z] = bush.position;\r\n                const scale = bush.scale;\r\n                const objectY = 2 * scale * 0.5;\r\n\r\n                tempObject.position.set(x, objectY, z);\r\n                tempObject.rotation.set(0, bush.rotation, 0);\r\n                tempObject.scale.setScalar(scale);\r\n                tempObject.updateMatrix();\r\n\r\n                bushesRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n            bushesRef.current.instanceMatrix.needsUpdate = true;\r\n            bushesRef.current.computeBoundingSphere();\r\n            if (bushesRef.current.boundingSphere) {\r\n                bushesRef.current.boundingSphere.radius *= 1.5;\r\n            }\r\n        }\r\n\r\n        // Setup large bush\r\n        if (largeBushRef.current && largeBush) {\r\n            const [x, y, z] = largeBush.position;\r\n            const scale = largeBush.scale;\r\n            const objectY = 2 * scale * 0.5;\r\n\r\n            tempObject.position.set(x, objectY, z);\r\n            tempObject.rotation.set(0, largeBush.rotation, 0);\r\n            tempObject.scale.setScalar(scale);\r\n            tempObject.updateMatrix();\r\n\r\n            largeBushRef.current.matrix.copy(tempObject.matrix);\r\n            largeBushRef.current.matrixAutoUpdate = false;\r\n            // Regular meshes don't have computeBoundingSphere method\r\n            // Create a manual bounding sphere for distance checks\r\n            if (!largeBushRef.current.boundingSphere) {\r\n                largeBushRef.current.boundingSphere = new THREE.Sphere(\r\n                    new THREE.Vector3(x, objectY, z),\r\n                    2 * scale // Approximate radius based on scale\r\n                );\r\n            }\r\n        }\r\n    }, [trees, rocks, bushes, largeBush, treeDimensions, tempObject]);\r\n\r\n    // Distance-based culling for performance\r\n    useFrame(({ camera }) => {\r\n        const cameraPosition = camera.position;\r\n        const FAR_DISTANCE = 1000;\r\n        const MID_DISTANCE = 500;\r\n\r\n        // Apply culling for trees\r\n        Object.entries(treeRefs).forEach(([treeType, refs]) => {\r\n            if (!refs.trunk.current || !refs.trunk.current.boundingSphere ||\r\n                !refs.foliage.current || !refs.foliage.current.boundingSphere) {\r\n                return;\r\n            }\r\n\r\n            const trunkDistance = refs.trunk.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            const foliageDistance = refs.foliage.current.boundingSphere.center.distanceTo(cameraPosition);\r\n\r\n            refs.trunk.current.visible = (trunkDistance < FAR_DISTANCE);\r\n            refs.foliage.current.visible = (foliageDistance < FAR_DISTANCE);\r\n        });\r\n\r\n        // Apply culling for rocks and bushes\r\n        if (rocksRef.current && rocksRef.current.boundingSphere) {\r\n            const rocksDistance = rocksRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            rocksRef.current.visible = (rocksDistance < FAR_DISTANCE);\r\n        }\r\n\r\n        if (bushesRef.current && bushesRef.current.boundingSphere) {\r\n            const bushesDistance = bushesRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            bushesRef.current.visible = (bushesDistance < FAR_DISTANCE);\r\n        }\r\n\r\n        // Large bush - individual mesh\r\n        if (largeBushRef.current && largeBushRef.current.boundingSphere) {\r\n            const largeDistance = largeBushRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            largeBushRef.current.visible = (largeDistance < FAR_DISTANCE);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            {/* All tree types with proper culling */}\r\n            {Object.entries(trees).map(([treeType, positions]) => {\r\n                if (!positions.length) return null;\r\n\r\n                // Get tree geometries\r\n                const highGeo = treeGeometries.highDetail[treeType];\r\n                const treeMat = treeMaterials[treeType];\r\n\r\n                return (\r\n                    <group key={treeType}>\r\n                        <instancedMesh\r\n                            ref={treeRefs[treeType].trunk}\r\n                            args={[null, null, positions.length]}\r\n                            frustumCulled={true}\r\n                        >\r\n                            <primitive object={highGeo.trunk} />\r\n                            <primitive object={treeMat.trunk} />\r\n                        </instancedMesh>\r\n\r\n                        <instancedMesh\r\n                            ref={treeRefs[treeType].foliage}\r\n                            args={[null, null, positions.length]}\r\n                            frustumCulled={true}\r\n                        >\r\n                            <primitive object={highGeo.foliage} />\r\n                            <primitive object={treeMat.foliage} />\r\n                        </instancedMesh>\r\n                    </group>\r\n                );\r\n            })}\r\n\r\n            {/* Rocks with instanced mesh */}\r\n            <instancedMesh\r\n                ref={rocksRef}\r\n                args={[rockGeometry, rockMaterial, rocks.length]}\r\n                frustumCulled={true}\r\n            />\r\n\r\n            {/* Bushes with instanced mesh */}\r\n            <instancedMesh\r\n                ref={bushesRef}\r\n                args={[bushGeometry, bushMaterial, bushes.length]}\r\n                frustumCulled={true}\r\n            />\r\n\r\n            {/* Special Large Bush */}\r\n            {largeBush && (\r\n                <mesh\r\n                    ref={largeBushRef}\r\n                    frustumCulled={true}\r\n                >\r\n                    <sphereGeometry args={[2, 10, 8]} />\r\n                    <meshStandardMaterial\r\n                        color=\"#2D5B0A\"\r\n                        roughness={0.6}\r\n                        metalness={0.1}\r\n                        flatShading={true}\r\n                    />\r\n                </mesh>\r\n            )}\r\n        </group>\r\n    );\r\n} ","import React, { createContext, useContext, useState } from 'react';\r\n\r\n// Define drone types\r\nexport const DRONE_TYPES = {\r\n    PLAYER: 'PLAYER',\r\n    GRENADIER: 'GRENADIER',\r\n    KAMIKAZE: 'KAMIKAZE',\r\n    BOMBER: 'BOMBER'\r\n};\r\n\r\n// Create context\r\nconst GameContext = createContext();\r\n\r\n// Consolidated context provider component\r\nexport function GameProvider({ children }) {\r\n    // State for the currently selected drone\r\n    const [currentDrone, setCurrentDrone] = useState(DRONE_TYPES.GRENADIER);\r\n\r\n    // State for the first person view\r\n    const [isFirstPerson, setIsFirstPerson] = useState(false);\r\n\r\n    // Function to switch drones\r\n    const switchDrone = (droneType) => {\r\n        setCurrentDrone(droneType);\r\n    };\r\n\r\n    // Function to toggle first person view\r\n    const toggleFirstPerson = () => {\r\n        setIsFirstPerson(prev => !prev);\r\n    };\r\n\r\n    // Value object to be provided by the context\r\n    const value = {\r\n        // Drone selection functionality\r\n        currentDrone,\r\n        switchDrone,\r\n\r\n        // First person view functionality\r\n        isFirstPerson,\r\n        toggleFirstPerson\r\n    };\r\n\r\n    return (\r\n        <GameContext.Provider value={value}>\r\n            {children}\r\n        </GameContext.Provider>\r\n    );\r\n}\r\n\r\n// Custom hook to use the drones functionality\r\nexport function useDrones() {\r\n    const context = useContext(GameContext);\r\n    if (context === undefined) {\r\n        throw new Error('useDrones must be used within a GameProvider');\r\n    }\r\n    return {\r\n        currentDrone: context.currentDrone,\r\n        switchDrone: context.switchDrone\r\n    };\r\n}\r\n\r\n// Custom hook to use the kamikaze/first-person functionality\r\nexport function useKamikaze() {\r\n    const context = useContext(GameContext);\r\n    if (context === undefined) {\r\n        throw new Error('useKamikaze must be used within a GameProvider');\r\n    }\r\n    return {\r\n        isFirstPerson: context.isFirstPerson,\r\n        toggleFirstPerson: context.toggleFirstPerson\r\n    };\r\n}\r\n\r\n// Combined hook to use all game context functionality\r\nexport function useGameContext() {\r\n    const context = useContext(GameContext);\r\n    if (context === undefined) {\r\n        throw new Error('useGameContext must be used within a GameProvider');\r\n    }\r\n    return context;\r\n} ","import React from 'react';\r\nimport { KeyboardControls as DreiKeyboardControls } from '@react-three/drei';\r\n\r\n// Define controls map for the drone\r\nexport const Controls = {\r\n    forward: 'forward',\r\n    backward: 'backward',\r\n    left: 'left',\r\n    right: 'right',\r\n    up: 'up',\r\n    down: 'down',\r\n    strafeLeft: 'strafeLeft',\r\n    strafeRight: 'strafeRight',\r\n    selectDrone1: 'selectDrone1',\r\n    selectDrone2: 'selectDrone2',\r\n    selectDrone3: 'selectDrone3',\r\n    selectDrone4: 'selectDrone4',\r\n    toggleFirstPerson: 'toggleFirstPerson'\r\n};\r\n\r\nexport default function KeyboardControls({ children }) {\r\n    // Define key mappings\r\n    const map = [\r\n        { name: Controls.forward, keys: ['KeyW'] },\r\n        { name: Controls.backward, keys: ['KeyS'] },\r\n        { name: Controls.left, keys: ['KeyQ'] },\r\n        { name: Controls.right, keys: ['KeyE'] },\r\n        { name: Controls.up, keys: ['Space'] },\r\n        { name: Controls.down, keys: ['ShiftLeft'] },\r\n        { name: Controls.strafeLeft, keys: ['KeyA'] },\r\n        { name: Controls.strafeRight, keys: ['KeyD'] },\r\n        { name: Controls.selectDrone1, keys: ['Digit1'] },\r\n        { name: Controls.selectDrone2, keys: ['Digit2'] },\r\n        { name: Controls.selectDrone3, keys: ['Digit3'] },\r\n        { name: Controls.selectDrone4, keys: ['Digit4'] },\r\n        { name: Controls.toggleFirstPerson, keys: ['KeyV'] }\r\n    ];\r\n\r\n    return (\r\n        <DreiKeyboardControls map={map}>\r\n            {children}\r\n        </DreiKeyboardControls>\r\n    );\r\n} ","import React, { useRef, useState, useEffect } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { useKeyboardControls, PerspectiveCamera, Html, useHelper } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport { Controls } from '../KeyboardControls';\r\nimport { useKamikaze } from '../../utils/GameContext';\r\n\r\nconst PlayerController = ({ world }) => {\r\n    const playerRef = useRef();\r\n    const cameraRef = useRef();\r\n    const bulletRef = useRef([]);\r\n    const [subscribeKeys, getKeys] = useKeyboardControls();\r\n    const velocity = useRef(new THREE.Vector3());\r\n    const [health, setHealth] = useState(100);\r\n    const [canShoot, setCanShoot] = useState(true);\r\n    const { isFirstPerson } = useKamikaze();\r\n\r\n    // Constants\r\n    const SPEED = 8;\r\n    const ROTATION_SPEED = 0.03;\r\n    const BULLET_SPEED = 30;\r\n    const SHOOT_COOLDOWN = 250; // milliseconds\r\n    const COLLISION_THRESHOLD = 1;\r\n\r\n    // Debug collision box\r\n    useHelper(playerRef, THREE.BoxHelper, 'cyan');\r\n\r\n    // Shooting mechanics\r\n    const shoot = () => {\r\n        if (!canShoot) return;\r\n\r\n        const player = playerRef.current;\r\n        const bulletDirection = new THREE.Vector3(0, 0, -1)\r\n            .applyQuaternion(player.quaternion);\r\n\r\n        const bullet = {\r\n            position: player.position.clone().add(bulletDirection.multiplyScalar(1)),\r\n            direction: bulletDirection,\r\n            createdAt: Date.now()\r\n        };\r\n\r\n        bulletRef.current.push(bullet);\r\n        setCanShoot(false);\r\n        setTimeout(() => setCanShoot(true), SHOOT_COOLDOWN);\r\n    };\r\n\r\n    // Handle damage\r\n    const takeDamage = (amount) => {\r\n        setHealth(prev => Math.max(0, prev - amount));\r\n        if (health <= 0) {\r\n            // Handle player death\r\n            console.log('Player died!');\r\n        }\r\n    };\r\n\r\n    // Collision detection\r\n    const checkCollisions = (position) => {\r\n        // Example collision with world boundaries\r\n        const worldBounds = 50;\r\n        if (Math.abs(position.x) > worldBounds || Math.abs(position.z) > worldBounds) {\r\n            return true;\r\n        }\r\n\r\n        // Add more collision checks here (e.g., with other objects)\r\n        return false;\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        const keys = getKeys();\r\n        const player = playerRef.current;\r\n        if (!player) return;\r\n\r\n        // Store original position for collision check\r\n        const originalPosition = player.position.clone();\r\n\r\n        // Update velocity based on keys\r\n        velocity.current.set(0, 0, 0);\r\n\r\n        if (keys[Controls.forward]) velocity.current.z -= SPEED * delta;\r\n        if (keys[Controls.backward]) velocity.current.z += SPEED * delta;\r\n        if (keys[Controls.strafeLeft]) velocity.current.x -= SPEED * delta;\r\n        if (keys[Controls.strafeRight]) velocity.current.x += SPEED * delta;\r\n\r\n        // Rotate based on Q and E keys\r\n        if (keys[Controls.left]) player.rotation.y += ROTATION_SPEED;\r\n        if (keys[Controls.right]) player.rotation.y -= ROTATION_SPEED;\r\n\r\n        // Shoot on space\r\n        if (keys[Controls.up]) shoot();\r\n\r\n        // Apply movement in the direction the player is facing\r\n        const moveVector = velocity.current.applyMatrix4(\r\n            new THREE.Matrix4().makeRotationY(player.rotation.y)\r\n        );\r\n\r\n        // Test new position for collisions\r\n        const newPosition = originalPosition.clone().add(moveVector);\r\n        if (!checkCollisions(newPosition)) {\r\n            player.position.copy(newPosition);\r\n        }\r\n\r\n        // Update camera position for first-person view\r\n        if (cameraRef.current) {\r\n            if (isFirstPerson) {\r\n                cameraRef.current.position.set(0, 0.5, 0);\r\n            } else {\r\n                cameraRef.current.position.set(0, 5, 10);\r\n                cameraRef.current.lookAt(player.position);\r\n            }\r\n        }\r\n\r\n        // Update bullets\r\n        const now = Date.now();\r\n        bulletRef.current = bulletRef.current.filter(bullet => {\r\n            bullet.position.add(bullet.direction.clone().multiplyScalar(BULLET_SPEED * delta));\r\n            return now - bullet.createdAt < 2000; // Remove bullets after 2 seconds\r\n        });\r\n\r\n        // Update world if needed\r\n        if (world?.updatePlayerPosition) {\r\n            world.updatePlayerPosition(\r\n                player.position.x,\r\n                player.position.z,\r\n                player.rotation.y\r\n            );\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group ref={playerRef}>\r\n            <PerspectiveCamera ref={cameraRef} makeDefault={isFirstPerson} fov={75} />\r\n\r\n            {/* Player body - only visible in third person */}\r\n            {!isFirstPerson && (\r\n                <>\r\n                    {/* Player body */}\r\n                    <mesh position={[0, 0, 0]}>\r\n                        <cylinderGeometry args={[0.5, 0.5, 1.8, 32]} />\r\n                        <meshStandardMaterial color=\"#4CAF50\" />\r\n                    </mesh>\r\n                    {/* Head */}\r\n                    <mesh position={[0, 1.2, 0]}>\r\n                        <sphereGeometry args={[0.3, 32, 32]} />\r\n                        <meshStandardMaterial color=\"#4CAF50\" />\r\n                    </mesh>\r\n                    {/* Gun */}\r\n                    <mesh position={[0.3, 0.5, -0.5]} rotation={[0, 0, 0]}>\r\n                        <boxGeometry args={[0.1, 0.1, 1]} />\r\n                        <meshStandardMaterial color=\"#333333\" />\r\n                    </mesh>\r\n                </>\r\n            )}\r\n\r\n            {/* Bullets */}\r\n            {bulletRef.current.map((bullet, index) => (\r\n                <mesh key={index} position={bullet.position}>\r\n                    <sphereGeometry args={[0.1, 8, 8]} />\r\n                    <meshStandardMaterial color=\"yellow\" emissive=\"orange\" />\r\n                </mesh>\r\n            ))}\r\n\r\n            {/* Health bar */}\r\n            <Html position={[0, 2, 0]}>\r\n                <div style={{\r\n                    width: '100px',\r\n                    height: '10px',\r\n                    backgroundColor: '#333',\r\n                    border: '1px solid #666',\r\n                    borderRadius: '5px',\r\n                    overflow: 'hidden',\r\n                    transform: 'translateX(-50%)'\r\n                }}>\r\n                    <div style={{\r\n                        width: `${health}%`,\r\n                        height: '100%',\r\n                        backgroundColor: health > 30 ? '#4CAF50' : '#ff0000',\r\n                        transition: 'width 0.3s ease-in-out'\r\n                    }} />\r\n                </div>\r\n            </Html>\r\n        </group>\r\n    );\r\n};\r\n\r\nexport default PlayerController; ","import * as THREE from 'three';\r\nimport { create } from 'zustand';\r\n\r\n// Vehicle health defaults by type category\r\nexport const VEHICLE_HEALTH_DEFAULTS = {\r\n    TANK: {\r\n        maxHealth: 100,\r\n        criticalThreshold: 0.5, // Changed to 50% health\r\n        visualDamageStages: [],\r\n        hitboxSize: new THREE.Vector3(2.4, 1.0, 3.2), // Increased for better hit detection\r\n        // Different damage multipliers by hit location\r\n        hitLocations: {\r\n            turret: { damageMultiplier: 1.2 }, // Critical component\r\n            tracks: { damageMultiplier: 0.8, mobilityEffect: 0.5 }, // Reduced damage but affects mobility\r\n            rear: { damageMultiplier: 1.5 }, // Weak spot\r\n            front: { damageMultiplier: 0.6 }, // Strong armor\r\n            body: { damageMultiplier: 1.0 } // Standard damage to body\r\n        }\r\n    },\r\n    IFV: {\r\n        maxHealth: 70,\r\n        criticalThreshold: 0.5, // Changed to 50% health\r\n        visualDamageStages: [],\r\n        hitboxSize: new THREE.Vector3(2.0, 0.9, 3.0), // Increased for better hit detection\r\n        hitLocations: {\r\n            turret: { damageMultiplier: 1.2 },\r\n            wheels: { damageMultiplier: 0.8, mobilityEffect: 0.4 },\r\n            rear: { damageMultiplier: 1.3 },\r\n            front: { damageMultiplier: 0.7 },\r\n            body: { damageMultiplier: 1.0 } // Standard damage to body\r\n        }\r\n    },\r\n    MILITARY_TRUCK: {\r\n        maxHealth: 50,\r\n        criticalThreshold: 0.5, // Changed to 50% health\r\n        visualDamageStages: [],\r\n        hitboxSize: new THREE.Vector3(1.7, 1.4, 3.2), // Increased for better hit detection\r\n        hitLocations: {\r\n            cabin: { damageMultiplier: 1.1 },\r\n            wheels: { damageMultiplier: 0.9, mobilityEffect: 0.5 },\r\n            cargo: { damageMultiplier: 0.8 },\r\n            engine: { damageMultiplier: 1.4 },\r\n            body: { damageMultiplier: 1.0 } // Standard damage to body\r\n        }\r\n    },\r\n    CIVILIAN_TRUCK: {\r\n        maxHealth: 30,\r\n        criticalThreshold: 0.5, // Changed to 50% health\r\n        visualDamageStages: [],\r\n        hitboxSize: new THREE.Vector3(1.7, 1.4, 3.2), // Increased for better hit detection\r\n        hitLocations: {\r\n            cabin: { damageMultiplier: 1.2 },\r\n            wheels: { damageMultiplier: 1.0, mobilityEffect: 0.7 },\r\n            cargo: { damageMultiplier: 0.9 },\r\n            engine: { damageMultiplier: 1.5 },\r\n            body: { damageMultiplier: 1.0 } // Standard damage to body\r\n        }\r\n    },\r\n    CAR: {\r\n        maxHealth: 20,\r\n        criticalThreshold: 0.5, // Changed to 50% health\r\n        visualDamageStages: [],\r\n        hitboxSize: new THREE.Vector3(1.4, 0.8, 2.2), // Increased for better hit detection\r\n        hitLocations: {\r\n            cabin: { damageMultiplier: 1.2 },\r\n            wheels: { damageMultiplier: 1.0, mobilityEffect: 0.8 },\r\n            engine: { damageMultiplier: 1.5 },\r\n            body: { damageMultiplier: 1.0 } // Standard damage to body\r\n        }\r\n    }\r\n};\r\n\r\n// Vehicle category mapping - which vehicle belongs to which category\r\nexport const VEHICLE_CATEGORY_MAP = {\r\n    // Tanks\r\n    tank_a: 'TANK',\r\n    tank_b: 'TANK',\r\n\r\n    // IFVs\r\n    ifv_a: 'IFV',\r\n    ifv_b: 'IFV',\r\n\r\n    // Civilian Trucks\r\n    civilian_truck_1: 'CIVILIAN_TRUCK',\r\n    civilian_truck_2: 'CIVILIAN_TRUCK',\r\n    civilian_truck_3: 'CIVILIAN_TRUCK',\r\n\r\n    // Military Trucks\r\n    military_truck_1: 'MILITARY_TRUCK',\r\n    military_truck_2: 'MILITARY_TRUCK',\r\n    military_truck_3: 'MILITARY_TRUCK',\r\n\r\n    // Cars\r\n    car_a: 'CAR',\r\n    car_b: 'CAR',\r\n    car_c: 'CAR',\r\n    car_d: 'CAR',\r\n    car_e: 'CAR'\r\n};\r\n\r\n// Zustand store for global health state management\r\nexport const useVehicleHealthStore = create((set, get) => ({\r\n    // Map of vehicle IDs to their health state\r\n    vehicleHealth: {},\r\n\r\n    // Map for respawn timers\r\n    respawnTimers: {},\r\n\r\n    // Initialize a vehicle in the health system\r\n    initVehicle: (vehicleId, vehicleType) => {\r\n        set((state) => {\r\n            // Skip if already initialized\r\n            if (state.vehicleHealth[vehicleId]) return state;\r\n\r\n            const category = VEHICLE_CATEGORY_MAP[vehicleType];\r\n            const healthDefaults = VEHICLE_HEALTH_DEFAULTS[category];\r\n\r\n            return {\r\n                vehicleHealth: {\r\n                    ...state.vehicleHealth,\r\n                    [vehicleId]: {\r\n                        id: vehicleId,\r\n                        type: vehicleType,\r\n                        category,\r\n                        currentHealth: healthDefaults.maxHealth,\r\n                        maxHealth: healthDefaults.maxHealth,\r\n                        isDead: false,\r\n                        isDestroyed: false, // New flag for when vehicle is removed from scene\r\n                        isCritical: false,\r\n                        mobilityFactor: 1.0, // Full mobility\r\n                        visualEffects: [],\r\n                        hitboxSize: healthDefaults.hitboxSize,\r\n                        damageLog: []\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    },\r\n\r\n    // Apply damage to a vehicle\r\n    applyDamage: (vehicleId, rawDamage, hitLocation = null, weaponType = null) => {\r\n        set((state) => {\r\n            const vehicle = state.vehicleHealth[vehicleId];\r\n            if (!vehicle || vehicle.isDead || vehicle.isDestroyed) return state;\r\n\r\n            const category = vehicle.category;\r\n            const healthDefaults = VEHICLE_HEALTH_DEFAULTS[category];\r\n\r\n            // Calculate final damage after hit location modifiers\r\n            let damageMultiplier = 1.0;\r\n            let mobilityEffect = 0;\r\n\r\n            // Apply hit location modifiers if provided\r\n            if (hitLocation && healthDefaults.hitLocations[hitLocation]) {\r\n                const locationData = healthDefaults.hitLocations[hitLocation];\r\n                damageMultiplier = locationData.damageMultiplier;\r\n                mobilityEffect = locationData.mobilityEffect || 0;\r\n            }\r\n\r\n            // Calculate final damage (removed armor reduction, only apply hit location multiplier)\r\n            const finalDamage = rawDamage * damageMultiplier;\r\n\r\n            // Calculate new health\r\n            const newHealth = Math.max(0, vehicle.currentHealth - finalDamage);\r\n            const healthPercentage = newHealth / vehicle.maxHealth;\r\n\r\n            // Determine visual effects based on damage stages\r\n            const visualEffects = [];\r\n            healthDefaults.visualDamageStages.forEach(stage => {\r\n                if (healthPercentage <= stage.threshold) {\r\n                    visualEffects.push(...stage.effects);\r\n                }\r\n            });\r\n\r\n            // Add greyed out effect if dead\r\n            if (newHealth <= 0) {\r\n                visualEffects.push('GREYED_OUT');\r\n            }\r\n\r\n            // Determine critical state (50% health = critical)\r\n            const isCritical = healthPercentage <= healthDefaults.criticalThreshold;\r\n\r\n            // Determine if dead (0% health = dead)\r\n            const isDead = newHealth <= 0;\r\n\r\n            // Calculate new mobility factor (lower = slower)\r\n            let newMobilityFactor = vehicle.mobilityFactor;\r\n\r\n            // Immobilize at 50% health or below\r\n            if (healthPercentage <= 0.5) {\r\n                newMobilityFactor = 0;\r\n            } else if (mobilityEffect > 0) {\r\n                // Only apply mobility effects if above 50% health\r\n                newMobilityFactor = Math.max(0.1, newMobilityFactor - mobilityEffect);\r\n            }\r\n\r\n            // Log the damage event\r\n            const damageEvent = {\r\n                timestamp: Date.now(),\r\n                rawDamage,\r\n                finalDamage,\r\n                hitLocation,\r\n                weaponType,\r\n                healthBefore: vehicle.currentHealth,\r\n                healthAfter: newHealth\r\n            };\r\n\r\n            const updatedVehicle = {\r\n                ...vehicle,\r\n                currentHealth: newHealth,\r\n                healthPercentage,\r\n                isDead,\r\n                isCritical,\r\n                mobilityFactor: isDead ? 0 : newMobilityFactor,\r\n                visualEffects: visualEffects,\r\n                damageLog: [...vehicle.damageLog, damageEvent]\r\n            };\r\n\r\n            // Set up destruction timer if vehicle just died\r\n            if (isDead && !vehicle.isDead) {\r\n                // Vehicle stays visible and greyed out for 5 seconds after death, then gets destroyed\r\n                setTimeout(() => {\r\n                    get().destroyVehicle(vehicleId);\r\n                }, 1500);\r\n            }\r\n\r\n            return {\r\n                vehicleHealth: {\r\n                    ...state.vehicleHealth,\r\n                    [vehicleId]: updatedVehicle\r\n                }\r\n            };\r\n        });\r\n    },\r\n\r\n    // Mark vehicle as destroyed (remove from scene)\r\n    destroyVehicle: (vehicleId) => {\r\n        set((state) => {\r\n            const vehicle = state.vehicleHealth[vehicleId];\r\n            if (!vehicle || vehicle.isDestroyed) return state;\r\n\r\n            // Only set respawn timer for military vehicles\r\n            let updatedTimers = state.respawnTimers;\r\n            if (vehicle.category !== 'CAR' && vehicle.category !== 'CIVILIAN_TRUCK') {\r\n                // Set respawn timer - vehicle will respawn after 30 seconds\r\n                const respawnTimer = setTimeout(() => {\r\n                    get().respawnVehicle(vehicleId);\r\n                }, 30000);\r\n\r\n                // Store the timer so we can cancel if needed\r\n                updatedTimers = {\r\n                    ...state.respawnTimers,\r\n                    [vehicleId]: respawnTimer\r\n                };\r\n            }\r\n\r\n            return {\r\n                vehicleHealth: {\r\n                    ...state.vehicleHealth,\r\n                    [vehicleId]: {\r\n                        ...vehicle,\r\n                        isDestroyed: true\r\n                    }\r\n                },\r\n                respawnTimers: updatedTimers\r\n            };\r\n        });\r\n    },\r\n\r\n    // Respawn a vehicle with full health\r\n    respawnVehicle: (vehicleId) => {\r\n        set((state) => {\r\n            const vehicle = state.vehicleHealth[vehicleId];\r\n            if (!vehicle) return state;\r\n\r\n            const category = vehicle.category;\r\n            const healthDefaults = VEHICLE_HEALTH_DEFAULTS[category];\r\n\r\n            return {\r\n                vehicleHealth: {\r\n                    ...state.vehicleHealth,\r\n                    [vehicleId]: {\r\n                        ...vehicle,\r\n                        currentHealth: healthDefaults.maxHealth,\r\n                        maxHealth: healthDefaults.maxHealth,\r\n                        isDead: false,\r\n                        isDestroyed: false,\r\n                        isCritical: false,\r\n                        mobilityFactor: 1.0,\r\n                        visualEffects: [],\r\n                        damageLog: [] // Clear damage log on respawn\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    },\r\n\r\n    // Repair a vehicle (partial or full repair)\r\n    repairVehicle: (vehicleId, amount = null) => {\r\n        set((state) => {\r\n            const vehicle = state.vehicleHealth[vehicleId];\r\n            if (!vehicle || vehicle.isDestroyed) return state;\r\n\r\n            // Full repair if no amount specified\r\n            const newHealth = amount ?\r\n                Math.min(vehicle.maxHealth, vehicle.currentHealth + amount) :\r\n                vehicle.maxHealth;\r\n\r\n            const healthPercentage = newHealth / vehicle.maxHealth;\r\n\r\n            // Determine visual effects based on damage stages\r\n            const visualEffects = [];\r\n            const healthDefaults = VEHICLE_HEALTH_DEFAULTS[vehicle.category];\r\n\r\n            return {\r\n                vehicleHealth: {\r\n                    ...state.vehicleHealth,\r\n                    [vehicleId]: {\r\n                        ...vehicle,\r\n                        currentHealth: newHealth,\r\n                        healthPercentage,\r\n                        isDead: false, // Resurrect if was dead\r\n                        isCritical: healthPercentage <= healthDefaults.criticalThreshold,\r\n                        mobilityFactor: 1.0, // Restore full mobility on repair\r\n                        visualEffects\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    },\r\n\r\n    // Remove a vehicle from the health system\r\n    removeVehicle: (vehicleId) => {\r\n        set((state) => {\r\n            // Clear any respawn timer\r\n            if (state.respawnTimers[vehicleId]) {\r\n                clearTimeout(state.respawnTimers[vehicleId]);\r\n            }\r\n\r\n            const { [vehicleId]: _, ...remainingVehicles } = state.vehicleHealth;\r\n            const { [vehicleId]: __, ...remainingTimers } = state.respawnTimers;\r\n\r\n            return {\r\n                vehicleHealth: remainingVehicles,\r\n                respawnTimers: remainingTimers\r\n            };\r\n        });\r\n    },\r\n\r\n    // Get vehicle health data\r\n    getVehicleHealth: (vehicleId) => {\r\n        return useVehicleHealthStore.getState().vehicleHealth[vehicleId];\r\n    }\r\n}));\r\n\r\n/**\r\n * Calculate whether a projectile hit a vehicle and where\r\n * @param {THREE.Vector3} projectilePosition - Position of the projectile\r\n * @param {Object} vehicle - Vehicle object with position, rotation and type properties\r\n * @returns {Object|null} Hit result with location or null if no hit\r\n */\r\nexport function checkVehicleHit(projectilePosition, vehicle) {\r\n    const vehicleCategory = VEHICLE_CATEGORY_MAP[vehicle.type];\r\n    const healthDefaults = VEHICLE_HEALTH_DEFAULTS[vehicleCategory];\r\n\r\n    // Skip if no matching vehicle type/category\r\n    if (!healthDefaults) {\r\n        return null;\r\n    }\r\n\r\n    // Create a bounding box for the vehicle based on its position, rotation and hitbox size\r\n    const hitboxSize = healthDefaults.hitboxSize;\r\n\r\n    // Get vehicle position as a Vector3\r\n    const boundingBoxCenter = new THREE.Vector3(\r\n        vehicle.position.x || 0,\r\n        vehicle.position.y || 0,\r\n        vehicle.position.z || 0\r\n    );\r\n\r\n    // Create a rotation matrix from vehicle rotation\r\n    const vehicleMatrix = new THREE.Matrix4().makeRotationFromEuler(\r\n        new THREE.Euler(\r\n            vehicle.rotation.x || 0,\r\n            vehicle.rotation.y || 0,\r\n            vehicle.rotation.z || 0\r\n        )\r\n    );\r\n\r\n    // Create an oriented bounding box (OBB) by setting up corner vertices\r\n    const halfExtents = new THREE.Vector3(\r\n        hitboxSize.x * 0.75, // Increased hitbox size for better hit detection\r\n        hitboxSize.y * 0.75,\r\n        hitboxSize.z * 0.75\r\n    );\r\n\r\n    // Create a standard axis-aligned bounding box\r\n    const boundingBox = new THREE.Box3(\r\n        new THREE.Vector3().copy(boundingBoxCenter).sub(halfExtents),\r\n        new THREE.Vector3().copy(boundingBoxCenter).add(halfExtents)\r\n    );\r\n\r\n    // Check if projectile position is inside bounding box\r\n    // Note: This is simplified collision and doesn't account for rotation,\r\n    // but should be enough for gameplay mechanics\r\n    if (boundingBox.containsPoint(projectilePosition)) {\r\n        // Determine hit location based on relative position within the vehicle\r\n        // First transform projectile position to vehicle's local space\r\n        const localPos = projectilePosition.clone().sub(boundingBoxCenter);\r\n\r\n        // Use invert instead of getInverse (deprecated)\r\n        const inverseMatrix = new THREE.Matrix4().copy(vehicleMatrix).invert();\r\n        localPos.applyMatrix4(inverseMatrix);\r\n\r\n        // Determine hit location based on local coordinates\r\n        let hitLocation;\r\n\r\n        // More precise hit location determination for different vehicle types\r\n        if (vehicleCategory === 'TANK') {\r\n            // Tank-specific hit locations\r\n            if (localPos.y > hitboxSize.y * 0.3) {\r\n                hitLocation = 'turret';\r\n            } else if (localPos.y < -hitboxSize.y * 0.3) {\r\n                hitLocation = 'tracks';\r\n            } else if (localPos.z > hitboxSize.z * 0.3) {\r\n                hitLocation = 'front';\r\n            } else if (localPos.z < -hitboxSize.z * 0.3) {\r\n                hitLocation = 'rear';\r\n            } else {\r\n                hitLocation = 'body';\r\n            }\r\n        } else if (vehicleCategory === 'IFV') {\r\n            // IFV-specific hit locations\r\n            if (localPos.y > hitboxSize.y * 0.3) {\r\n                hitLocation = 'turret';\r\n            } else if (localPos.y < -hitboxSize.y * 0.3) {\r\n                hitLocation = 'wheels';\r\n            } else if (localPos.z > hitboxSize.z * 0.3) {\r\n                hitLocation = 'front';\r\n            } else if (localPos.z < -hitboxSize.z * 0.3) {\r\n                hitLocation = 'rear';\r\n            } else {\r\n                hitLocation = 'body';\r\n            }\r\n        } else if (vehicleCategory === 'CIVILIAN_TRUCK' || vehicleCategory === 'MILITARY_TRUCK') {\r\n            // Truck-specific hit locations\r\n            if (localPos.z > hitboxSize.z * 0.2) {\r\n                hitLocation = 'cabin';\r\n            } else if (localPos.z < -hitboxSize.z * 0.2) {\r\n                hitLocation = 'cargo';\r\n            } else if (localPos.y < -hitboxSize.y * 0.3) {\r\n                hitLocation = 'wheels';\r\n            } else if (localPos.z > 0 && localPos.y > 0) {\r\n                hitLocation = 'engine';\r\n            } else {\r\n                hitLocation = 'body';\r\n            }\r\n        } else if (vehicleCategory === 'CAR') {\r\n            // Car-specific hit locations\r\n            if (localPos.z > hitboxSize.z * 0.3) {\r\n                hitLocation = 'engine';\r\n            } else if (localPos.z < -hitboxSize.z * 0.3) {\r\n                hitLocation = 'rear';\r\n            } else if (localPos.y < -hitboxSize.y * 0.3) {\r\n                hitLocation = 'wheels';\r\n            } else if (localPos.z > 0) {\r\n                hitLocation = 'cabin';\r\n            } else {\r\n                hitLocation = 'body';\r\n            }\r\n        } else {\r\n            // Default hit location for unknown vehicle types\r\n            hitLocation = 'body';\r\n        }\r\n\r\n        return {\r\n            hit: true,\r\n            location: hitLocation,\r\n            position: projectilePosition.clone(),\r\n            distanceFromCenter: localPos.length()\r\n        };\r\n    }\r\n\r\n    return null; // No hit\r\n}\r\n\r\n/**\r\n * Utility function to create visual effects for damaged vehicles\r\n * @param {Object} vehicleHealth - Health data for the vehicle\r\n * @returns {Array} Array of effect components to render\r\n */\r\nexport function createDamageEffects(vehicleHealth) {\r\n    if (!vehicleHealth || vehicleHealth.isDead || vehicleHealth.visualEffects.length === 0) {\r\n        return [];\r\n    }\r\n\r\n    // Map of effect types to their rendering components\r\n    // These would be implemented separately in a visual effects system\r\n    const effects = [];\r\n\r\n    vehicleHealth.visualEffects.forEach(effectType => {\r\n        switch (effectType) {\r\n            case 'LIGHT_SMOKE':\r\n                effects.push({\r\n                    type: 'smoke',\r\n                    size: 0.5,\r\n                    color: '#888888',\r\n                    opacity: 0.4,\r\n                    rate: 0.2\r\n                });\r\n                break;\r\n            case 'MEDIUM_SMOKE':\r\n                effects.push({\r\n                    type: 'smoke',\r\n                    size: 1.0,\r\n                    color: '#555555',\r\n                    opacity: 0.6,\r\n                    rate: 0.5\r\n                });\r\n                break;\r\n            case 'HEAVY_SMOKE':\r\n                effects.push({\r\n                    type: 'smoke',\r\n                    size: 1.5,\r\n                    color: '#333333',\r\n                    opacity: 0.8,\r\n                    rate: 0.8\r\n                });\r\n                break;\r\n            case 'FIRE':\r\n                effects.push({\r\n                    type: 'fire',\r\n                    size: 0.8,\r\n                    intensity: 1.2,\r\n                    flickerSpeed: 0.1\r\n                });\r\n                break;\r\n            case 'SPARK':\r\n                effects.push({\r\n                    type: 'spark',\r\n                    size: 0.3,\r\n                    rate: 0.4,\r\n                    color: '#ffaa00'\r\n                });\r\n                break;\r\n            case 'DESTROYED':\r\n                effects.push({\r\n                    type: 'wreckage',\r\n                    blackenFactor: 0.8\r\n                });\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    });\r\n\r\n    return effects;\r\n} ","import * as THREE from 'three';\r\n// Import the vehicle health system\r\nimport { checkVehicleHit, useVehicleHealthStore, VEHICLE_CATEGORY_MAP } from './VehicleHealthSystem';\r\n\r\n// FPS Tracking for performance optimization\r\nwindow.currentFps = 60; // Initialize with ideal FPS\r\nwindow.fpsHistory = []; // Store recent FPS values for stability\r\nwindow.lowFpsWarning = false; // Flag for low FPS warning\r\nlet frameCount = 0;\r\nlet lastFpsUpdateTime = 0;\r\nconst FPS_HISTORY_LENGTH = 5; // Keep track of last 5 FPS readings for stability\r\n\r\n// Update FPS calculation every 0.5 seconds\r\nif (typeof window !== 'undefined') {\r\n    const updateFps = () => {\r\n        const now = performance.now();\r\n        const elapsed = now - lastFpsUpdateTime;\r\n\r\n        if (elapsed >= 500) { // Update every 0.5 seconds\r\n            const instantFps = frameCount * (1000 / elapsed);\r\n\r\n            // Add to history and keep only the last N readings\r\n            window.fpsHistory.push(instantFps);\r\n            if (window.fpsHistory.length > FPS_HISTORY_LENGTH) {\r\n                window.fpsHistory.shift();\r\n            }\r\n\r\n            // Calculate average FPS for more stable readings\r\n            const avgFps = window.fpsHistory.reduce((sum, fps) => sum + fps, 0) /\r\n                window.fpsHistory.length;\r\n\r\n            // Update the current FPS with the smoothed value\r\n            window.currentFps = avgFps;\r\n\r\n            // Check for low FPS conditions\r\n            if (avgFps < 30) {\r\n                // Set low FPS warning flag for game to adapt\r\n                window.lowFpsWarning = true;\r\n\r\n                // If this is persistent low FPS, consider adjusting global quality settings\r\n                if (window.fpsHistory.every(fps => fps < 30)) {\r\n                    // Publish event for game to respond to persistent performance issues\r\n                    if (!window.persistentLowFpsWarning) {\r\n                        window.persistentLowFpsWarning = true;\r\n                        window.dispatchEvent(new CustomEvent('persistentLowFps', {\r\n                            detail: { averageFps: avgFps }\r\n                        }));\r\n                    }\r\n                }\r\n            } else {\r\n                window.lowFpsWarning = false;\r\n                window.persistentLowFpsWarning = false;\r\n            }\r\n\r\n            lastFpsUpdateTime = now;\r\n            frameCount = 0;\r\n        } else {\r\n            frameCount++;\r\n        }\r\n\r\n        requestAnimationFrame(updateFps);\r\n    };\r\n\r\n    requestAnimationFrame(updateFps);\r\n}\r\n\r\n// Weapon types and their damage profiles\r\nexport const WEAPON_TYPES = {\r\n    // Bomber weapons\r\n    ANTI_TANK_MINE: 'ANTI_TANK_MINE',\r\n    RPG: 'RPG',\r\n    MORTAR: 'MORTAR',\r\n\r\n    // Grenadier weapons\r\n    DART: 'DART',\r\n    GRENADE: 'GRENADE',\r\n    SHOTGUN: 'SHOTGUN',\r\n\r\n    // Kamikaze drone weapon\r\n    KAMIKAZE: 'KAMIKAZE'\r\n};\r\n\r\n// Damage profiles for each weapon type\r\nexport const DAMAGE_PROFILES = {\r\n    // Bomber weapons\r\n    [WEAPON_TYPES.ANTI_TANK_MINE]: {\r\n        innerRadius: 8, // meters\r\n        outerRadius: 20, // meters\r\n        innerDamage: 30,\r\n        outerDamage: 10,\r\n        falloff: 'EXPONENTIAL', // damage falls off exponentially\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 4,\r\n            duration: 10, // frames\r\n            color: 0xff5500, // orange-red\r\n            intensity: 2.5,\r\n            secondaryEffects: {\r\n                debris: { count: 45, size: 1.2 },\r\n                smoke: { volume: 2.0, duration: 1.8 },\r\n                shockwave: true\r\n            }\r\n        }\r\n    },\r\n    [WEAPON_TYPES.RPG]: {\r\n        innerRadius: 6,\r\n        outerRadius: 15,\r\n        innerDamage: 25,\r\n        outerDamage: 8,\r\n        falloff: 'EXPONENTIAL',\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 3,\r\n            duration: 10,\r\n            color: 0xff3300, // bright red-orange\r\n            intensity: 0.7,\r\n            secondaryEffects: {\r\n                debris: { count: 35, size: 0.8 },\r\n                smoke: { volume: 1.5, duration: 1.3 },\r\n                shockwave: true,\r\n                tracer: true\r\n            }\r\n        }\r\n    },\r\n    [WEAPON_TYPES.MORTAR]: {\r\n        innerRadius: 10,\r\n        outerRadius: 25,\r\n        innerDamage: 20,\r\n        outerDamage: 12,\r\n        falloff: 'EXPONENTIAL',\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 3,\r\n            duration: 10,\r\n            color: 0x222222, // darker with smoke\r\n            intensity: 1.4,\r\n            secondaryEffects: {\r\n                debris: { count: 60, size: 1.5 },\r\n                smoke: { volume: 2.5, duration: 2.0 },\r\n                shockwave: true,\r\n                dustCloud: true\r\n            }\r\n        }\r\n    },\r\n\r\n    // Grenadier weapons\r\n    [WEAPON_TYPES.DART]: {\r\n        innerRadius: 5,\r\n        outerRadius: 12,\r\n        innerDamage: 22,\r\n        outerDamage: 8,\r\n        falloff: 'LINEAR',\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 2.0,\r\n            duration: 20,\r\n            color: 0x00ffff, // cyan\r\n            intensity: 1.5,\r\n            secondaryEffects: {\r\n                debris: { count: 20, size: 0.5 },\r\n                smoke: { volume: 1.0, duration: 1.0 },\r\n                energyField: true\r\n            }\r\n        }\r\n    },\r\n    [WEAPON_TYPES.GRENADE]: {\r\n        innerRadius: 10,\r\n        outerRadius: 25,\r\n        innerDamage: 30,\r\n        outerDamage: 12,\r\n        falloff: 'EXPONENTIAL',\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 2.5,\r\n            duration: 35,\r\n            color: 0xffaa00, // amber\r\n            intensity: 2.5,\r\n            secondaryEffects: {\r\n                debris: { count: 50, size: 0.9 },\r\n                smoke: { volume: 2.0, duration: 1.8 },\r\n                shockwave: true,\r\n                fragments: true\r\n            }\r\n        }\r\n    },\r\n    [WEAPON_TYPES.SHOTGUN]: {\r\n        innerRadius: 4,\r\n        outerRadius: 10,\r\n        innerDamage: 18,\r\n        outerDamage: 6,\r\n        falloff: 'EXPONENTIAL',\r\n        shape: 'CONE',\r\n        coneAngle: Math.PI / 6, // 30 degrees cone\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 3,\r\n            duration: 15,\r\n            color: 0xffffaa, // yellowish flash\r\n            intensity: 1.5,\r\n            shape: 'CONE',\r\n            coneAngle: Math.PI / 6,\r\n            secondaryEffects: {\r\n                debris: { count: 20, size: 0.3 },\r\n                smoke: { volume: 0.8, duration: 0.6 },\r\n                muzzleFlash: true\r\n            }\r\n        }\r\n    },\r\n\r\n    // Kamikaze drone weapon\r\n    [WEAPON_TYPES.KAMIKAZE]: {\r\n        innerRadius: 15, // 15m inner radius as specified\r\n        outerRadius: 25, // 25m outer radius as specified\r\n        innerDamage: 80, // Updated to 80 damage in inner radius\r\n        outerDamage: 50, // Updated to 50 damage in outer radius\r\n        falloff: 'EXPONENTIAL',\r\n        explodesOnImpact: true, // Always explode on impact with vehicles\r\n        visualEffect: {\r\n            radius: 5, // Larger explosion radius\r\n            duration: 15, // Longer duration\r\n            color: 0xff0000, // Bright red explosion\r\n            intensity: 3.0, // Higher intensity\r\n            secondaryEffects: {\r\n                debris: { count: 60, size: 1.5 },\r\n                smoke: { volume: 2.5, duration: 2.0 },\r\n                shockwave: true,\r\n                fragments: true,\r\n                dustCloud: true\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Calculate damage based on distance from explosion center\r\n * @param {string} weaponType - The type of weapon \r\n * @param {THREE.Vector3} explosionPosition - Position of the explosion\r\n * @param {THREE.Vector3} targetPosition - Position of the target\r\n * @returns {number} - The calculated damage amount\r\n */\r\nexport function calculateDamage(weaponType, explosionPosition, targetPosition) {\r\n    const profile = DAMAGE_PROFILES[weaponType];\r\n    if (!profile) return 0;\r\n\r\n    // Calculate distance from explosion to target (using squared distance for performance)\r\n    const dx = explosionPosition.x - targetPosition.x;\r\n    const dy = explosionPosition.y - targetPosition.y;\r\n    const dz = explosionPosition.z - targetPosition.z;\r\n    const distanceSquared = dx * dx + dy * dy + dz * dz;\r\n\r\n    // Special case for shotgun cone shape\r\n    if (weaponType === WEAPON_TYPES.SHOTGUN && profile.shape === 'CONE') {\r\n        // TODO: Implement cone detection when direction vector is provided\r\n        // For now, continue with radius-based calculation\r\n    }\r\n\r\n    // No damage beyond outer radius (using squared distance for performance)\r\n    const outerRadiusSquared = profile.outerRadius * profile.outerRadius;\r\n    if (distanceSquared > outerRadiusSquared) return 0;\r\n\r\n    // Full damage within inner radius\r\n    const innerRadiusSquared = profile.innerRadius * profile.innerRadius;\r\n    if (distanceSquared <= innerRadiusSquared) return profile.innerDamage;\r\n\r\n    // Calculate actual distance for falloff calculation\r\n    const distance = Math.sqrt(distanceSquared);\r\n\r\n    // Calculate falloff based on specified type\r\n    const ratio = (distance - profile.innerRadius) / (profile.outerRadius - profile.innerRadius);\r\n\r\n    // Use lookup or precomputed values for common falloff types for better performance\r\n    return profile.falloff === 'EXPONENTIAL'\r\n        ? profile.innerDamage * Math.pow(1 - ratio, 2)  // Exponential falloff\r\n        : profile.innerDamage - (ratio * (profile.innerDamage - profile.outerDamage)); // Linear falloff\r\n}\r\n\r\n/**\r\n * Apply explosion damage to all targets in range\r\n * @param {string} weaponType - The type of weapon\r\n * @param {THREE.Vector3} explosionPosition - Position of the explosion\r\n * @param {Array} targets - Array of target objects with position property\r\n */\r\nexport function applyExplosionDamage(weaponType, explosionPosition, targets) {\r\n    // Get the applyDamage function from the vehicle health store\r\n    const applyDamage = useVehicleHealthStore.getState().applyDamage;\r\n\r\n    // Early return if no targets or invalid weaponType\r\n    if (!targets || targets.length === 0 || !DAMAGE_PROFILES[weaponType]) {\r\n        return;\r\n    }\r\n\r\n    // Get damage profile for quick reference\r\n    const profile = DAMAGE_PROFILES[weaponType];\r\n    const outerRadiusSquared = profile.outerRadius * profile.outerRadius;\r\n\r\n    // Performance optimization: Filter targets by distance first\r\n    // This avoids processing targets that are definitely out of range\r\n    const potentialTargets = targets.filter(target => {\r\n        if (!target || !target.position) return false;\r\n\r\n        // Quick distance squared check\r\n        const dx = explosionPosition.x - target.position.x;\r\n        const dy = explosionPosition.y - target.position.y;\r\n        const dz = explosionPosition.z - target.position.z;\r\n        const distanceSquared = dx * dx + dy * dy + dz * dz;\r\n\r\n        // Only include targets within outer radius\r\n        return distanceSquared <= outerRadiusSquared * 1.1; // Small buffer for safety\r\n    });\r\n\r\n    // If no targets in range, return early\r\n    if (potentialTargets.length === 0) {\r\n        return;\r\n    }\r\n\r\n    // Process targets in batches to avoid blocking the main thread\r\n    const processBatch = (startIndex, batchSize) => {\r\n        const endIndex = Math.min(startIndex + batchSize, potentialTargets.length);\r\n\r\n        for (let i = startIndex; i < endIndex; i++) {\r\n            const target = potentialTargets[i];\r\n\r\n            // For vehicle targets with userData containing vehicleId\r\n            if (target.userData && target.userData.vehicleId) {\r\n                processVehicleTarget(target, weaponType, explosionPosition, applyDamage);\r\n            }\r\n            // For legacy targets with takeDamage method\r\n            else if (typeof target.takeDamage === 'function') {\r\n                const damage = calculateDamage(weaponType, explosionPosition, target.position);\r\n                if (damage > 0) {\r\n                    target.takeDamage(damage);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Process next batch if there are more targets\r\n        if (endIndex < potentialTargets.length) {\r\n            setTimeout(() => {\r\n                processBatch(endIndex, batchSize);\r\n            }, 0);\r\n        }\r\n    };\r\n\r\n    // Start processing targets in batches of 10 (reduced from 20 for smoother frames)\r\n    processBatch(0, 10);\r\n}\r\n\r\n/**\r\n * Process a vehicle target for damage calculation and application\r\n * @private\r\n */\r\nfunction processVehicleTarget(target, weaponType, explosionPosition, applyDamage) {\r\n    // Check for direct hit and hit location\r\n    const hit = checkVehicleHit(explosionPosition, {\r\n        position: target.position,\r\n        rotation: target.rotation,\r\n        type: target.userData.vehicleType || 'car_a' // Default if not specified\r\n    });\r\n\r\n    // Calculate damage\r\n    const damage = calculateDamage(weaponType, explosionPosition, target.position);\r\n\r\n    if (damage <= 0) {\r\n        return;\r\n    }\r\n\r\n    if (hit) {\r\n        // Direct hit - apply damage with hit location info\r\n        applyDamage(target.userData.vehicleId, damage, hit.location, weaponType);\r\n    } else {\r\n        // Explosion radius damage - apply general damage to the body\r\n        applyDamage(target.userData.vehicleId, damage, 'body', weaponType);\r\n    }\r\n}\r\n\r\n/**\r\n * Create explosion effect\r\n * @param {string} weaponType - The type of weapon\r\n * @param {THREE.Vector3} position - Position of explosion\r\n * @returns {Object} - Data needed to render explosion effect\r\n */\r\nexport function createExplosionEffect(weaponType, position) {\r\n    // Performance optimization for low FPS situations\r\n    // If lots of explosions are happening, downgrade the visual quality\r\n    const fpsAdjustment = window.performance && window.performance.now ?\r\n        Math.min(1.0, 60 / (window.currentFps || 60)) : 1.0;\r\n\r\n    const profile = DAMAGE_PROFILES[weaponType];\r\n\r\n    // Early return with minimal data for shotgun (handled separately)\r\n    if (weaponType === WEAPON_TYPES.SHOTGUN) {\r\n        // Even more aggressive optimization for shotgun effects - completely disabled at very low FPS\r\n        const currentFps = window.currentFps || 60;\r\n        if (currentFps < 25) {\r\n            // At extremely low FPS, just return position for damage calculation but no visual effect\r\n            return {\r\n                position: position.clone(),\r\n                type: weaponType,\r\n                noVisual: true,\r\n                startTime: Date.now()\r\n            };\r\n        }\r\n\r\n        // Further reduce shotgun visual effects when FPS is below threshold\r\n        const shotgunFpsThreshold = 45; // Higher threshold specifically for shotgun effects\r\n        const shotgunSpecificAdjustment = currentFps < shotgunFpsThreshold ?\r\n            Math.min(0.4, 60 / (window.currentFps || 60)) : 0.8;\r\n\r\n        return {\r\n            position: position.clone(),\r\n            radius: profile.outerRadius / 4 * shotgunSpecificAdjustment, // Even smaller radius\r\n            duration: 1,\r\n            type: weaponType,\r\n            startTime: Date.now()\r\n        };\r\n    }\r\n\r\n    const visual = profile.visualEffect;\r\n\r\n    // Scale down particle counts and visual effects based on current FPS\r\n    const debrisCount = Math.floor((visual.secondaryEffects.debris?.count || 0) * fpsAdjustment);\r\n    const smokeVolume = (visual.secondaryEffects.smoke?.volume || 0) * fpsAdjustment;\r\n\r\n    // Create standardized explosion data structure with adjusted values\r\n    return {\r\n        position: position.clone(),\r\n        radius: visual.radius * fpsAdjustment,  // Smaller radius when FPS is low\r\n        duration: visual.duration,\r\n        color: visual.color,\r\n        intensity: visual.intensity * fpsAdjustment,  // Lower intensity when FPS is low\r\n\r\n        // Shape details (cone or sphere)\r\n        shape: visual.shape || 'SPHERE',\r\n        coneAngle: visual.coneAngle,\r\n\r\n        // Process secondary effects with the new structure and FPS adjustment\r\n        secondaryEffects: {\r\n            // Debris settings - reduce count when FPS is low\r\n            debris: {\r\n                count: debrisCount,\r\n                size: visual.secondaryEffects.debris?.size || 0\r\n            },\r\n\r\n            // Smoke settings - reduce volume when FPS is low\r\n            smoke: {\r\n                volume: smokeVolume,\r\n                duration: visual.secondaryEffects.smoke?.duration || 0\r\n            },\r\n\r\n            // Boolean flags for special effects\r\n            shockwave: visual.secondaryEffects.shockwave && fpsAdjustment > 0.7,\r\n            dustCloud: visual.secondaryEffects.dustCloud && fpsAdjustment > 0.7,\r\n            energyField: visual.secondaryEffects.energyField && fpsAdjustment > 0.8,\r\n            fragments: visual.secondaryEffects.fragments && fpsAdjustment > 0.7,\r\n            muzzleFlash: visual.secondaryEffects.muzzleFlash,\r\n            tracer: visual.secondaryEffects.tracer\r\n        },\r\n\r\n        // Metadata\r\n        type: weaponType,\r\n        startTime: Date.now(),\r\n        quality: fpsAdjustment  // Store quality level for renderer reference\r\n    };\r\n}\r\n\r\n/**\r\n * Convert weapon type string to readable name\r\n * @param {string} weaponType - The internal weapon type constant\r\n * @returns {string} - Human readable weapon name\r\n */\r\nexport function getWeaponName(weaponType) {\r\n    switch (weaponType) {\r\n        case WEAPON_TYPES.ANTI_TANK_MINE: return 'Anti-Tank Mine';\r\n        case WEAPON_TYPES.RPG: return 'RPG';\r\n        case WEAPON_TYPES.MORTAR: return 'Mortar';\r\n        case WEAPON_TYPES.DART: return 'Dart';\r\n        case WEAPON_TYPES.GRENADE: return 'Grenade';\r\n        case WEAPON_TYPES.SHOTGUN: return 'Shotgun';\r\n        case WEAPON_TYPES.KAMIKAZE: return 'Kamikaze';\r\n        default: return 'Unknown Weapon';\r\n    }\r\n}\r\n\r\n/**\r\n * Create vehicle hitbox for collision testing\r\n * @param {Object} vehicle - The vehicle object with position, rotation, and hitbox properties\r\n * @returns {THREE.Box3} - Axis-aligned bounding box for the vehicle\r\n */\r\nfunction createVehicleHitbox(vehicle) {\r\n    // Default hitbox dimensions if not specified\r\n    const dimensions = vehicle.hitbox || {\r\n        width: 1.33,  // Width (left/right)\r\n        height: 1.33, // Height (up/down)\r\n        depth: 4.0   // Depth (front/back)\r\n    };\r\n\r\n    // Create a box with the correct dimensions\r\n    const halfWidth = dimensions.width / 2;\r\n    const halfHeight = dimensions.height / 2;\r\n    const halfDepth = dimensions.depth / 2;\r\n\r\n    // Create the box based on vehicle's rotation\r\n    const rotation = vehicle.rotation.y || 0;\r\n\r\n    // For vehicles oriented along X axis vs Z axis\r\n    const isAlongX = Math.abs(Math.sin(rotation)) > 0.7;\r\n\r\n    // Determine the correct dimensions based on vehicle rotation\r\n    const xExtent = isAlongX ? halfDepth : halfWidth;\r\n    const zExtent = isAlongX ? halfWidth : halfDepth;\r\n\r\n    // Create min and max points for the box\r\n    const min = new THREE.Vector3(\r\n        vehicle.position.x - xExtent,\r\n        vehicle.position.y,\r\n        vehicle.position.z - zExtent\r\n    );\r\n\r\n    const max = new THREE.Vector3(\r\n        vehicle.position.x + xExtent,\r\n        vehicle.position.y + dimensions.height,\r\n        vehicle.position.z + zExtent\r\n    );\r\n\r\n    // Create and return the box\r\n    return new THREE.Box3(min, max);\r\n}\r\n\r\n/**\r\n * Test if a line segment intersects with a box\r\n * @param {THREE.Line3} line - Line segment to test\r\n * @param {THREE.Box3} box - Box to test against\r\n * @returns {boolean} - True if the line intersects the box\r\n */\r\nfunction lineBoxIntersection(line, box) {\r\n    // Simple point in box test first (for either endpoint)\r\n    if (box.containsPoint(line.start) || box.containsPoint(line.end)) {\r\n        return true;\r\n    }\r\n\r\n    // Use a ray approach with the line direction and length\r\n    const direction = new THREE.Vector3().subVectors(line.end, line.start).normalize();\r\n    const length = line.start.distanceTo(line.end);\r\n\r\n    // Create a ray from the line start in the direction of the line\r\n    const ray = new THREE.Ray(line.start, direction);\r\n\r\n    // Find intersection with box\r\n    const result = new THREE.Vector3();\r\n    if (ray.intersectBox(box, result)) {\r\n        // Check if intersection point is within the line segment length\r\n        const distToIntersection = line.start.distanceTo(result);\r\n        return distToIntersection <= length;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Check if a projectile has collided with a vehicle using raycasting for more accurate detection\r\n * @param {Object} projectile - The projectile object with position and previousPosition properties\r\n * @param {THREE.Scene} scene - The scene to check for vehicle objects\r\n * @returns {Object|null} - The hit result with vehicle and position, or null if no collision\r\n */\r\nexport function checkProjectileVehicleCollision(projectile, scene) {\r\n    if (!projectile || !projectile.position || !scene) return null;\r\n\r\n    // If there's no previous position, just use the current position (first frame)\r\n    if (!projectile.previousPosition) {\r\n        projectile.previousPosition = projectile.position.clone();\r\n        return null;\r\n    }\r\n\r\n    // Start with a simple point-based collision check first (faster)\r\n    // This helps catch cases where a projectile might be inside a vehicle\r\n    const simpleCheckResult = checkSimpleVehicleCollision(projectile.position, scene);\r\n    if (simpleCheckResult) {\r\n        return simpleCheckResult;\r\n    }\r\n\r\n    // If simple check failed, use the more sophisticated raycasting approach\r\n    const direction = new THREE.Vector3().subVectors(\r\n        projectile.position,\r\n        projectile.previousPosition\r\n    ).normalize();\r\n\r\n    const rayLength = projectile.previousPosition.distanceTo(projectile.position);\r\n\r\n    // Simple spatial partitioning - only check vehicles within a reasonable distance\r\n    const searchRadius = Math.max(rayLength, 5.0);\r\n    const searchCenter = new THREE.Vector3().copy(projectile.position).add(\r\n        projectile.previousPosition).multiplyScalar(0.5);\r\n\r\n    // Create a raycaster with optimized settings for performance\r\n    const raycaster = new THREE.Raycaster(projectile.previousPosition, direction, 0, rayLength * 1.1);\r\n    raycaster.params.Line.threshold = 0.2;\r\n    raycaster.params.Points.threshold = 0.2;\r\n\r\n    // Function to collect only nearby vehicles for more efficient collision testing\r\n    const collectNearbyVehicles = (object, objects = []) => {\r\n        // Skip if the object is not visible or doesn't have userData\r\n        if (!object.visible || !object.userData) return objects;\r\n\r\n        // Quick distance check for early rejection\r\n        if (object.position) {\r\n            const distSquared = object.position.distanceToSquared(searchCenter);\r\n            if (distSquared > searchRadius * searchRadius * 1.5) {\r\n                return objects; // Skip objects too far away\r\n            }\r\n        }\r\n\r\n        // If this has vehicle data, include it\r\n        if (object.userData.vehicleId || object.userData.isVehiclePart ||\r\n            (object.userData.type && object.name && (\r\n                object.name.includes('vehicle') ||\r\n                object.name.includes('car') ||\r\n                object.name.includes('truck') ||\r\n                object.name.includes('tank')\r\n            ))\r\n        ) {\r\n            objects.push(object);\r\n        }\r\n\r\n        // Process children recursively (but only for objects that could be close enough)\r\n        if (object.children && object.children.length > 0) {\r\n            for (let child of object.children) {\r\n                collectNearbyVehicles(child, objects);\r\n            }\r\n        }\r\n\r\n        return objects;\r\n    };\r\n\r\n    // Collect potentially nearby vehicle objects\r\n    const nearbyVehicles = [];\r\n    scene.children.forEach(child => {\r\n        collectNearbyVehicles(child, nearbyVehicles);\r\n    });\r\n\r\n    // If no nearby vehicles, return early\r\n    if (nearbyVehicles.length === 0) return null;\r\n\r\n    // Try simple box-based check first (much faster)\r\n    for (const object of nearbyVehicles) {\r\n        if (!object.userData.vehicleId && !object.userData.isVehicle) continue;\r\n\r\n        const vehicleObject = {\r\n            position: object.position,\r\n            rotation: object.rotation,\r\n            hitbox: object.userData.hitbox\r\n        };\r\n\r\n        const hitbox = createVehicleHitbox(vehicleObject);\r\n\r\n        // Check line intersection\r\n        const line = new THREE.Line3(projectile.previousPosition, projectile.position);\r\n\r\n        if (lineBoxIntersection(line, hitbox) || hitbox.containsPoint(projectile.position)) {\r\n            return {\r\n                vehicle: object,\r\n                position: projectile.position.clone(),\r\n                hitLocation: 'body'\r\n            };\r\n        }\r\n    }\r\n\r\n    // If box test failed, try full raycasting against all nearby vehicles\r\n    const intersects = raycaster.intersectObjects(nearbyVehicles, true);\r\n\r\n    if (intersects.length === 0) return null;\r\n\r\n    // Get the closest intersection\r\n    const closestIntersection = intersects[0];\r\n    const hitObject = closestIntersection.object;\r\n    const hitPoint = closestIntersection.point;\r\n\r\n    // Find the vehicle this part belongs to\r\n    let vehicleObject = hitObject;\r\n    let hitLocation = 'body';\r\n    let parent = hitObject;\r\n\r\n    while (parent && !parent.userData.vehicleId) {\r\n        if (parent.userData.isVehiclePart && parent.userData.partType) {\r\n            hitLocation = parent.userData.partType;\r\n        }\r\n        parent = parent.parent;\r\n        if (parent && parent.userData.vehicleId) {\r\n            vehicleObject = parent;\r\n        }\r\n    }\r\n\r\n    if (hitObject.userData.vehicleId) {\r\n        vehicleObject = hitObject;\r\n    }\r\n\r\n    if (hitObject.userData.isVehiclePart && hitObject.userData.partType) {\r\n        hitLocation = hitObject.userData.partType;\r\n    }\r\n\r\n    const vehicleId = vehicleObject.userData.vehicleId;\r\n    const vehicleType = vehicleObject.userData.vehicleType || 'car_a';\r\n\r\n    if (!vehicleId) return null;\r\n\r\n    return {\r\n        vehicle: vehicleObject,\r\n        position: hitPoint,\r\n        hitLocation: hitLocation\r\n    };\r\n}\r\n\r\n/**\r\n * Simple point-based collision check with vehicles\r\n * This is a faster first-pass check\r\n */\r\nfunction checkSimpleVehicleCollision(position, scene) {\r\n    const collectVehiclesAtPoint = (object, results = []) => {\r\n        if (!object.visible || !object.userData) return results;\r\n\r\n        // Check if object is a vehicle or part\r\n        if (object.userData.vehicleId || object.userData.isVehiclePart) {\r\n            // Create a simple bounding box for the object\r\n            const box = new THREE.Box3().setFromObject(object);\r\n\r\n            // Check if position is inside the box\r\n            if (box.containsPoint(position)) {\r\n                let hitLocation = 'body';\r\n                let vehicleObject = object;\r\n\r\n                // Handle parts\r\n                if (object.userData.isVehiclePart && object.userData.partType) {\r\n                    hitLocation = object.userData.partType;\r\n                    // Find parent vehicle\r\n                    let parent = object.parent;\r\n                    while (parent && !parent.userData.vehicleId) {\r\n                        parent = parent.parent;\r\n                    }\r\n                    if (parent) vehicleObject = parent;\r\n                }\r\n\r\n                results.push({\r\n                    vehicle: vehicleObject,\r\n                    position: position.clone(),\r\n                    hitLocation: hitLocation\r\n                });\r\n            }\r\n        }\r\n\r\n        // Check children recursively\r\n        if (object.children && object.children.length > 0) {\r\n            for (let child of object.children) {\r\n                collectVehiclesAtPoint(child, results);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    };\r\n\r\n    const hitVehicles = [];\r\n    scene.children.forEach(child => {\r\n        collectVehiclesAtPoint(child, hitVehicles);\r\n    });\r\n\r\n    return hitVehicles.length > 0 ? hitVehicles[0] : null;\r\n} ","import React, { useRef, useEffect, useState, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport * as THREE from 'three';\r\nimport { WEAPON_TYPES } from '../../utils/WeaponPhysics';\r\n\r\n// Shared geometries and materials to reduce memory usage\r\nconst sharedGeometries = {\r\n    sphere: new THREE.SphereGeometry(1, 16, 16),\r\n    smallSphere: new THREE.SphereGeometry(1, 8, 8),\r\n    debris: new THREE.BoxGeometry(1, 1, 1)\r\n};\r\n\r\n// Create shared, reusable materials for better performance\r\nconst sharedMaterials = {\r\n    // Create a base material that will be cloned for each explosion\r\n    fireballBase: new THREE.MeshStandardMaterial({\r\n        transparent: true,\r\n        emissive: new THREE.Color(0xFFFFFF)\r\n    }),\r\n    debrisBase: new THREE.MeshStandardMaterial({\r\n        transparent: true\r\n    }),\r\n    smokeBase: new THREE.MeshStandardMaterial({\r\n        transparent: true\r\n    }),\r\n    flashBase: new THREE.MeshBasicMaterial({\r\n        color: 0xFFFFFF,\r\n        transparent: true\r\n    })\r\n};\r\n\r\n// Precomputed explosion colors for each weapon type\r\nconst explosionProperties = {\r\n    [WEAPON_TYPES.ANTI_TANK_MINE]: {\r\n        fireballColor: new THREE.Color(0xFF4500),\r\n        smokeColor: new THREE.Color(0x222222),\r\n        debrisColor: new THREE.Color(0x777777),\r\n        dustColor: new THREE.Color(0x998866),\r\n        lightIntensity: 2.5,\r\n        lightColor: 0xFF5500\r\n    },\r\n    [WEAPON_TYPES.RPG]: {\r\n        fireballColor: new THREE.Color(0xFF6347),\r\n        smokeColor: new THREE.Color(0x333333),\r\n        debrisColor: new THREE.Color(0x777777),\r\n        dustColor: new THREE.Color(0x887766),\r\n        lightIntensity: 3,\r\n        lightColor: 0xFF3300\r\n    },\r\n    [WEAPON_TYPES.MORTAR]: {\r\n        fireballColor: new THREE.Color(0xB22222),\r\n        smokeColor: new THREE.Color(0x111111),\r\n        debrisColor: new THREE.Color(0x555555),\r\n        dustColor: new THREE.Color(0x776655),\r\n        lightIntensity: 2.5,\r\n        lightColor: 0xDD2222\r\n    },\r\n    [WEAPON_TYPES.DART]: {\r\n        fireballColor: new THREE.Color(0x7CFC00),\r\n        smokeColor: new THREE.Color(0x99AA99),\r\n        debrisColor: new THREE.Color(0xAAFFAA),\r\n        dustColor: new THREE.Color(0xAABBAA),\r\n        lightIntensity: 1.5,\r\n        lightColor: 0x88FF00\r\n    },\r\n    [WEAPON_TYPES.GRENADE]: {\r\n        fireballColor: new THREE.Color(0xFFD700),\r\n        smokeColor: new THREE.Color(0x555555),\r\n        debrisColor: new THREE.Color(0x999999),\r\n        dustColor: new THREE.Color(0x998877),\r\n        lightIntensity: 2,\r\n        lightColor: 0xFFAA00\r\n    },\r\n    [WEAPON_TYPES.SHOTGUN]: {\r\n        fireballColor: new THREE.Color(0xFFFFAA),\r\n        smokeColor: new THREE.Color(0xDDDDDD),\r\n        debrisColor: new THREE.Color(0xDDDDDD),\r\n        dustColor: new THREE.Color(0xCCCCBB),\r\n        lightIntensity: 1,\r\n        lightColor: 0xFFFFAA\r\n    },\r\n    [WEAPON_TYPES.KAMIKAZE]: {\r\n        fireballColor: new THREE.Color(0xFF0000), // Bright red fireball\r\n        smokeColor: new THREE.Color(0x222222), // Dark smoke\r\n        debrisColor: new THREE.Color(0x666666), // Medium gray debris\r\n        dustColor: new THREE.Color(0x998866), // Dusty brown\r\n        lightIntensity: 3.5, // Very bright\r\n        lightColor: 0xFF1100 // Red-orange light\r\n    },\r\n    default: {\r\n        fireballColor: new THREE.Color(0xFF4500),\r\n        smokeColor: new THREE.Color(0x333333),\r\n        debrisColor: new THREE.Color(0x888888),\r\n        dustColor: new THREE.Color(0xAA9988),\r\n        lightIntensity: 2,\r\n        lightColor: 0xFF7700\r\n    }\r\n};\r\n\r\n// Particle type constants to avoid string literals\r\nconst PARTICLE_TYPES = {\r\n    DEBRIS: 'debris',\r\n    SMOKE: 'smoke',\r\n    DUST: 'dust',\r\n    SHOCKWAVE: 'shockwave'\r\n};\r\n\r\n// Animation performance constants\r\nconst ANIM_CONSTANTS = {\r\n    UPDATE_THRESHOLD: 0.02,      // Threshold for state updates\r\n    OPACITY_THRESHOLD: 0.01,     // Minimum particle opacity to render\r\n    FRAME_SKIP_THRESHOLD: 2,     // Frame skip for small explosions\r\n    BATCH_SIZE: 20,              // Particles to process per batch\r\n    MAX_DEBRIS: 60,              // Maximum debris particles\r\n    MAX_SMOKE: 50,               // Maximum smoke particles\r\n    MAX_DUST: 15,                // Maximum dust particles\r\n    MAX_SHOCKWAVE: 10            // Maximum shockwave particles\r\n};\r\n\r\n// Create a Vector3 pool for performance (reuse instead of creating new ones)\r\nconst vectorPool = {\r\n    _pool: [],\r\n    get: function () {\r\n        if (this._pool.length > 0) {\r\n            return this._pool.pop().set(0, 0, 0);\r\n        }\r\n        return new THREE.Vector3(0, 0, 0);\r\n    },\r\n    release: function (vector) {\r\n        this._pool.push(vector);\r\n    }\r\n};\r\n\r\nexport default function Explosion({ position, radius, type, duration = 30, onComplete, secondaryEffects = {} }) {\r\n    const groupRef = useRef();\r\n    const [progress, setProgress] = useState(0);\r\n    const [size, setSize] = useState(0.1);\r\n    const [opacity, setOpacity] = useState(1);\r\n    const [lifespan, setLifespan] = useState(duration);\r\n    const frameCount = useRef(0);\r\n    const lastProgressUpdate = useRef(0);\r\n    const lastSizeUpdate = useRef(0.1);\r\n\r\n    // Create optimized, cached materials based on explosion type\r\n    const materials = useMemo(() => {\r\n        const props = explosionProperties[type] || explosionProperties.default;\r\n\r\n        // Clone base materials to avoid modifying shared ones\r\n        const fireballMaterial = sharedMaterials.fireballBase.clone();\r\n        fireballMaterial.color = props.fireballColor.clone();\r\n        fireballMaterial.emissive = props.fireballColor.clone();\r\n\r\n        const debrisMaterial = sharedMaterials.debrisBase.clone();\r\n        debrisMaterial.color = props.debrisColor.clone();\r\n        debrisMaterial.emissive = props.debrisColor.clone();\r\n\r\n        const smokeMaterial = sharedMaterials.smokeBase.clone();\r\n        smokeMaterial.color = props.smokeColor.clone();\r\n\r\n        const dustMaterial = sharedMaterials.smokeBase.clone();\r\n        dustMaterial.color = props.dustColor.clone();\r\n\r\n        // Return all materials as a single object\r\n        return {\r\n            fireball: fireballMaterial,\r\n            debris: debrisMaterial,\r\n            smoke: smokeMaterial,\r\n            dust: dustMaterial,\r\n            flash: sharedMaterials.flashBase.clone()\r\n        };\r\n    }, [type]);\r\n\r\n    // Get explosion properties based on weapon type with fallback to default\r\n    const explosionProps = useMemo(() =>\r\n        explosionProperties[type] || explosionProperties.default,\r\n        [type]);\r\n\r\n    // Create optimized particle system with appropriate counts\r\n    const particles = useMemo(() => {\r\n        // Extract values from the new structured secondaryEffects\r\n        const debris = secondaryEffects.debris || { count: Math.floor(radius * 5), size: 0.7 };\r\n        const smoke = secondaryEffects.smoke || { volume: 1.0, duration: 1.0 };\r\n\r\n        // Cap particle counts for performance\r\n        const totalDebris = Math.min(ANIM_CONSTANTS.MAX_DEBRIS, Math.floor(debris.count));\r\n        const totalSmoke = Math.min(ANIM_CONSTANTS.MAX_SMOKE, Math.floor(radius * 8 * smoke.volume));\r\n\r\n        return generateParticles(\r\n            totalDebris,\r\n            totalSmoke,\r\n            debris.size,\r\n            radius,\r\n            duration,\r\n            secondaryEffects,\r\n            smoke.duration\r\n        );\r\n    }, [radius, duration, secondaryEffects]);\r\n\r\n    // Clean up materials when component unmounts\r\n    useEffect(() => {\r\n        return () => {\r\n            // Dispose cloned materials to prevent memory leaks\r\n            Object.values(materials).forEach(material => material.dispose());\r\n        };\r\n    }, [materials]);\r\n\r\n    // Optimized animation frame handler with batch processing and frame skipping\r\n    useFrame(() => {\r\n        if (!groupRef.current || lifespan <= 0) {\r\n            // Ensure cleanup happens if lifespan is already zero\r\n            if (lifespan <= 0 && onComplete) {\r\n                onComplete();\r\n            }\r\n            return;\r\n        }\r\n\r\n        frameCount.current++;\r\n\r\n        // Skip frames for smaller explosions (performance optimization)\r\n        if (radius < ANIM_CONSTANTS.FRAME_SKIP_THRESHOLD && frameCount.current % 2 !== 0) return;\r\n\r\n        // Calculate new progress - update state only when significant change\r\n        const newProgress = 1 - (lifespan / duration);\r\n        if (Math.abs(newProgress - lastProgressUpdate.current) > ANIM_CONSTANTS.UPDATE_THRESHOLD) {\r\n            lastProgressUpdate.current = newProgress;\r\n            setProgress(newProgress);\r\n\r\n            // Update material properties based on progress\r\n            updateMaterials(materials, newProgress);\r\n        }\r\n\r\n        // Optimize size updates with batched state updates\r\n        if (size < radius) {\r\n            const growthProgress = Math.min(1, newProgress * 2);\r\n            const targetSize = radius * Math.min(1, growthProgress * 1.2);\r\n            const growthRate = (targetSize - lastSizeUpdate.current) * 0.2;\r\n            const newSize = lastSizeUpdate.current + Math.max(0.05, growthRate);\r\n\r\n            if (Math.abs(newSize - lastSizeUpdate.current) > ANIM_CONSTANTS.UPDATE_THRESHOLD) {\r\n                lastSizeUpdate.current = newSize;\r\n                setSize(newSize);\r\n            }\r\n        }\r\n\r\n        // Optimize opacity updates\r\n        const shouldUpdateOpacity = newProgress < 0.4 ?\r\n            opacity !== 1 :\r\n            opacity > ANIM_CONSTANTS.OPACITY_THRESHOLD;\r\n\r\n        if (shouldUpdateOpacity) {\r\n            setOpacity(newProgress < 0.4 ? 1 : Math.max(0, opacity - (1 / (duration * 0.6))));\r\n        }\r\n\r\n        // Update particles with batched processing\r\n        updateParticlesBatch(particles, newProgress);\r\n\r\n        // Reduce lifespan\r\n        setLifespan(prev => prev - 1);\r\n\r\n        // Trigger completion\r\n        if (lifespan <= 1 && onComplete) {\r\n            try {\r\n                onComplete();\r\n            } catch (error) {\r\n                console.error(\"Error in explosion onComplete callback:\", error);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Reset explosion when position changes\r\n    useEffect(() => {\r\n        setSize(0.1);\r\n        lastSizeUpdate.current = 0.1;\r\n        setOpacity(1);\r\n        setLifespan(duration);\r\n        setProgress(0);\r\n        lastProgressUpdate.current = 0;\r\n        frameCount.current = 0;\r\n\r\n        // Reset all particles\r\n        resetParticles(particles);\r\n\r\n        // Reset materials\r\n        updateMaterials(materials, 0);\r\n    }, [position, duration, particles, materials]);\r\n\r\n    // Filter active particles for rendering optimization - using memoization with better dependency tracking\r\n    const activeParticles = useMemo(() => {\r\n        // Group particles by type for more efficient rendering\r\n        const result = {\r\n            [PARTICLE_TYPES.DEBRIS]: [],\r\n            [PARTICLE_TYPES.SMOKE]: [],\r\n            [PARTICLE_TYPES.DUST]: [],\r\n            [PARTICLE_TYPES.SHOCKWAVE]: []\r\n        };\r\n\r\n        // Only process if progress has changed significantly\r\n        if (Math.abs(progress - lastProgressUpdate.current) < 0.05) {\r\n            return result;\r\n        }\r\n\r\n        // Filter and group active particles\r\n        for (const particle of particles) {\r\n            if (particle.active && particle.life > 0 && particle.opacity > ANIM_CONSTANTS.OPACITY_THRESHOLD) {\r\n                result[particle.type].push(particle);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }, [particles, progress, lastProgressUpdate]);\r\n\r\n    // Update materials based on animation progress\r\n    function updateMaterials(materials, progress) {\r\n        materials.fireball.opacity = opacity;\r\n        materials.fireball.emissiveIntensity = 2 * (1 - progress * 0.7);\r\n\r\n        materials.flash.opacity = Math.max(0, 1 - (progress / 0.2));\r\n\r\n        // No need to update debris/smoke/dust materials here as they're handled per-particle\r\n    }\r\n\r\n    return (\r\n        <group ref={groupRef} position={[position.x, position.y, position.z]}>\r\n            {/* Initial flash - only render during early phase */}\r\n            {progress < 0.2 && (\r\n                <mesh>\r\n                    <sphereGeometry args={[size * 1.2, 16, 16]} />\r\n                    <primitive object={materials.flash} attach=\"material\" />\r\n                </mesh>\r\n            )}\r\n\r\n            {/* Main fireball */}\r\n            <mesh scale={[size, size, size]}>\r\n                <primitive attach=\"geometry\" object={sharedGeometries.sphere} />\r\n                <primitive object={materials.fireball} attach=\"material\" />\r\n            </mesh>\r\n\r\n            {/* Render particles by type for better batching */}\r\n            {Object.entries(activeParticles).map(([type, particles]) => (\r\n                <ParticleGroup\r\n                    key={type}\r\n                    type={type}\r\n                    particles={particles}\r\n                    materials={materials}\r\n                    progress={progress}\r\n                />\r\n            ))}\r\n\r\n            {/* Dynamic light - only render during relevant phase */}\r\n            {progress < 0.7 && (\r\n                <pointLight\r\n                    color={explosionProps.lightColor}\r\n                    intensity={explosionProps.lightIntensity * (1 - Math.pow(progress, 1.5)) * 20}\r\n                    distance={radius * 15}\r\n                    decay={2}\r\n                />\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\n// Particle group component for better batching\r\nfunction ParticleGroup({ type, particles, materials, progress }) {\r\n    if (particles.length === 0) return null;\r\n\r\n    // Get the appropriate material for this particle type\r\n    let material;\r\n    let emissiveIntensity = 0;\r\n\r\n    switch (type) {\r\n        case PARTICLE_TYPES.DEBRIS:\r\n            material = materials.debris;\r\n            emissiveIntensity = 1 * (1 - progress);\r\n            break;\r\n        case PARTICLE_TYPES.SMOKE:\r\n            material = materials.smoke;\r\n            break;\r\n        case PARTICLE_TYPES.DUST:\r\n            material = materials.dust;\r\n            break;\r\n        case PARTICLE_TYPES.SHOCKWAVE:\r\n            material = materials.dust;\r\n            emissiveIntensity = 0.5 * (1 - progress);\r\n            break;\r\n        default:\r\n            material = materials.debris;\r\n    }\r\n\r\n    // Set material properties\r\n    material.emissiveIntensity = emissiveIntensity;\r\n\r\n    return (\r\n        <>\r\n            {particles.map((particle, index) => (\r\n                <mesh\r\n                    key={`${type}-${index}`}\r\n                    position={particle.position.toArray()}\r\n                    rotation={particle.rotation.toArray()}\r\n                    scale={[particle.size, particle.size, particle.size]}\r\n                >\r\n                    <primitive attach=\"geometry\" object={getGeometryForParticle(type)} />\r\n                    <meshStandardMaterial\r\n                        color={material.color}\r\n                        transparent\r\n                        opacity={particle.opacity}\r\n                        emissive={material.color}\r\n                        emissiveIntensity={emissiveIntensity}\r\n                    />\r\n                </mesh>\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// Get the appropriate geometry based on particle type - optimized to use type directly\r\nfunction getGeometryForParticle(type) {\r\n    if (type === PARTICLE_TYPES.DEBRIS) {\r\n        return sharedGeometries.debris;\r\n    }\r\n    return sharedGeometries.smallSphere;\r\n}\r\n\r\n// Optimized particle generation with better initial value distribution\r\nfunction generateParticles(totalDebris, totalSmoke, debrisSize, radius, duration, secondaryEffects, smokeDuration) {\r\n    const particles = [];\r\n\r\n    // Pre-calculate common values\r\n    const twoPI = Math.PI * 2;\r\n\r\n    // Generate debris particles\r\n    for (let i = 0; i < totalDebris; i++) {\r\n        const angle = Math.random() * twoPI;\r\n        const speed = 0.01 + Math.random() * 0.03;\r\n        const size = (0.05 + Math.random() * 0.15) * debrisSize;\r\n        const life = Math.floor(duration * (0.7 + Math.random() * 0.3));\r\n\r\n        // Create velocity vector from pool\r\n        const velocity = vectorPool.get().set(\r\n            Math.cos(angle) * speed * (0.5 + Math.random()),\r\n            0.01 + Math.random() * 0.03,\r\n            Math.sin(angle) * speed * (0.5 + Math.random())\r\n        );\r\n\r\n        particles.push({\r\n            active: false,\r\n            spawnDelay: Math.floor(Math.random() * 3),\r\n            position: vectorPool.get(),\r\n            velocity,\r\n            rotation: vectorPool.get().set(0, 0, 0),\r\n            rotationSpeed: vectorPool.get().set(\r\n                (Math.random() - 0.5) * 0.1,\r\n                (Math.random() - 0.5) * 0.1,\r\n                (Math.random() - 0.5) * 0.1\r\n            ),\r\n            size,\r\n            originalSize: size,\r\n            type: PARTICLE_TYPES.DEBRIS,\r\n            opacity: 0,\r\n            targetOpacity: 0.7 + Math.random() * 0.3,\r\n            life,\r\n            initialLife: life\r\n        });\r\n    }\r\n\r\n    // Generate smoke particles\r\n    for (let i = 0; i < totalSmoke; i++) {\r\n        const angle = Math.random() * twoPI;\r\n        const distance = Math.random() * radius * 0.8;\r\n        const speed = 0.003 + Math.random() * 0.007;\r\n        const size = 0.2 + Math.random() * 0.4;\r\n        const life = Math.floor(duration * (0.8 + Math.random() * 0.4) * smokeDuration);\r\n\r\n        particles.push({\r\n            active: false,\r\n            spawnDelay: 3 + Math.floor(Math.random() * 5),\r\n            position: vectorPool.get().set(\r\n                Math.cos(angle) * distance * 0.2,\r\n                0.2 + Math.random() * 0.3,\r\n                Math.sin(angle) * distance * 0.2\r\n            ),\r\n            velocity: vectorPool.get().set(\r\n                Math.cos(angle) * speed * 0.5,\r\n                0.005 + Math.random() * 0.01,\r\n                Math.sin(angle) * speed * 0.5\r\n            ),\r\n            rotation: vectorPool.get().set(0, 0, 0),\r\n            rotationSpeed: vectorPool.get().set(\r\n                (Math.random() - 0.5) * 0.02,\r\n                (Math.random() - 0.5) * 0.02,\r\n                (Math.random() - 0.5) * 0.02\r\n            ),\r\n            size,\r\n            originalSize: size,\r\n            type: PARTICLE_TYPES.SMOKE,\r\n            opacity: 0,\r\n            targetOpacity: 0.4 + Math.random() * 0.2,\r\n            life,\r\n            initialLife: life\r\n        });\r\n    }\r\n\r\n    // Add shockwave if specified\r\n    if (secondaryEffects.shockwave) {\r\n        const shockwaveCount = Math.min(ANIM_CONSTANTS.MAX_SHOCKWAVE, Math.max(8, radius * 3));\r\n\r\n        for (let i = 0; i < shockwaveCount; i++) {\r\n            const angle = (i / shockwaveCount) * twoPI;\r\n            const life = Math.floor(duration * 0.4);\r\n\r\n            particles.push({\r\n                active: false,\r\n                spawnDelay: 0,\r\n                position: vectorPool.get().set(0, 0.05, 0),\r\n                velocity: vectorPool.get().set(0, 0, 0),\r\n                rotation: vectorPool.get().set(Math.PI / 2, 0, angle),\r\n                rotationSpeed: vectorPool.get().set(0, 0, 0),\r\n                angle,\r\n                size: 0.2,\r\n                originalSize: 0.2,\r\n                type: PARTICLE_TYPES.SHOCKWAVE,\r\n                opacity: 0,\r\n                targetOpacity: 0.6,\r\n                life,\r\n                initialLife: life\r\n            });\r\n        }\r\n    }\r\n\r\n    // Add dust cloud if specified\r\n    if (secondaryEffects.dustCloud) {\r\n        const dustCount = Math.min(ANIM_CONSTANTS.MAX_DUST, Math.floor(radius * 4));\r\n\r\n        for (let i = 0; i < dustCount; i++) {\r\n            const angle = Math.random() * twoPI;\r\n            const distance = radius * 0.3 + Math.random() * radius * 0.5;\r\n            const speed = 0.002 + Math.random() * 0.005;\r\n            const size = 0.3 + Math.random() * 0.5;\r\n            const life = Math.floor(duration * 0.6 + Math.random() * duration * 0.4);\r\n\r\n            particles.push({\r\n                active: false,\r\n                spawnDelay: 5 + Math.floor(Math.random() * 7),\r\n                position: vectorPool.get().set(0, 0, 0),\r\n                velocity: vectorPool.get().set(\r\n                    Math.cos(angle) * speed * distance,\r\n                    0.001 + Math.random() * 0.004,\r\n                    Math.sin(angle) * speed * distance\r\n                ),\r\n                rotation: vectorPool.get().set(0, 0, 0),\r\n                rotationSpeed: vectorPool.get().set(0, (Math.random() - 0.5) * 0.02, 0),\r\n                size,\r\n                originalSize: size,\r\n                type: PARTICLE_TYPES.DUST,\r\n                opacity: 0,\r\n                targetOpacity: 0.3 + Math.random() * 0.2,\r\n                life,\r\n                initialLife: life\r\n            });\r\n        }\r\n    }\r\n\r\n    return particles;\r\n}\r\n\r\n// Optimized batch particle update with reduced calculations\r\nfunction updateParticlesBatch(particles, progress) {\r\n    const chunkSize = ANIM_CONSTANTS.BATCH_SIZE;\r\n    const particleCount = particles.length;\r\n\r\n    for (let i = 0; i < particleCount; i += chunkSize) {\r\n        const end = Math.min(i + chunkSize, particleCount);\r\n\r\n        for (let j = i; j < end; j++) {\r\n            const particle = particles[j];\r\n\r\n            // Skip inactive or dead particles\r\n            if (!particle.active) {\r\n                particle.spawnDelay--;\r\n                if (particle.spawnDelay <= 0) {\r\n                    particle.active = true;\r\n                }\r\n                continue;\r\n            }\r\n\r\n            if (particle.life <= 0) continue;\r\n\r\n            // Calculate this once per update\r\n            const particleProgress = 1 - (particle.life / particle.initialLife);\r\n\r\n            // Fade in particles - only update if needed\r\n            if (particle.opacity < particle.targetOpacity) {\r\n                particle.opacity = Math.min(\r\n                    particle.targetOpacity,\r\n                    particle.opacity + (particle.targetOpacity / 10)\r\n                );\r\n            }\r\n\r\n            // Use switch instead of if/else for better performance on type-specific updates\r\n            switch (particle.type) {\r\n                case PARTICLE_TYPES.SHOCKWAVE:\r\n                    updateShockwaveParticle(particle, particleProgress);\r\n                    break;\r\n                case PARTICLE_TYPES.DUST:\r\n                    updateDustParticle(particle, particleProgress);\r\n                    break;\r\n                case PARTICLE_TYPES.SMOKE:\r\n                    updateSmokeParticle(particle, particleProgress);\r\n                    break;\r\n                case PARTICLE_TYPES.DEBRIS:\r\n                default:\r\n                    updateDebrisParticle(particle, particleProgress);\r\n                    break;\r\n            }\r\n\r\n            // Decrement life\r\n            particle.life--;\r\n        }\r\n    }\r\n}\r\n\r\n// Particle update functions with optimized calculations\r\nfunction updateShockwaveParticle(particle, progress) {\r\n    // Faster calculation with less branching\r\n    const currentRadius = progress * 3;\r\n\r\n    particle.position.x = Math.cos(particle.angle) * currentRadius;\r\n    particle.position.z = Math.sin(particle.angle) * currentRadius;\r\n\r\n    // Combine conditions to reduce branches\r\n    if (progress > 0.7) {\r\n        particle.opacity = Math.max(0, particle.targetOpacity * (1 - ((progress - 0.7) / 0.3)));\r\n    }\r\n\r\n    particle.size = 0.1 + progress * 0.4;\r\n}\r\n\r\nfunction updateDustParticle(particle, progress) {\r\n    particle.position.add(particle.velocity);\r\n    particle.size = particle.originalSize * (1 + progress * 0.8);\r\n    particle.rotation.y += particle.rotationSpeed.y;\r\n\r\n    // Simplified opacity calculation\r\n    if (progress > 0.6) {\r\n        particle.opacity = particle.targetOpacity * Math.max(0, 1 - ((progress - 0.6) / 0.4));\r\n    }\r\n}\r\n\r\nfunction updateSmokeParticle(particle, progress) {\r\n    particle.position.add(particle.velocity);\r\n\r\n    // Combined calculation - apply gravity and buoyancy in one step\r\n    const buoyancyFactor = progress < 0.3 ? 0.0004 * (1 - progress / 0.3) : 0;\r\n    particle.velocity.y += buoyancyFactor - 0.0002;\r\n\r\n    // Calculate size directly\r\n    particle.size = particle.originalSize * (1 + progress * 2.0);\r\n\r\n    // Fade out in later stages\r\n    if (progress > 0.6) {\r\n        particle.opacity = particle.targetOpacity * Math.max(0, 1 - ((progress - 0.6) / 0.4));\r\n    }\r\n\r\n    // Apply rotation - consolidated\r\n    particle.rotation.x += particle.rotationSpeed.x;\r\n    particle.rotation.y += particle.rotationSpeed.y;\r\n    particle.rotation.z += particle.rotationSpeed.z;\r\n}\r\n\r\nfunction updateDebrisParticle(particle, progress) {\r\n    // Update position\r\n    particle.position.add(particle.velocity);\r\n\r\n    // Apply gravity\r\n    particle.velocity.y -= 0.002;\r\n\r\n    // Ground collision with simplified logic\r\n    if (particle.position.y < 0.05 && particle.velocity.y < 0) {\r\n        // Combined update for bounce and friction\r\n        particle.velocity.y *= -0.3;\r\n        particle.velocity.x *= 0.8;\r\n        particle.velocity.z *= 0.8;\r\n    }\r\n\r\n    // Fade out\r\n    if (progress > 0.7) {\r\n        particle.opacity = particle.targetOpacity * Math.max(0, 1 - ((progress - 0.7) / 0.3));\r\n    }\r\n\r\n    // Apply rotation - simplified for better performance\r\n    const { rotationSpeed, rotation } = particle;\r\n    rotation.x += rotationSpeed.x;\r\n    rotation.y += rotationSpeed.y;\r\n    rotation.z += rotationSpeed.z;\r\n}\r\n\r\n// Reset all particles efficiently with vector pooling\r\nfunction resetParticles(particles) {\r\n    for (let particle of particles) {\r\n        particle.opacity = 0;\r\n        particle.active = particle.spawnDelay === 0;\r\n        particle.life = particle.initialLife;\r\n\r\n        // Reset position\r\n        particle.position.set(0, 0, 0);\r\n\r\n        // Type-specific resets\r\n        if (particle.type === PARTICLE_TYPES.SHOCKWAVE) {\r\n            particle.position.set(0, 0.05, 0);\r\n        }\r\n        else if (particle.type === PARTICLE_TYPES.SMOKE) {\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const distance = Math.random() * 0.2;\r\n            particle.position.set(\r\n                Math.cos(angle) * distance,\r\n                0.2 + Math.random() * 0.3,\r\n                Math.sin(angle) * distance\r\n            );\r\n        }\r\n    }\r\n} ","import React, { useState, useEffect, useRef } from 'react';\r\nimport { useThree } from '@react-three/fiber';\r\nimport * as THREE from 'three';\r\nimport Explosion from './Explosion';\r\nimport { createExplosionEffect, WEAPON_TYPES, applyExplosionDamage, DAMAGE_PROFILES } from '../../utils/WeaponPhysics';\r\n\r\nexport default function ExplosionsManager() {\r\n    const [explosions, setExplosions] = useState([]);\r\n    const { scene } = useThree();\r\n    const objectsCacheRef = useRef(new Map()); // Cache for scene objects to avoid re-traversing scene\r\n    const explosionTimestampsRef = useRef(new Map()); // Store creation timestamps for safety cleanup\r\n\r\n    // Refs for shotgun optimizations - moved outside useEffect\r\n    const lastShotgunProcessTimeRef = useRef(0);\r\n    const objectsCacheForShotgunRef = useRef(new Map());\r\n    const SHOTGUN_THROTTLE_MS = 50; // Only process shotgun effects every 50ms\r\n\r\n    // Update object cache when scene changes\r\n    useEffect(() => {\r\n        // Function to update the object cache\r\n        const updateObjectCache = () => {\r\n            const newCache = new Map();\r\n            const processObject = (object) => {\r\n                // More thorough check for vehicles and their parts\r\n                if (object.userData && (object.userData.vehicleId ||\r\n                    object.userData.isVehiclePart ||\r\n                    object.userData.parentVehicleId ||\r\n                    object.userData.vehicleType)) {\r\n                    newCache.set(object.id, object);\r\n                } else if (object.isMesh) {\r\n                    // Still keep meshes for other types of collision\r\n                    newCache.set(object.id, object);\r\n                }\r\n\r\n                // Process children\r\n                if (object.children && object.children.length > 0) {\r\n                    object.children.forEach(processObject);\r\n                }\r\n            };\r\n            scene.children.forEach(processObject);\r\n            objectsCacheRef.current = newCache;\r\n        };\r\n\r\n        updateObjectCache();\r\n\r\n        // Use an interval instead of MutationObserver since THREE.js scenes don't trigger DOM mutations\r\n        const intervalId = setInterval(updateObjectCache, 2000);\r\n\r\n        return () => {\r\n            clearInterval(intervalId);\r\n        };\r\n    }, [scene]);\r\n\r\n    // Set up a custom event listener for creating explosions\r\n    useEffect(() => {\r\n        // Using refs that were moved to component scope\r\n        const handleExplosion = (event) => {\r\n            const { position, weaponType } = event.detail;\r\n\r\n            // Skip adding explosion animation for shotgun\r\n            if (weaponType === WEAPON_TYPES.SHOTGUN) {\r\n                // Apply throttling for shotgun events\r\n                const now = Date.now();\r\n                if (now - lastShotgunProcessTimeRef.current < SHOTGUN_THROTTLE_MS) {\r\n                    // Skip this shotgun event due to throttling\r\n                    return;\r\n                }\r\n                lastShotgunProcessTimeRef.current = now;\r\n\r\n                // Check if FPS is extremely low - if so, simplify further\r\n                const currentFps = window.currentFps || 60;\r\n                if (currentFps < 20) {\r\n                    // At extremely low FPS, we'll only process every other shotgun event\r\n                    if (Math.random() > 0.5) return;\r\n                }\r\n\r\n                // Only apply damage for shotgun without visual explosion effect\r\n                const damageRadius = DAMAGE_PROFILES[weaponType].outerRadius * 1.5; // Reduced from 2.0 for performance\r\n\r\n                // Use cached objects for performance if available\r\n                const cacheKey = `${Math.floor(position.x)},${Math.floor(position.y)},${Math.floor(position.z)}`;\r\n                let objectsInRange = [];\r\n\r\n                // Check if we have a recent cached result for a similar position\r\n                if (objectsCacheForShotgunRef.current.has(cacheKey) &&\r\n                    now - objectsCacheForShotgunRef.current.get(cacheKey).timestamp < 200) {\r\n                    objectsInRange = objectsCacheForShotgunRef.current.get(cacheKey).objects;\r\n                } else {\r\n                    // If no cache hit, find objects normally\r\n                    objectsInRange = findObjectsInRadius(position, damageRadius);\r\n\r\n                    // Cache the result\r\n                    objectsCacheForShotgunRef.current.set(cacheKey, {\r\n                        objects: objectsInRange,\r\n                        timestamp: now\r\n                    });\r\n\r\n                    // Limit cache size to prevent memory issues\r\n                    if (objectsCacheForShotgunRef.current.size > 20) {\r\n                        const oldestKey = Array.from(objectsCacheForShotgunRef.current.keys())[0];\r\n                        objectsCacheForShotgunRef.current.delete(oldestKey);\r\n                    }\r\n                }\r\n\r\n                if (objectsInRange.length > 0) {\r\n                    // Use requestIdleCallback if available for non-critical processing\r\n                    if (window.requestIdleCallback) {\r\n                        window.requestIdleCallback(() => {\r\n                            applyExplosionDamage(weaponType, position, objectsInRange);\r\n                        });\r\n                    } else {\r\n                        requestAnimationFrame(() => {\r\n                            applyExplosionDamage(weaponType, position, objectsInRange);\r\n                        });\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Create explosion effect data\r\n            const explosionEffect = createExplosionEffect(weaponType, position);\r\n\r\n            // Find all objects in range of the explosion\r\n            const damageRadius = explosionEffect.radius * 6; // Increased radius multiplier for better damage detection\r\n            const objectsInRange = findObjectsInRadius(position, damageRadius);\r\n\r\n            // Apply damage to objects\r\n            if (objectsInRange.length > 0) {\r\n                requestAnimationFrame(() => {\r\n                    applyExplosionDamage(weaponType, position, objectsInRange);\r\n                });\r\n            }\r\n\r\n            // Generate unique ID for explosion\r\n            const explosionId = `explosion-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 5)}`;\r\n\r\n            // Add timestamp to track this explosion\r\n            explosionTimestampsRef.current.set(explosionId, Date.now());\r\n\r\n            // Add to explosions state with a unique ID\r\n            setExplosions(prev => [...prev, {\r\n                ...explosionEffect,\r\n                id: explosionId\r\n            }]);\r\n        };\r\n\r\n        // Add event listener\r\n        window.addEventListener('weapon-impact', handleExplosion);\r\n\r\n        // Clean up\r\n        return () => {\r\n            window.removeEventListener('weapon-impact', handleExplosion);\r\n        };\r\n    }, [scene]);\r\n\r\n    // Add a safety cleanup mechanism for explosions that might be stuck\r\n    useEffect(() => {\r\n        const cleanupInterval = setInterval(() => {\r\n            const MAX_EXPLOSION_LIFETIME = 5000; // 5 seconds, adjust based on your max expected animation duration\r\n            const now = Date.now();\r\n            let stuckExplosionsFound = false;\r\n\r\n            // Check for explosions that have been around too long\r\n            explosionTimestampsRef.current.forEach((timestamp, id) => {\r\n                if (now - timestamp > MAX_EXPLOSION_LIFETIME) {\r\n                    // Remove from timestamps\r\n                    explosionTimestampsRef.current.delete(id);\r\n                    stuckExplosionsFound = true;\r\n                }\r\n            });\r\n\r\n            // If any stuck explosions found, update the state to remove them\r\n            if (stuckExplosionsFound) {\r\n                setExplosions(prev => {\r\n                    const validIds = Array.from(explosionTimestampsRef.current.keys());\r\n                    return prev.filter(explosion => validIds.includes(explosion.id));\r\n                });\r\n            }\r\n        }, 1000); // Check every second\r\n\r\n        return () => clearInterval(cleanupInterval);\r\n    }, []);\r\n\r\n    // Find all objects in radius around a position (optimized version)\r\n    const findObjectsInRadius = (position, radius) => {\r\n        const objectsInRange = [];\r\n        const searchPosition = position.clone();\r\n        const radiusSquared = radius * radius; // Squared distance for faster comparisons\r\n\r\n        // Recursive function to check all scene objects and their children\r\n        const checkObject = (object) => {\r\n            if (!object.position) return;\r\n\r\n            // Get world position of the object\r\n            const worldPosition = new THREE.Vector3();\r\n            object.getWorldPosition(worldPosition);\r\n\r\n            // Compare squared distances (faster than using distanceTo)\r\n            const dx = worldPosition.x - searchPosition.x;\r\n            const dy = worldPosition.y - searchPosition.y;\r\n            const dz = worldPosition.z - searchPosition.z;\r\n            const distanceSquared = dx * dx + dy * dy + dz * dz;\r\n\r\n            // If within radius, add to our list\r\n            if (distanceSquared <= radiusSquared) {\r\n                objectsInRange.push(object);\r\n            }\r\n\r\n            // Check children recursively\r\n            if (object.children && object.children.length > 0) {\r\n                for (const child of object.children) {\r\n                    checkObject(child);\r\n                }\r\n            }\r\n        };\r\n\r\n        // Check all top-level scene objects\r\n        scene.children.forEach(checkObject);\r\n\r\n        return objectsInRange;\r\n    };\r\n\r\n    // Handle explosion completion (removal)\r\n    const removeExplosion = (id) => {\r\n        // Remove from timestamps tracking\r\n        explosionTimestampsRef.current.delete(id);\r\n\r\n        // Remove from state\r\n        setExplosions(prev => prev.filter(explosion => explosion.id !== id));\r\n    };\r\n\r\n    // Render all active explosions\r\n    return (\r\n        <>\r\n            {explosions.map(explosion => (\r\n                <Explosion\r\n                    key={explosion.id}\r\n                    position={explosion.position}\r\n                    radius={explosion.radius}\r\n                    type={explosion.type}\r\n                    duration={explosion.duration}\r\n                    secondaryEffects={explosion.secondaryEffects}\r\n                    onComplete={() => removeExplosion(explosion.id)}\r\n                />\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// Helper function to trigger an explosion event\r\nexport function triggerExplosion(position, weaponType) {\r\n    // Create and dispatch custom event\r\n    const event = new CustomEvent('weapon-impact', {\r\n        detail: {\r\n            position,\r\n            weaponType\r\n        }\r\n    });\r\n\r\n    window.dispatchEvent(event);\r\n} ","import React, { useRef, useState } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\n\r\n// Global setting to control whether damage indicators are displayed\r\nexport const damageIndicatorSettings = {\r\n    showDamageNumbers: false // Set to false to disable damage numbers by default\r\n};\r\n\r\nexport default function DamageIndicator({ position, damage = 0, duration = 60 }) {\r\n    const groupRef = useRef();\r\n    const [lifespan, setLifespan] = useState(duration);\r\n    const [offset, setOffset] = useState(0);\r\n\r\n    // Ensure damage is a number\r\n    const damageValue = typeof damage === 'number' ? damage : 0;\r\n\r\n    // Animation effect - float upward and fade out\r\n    useFrame(() => {\r\n        if (!groupRef.current) return;\r\n\r\n        // Move upward\r\n        setOffset(prev => prev + 0.02);\r\n\r\n        // Update position and opacity\r\n        if (groupRef.current) {\r\n            // Reduce lifespan\r\n            setLifespan(prev => prev - 1);\r\n\r\n            // Fade out towards the end\r\n            if (lifespan < duration * 0.3) {\r\n                groupRef.current.children.forEach(child => {\r\n                    if (child.material) {\r\n                        child.material.opacity = lifespan / (duration * 0.3);\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Remove when lifespan is over\r\n            if (lifespan <= 0) {\r\n                // The component will be removed by the parent\r\n            }\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group\r\n            ref={groupRef}\r\n            position={[position.x, position.y + 1 + offset, position.z]}\r\n            lookAt={[position.x, position.y + 10, position.z - 5]} // Always face camera\r\n        >\r\n            <Text\r\n                color={damageValue >= 15 ? \"red\" : damageValue >= 10 ? \"orange\" : \"yellow\"}\r\n                fontSize={0.5}\r\n                anchorX=\"center\"\r\n                anchorY=\"middle\"\r\n                outlineWidth={0.05}\r\n                outlineColor=\"#000000\"\r\n                material-transparent={true}\r\n            >\r\n                {damageValue.toFixed(0)}\r\n            </Text>\r\n        </group>\r\n    );\r\n}\r\n\r\n// Damage indicators manager component\r\nexport function DamageIndicatorsManager() {\r\n    const [indicators, setIndicators] = useState([]);\r\n\r\n    // Set up event listener for damage events\r\n    React.useEffect(() => {\r\n        const handleDamage = (event) => {\r\n            // If damage numbers are disabled, don't add new indicators\r\n            if (!damageIndicatorSettings.showDamageNumbers) return;\r\n\r\n            const { position, damage } = event.detail;\r\n\r\n            // Add new damage indicator\r\n            setIndicators(prev => [\r\n                ...prev,\r\n                {\r\n                    id: `damage-${Date.now()}-${Math.random()}`,\r\n                    position: position.clone(),\r\n                    damage,\r\n                    createdAt: Date.now()\r\n                }\r\n            ]);\r\n\r\n            // Clean up old indicators after their duration\r\n            setTimeout(() => {\r\n                setIndicators(prev =>\r\n                    prev.filter(indicator =>\r\n                        indicator.createdAt > Date.now() - 2000 // 2 seconds\r\n                    )\r\n                );\r\n            }, 2000);\r\n        };\r\n\r\n        window.addEventListener('damage-dealt', handleDamage);\r\n\r\n        return () => {\r\n            window.removeEventListener('damage-dealt', handleDamage);\r\n        };\r\n    }, []);\r\n\r\n    // If damage indicators are disabled, don't render anything\r\n    if (!damageIndicatorSettings.showDamageNumbers) return null;\r\n\r\n    return (\r\n        <>\r\n            {indicators.map(indicator => (\r\n                <DamageIndicator\r\n                    key={indicator.id}\r\n                    position={indicator.position}\r\n                    damage={indicator.damage}\r\n                />\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// Helper function to trigger a damage indicator\r\nexport function showDamageIndicator(position, damage) {\r\n    // If damage numbers are disabled, don't show anything\r\n    if (!damageIndicatorSettings.showDamageNumbers) return;\r\n\r\n    // Ensure damage is a number with a default value of 0\r\n    const damageValue = typeof damage === 'number' ? damage : 0;\r\n\r\n    const event = new CustomEvent('damage-dealt', {\r\n        detail: {\r\n            position: position.clone(),\r\n            damage: damageValue\r\n        }\r\n    });\r\n\r\n    window.dispatchEvent(event);\r\n} ","import React, { useRef, useEffect, useState, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport * as THREE from 'three';\r\n\r\n/**\r\n * A dedicated component for shotgun muzzle flash effects\r\n * This replaces the explosion effect for shotguns with a more appropriate\r\n * muzzle flash visualization - optimized for performance\r\n */\r\nexport default function ShotgunMuzzleFlash({ position, direction, onComplete, isImpact }) {\r\n    const [life, setLife] = useState(isImpact ? 5 : 8); // Shorter lifetime, even shorter for impacts\r\n    const flashRef = useRef();\r\n    const particlesRef = useRef([]);\r\n\r\n    // Initialize particles on mount\r\n    useEffect(() => {\r\n        // Create particles for the shotgun muzzle flash\r\n        const particles = [];\r\n\r\n        // Get current FPS for adaptive particle count\r\n        const currentFps = window.currentFps || 60;\r\n        // Much more aggressive FPS-based particle reduction\r\n        const particleCountMultiplier = currentFps < 30 ? 0.2 :\r\n            (currentFps < 40 ? 0.4 :\r\n                (currentFps < 50 ? 0.6 : 0.8));\r\n\r\n        // For impact effects, use fewer particles\r\n        const impactMultiplier = isImpact ? 0.5 : 1.0;\r\n\r\n        // Create cone flash - reduce particle count based on FPS\r\n        const particleCount = Math.max(1, Math.floor(6 * particleCountMultiplier * impactMultiplier)); // Significantly reduced base particles\r\n        for (let i = 0; i < particleCount; i++) {\r\n            const angle = Math.random() * Math.PI * 2;\r\n            const radius = Math.random() * 0.3;\r\n\r\n            particles.push({\r\n                position: new THREE.Vector3(\r\n                    Math.cos(angle) * radius,\r\n                    Math.sin(angle) * radius,\r\n                    -0.5 - Math.random() * 0.5\r\n                ),\r\n                size: 0.05 + Math.random() * 0.1,\r\n                opacity: 0.7 + Math.random() * 0.3,\r\n                color: new THREE.Color(\r\n                    0.9 + Math.random() * 0.1,\r\n                    0.7 + Math.random() * 0.2,\r\n                    0.2 + Math.random() * 0.2\r\n                )\r\n            });\r\n        }\r\n\r\n        // Only add pellet particles if FPS is high enough and not an impact effect\r\n        if (currentFps > 40 && !isImpact) {\r\n            // Add some small pellet particles - significantly reduce count\r\n            const pelletCount = Math.max(1, Math.floor(3 * particleCountMultiplier)); // Drastically reduced from 6 to 3 base particles\r\n            for (let i = 0; i < pelletCount; i++) {\r\n                const spread = Math.random() * 0.2;\r\n                const distance = 0.5 + Math.random() * 1.0;\r\n                const angle = Math.random() * Math.PI * 2;\r\n\r\n                particles.push({\r\n                    position: new THREE.Vector3(\r\n                        Math.cos(angle) * spread,\r\n                        Math.sin(angle) * spread,\r\n                        -distance\r\n                    ),\r\n                    size: 0.03 + Math.random() * 0.05,\r\n                    opacity: 0.5 + Math.random() * 0.3,\r\n                    color: new THREE.Color(0.8, 0.8, 0.8) // Pellet color\r\n                });\r\n            }\r\n        }\r\n\r\n        particlesRef.current = particles;\r\n\r\n        // Auto-cleanup - shorter duration for better performance\r\n        const duration = isImpact ? 100 : 150; // Very short duration, even shorter for impacts\r\n        const timer = setTimeout(() => {\r\n            if (onComplete) onComplete();\r\n        }, duration);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [onComplete, isImpact]);\r\n\r\n    // Animation frame handling\r\n    useFrame(() => {\r\n        if (life <= 0) return;\r\n        setLife(prev => prev - 1);\r\n    });\r\n\r\n    // Calculate the rotation to align with direction\r\n    const rotation = useMemo(() => {\r\n        if (!direction) return [0, 0, 0];\r\n\r\n        // Default direction is -Z\r\n        const defaultDir = new THREE.Vector3(0, 0, -1);\r\n        const targetDir = new THREE.Vector3().copy(direction).normalize();\r\n\r\n        // Create quaternion for rotation from default to target direction\r\n        const quaternion = new THREE.Quaternion().setFromUnitVectors(defaultDir, targetDir);\r\n        const euler = new THREE.Euler().setFromQuaternion(quaternion);\r\n\r\n        return [euler.x, euler.y, euler.z];\r\n    }, [direction]);\r\n\r\n    // Early completion if life is over\r\n    if (life <= 0) return null;\r\n\r\n    // Scale opacity with life\r\n    const opacity = life / (isImpact ? 5 : 8);\r\n\r\n    // For very low FPS, use a simplified representation\r\n    const currentFps = window.currentFps || 60;\r\n    const useSimplifiedVersion = currentFps < 30;\r\n\r\n    if (useSimplifiedVersion) {\r\n        // Extremely simplified version for low FPS\r\n        return (\r\n            <group\r\n                ref={flashRef}\r\n                position={[position.x, position.y, position.z]}\r\n                rotation={rotation}\r\n            >\r\n                {/* Single center flash */}\r\n                <mesh>\r\n                    <sphereGeometry args={[0.2, 6, 6]} />\r\n                    <meshBasicMaterial\r\n                        color={0xffdd88}\r\n                        transparent={true}\r\n                        opacity={opacity * 0.8}\r\n                    />\r\n                </mesh>\r\n\r\n                {/* Light source with reduced intensity */}\r\n                <pointLight\r\n                    color={0xffdd88}\r\n                    intensity={4 * opacity}\r\n                    distance={2}\r\n                    decay={2}\r\n                />\r\n            </group>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <group\r\n            ref={flashRef}\r\n            position={[position.x, position.y, position.z]}\r\n            rotation={rotation}\r\n        >\r\n            {/* Center flash */}\r\n            <mesh>\r\n                <sphereGeometry args={[0.2, 6, 6]} /> {/* Reduced geometry detail */}\r\n                <meshBasicMaterial\r\n                    color={0xffdd88}\r\n                    transparent={true}\r\n                    opacity={opacity * 0.8}\r\n                />\r\n            </mesh>\r\n\r\n            {/* Cone flash - only if not impact */}\r\n            {!isImpact && (\r\n                <mesh position={[0, 0, -0.1]}>\r\n                    <coneGeometry args={[0.3, 0.6, 6]} /> {/* Reduced geometry detail */}\r\n                    <meshBasicMaterial\r\n                        color={0xffffaa}\r\n                        transparent={true}\r\n                        opacity={opacity * 0.6}\r\n                    />\r\n                </mesh>\r\n            )}\r\n\r\n            {/* Particles - limit the number rendered based on FPS */}\r\n            {particlesRef.current.map((particle, i) => (\r\n                <mesh key={i} position={particle.position.toArray()}>\r\n                    <sphereGeometry args={[particle.size, 4, 4]} /> {/* Reduced geometry detail */}\r\n                    <meshBasicMaterial\r\n                        color={particle.color}\r\n                        transparent={true}\r\n                        opacity={particle.opacity * opacity}\r\n                    />\r\n                </mesh>\r\n            ))}\r\n\r\n            {/* Light source with conditional intensity */}\r\n            <pointLight\r\n                color={0xffdd88}\r\n                intensity={isImpact ? 3 * opacity : 5 * opacity}\r\n                distance={isImpact ? 2 : 3}\r\n                decay={2}\r\n            />\r\n        </group>\r\n    );\r\n} ","import React, { useState, useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport ShotgunMuzzleFlash from './ShotgunMuzzleFlash';\r\nimport { WEAPON_TYPES } from '../../utils/WeaponPhysics';\r\n\r\n/**\r\n * Manager component for shotgun-specific effects\r\n * This is used instead of explosions for shotgun weapons\r\n */\r\nexport default function ShotgunEffectsManager() {\r\n    // Track active muzzle flashes\r\n    const [muzzleFlashes, setMuzzleFlashes] = useState([]);\r\n\r\n    // Performance optimization refs\r\n    const pendingFlashesRef = useRef([]);\r\n    const processingBatchRef = useRef(false);\r\n    const lastProcessTimeRef = useRef(0);\r\n\r\n    // Batch process flashes for better performance\r\n    const processPendingFlashes = () => {\r\n        if (processingBatchRef.current || pendingFlashesRef.current.length === 0) return;\r\n\r\n        processingBatchRef.current = true;\r\n\r\n        // Limit the number of flashes processed in a single batch based on FPS\r\n        const currentFps = window.currentFps || 60;\r\n        const batchLimit = currentFps < 30 ? 1 : (currentFps < 45 ? 2 : 3);\r\n\r\n        // Get a batch of pending flashes\r\n        const flashesToProcess = pendingFlashesRef.current.slice(0, batchLimit);\r\n        pendingFlashesRef.current = pendingFlashesRef.current.slice(batchLimit);\r\n\r\n        // Add them to the state\r\n        setMuzzleFlashes(prev => [...prev, ...flashesToProcess]);\r\n\r\n        // Schedule the next batch if there are more pending\r\n        if (pendingFlashesRef.current.length > 0) {\r\n            setTimeout(() => {\r\n                processingBatchRef.current = false;\r\n                processPendingFlashes();\r\n            }, 0);\r\n        } else {\r\n            processingBatchRef.current = false;\r\n        }\r\n    };\r\n\r\n    // Add a flash to the pending queue\r\n    const queueMuzzleFlash = (flash) => {\r\n        pendingFlashesRef.current.push(flash);\r\n\r\n        // Start processing the queue if not already processing\r\n        if (!processingBatchRef.current) {\r\n            processPendingFlashes();\r\n        }\r\n    };\r\n\r\n    // Set up a custom event listener for shotgun firing\r\n    useEffect(() => {\r\n        // Handler for shotgun-specific effects with throttling\r\n        const handleShotgunFire = (event) => {\r\n            const { position, direction, weaponType } = event.detail;\r\n\r\n            // Only process shotgun events\r\n            if (weaponType !== WEAPON_TYPES.SHOTGUN) return;\r\n\r\n            // Apply throttling for shotgun events in low FPS situations\r\n            const now = Date.now();\r\n            const throttleTime = window.lowFpsWarning ? 150 : 50; // Longer throttle time when FPS is low\r\n\r\n            if (now - lastProcessTimeRef.current < throttleTime) {\r\n                // Skip this shotgun event due to throttling\r\n                console.log(\"Throttled shotgun effect\");\r\n                return;\r\n            }\r\n            lastProcessTimeRef.current = now;\r\n\r\n            // Create a unique ID for this muzzle flash\r\n            const id = `flash-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 5)}`;\r\n\r\n            // Add to the pending queue instead of directly to state\r\n            queueMuzzleFlash({\r\n                id,\r\n                position,\r\n                direction: direction || new THREE.Vector3(0, 0, -1) // Default if not provided\r\n            });\r\n        };\r\n\r\n        // Add event listener specific to shotgun firing\r\n        window.addEventListener('shotgun-fire', handleShotgunFire);\r\n\r\n        // Listen for regular weapon impacts to handle shotgun impacts without explosions\r\n        const handleWeaponImpact = (event) => {\r\n            const { position, weaponType, direction } = event.detail;\r\n\r\n            // Only process shotgun events\r\n            if (weaponType !== WEAPON_TYPES.SHOTGUN) return;\r\n\r\n            // Apply even more aggressive throttling for impact effects\r\n            const now = Date.now();\r\n            const throttleTime = window.lowFpsWarning ? 200 : 100; // Longer throttle time when FPS is low\r\n\r\n            if (now - lastProcessTimeRef.current < throttleTime) {\r\n                // Skip this impact event due to throttling\r\n                return;\r\n            }\r\n\r\n            // At very low FPS, randomly skip some impacts entirely\r\n            if (window.currentFps < 25 && Math.random() < 0.7) {\r\n                return;\r\n            }\r\n\r\n            // For shotgun impacts, we might want to show small pellet hit effects\r\n            // But we don't create full explosions - those are now disabled in ExplosionsManager\r\n\r\n            // For demonstration, we'll create a small muzzle flash at the impact point\r\n            const id = `impact-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 5)}`;\r\n\r\n            // Add to the pending queue instead of directly to state\r\n            queueMuzzleFlash({\r\n                id,\r\n                position,\r\n                direction: direction || new THREE.Vector3(0, 0, -1),\r\n                isImpact: true // Flag this as an impact flash (could be styled differently)\r\n            });\r\n        };\r\n\r\n        // Also listen for regular weapon impacts to handle shotgun specially\r\n        window.addEventListener('weapon-impact', handleWeaponImpact);\r\n\r\n        // Set up listener for persistent low FPS events to adjust effect quality\r\n        const handlePersistentLowFps = () => {\r\n            console.log(\"Persistent low FPS detected - reducing shotgun effect quality\");\r\n            // Immediately clear any pending effects\r\n            pendingFlashesRef.current = [];\r\n\r\n            // Reduce current effects if there are too many\r\n            setMuzzleFlashes(prev => {\r\n                if (prev.length > 3) {\r\n                    return prev.slice(0, 3);\r\n                }\r\n                return prev;\r\n            });\r\n        };\r\n\r\n        window.addEventListener('persistentLowFps', handlePersistentLowFps);\r\n\r\n        // Clean up\r\n        return () => {\r\n            window.removeEventListener('shotgun-fire', handleShotgunFire);\r\n            window.removeEventListener('weapon-impact', handleWeaponImpact);\r\n            window.removeEventListener('persistentLowFps', handlePersistentLowFps);\r\n        };\r\n    }, []);\r\n\r\n    // Remove a muzzle flash when it completes\r\n    const removeMuzzleFlash = (id) => {\r\n        setMuzzleFlashes(prev => prev.filter(flash => flash.id !== id));\r\n    };\r\n\r\n    // Render all active muzzle flashes\r\n    return (\r\n        <>\r\n            {muzzleFlashes.map(flash => (\r\n                <ShotgunMuzzleFlash\r\n                    key={flash.id}\r\n                    position={flash.position}\r\n                    direction={flash.direction}\r\n                    onComplete={() => removeMuzzleFlash(flash.id)}\r\n                    isImpact={flash.isImpact}\r\n                />\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// Helper function to trigger a shotgun fire effect\r\nexport function triggerShotgunFire(position, direction) {\r\n    // Create and dispatch custom event specifically for shotgun effects\r\n    const event = new CustomEvent('shotgun-fire', {\r\n        detail: {\r\n            position,\r\n            direction,\r\n            weaponType: WEAPON_TYPES.SHOTGUN\r\n        }\r\n    });\r\n\r\n    window.dispatchEvent(event);\r\n} ","import React, { useRef, useEffect, useState, useMemo, useCallback } from 'react';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport { useKeyboardControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport '../../styles/drone.css';\r\nimport { WEAPON_TYPES, checkProjectileVehicleCollision } from '../../utils/WeaponPhysics';\r\nimport { triggerExplosion } from '../effects/ExplosionsManager';\r\nimport { showDamageIndicator } from '../effects/DamageIndicator';\r\nimport { Controls } from '../KeyboardControls';\r\nimport { triggerShotgunFire } from '../effects/ShotgunEffectsManager';\r\nimport { DRONE_TYPES } from '../../utils/GameContext';\r\n\r\n// Constants for object pooling\r\nconst POOL_SIZE = {\r\n    [WEAPON_TYPES.SHOTGUN]: 16,  // Increased from 8\r\n    [WEAPON_TYPES.GRENADE]: 3,\r\n    [WEAPON_TYPES.DART]: 3\r\n};\r\n\r\nexport default function Grenadier() {\r\n    // References\r\n    const droneRef = useRef();\r\n    const cameraFollowRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const velocityRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const propellersRefs = useRef([]);\r\n\r\n    // Initial rotation reference - with explicit YXZ rotation order\r\n    const initialRotationRef = useRef(new THREE.Euler(0, 0, 0, 'YXZ'));\r\n\r\n    // State\r\n    const [position, setPosition] = useState([0, 10, 0]); // Start 10 units above ground\r\n    const [propellersActive, setPropellersActive] = useState(false);\r\n    const [propellersSpeed, setPropellersSpeed] = useState(0);\r\n\r\n    // Weapon ammo state\r\n    const [shotgunAmmo, setShotgunAmmo] = useState(12);\r\n    const [grenadeAmmo, setGrenadeAmmo] = useState(6);\r\n    const [dartAmmo, setDartAmmo] = useState(9);\r\n\r\n    // Weapon cooldown state\r\n    const [shotgunCooldown, setShotgunCooldown] = useState(false);\r\n    const [grenadeCooldown, setGrenadeCooldown] = useState(false);\r\n    const [dartCooldown, setDartCooldown] = useState(false);\r\n\r\n    // Object pool for projectiles\r\n    const projectilePool = useRef({\r\n        [WEAPON_TYPES.SHOTGUN]: [],\r\n        [WEAPON_TYPES.GRENADE]: [],\r\n        [WEAPON_TYPES.DART]: []\r\n    });\r\n\r\n    // Active projectiles\r\n    const [activeProjectiles, setActiveProjectiles] = useState([]);\r\n\r\n    // Access scene elements\r\n    const { camera, scene } = useThree();\r\n\r\n    // Setup keyboard controls\r\n    const [subscribeKeys, getKeys] = useKeyboardControls();\r\n\r\n    // Add downward view state\r\n    const [downwardViewActive, setDownwardViewActive] = useState(false);\r\n\r\n    // Add HUD state\r\n    const [showHUD, setShowHUD] = useState(true);\r\n\r\n    // Initialize object pools\r\n    useEffect(() => {\r\n        // Create initial pools for each weapon type\r\n        Object.entries(POOL_SIZE).forEach(([type, size]) => {\r\n            for (let i = 0; i < size; i++) {\r\n                projectilePool.current[type].push({\r\n                    id: `${type}-${i}`,\r\n                    position: new THREE.Vector3(),\r\n                    previousPosition: new THREE.Vector3(),\r\n                    direction: new THREE.Vector3(),\r\n                    type: type,\r\n                    speed: 0,\r\n                    life: 0,\r\n                    active: false,\r\n                    gravity: 0\r\n                });\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    // Drone physics parameters\r\n    const THRUST = 0.05;\r\n    const MAX_SPEED = 1.5;\r\n    const ROTATION_SPEED = 0.06; // Reduced for more subtle rotation\r\n    const FRICTION = 0.98;\r\n    const GRAVITY = 0.004;\r\n    const LIFT_POWER = 0.05;\r\n    const STRAFE_POWER = 0.04; // Power for strafing left/right\r\n    const DIVE_POWER = 0.005; // Power for slight downward movement with W\r\n\r\n    // Get projectile from pool\r\n    const getProjectileFromPool = (type) => {\r\n        // Find first inactive projectile of the requested type\r\n        const pool = projectilePool.current[type];\r\n        const projectile = pool.find(p => !p.active);\r\n\r\n        if (projectile) {\r\n            projectile.active = true;\r\n            return projectile;\r\n        }\r\n\r\n        console.warn(`Pool exhausted for ${type} projectiles`);\r\n\r\n        // If pool is exhausted, create a new one (fallback)\r\n        if (pool.length < 25) { // Cap at 25 to prevent unlimited growth\r\n            const newProjectile = {\r\n                id: `${type}-${pool.length}`,\r\n                position: new THREE.Vector3(),\r\n                previousPosition: new THREE.Vector3(),\r\n                direction: new THREE.Vector3(),\r\n                type: type,\r\n                speed: 0,\r\n                life: 0,\r\n                active: true,\r\n                gravity: 0\r\n            };\r\n\r\n            pool.push(newProjectile);\r\n            return newProjectile;\r\n        }\r\n\r\n        // Return null if we hit the cap - the calling code should handle this\r\n        return null;\r\n    };\r\n\r\n    // Return projectile to pool\r\n    const returnProjectileToPool = (projectile) => {\r\n        const pool = projectilePool.current[projectile.type];\r\n        const pooledProjectile = pool.find(p => p.id === projectile.id);\r\n\r\n        if (pooledProjectile) {\r\n            pooledProjectile.active = false;\r\n            // Reset other properties as needed\r\n            pooledProjectile.life = 0;\r\n        }\r\n    };\r\n\r\n    // Weapon firing functions\r\n    const fireShotgun = useCallback(() => {\r\n        if (shotgunAmmo <= 0 || shotgunCooldown) return;\r\n\r\n        console.log(\"Firing shotgun!\");\r\n        const newAmmo = shotgunAmmo - 1;\r\n        setShotgunAmmo(newAmmo);\r\n        setShotgunCooldown(true);\r\n\r\n        // Dispatch ammo update event\r\n        window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n            detail: {\r\n                droneType: DRONE_TYPES.GRENADIER,\r\n                weaponType: 'shotgunAmmo',\r\n                ammoCount: Number(newAmmo)\r\n            }\r\n        }));\r\n\r\n        // Add shotgun projectile logic here\r\n        const rotation = droneRef.current.rotation.y;\r\n        const forward = new THREE.Vector3(\r\n            -Math.sin(rotation),\r\n            0,\r\n            -Math.cos(rotation)\r\n        );\r\n\r\n        // Trigger the shotgun muzzle flash at the drone's position\r\n        const muzzlePosition = droneRef.current.position.clone().add(\r\n            forward.clone().multiplyScalar(1.0)\r\n        );\r\n        triggerShotgunFire(muzzlePosition, forward);\r\n\r\n        // Get current FPS to adaptively reduce shotgun pellets at lower FPS\r\n        const currentFps = window.currentFps || 60;\r\n        // More aggressive FPS-based pellet reduction\r\n        const pelletCount = currentFps < 30 ? 1 : (currentFps < 45 ? 2 : 3);\r\n\r\n        // Creating buckshot - adaptively reduce pellet count based on FPS\r\n        for (let i = 0; i < pelletCount; i++) {\r\n            // Reduce spread at lower pellet counts for more consistent damage\r\n            const spreadFactor = pelletCount === 1 ? 0.1 : 0.2;\r\n\r\n            // Add slight random deviation for buckshot spread\r\n            const spread = new THREE.Vector3(\r\n                (Math.random() - 0.5) * spreadFactor,\r\n                (Math.random() - 0.5) * (spreadFactor * 0.5),\r\n                (Math.random() - 0.5) * spreadFactor\r\n            );\r\n\r\n            const direction = forward.clone().add(spread).normalize();\r\n\r\n            // Get projectile from pool\r\n            const projectile = getProjectileFromPool(WEAPON_TYPES.SHOTGUN);\r\n            if (!projectile) continue; // Skip if no projectile available\r\n\r\n            // Set projectile properties\r\n            projectile.position.copy(droneRef.current.position)\r\n                .add(direction.clone().multiplyScalar(1.5)); // Start position in front of drone\r\n\r\n            // Initialize previousPosition if needed\r\n            if (!projectile.previousPosition) {\r\n                projectile.previousPosition = new THREE.Vector3();\r\n            }\r\n            projectile.previousPosition.copy(projectile.position);\r\n            projectile.direction.copy(direction);\r\n            projectile.speed = 1.0 + Math.random() * 0.2; // Slightly faster speed for less frames in flight\r\n            projectile.life = 25; // Further reduced lifetime from 30 to 25 frames\r\n\r\n            // Add to active projectiles\r\n            setActiveProjectiles(prev => [...prev, projectile]);\r\n        }\r\n\r\n        // Set cooldown\r\n        setTimeout(() => {\r\n            setShotgunCooldown(false);\r\n        }, 800);\r\n    }, [shotgunAmmo, shotgunCooldown]);\r\n\r\n    const dropGrenade = () => {\r\n        if (grenadeAmmo <= 0 || grenadeCooldown) return;\r\n\r\n        console.log(\"Dropping grenade!\");\r\n        const newAmmo = grenadeAmmo - 1;\r\n        setGrenadeAmmo(newAmmo);\r\n        setGrenadeCooldown(true);\r\n\r\n        // Dispatch ammo update event\r\n        window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n            detail: {\r\n                droneType: DRONE_TYPES.GRENADIER,\r\n                weaponType: 'grenadeAmmo',\r\n                ammoCount: Number(newAmmo)\r\n            }\r\n        }));\r\n\r\n        // Get current position from the drone ref\r\n        const currentPosition = droneRef.current.position;\r\n        console.log(\"Drone position:\", currentPosition.x, currentPosition.y, currentPosition.z);\r\n\r\n        // Get projectile from pool\r\n        const projectile = getProjectileFromPool(WEAPON_TYPES.GRENADE);\r\n\r\n        // Set projectile properties\r\n        projectile.position.set(\r\n            currentPosition.x, // Center position\r\n            currentPosition.y - 0.5, // Drop from bottom of drone\r\n            currentPosition.z\r\n        );\r\n        // Initialize previousPosition same as current position at first\r\n        if (!projectile.previousPosition) {\r\n            projectile.previousPosition = new THREE.Vector3();\r\n        }\r\n        projectile.previousPosition.copy(projectile.position);\r\n        projectile.direction.set(0, -1, 0); // Fall straight down\r\n        projectile.speed = 0.4; // Increased from 0.2\r\n        projectile.life = 70; // Reduced from 100\r\n        projectile.gravity = 0.005; // Reduced from 0.01 for straighter trajectory\r\n\r\n        // Add to active projectiles\r\n        setActiveProjectiles(prev => [...prev, projectile]);\r\n\r\n        // Set cooldown\r\n        setTimeout(() => {\r\n            setGrenadeCooldown(false);\r\n        }, 1200);\r\n    };\r\n\r\n    const dropDart = () => {\r\n        if (dartAmmo <= 0 || dartCooldown) return;\r\n\r\n        console.log(\"Dropping dart!\");\r\n        const newAmmo = dartAmmo - 1;\r\n        setDartAmmo(newAmmo);\r\n        setDartCooldown(true);\r\n\r\n        // Dispatch ammo update event\r\n        window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n            detail: {\r\n                droneType: DRONE_TYPES.GRENADIER,\r\n                weaponType: 'dartAmmo',\r\n                ammoCount: Number(newAmmo)\r\n            }\r\n        }));\r\n\r\n        // Get current position from the drone ref\r\n        const currentPosition = droneRef.current.position;\r\n\r\n        // Get projectile from pool\r\n        const projectile = getProjectileFromPool(WEAPON_TYPES.DART);\r\n\r\n        // Set projectile properties\r\n        projectile.position.set(\r\n            currentPosition.x, // Center position\r\n            currentPosition.y - 0.5, // Drop from bottom of drone\r\n            currentPosition.z\r\n        );\r\n        // Initialize previousPosition same as current position at first\r\n        if (!projectile.previousPosition) {\r\n            projectile.previousPosition = new THREE.Vector3();\r\n        }\r\n        projectile.previousPosition.copy(projectile.position);\r\n        projectile.direction.set(0, -1, 0); // Fall straight down\r\n        projectile.speed = 0.6; // Increased from 0.3\r\n        projectile.life = 60; // Reduced from 80\r\n        projectile.gravity = 0.008; // Reduced from 0.015 for straighter trajectory\r\n\r\n        // Add to active projectiles\r\n        setActiveProjectiles(prev => [...prev, projectile]);\r\n        console.log(\"Projectiles after adding dart:\", activeProjectiles.length + 1);\r\n\r\n        // Set cooldown\r\n        setTimeout(() => {\r\n            setDartCooldown(false);\r\n        }, 1000);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Setup camera initial position\r\n        camera.position.set(0, 15, 20);\r\n        camera.lookAt(0, 10, 0);\r\n\r\n        // Ensure drone has proper initial rotation with correct order\r\n        if (droneRef.current) {\r\n            // Set rotation order explicitly first\r\n            droneRef.current.rotation.order = 'YXZ';\r\n\r\n            // Set individual rotation components (can't assign the entire rotation object)\r\n            droneRef.current.rotation.x = initialRotationRef.current.x;\r\n            droneRef.current.rotation.y = initialRotationRef.current.y;\r\n            droneRef.current.rotation.z = initialRotationRef.current.z;\r\n        }\r\n\r\n        // Subscribe to keyboard controls\r\n        return subscribeKeys(\r\n            state => state,\r\n            state => {\r\n                // Activate propellers when any control is pressed\r\n                const { forward, backward, left, right, up, down, strafeLeft, strafeRight } = state;\r\n                if (forward || backward || left || right || up || down || strafeLeft || strafeRight) {\r\n                    setPropellersActive(true);\r\n                    setPropellersSpeed(1.0);\r\n                } else {\r\n                    setPropellersSpeed(0.5); // Idle speed when not moving\r\n                }\r\n            }\r\n        );\r\n    }, [camera, subscribeKeys]);\r\n\r\n    // Handle weapon firing with mouse and keyboard\r\n    useEffect(() => {\r\n        // Handle mouse clicks for weapons\r\n        const handleMouseDown = (e) => {\r\n            switch (e.button) {\r\n                case 0: // Left mouse button\r\n                    fireShotgun();\r\n                    break;\r\n                case 2: // Right mouse button\r\n                    dropGrenade();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n\r\n        // Handle keyboard keys\r\n        const handleKeyDown = (e) => {\r\n            switch (e.key) {\r\n                case 'c':\r\n                case 'C':\r\n                    dropDart(); // C key exclusively for dart weapon\r\n                    break;\r\n                case 'v':\r\n                case 'V':\r\n                    setDownwardViewActive(prev => !prev); // V key for toggling downward view\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n\r\n        // Prevent default right-click context menu\r\n        const handleContextMenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n\r\n        window.addEventListener('mousedown', handleMouseDown);\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        window.addEventListener('contextmenu', handleContextMenu);\r\n\r\n        return () => {\r\n            window.removeEventListener('mousedown', handleMouseDown);\r\n            window.removeEventListener('keydown', handleKeyDown);\r\n            window.removeEventListener('contextmenu', handleContextMenu);\r\n        };\r\n    }, [shotgunAmmo, grenadeAmmo, dartAmmo, shotgunCooldown, grenadeCooldown, dartCooldown]);\r\n\r\n    // Enhanced weapon impact function that triggers explosion effects\r\n    const handleWeaponImpact = (position, weaponType) => {\r\n        console.log(`Weapon impact: ${weaponType} at position [${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}]`);\r\n\r\n        // Create a position that can be cloned for custom events\r\n        const cloneablePosition = {\r\n            x: position.x,\r\n            y: position.y,\r\n            z: position.z\r\n        };\r\n\r\n        // Use setTimeout to avoid calling setState during render\r\n        setTimeout(() => {\r\n            // For shotgun impacts, we rely on the ExplosionsManager to apply damage\r\n            // without creating visual explosion effects\r\n\r\n            // Create a THREE.Vector3 for any functions that need it\r\n            const positionVector = new THREE.Vector3(cloneablePosition.x, cloneablePosition.y, cloneablePosition.z);\r\n\r\n            // Trigger explosion effect - ExplosionsManager will handle shotgun specially\r\n            triggerExplosion(positionVector, weaponType);\r\n\r\n            // Show damage indicator at the impact point\r\n            showDamageIndicator(positionVector, 20);\r\n        }, 0);\r\n    };\r\n\r\n    // Update projectiles with explosion effects\r\n    useFrame(() => {\r\n        // Process projectiles with object pooling\r\n        setActiveProjectiles(prevProjectiles => {\r\n            // Early return if no projectiles to process\r\n            if (prevProjectiles.length === 0) return prevProjectiles;\r\n\r\n            const stillActiveProjectiles = [];\r\n\r\n            for (const projectile of prevProjectiles) {\r\n                // Decrement life and remove if expired\r\n                if (projectile.life <= 0) {\r\n                    // Trigger weapon impact with explosion\r\n                    handleWeaponImpact(projectile.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile in the updated array\r\n                }\r\n\r\n                // Check for ground collision\r\n                if (projectile.position.y <= 0.1) {\r\n                    // Trigger weapon impact with explosion\r\n                    handleWeaponImpact(projectile.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile\r\n                }\r\n\r\n                // Check for vehicle collision - only if projectile is close to ground level\r\n                // This optimization avoids collision checks when projectiles are high in the air\r\n                const vehicleHit = checkProjectileVehicleCollision(projectile, scene);\r\n                if (vehicleHit) {\r\n                    // Trigger weapon impact with explosion at the collision point\r\n                    handleWeaponImpact(vehicleHit.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile\r\n                }\r\n\r\n                // Store the previous position before updating\r\n                if (!projectile.previousPosition) {\r\n                    projectile.previousPosition = new THREE.Vector3();\r\n                }\r\n                projectile.previousPosition.copy(projectile.position);\r\n\r\n                // Update position based on direction and speed\r\n                projectile.position.add(\r\n                    projectile.direction.clone().multiplyScalar(projectile.speed)\r\n                );\r\n\r\n                // Apply gravity if applicable\r\n                if (projectile.gravity) {\r\n                    projectile.direction.y -= projectile.gravity;\r\n                }\r\n\r\n                // Reduce life\r\n                projectile.life--;\r\n\r\n                // Add to still active projectiles\r\n                stillActiveProjectiles.push(projectile);\r\n            }\r\n\r\n            return stillActiveProjectiles;\r\n        });\r\n    });\r\n\r\n    useFrame((state, delta) => {\r\n        if (!droneRef.current) return;\r\n\r\n        // Get current keyboard state\r\n        const { forward, backward, left, right, up, down, strafeLeft, strafeRight, shift } = getKeys();\r\n\r\n        // Get drone's current rotation\r\n        const rotation = droneRef.current.rotation.y;\r\n\r\n        // Get directional vectors\r\n        const forwardVector = new THREE.Vector3(\r\n            -Math.sin(rotation),\r\n            0,\r\n            -Math.cos(rotation)\r\n        );\r\n\r\n        const rightVector = new THREE.Vector3(\r\n            Math.cos(rotation),\r\n            0,\r\n            -Math.sin(rotation)\r\n        );\r\n\r\n        // Calculate thrust based on controls\r\n        if (forward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(THRUST * 2)); // 2x speed for forward\r\n            velocityRef.current.y -= DIVE_POWER; // Slight downward movement when pressing W\r\n        }\r\n        if (backward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(-THRUST));\r\n            velocityRef.current.y += DIVE_POWER * 0.8; // Slight upward movement when pressing S\r\n        }\r\n\r\n        // Handle rotation separately from strafing - now with smoother turning\r\n        if (left) {\r\n            // Smooth rotation with lerping\r\n            droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.y,\r\n                droneRef.current.rotation.y + ROTATION_SPEED * 2,\r\n                0.2\r\n            );\r\n        }\r\n        if (right) {\r\n            // Smooth rotation with lerping\r\n            droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.y,\r\n                droneRef.current.rotation.y - ROTATION_SPEED * 2,\r\n                0.2\r\n            );\r\n        }\r\n\r\n        // Add strafing with A and D keys\r\n        if (strafeLeft) velocityRef.current.add(rightVector.clone().multiplyScalar(-STRAFE_POWER));\r\n        if (strafeRight) velocityRef.current.add(rightVector.clone().multiplyScalar(STRAFE_POWER));\r\n\r\n        // Handle vertical movement\r\n        if (up) {\r\n            velocityRef.current.y += LIFT_POWER;\r\n        } else if (down) {\r\n            // If shift is pressed, go down 50% faster\r\n            const downSpeed = shift ? LIFT_POWER * 1.5 : LIFT_POWER;\r\n            velocityRef.current.y -= downSpeed;\r\n        } else {\r\n            // Apply gravity when not actively going up or down\r\n            velocityRef.current.y -= GRAVITY;\r\n        }\r\n\r\n        // Apply friction to slow down over time\r\n        velocityRef.current.multiplyScalar(FRICTION);\r\n\r\n        // Limit max speed\r\n        const speed = velocityRef.current.length();\r\n        if (speed > MAX_SPEED) {\r\n            velocityRef.current.normalize().multiplyScalar(MAX_SPEED);\r\n        }\r\n\r\n        // Apply velocity to drone position\r\n        droneRef.current.position.add(velocityRef.current);\r\n\r\n        // Prevent going below the ground\r\n        if (droneRef.current.position.y < 1) {\r\n            droneRef.current.position.y = 1;\r\n            velocityRef.current.y = 0;\r\n        }\r\n\r\n        // SIMPLIFIED QUATERNION-BASED TILTING APPROACH\r\n        // Using YXZ rotation order consistently (Yaw, Pitch, Roll)\r\n\r\n        // Calculate target tilt values based on input keys\r\n        let targetForwardTilt = 0;\r\n        let targetSideTilt = 0;\r\n\r\n        // Direct forward/backward tilt based on keys - REVERSED VALUES\r\n        if (forward) targetForwardTilt = -0.3;  // Reversed: Tilt backward when W pressed\r\n        if (backward) targetForwardTilt = 0.3; // Reversed: Tilt forward when S pressed\r\n\r\n        // Direct side tilt based on strafe keys\r\n        if (strafeLeft) targetSideTilt = 0.2;  // Tilt left when A pressed\r\n        if (strafeRight) targetSideTilt = -0.2; // Tilt right when D pressed\r\n\r\n        // Keep existing yaw (y-axis rotation)\r\n        const currentYaw = droneRef.current.rotation.y;\r\n\r\n        // Get current quaternion (preserves rotation order)\r\n        const currentQuat = new THREE.Quaternion();\r\n        currentQuat.setFromEuler(droneRef.current.rotation);\r\n\r\n        // Create a target quaternion with desired tilts\r\n        const targetEuler = new THREE.Euler(targetForwardTilt, currentYaw, targetSideTilt, 'YXZ');\r\n        const targetQuat = new THREE.Quaternion();\r\n        targetQuat.setFromEuler(targetEuler);\r\n\r\n        // Smoothly interpolate between current and target quaternions\r\n        const slerpQuat = new THREE.Quaternion().copy(currentQuat);\r\n        slerpQuat.slerp(targetQuat, 0.1);\r\n\r\n        // Apply the interpolated quaternion back to the drone\r\n        droneRef.current.setRotationFromQuaternion(slerpQuat);\r\n\r\n        // Update target position for smooth following\r\n        const targetPosition = new THREE.Vector3(\r\n            droneRef.current.position.x,\r\n            droneRef.current.position.y,\r\n            droneRef.current.position.z\r\n        );\r\n\r\n        // Fixed camera parameters - using more strict values\r\n        const cameraDistance = 25; // Increased from 18 to zoom out more\r\n        const cameraHeight = 8; // Keeping the same height for now\r\n\r\n        // Handle camera positioning based on view mode\r\n        if (downwardViewActive) {\r\n            // Position camera directly below the drone, looking down\r\n            camera.position.set(\r\n                droneRef.current.position.x,\r\n                droneRef.current.position.y - 3, // 3 units below the drone\r\n                droneRef.current.position.z\r\n            );\r\n            // Look directly at ground below the drone\r\n            camera.lookAt(\r\n                droneRef.current.position.x,\r\n                0, // Looking at ground level\r\n                droneRef.current.position.z\r\n            );\r\n        } else {\r\n            // Calculate camera position strictly behind the drone\r\n            // Use exact rotation values for precise positioning\r\n            const cameraOffset = new THREE.Vector3(\r\n                Math.sin(rotation) * cameraDistance,\r\n                cameraHeight,\r\n                Math.cos(rotation) * cameraDistance\r\n            );\r\n\r\n            // Set camera position directly without lerping for strict following\r\n            camera.position.copy(targetPosition).add(cameraOffset);\r\n\r\n            // Make camera look exactly at the drone\r\n            camera.lookAt(\r\n                droneRef.current.position.x,\r\n                droneRef.current.position.y + 0.5, // Aim slightly above center\r\n                droneRef.current.position.z\r\n            );\r\n        }\r\n\r\n        // Update position state for external components\r\n        setPosition([\r\n            droneRef.current.position.x,\r\n            droneRef.current.position.y,\r\n            droneRef.current.position.z\r\n        ]);\r\n    });\r\n\r\n    return (\r\n        <>\r\n            <group ref={droneRef}>\r\n                {/* Main drone body - redesigned with more polygons */}\r\n                <mesh castShadow receiveShadow position={[0, 0, 0]}>\r\n                    <boxGeometry args={[0.8, 0.35, 2.0]} />\r\n                    <meshStandardMaterial color=\"#1d3557\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n\r\n                {/* Side bevels for more polished look */}\r\n                <mesh castShadow receiveShadow position={[0.4, 0, 0]} rotation={[0, 0, Math.PI / 4]}>\r\n                    <boxGeometry args={[0.25, 0.35, 2.0]} />\r\n                    <meshStandardMaterial color=\"#2a4568\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n                <mesh castShadow receiveShadow position={[-0.4, 0, 0]} rotation={[0, 0, -Math.PI / 4]}>\r\n                    <boxGeometry args={[0.25, 0.35, 2.0]} />\r\n                    <meshStandardMaterial color=\"#2a4568\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n\r\n                {/* Front and back bevels */}\r\n                <mesh castShadow receiveShadow position={[0, 0, 1.0]} rotation={[Math.PI / 4, 0, 0]}>\r\n                    <boxGeometry args={[0.8, 0.25, 0.25]} />\r\n                    <meshStandardMaterial color=\"#2a4568\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n                <mesh castShadow receiveShadow position={[0, 0, -1.0]} rotation={[-Math.PI / 4, 0, 0]}>\r\n                    <boxGeometry args={[0.8, 0.25, 0.25]} />\r\n                    <meshStandardMaterial color=\"#2a4568\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n\r\n                {/* Central cross for arms */}\r\n                <mesh castShadow position={[0, 0, 0]} rotation={[0, Math.PI / 4, 0]}>\r\n                    <boxGeometry args={[3.0, 0.08, 0.1]} />\r\n                    <meshStandardMaterial color=\"#e63946\" metalness={0.4} roughness={0.6} />\r\n                </mesh>\r\n                <mesh castShadow position={[0, 0, 0]} rotation={[0, -Math.PI / 4, 0]}>\r\n                    <boxGeometry args={[3.0, 0.08, 0.1]} />\r\n                    <meshStandardMaterial color=\"#e63946\" metalness={0.4} roughness={0.6} />\r\n                </mesh>\r\n\r\n                {/* Landing gear - adjusted to y=-0.3 */}\r\n                <LandingLeg position={[0.6, -0.3, 0.6]} />\r\n                <LandingLeg position={[-0.6, -0.3, 0.6]} />\r\n                <LandingLeg position={[0.6, -0.3, -0.6]} />\r\n                <LandingLeg position={[-0.6, -0.3, -0.6]} />\r\n\r\n                {/* Motors and propellers */}\r\n                <PropellerUnit\r\n                    position={[1.1, 0, 1.1]}\r\n                    index={0}\r\n                    propRef={(el) => (propellersRefs.current[0] = el)}\r\n                    active={propellersActive}\r\n                    speed={propellersSpeed}\r\n                />\r\n                <PropellerUnit\r\n                    position={[-1.1, 0, 1.1]}\r\n                    index={1}\r\n                    propRef={(el) => (propellersRefs.current[1] = el)}\r\n                    active={propellersActive}\r\n                    speed={propellersSpeed}\r\n                    counterClockwise\r\n                />\r\n                <PropellerUnit\r\n                    position={[1.1, 0, -1.1]}\r\n                    index={2}\r\n                    propRef={(el) => (propellersRefs.current[2] = el)}\r\n                    active={propellersActive}\r\n                    speed={propellersSpeed}\r\n                    counterClockwise\r\n                />\r\n                <PropellerUnit\r\n                    position={[-1.1, 0, -1.1]}\r\n                    index={3}\r\n                    propRef={(el) => (propellersRefs.current[3] = el)}\r\n                    active={propellersActive}\r\n                    speed={propellersSpeed}\r\n                />\r\n\r\n                {/* Shotgun - two barrels side by side with space in between */}\r\n                <group position={[0, -0.3, -1.0]} rotation={[Math.PI / 2, 0, Math.PI]}>\r\n                    <mesh castShadow receiveShadow position={[-0.25, 0, -0.2]}>\r\n                        <cylinderGeometry args={[0.15, 0.15, 2.4, 12]} />\r\n                        <meshStandardMaterial color=\"#2b2d42\" metalness={0.8} roughness={0.2} />\r\n                    </mesh>\r\n                    <mesh castShadow receiveShadow position={[0.25, 0, -0.2]}>\r\n                        <cylinderGeometry args={[0.15, 0.15, 2.4, 12]} />\r\n                        <meshStandardMaterial color=\"#2b2d42\" metalness={0.8} roughness={0.2} />\r\n                    </mesh>\r\n\r\n                </group>\r\n\r\n                {/* Robust Grenade module - centered and more prominent */}\r\n                <group position={[0, -0.35, 1.0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                    {/* Main grenade housing */}\r\n                    <mesh castShadow receiveShadow position={[0, 0, 0.15]}>\r\n                        <boxGeometry args={[1.0, 0.5, 0.3]} />\r\n                        <meshStandardMaterial color=\"#4a5568\" metalness={0.6} roughness={0.3} />\r\n                    </mesh>\r\n                    {/* Grenade tubes in a robust configuration */}\r\n                    {[...Array(4)].map((_, i) => (\r\n                        <mesh key={i} position={[(i - 1.5) * 0.22, 0, 0]} castShadow receiveShadow>\r\n                            <cylinderGeometry args={[0.08, 0.08, 0.3, 10]} />\r\n                            <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.4} />\r\n                        </mesh>\r\n                    ))}\r\n                    {/* Reinforcement bars */}\r\n                    <mesh castShadow receiveShadow position={[0, 0.15, 0.15]}>\r\n                        <boxGeometry args={[1.0, 0.08, 0.08]} />\r\n                        <meshStandardMaterial color=\"#e63946\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n                    <mesh castShadow receiveShadow position={[0, -0.15, 0.15]}>\r\n                        <boxGeometry args={[1.0, 0.08, 0.08]} />\r\n                        <meshStandardMaterial color=\"#e63946\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Dart tubes - moved to bottom position */}\r\n                <group position={[0, -0.4, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                    {/* Main dart housing */}\r\n                    <mesh castShadow receiveShadow position={[0, 0, 0.1]}>\r\n                        <boxGeometry args={[0.8, 0.25, 0.2]} />\r\n                        <meshStandardMaterial color=\"#4a5568\" metalness={0.6} roughness={0.3} />\r\n                    </mesh>\r\n                    {/* Dart tubes in a row on bottom */}\r\n                    {[...Array(5)].map((_, i) => (\r\n                        <mesh key={i} position={[(i - 2) * 0.15, 0, 0]} castShadow receiveShadow>\r\n                            <cylinderGeometry args={[0.03, 0.03, 0.15, 8]} />\r\n                            <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.4} />\r\n                        </mesh>\r\n                    ))}\r\n                    {/* Dart ammo indicator */}\r\n                    <mesh position={[0, 0.15, 0.1]}>\r\n                        <boxGeometry args={[0.2, 0.1, 0.1]} />\r\n                        <meshStandardMaterial color=\"#ff5733\" emissive=\"#ff5733\" emissiveIntensity={0.5} />\r\n                    </mesh>\r\n                </group>\r\n            </group>\r\n\r\n            {/* Render only active projectiles */}\r\n            <ProjectileRenderer projectiles={activeProjectiles} />\r\n        </>\r\n    );\r\n}\r\n\r\n// Directly combined motor and propeller unit\r\nfunction PropellerUnit({ position, index, propRef, active = true, speed = 1.0, counterClockwise = false }) {\r\n    const motorRef = useRef();\r\n    const propellerRef = useRef();\r\n    const direction = counterClockwise ? -1 : 1;\r\n\r\n    useFrame(() => {\r\n        if (propellerRef.current && active) {\r\n            // Spin propellers continuously, with variable speed\r\n            propellerRef.current.rotation.y += 0.5 * speed * direction;\r\n        }\r\n\r\n        if (propRef) {\r\n            propRef(propellerRef.current);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group position={position}>\r\n            {/* Motor housing - directly on arms */}\r\n            <mesh castShadow receiveShadow>\r\n                <cylinderGeometry args={[0.15, 0.18, 0.2, 12]} />\r\n                <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.3} />\r\n            </mesh>\r\n\r\n            {/* Motor top */}\r\n            <mesh castShadow position={[0, 0.12, 0]}>\r\n                <cylinderGeometry args={[0.12, 0.12, 0.05, 12]} />\r\n                <meshStandardMaterial color=\"#8d99ae\" metalness={0.8} roughness={0.2} />\r\n            </mesh>\r\n\r\n            {/* Propeller - using a more realistic shape */}\r\n            <group ref={propellerRef} position={[0, 0.15, 0]}>\r\n                {/* First blade */}\r\n                <mesh castShadow>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.6, 0.02, -0.1, 0.6, -0.02, 0.1,  // triangle 1\r\n                                0, 0, 0, 0.6, -0.02, 0.1, 1.2, 0, 0,        // triangle 2\r\n                                0, 0, 0, 1.2, 0, 0, 0.6, 0.02, -0.1,  // triangle 3\r\n                                0.6, 0.02, -0.1, 1.2, 0, 0, 0.6, -0.02, 0.1,  // triangle 4 (back face)\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n\r\n                {/* Second blade - rotated 180 degrees */}\r\n                <mesh castShadow rotation={[0, Math.PI, 0]}>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.6, 0.02, -0.1, 0.6, -0.02, 0.1,  // triangle 1\r\n                                0, 0, 0, 0.6, -0.02, 0.1, 1.2, 0, 0,        // triangle 2\r\n                                0, 0, 0, 1.2, 0, 0, 0.6, 0.02, -0.1,  // triangle 3\r\n                                0.6, 0.02, -0.1, 1.2, 0, 0, 0.6, -0.02, 0.1,  // triangle 4 (back face)\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n\r\n                {/* Propeller center cap */}\r\n                <mesh>\r\n                    <sphereGeometry args={[0.06, 8, 8]} />\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// Simplified landing leg component\r\nfunction LandingLeg({ position }) {\r\n    return (\r\n        <group position={position}>\r\n            {/* Vertical strut */}\r\n            <mesh castShadow>\r\n                <cylinderGeometry args={[0.04, 0.04, 0.6, 8]} />\r\n                <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n            </mesh>\r\n\r\n            {/* Foot pad */}\r\n            <mesh castShadow position={[0, -0.35, 0]}>\r\n                <sphereGeometry args={[0.08, 8, 8]} />\r\n                <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n            </mesh>\r\n        </group>\r\n    );\r\n}\r\n\r\n// Optimized ProjectileRenderer for better performance\r\nfunction ProjectileRenderer({ projectiles }) {\r\n    // Use a simple shared geometry for all projectiles of the same type with low poly designs\r\n    const geometries = useMemo(() => ({\r\n        // Shotgun pellets - simple low poly pellets\r\n        [WEAPON_TYPES.SHOTGUN]: new THREE.SphereGeometry(0.05, 3, 3),  // Keep as simple spheres\r\n\r\n        // Grenade - low poly grenade design with pull ring and lever\r\n        [WEAPON_TYPES.GRENADE]: new THREE.Group().add(\r\n            // Main grenade body\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.15, 0.15, 0.23, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#4d7c0f', metalness: 0.6, roughness: 0.3 })\r\n            ),\r\n            // Grenade top\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.14, 0.15, 0.06, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#3f6212', metalness: 0.7, roughness: 0.4 })\r\n            ).translateY(0.145),\r\n            // Pull pin\r\n            new THREE.Mesh(\r\n                new THREE.TorusGeometry(0.03, 0.007, 6, 6),\r\n                new THREE.MeshStandardMaterial({ color: '#a3a3a3', metalness: 0.8, roughness: 0.2 })\r\n            ).translateY(0.17).translateX(0.09).rotateX(Math.PI / 2)\r\n        ),\r\n\r\n        // Dart - low poly dart design with fins\r\n        [WEAPON_TYPES.DART]: new THREE.Group().add(\r\n            // Dart body\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.08, 0.08, 0.35, 6),\r\n                new THREE.MeshStandardMaterial({ color: '#8b5cf6', metalness: 0.6, roughness: 0.3 })\r\n            ),\r\n            // Dart tip\r\n            new THREE.Mesh(\r\n                new THREE.ConeGeometry(0.08, 0.12, 6),\r\n                new THREE.MeshStandardMaterial({ color: '#7c3aed', metalness: 0.7, roughness: 0.4 })\r\n            ).translateY(-0.23),\r\n            // Dart fins (simplified as flat boxes)\r\n            ...[0, 1, 2, 3].map(i => new THREE.Mesh(\r\n                new THREE.BoxGeometry(0.025, 0.13, 0.09),\r\n                new THREE.MeshStandardMaterial({ color: '#a78bfa', metalness: 0.5, roughness: 0.5 })\r\n            ).translateY(0.14).rotateY(i * Math.PI / 2))\r\n        ).rotateX(Math.PI)\r\n    }), []);\r\n\r\n    // Remove shared materials and use rotation for projectiles\r\n    const ProjectileMesh = React.memo(({ projectile }) => {\r\n        // Using rotation to simulate projectile movement\r\n        const [rotation, setRotation] = useState([0, 0, 0]);\r\n\r\n        useFrame(() => {\r\n            // Simple rotation for projectiles to make them look more dynamic\r\n            if (projectile.type === WEAPON_TYPES.GRENADE) {\r\n                // Grenade tumbles as it flies\r\n                setRotation([\r\n                    rotation[0] + 0.03,\r\n                    rotation[1] + 0.02,\r\n                    rotation[2] + 0.01\r\n                ]);\r\n            } else if (projectile.type === WEAPON_TYPES.DART) {\r\n                // Dart stays oriented in flight direction with slight wobble\r\n                const speedFactor = projectile.speed * 10;\r\n                setRotation([\r\n                    Math.sin(Date.now() * 0.005) * 0.05,\r\n                    rotation[1] + 0.01,\r\n                    Math.cos(Date.now() * 0.005) * 0.05\r\n                ]);\r\n            }\r\n            // Shotgun pellets don't need rotation\r\n        });\r\n\r\n        if (projectile.type === WEAPON_TYPES.SHOTGUN) {\r\n            // Shotgun pellets remain as simple meshes for performance\r\n            return (\r\n                <mesh\r\n                    position={[projectile.position.x, projectile.position.y, projectile.position.z]}\r\n                    geometry={geometries[projectile.type]}\r\n                    material={new THREE.MeshBasicMaterial({ color: 'gray' })}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <group\r\n                position={[projectile.position.x, projectile.position.y, projectile.position.z]}\r\n                rotation={rotation}\r\n            >\r\n                <primitive object={geometries[projectile.type].clone()} />\r\n            </group>\r\n        );\r\n    });\r\n\r\n    // Group projectiles by type for batched rendering (less important now with custom meshes)\r\n    const projectilesByType = useMemo(() => {\r\n        const grouped = {\r\n            [WEAPON_TYPES.SHOTGUN]: [],\r\n            [WEAPON_TYPES.GRENADE]: [],\r\n            [WEAPON_TYPES.DART]: []\r\n        };\r\n\r\n        projectiles.forEach(projectile => {\r\n            if (grouped[projectile.type]) {\r\n                grouped[projectile.type].push(projectile);\r\n            }\r\n        });\r\n\r\n        return grouped;\r\n    }, [projectiles]);\r\n\r\n    return (\r\n        <>\r\n            {Object.entries(projectilesByType).map(([type, typeProjectiles]) => (\r\n                typeProjectiles.map(projectile => (\r\n                    <ProjectileMesh key={projectile.id} projectile={projectile} />\r\n                ))\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// HUD component that will be used outside the Canvas\r\nexport function GrenadierHUD({ shotgunAmmo, grenadeAmmo, dartAmmo, showHUD }) {\r\n    if (!showHUD) return null;\r\n\r\n    return (\r\n        <div className=\"weapon-hud grenadier-hud\">\r\n            <h2>GRENADIER DRONE</h2>\r\n            <div className=\"weapon-list\">\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">SHOTGUN [{shotgunAmmo}]</span>\r\n                    <span className=\"weapon-key\">LMB</span>\r\n                </div>\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">GRENADE [{grenadeAmmo}]</span>\r\n                    <span className=\"weapon-key\">RMB</span>\r\n                </div>\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">DART [{dartAmmo}]</span>\r\n                    <span className=\"weapon-key\">C</span>\r\n                </div>\r\n            </div>\r\n            <div className=\"view-toggle\">\r\n                <span>CAMERA VIEW TOGGLE: V</span>\r\n            </div>\r\n        </div>\r\n    );\r\n} ","import React, { useRef, useEffect, useState } from 'react';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport { useKeyboardControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport '../../styles/drone.css';\r\nimport { checkProjectileVehicleCollision, WEAPON_TYPES } from '../../utils/WeaponPhysics';\r\nimport { triggerExplosion } from '../effects/ExplosionsManager';\r\nimport { showDamageIndicator } from '../effects/DamageIndicator';\r\nimport { DRONE_TYPES } from '../../utils/GameContext';\r\nimport { Controls } from '../KeyboardControls';\r\nimport { useKamikaze } from '../../utils/GameContext';\r\n\r\nexport default function Kamikaze() {\r\n    const droneRef = useRef();\r\n    const cameraFollowRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const velocityRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const propellersRefs = useRef([]);\r\n    const previousPositionRef = useRef(new THREE.Vector3(0, 10, 0)); // Store previous position for collision detection\r\n    const collisionOccurred = useRef(false); // Track if a collision has occurred\r\n    const mousePos = useRef({ x: 0, y: 0 });\r\n\r\n    // First person view state from context\r\n    const { isFirstPerson, toggleFirstPerson } = useKamikaze();\r\n\r\n    // Initial rotation reference - with explicit YXZ rotation order\r\n    const initialRotationRef = useRef(new THREE.Euler(0, 0, 0, 'YXZ'));\r\n\r\n    const [position, setPosition] = useState([0, 10, 0]);\r\n    const [propellersActive, setPropellersActive] = useState(false);\r\n    const [propellersSpeed, setPropellersSpeed] = useState(0);\r\n    const { camera, scene, gl } = useThree();\r\n    const [subscribeKeys, getKeys] = useKeyboardControls();\r\n\r\n    const THRUST = 0.05;\r\n    const MAX_SPEED = 3.0;\r\n    const ROTATION_SPEED = 0.08;\r\n    const FRICTION = 0.98;\r\n    const GRAVITY = 0.003;\r\n    const LIFT_POWER = 0.06;\r\n    const STRAFE_POWER = 0.04; // Power for strafing left/right\r\n    const DIVE_POWER = 0.020; // Power for slight downward movement with W\r\n\r\n    // Function to handle collision with a vehicle\r\n    const handleVehicleCollision = (hitPosition) => {\r\n        if (collisionOccurred.current) return; // Prevent multiple collisions\r\n\r\n        collisionOccurred.current = true;\r\n        console.log(\"Kamikaze drone collided with vehicle!\");\r\n\r\n        // Trigger explosion at the collision point\r\n        triggerExplosion(hitPosition, WEAPON_TYPES.KAMIKAZE);\r\n\r\n        // Show damage indicator with the inner damage value from the KAMIKAZE weapon type\r\n        showDamageIndicator(hitPosition, 80); // Updated to show 80 damage\r\n\r\n        // Make drone inactive/invisible after collision\r\n        if (droneRef.current) {\r\n            droneRef.current.visible = false;\r\n        }\r\n\r\n        // Reset drone position after a delay (respawn)\r\n        setTimeout(() => {\r\n            if (droneRef.current) {\r\n                droneRef.current.position.set(0, 10, 0);\r\n                droneRef.current.visible = true;\r\n                collisionOccurred.current = false;\r\n                velocityRef.current.set(0, 0, 0);\r\n                setPosition([0, 10, 0]);\r\n                previousPositionRef.current.set(0, 10, 0);\r\n            }\r\n        }, 3000); // Respawn after 3 seconds\r\n    };\r\n\r\n    // Mouse move handler\r\n    const handleMouseMove = (event) => {\r\n        if (isFirstPerson) {\r\n            // Get normalized device coordinates (NDC) between -1 and 1\r\n            mousePos.current.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n            mousePos.current.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Handle first person view toggle with keypress\r\n        const handleKeyDown = (e) => {\r\n            if (e.code === 'KeyV') {\r\n                toggleFirstPerson();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        window.addEventListener('mousemove', handleMouseMove);\r\n\r\n        return () => {\r\n            window.removeEventListener('keydown', handleKeyDown);\r\n            window.removeEventListener('mousemove', handleMouseMove);\r\n        };\r\n    }, [toggleFirstPerson]);\r\n\r\n    useEffect(() => {\r\n        // Setup camera initial position\r\n        camera.position.set(0, 15, 20);\r\n        camera.lookAt(0, 10, 0);\r\n\r\n        // Ensure drone has proper initial rotation with correct order\r\n        if (droneRef.current) {\r\n            // Set rotation order explicitly first\r\n            droneRef.current.rotation.order = 'YXZ';\r\n\r\n            // Set individual rotation components\r\n            droneRef.current.rotation.x = initialRotationRef.current.x;\r\n            droneRef.current.rotation.y = initialRotationRef.current.y;\r\n            droneRef.current.rotation.z = initialRotationRef.current.z;\r\n        }\r\n\r\n        return subscribeKeys(\r\n            state => state,\r\n            state => {\r\n                const { forward, backward, left, right, up, down, strafeLeft, strafeRight } = state;\r\n                if (forward || backward || left || right || up || down || strafeLeft || strafeRight) {\r\n                    setPropellersActive(true);\r\n                    setPropellersSpeed(1.0);\r\n                } else {\r\n                    setPropellersSpeed(0.5);\r\n                }\r\n            }\r\n        );\r\n    }, [camera, subscribeKeys]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (!droneRef.current || collisionOccurred.current) return;\r\n\r\n        // Store previous position for collision detection\r\n        previousPositionRef.current.copy(droneRef.current.position);\r\n\r\n        const { forward, backward, left, right, up, down, strafeLeft, strafeRight, shift } = getKeys();\r\n        const rotation = droneRef.current.rotation.y;\r\n        const forwardVector = new THREE.Vector3(-Math.sin(rotation), 0, -Math.cos(rotation));\r\n        const rightVector = new THREE.Vector3(Math.cos(rotation), 0, -Math.sin(rotation));\r\n\r\n        // Apply forward movement and slight downward movement when pressing W\r\n        if (forward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(THRUST * 2)); // 2x speed for forward\r\n            velocityRef.current.y -= DIVE_POWER; // Slight downward movement\r\n        }\r\n        if (backward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(-THRUST));\r\n            velocityRef.current.y += DIVE_POWER * 0.8; // Slight upward movement when pressing S\r\n        }\r\n\r\n        // If in first person mode, use mouse for direction with smoother interpolation\r\n        if (isFirstPerson) {\r\n            // Use mouse position to influence the drone rotation with smoother interpolation\r\n            const targetRotationY = rotation - mousePos.current.x * 0.15; // Increased sensitivity\r\n            droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.y,\r\n                targetRotationY,\r\n                0.15 // Smoother interpolation\r\n            );\r\n\r\n            // Pitch control with mouse Y and smoother interpolation\r\n            const pitchAmount = Math.max(-0.4, Math.min(0.4, mousePos.current.y * 0.4)); // Increased range\r\n            droneRef.current.rotation.x = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.x,\r\n                pitchAmount,\r\n                0.15 // Smoother interpolation\r\n            );\r\n        } else {\r\n            // Standard keyboard rotation for third person\r\n            if (left) {\r\n                droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                    droneRef.current.rotation.y,\r\n                    droneRef.current.rotation.y + ROTATION_SPEED * 3,\r\n                    0.2\r\n                );\r\n            }\r\n            if (right) {\r\n                droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                    droneRef.current.rotation.y,\r\n                    droneRef.current.rotation.y - ROTATION_SPEED * 3,\r\n                    0.2\r\n                );\r\n            }\r\n        }\r\n\r\n        if (strafeLeft) velocityRef.current.add(rightVector.clone().multiplyScalar(-STRAFE_POWER));\r\n        if (strafeRight) velocityRef.current.add(rightVector.clone().multiplyScalar(STRAFE_POWER));\r\n\r\n        if (up) velocityRef.current.y += LIFT_POWER;\r\n        else if (down) {\r\n            // If shift is pressed, go down 50% faster\r\n            const downSpeed = shift ? LIFT_POWER * 1.5 : LIFT_POWER;\r\n            velocityRef.current.y -= downSpeed;\r\n        }\r\n        else velocityRef.current.y -= GRAVITY;\r\n\r\n        velocityRef.current.multiplyScalar(FRICTION);\r\n        const speed = velocityRef.current.length();\r\n        if (speed > MAX_SPEED) velocityRef.current.normalize().multiplyScalar(MAX_SPEED);\r\n        droneRef.current.position.add(velocityRef.current);\r\n        if (droneRef.current.position.y < 1) {\r\n            droneRef.current.position.y = 1;\r\n            velocityRef.current.y = 0;\r\n        }\r\n\r\n        // Check for collision with vehicles\r\n        if (scene && droneRef.current) {\r\n            // Create a projectile-like object for collision detection\r\n            const droneProjectile = {\r\n                position: droneRef.current.position.clone(),\r\n                previousPosition: previousPositionRef.current.clone(),\r\n                type: WEAPON_TYPES.KAMIKAZE\r\n            };\r\n\r\n            // Check for vehicle collision\r\n            const vehicleHit = checkProjectileVehicleCollision(droneProjectile, scene);\r\n            if (vehicleHit) {\r\n                handleVehicleCollision(vehicleHit.position);\r\n                return; // Skip the rest of the frame processing\r\n            }\r\n        }\r\n\r\n        // SIMPLIFIED QUATERNION-BASED TILTING APPROACH\r\n        // Using YXZ rotation order consistently (Yaw, Pitch, Roll)\r\n\r\n        // Calculate target tilt values based on input keys\r\n        let targetForwardTilt = 0;\r\n        let targetSideTilt = 0;\r\n\r\n        // Direct forward/backward tilt based on keys - REVERSED VALUES\r\n        if (forward) targetForwardTilt = -0.3;  // Reversed: Tilt backward when W pressed\r\n        if (backward) targetForwardTilt = 0.3; // Reversed: Tilt forward when S pressed\r\n\r\n        // Direct side tilt based on strafe keys\r\n        if (strafeLeft) targetSideTilt = 0.2;  // Tilt left when A pressed\r\n        if (strafeRight) targetSideTilt = -0.2; // Tilt right when D pressed\r\n\r\n        // Keep existing yaw (y-axis rotation)\r\n        const currentYaw = droneRef.current.rotation.y;\r\n\r\n        // Get current quaternion (preserves rotation order)\r\n        const currentQuat = new THREE.Quaternion();\r\n        currentQuat.setFromEuler(droneRef.current.rotation);\r\n\r\n        // Create a target quaternion with desired tilts\r\n        const targetEuler = new THREE.Euler(targetForwardTilt, currentYaw, targetSideTilt, 'YXZ');\r\n        const targetQuat = new THREE.Quaternion();\r\n        targetQuat.setFromEuler(targetEuler);\r\n\r\n        // Smoothly interpolate between current and target quaternions\r\n        const slerpQuat = new THREE.Quaternion().copy(currentQuat);\r\n        slerpQuat.slerp(targetQuat, 0.1);\r\n\r\n        // Apply the interpolated quaternion back to the drone\r\n        droneRef.current.setRotationFromQuaternion(slerpQuat);\r\n\r\n        const targetPosition = new THREE.Vector3(\r\n            droneRef.current.position.x,\r\n            droneRef.current.position.y,\r\n            droneRef.current.position.z\r\n        );\r\n\r\n        // Camera positioning based on view mode\r\n        if (isFirstPerson) {\r\n            // First person - position camera at drone's location with slight offset\r\n            const fpOffset = new THREE.Vector3(0, 0.2, 0);\r\n            const fpDirection = new THREE.Vector3(\r\n                -Math.sin(rotation),\r\n                droneRef.current.rotation.x * 0.5, // Look slightly up/down based on pitch\r\n                -Math.cos(rotation)\r\n            ).normalize();\r\n\r\n            // Position the camera at the drone's position with a slight vertical offset\r\n            camera.position.copy(targetPosition).add(fpOffset);\r\n\r\n            // Look in the direction the drone is pointing\r\n            camera.lookAt(\r\n                camera.position.x + fpDirection.x,\r\n                camera.position.y + fpDirection.y,\r\n                camera.position.z + fpDirection.z\r\n            );\r\n        } else {\r\n            // Third person - regular follow camera\r\n            const cameraDistance = 15;\r\n            const cameraHeight = 6;\r\n\r\n            // Calculate camera position behind the drone\r\n            const cameraOffset = new THREE.Vector3(\r\n                Math.sin(rotation) * cameraDistance,\r\n                cameraHeight,\r\n                Math.cos(rotation) * cameraDistance\r\n            );\r\n\r\n            // Set camera position\r\n            camera.position.copy(targetPosition).add(cameraOffset);\r\n\r\n            // Make camera look at the drone\r\n            camera.lookAt(\r\n                droneRef.current.position.x,\r\n                droneRef.current.position.y + 0.5,\r\n                droneRef.current.position.z\r\n            );\r\n        }\r\n\r\n        setPosition([droneRef.current.position.x, droneRef.current.position.y, droneRef.current.position.z]);\r\n    });\r\n\r\n    return (\r\n        <group ref={droneRef} position={position}>\r\n            {/* Elongated Body */}\r\n            <mesh castShadow receiveShadow position={[0, 0, 0]}>\r\n                <boxGeometry args={[0.3, 0.1, 0.7]} />\r\n                <meshStandardMaterial color=\"#ff3300\" metalness={0.7} roughness={0.2} />\r\n            </mesh>\r\n\r\n            {/* Arms */}\r\n            <mesh castShadow position={[0, 0, 0]} rotation={[0, Math.PI / 4, 0]}>\r\n                <boxGeometry args={[1.414, 0.03, 0.05]} />\r\n                <meshStandardMaterial color=\"#4a4a4a\" metalness={0.4} roughness={0.6} />\r\n            </mesh>\r\n            <mesh castShadow position={[0, 0, 0]} rotation={[0, -Math.PI / 4, 0]}>\r\n                <boxGeometry args={[1.414, 0.03, 0.05]} />\r\n                <meshStandardMaterial color=\"#4a4a4a\" metalness={0.4} roughness={0.6} />\r\n            </mesh>\r\n\r\n            {/* Landing Gear */}\r\n            <LandingLeg position={[0.1, -0.1, 0.4]} />\r\n            <LandingLeg position={[-0.1, -0.1, 0.4]} />\r\n            <LandingLeg position={[0.1, -0.1, -0.4]} />\r\n            <LandingLeg position={[-0.1, -0.1, -0.4]} />\r\n\r\n            {/* Propellers and Motors */}\r\n            <PropellerUnit position={[0.5, 0, 0.5]} index={0} propRef={(el) => propellersRefs.current[0] = el} active={propellersActive} speed={propellersSpeed} />\r\n            <PropellerUnit position={[-0.5, 0, 0.5]} index={1} propRef={(el) => propellersRefs.current[1] = el} active={propellersActive} speed={propellersSpeed} counterClockwise={true} />\r\n            <PropellerUnit position={[0.5, 0, -0.5]} index={2} propRef={(el) => propellersRefs.current[2] = el} active={propellersActive} speed={propellersSpeed} counterClockwise={true} />\r\n            <PropellerUnit position={[-0.5, 0, -0.5]} index={3} propRef={(el) => propellersRefs.current[3] = el} active={propellersActive} speed={propellersSpeed} />\r\n\r\n            {/* Bigger and Brighter Battery */}\r\n            <mesh position={[0, 0.16, 0]}>\r\n                <boxGeometry args={[0.25, 0.2, 0.35]} />\r\n                <meshStandardMaterial color=\"#0000ff\" />\r\n            </mesh>\r\n\r\n            <group>\r\n                {/* Main Warhead Body */}\r\n                <mesh position={[0, -0.2, 0]} rotation={[Math.PI / 2, 0, 0]}>\r\n                    <cylinderGeometry args={[0.15, 0.25, 1.2, 8]} />\r\n                    <meshStandardMaterial color=\"#004d00\" metalness={0.7} roughness={0.5} />\r\n                </mesh>\r\n\r\n                {/* Pointed Nose Cone */}\r\n                <mesh position={[0, -0.2, -0.8]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                    <coneGeometry args={[0.25, 0.5, 8]} />\r\n                    <meshStandardMaterial color=\"#2e7d32\" metalness={0.7} roughness={0.5} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PropellerUnit({ position, index, propRef, active = true, speed = 1.0, counterClockwise = false }) {\r\n    const propellerRef = useRef();\r\n    const direction = counterClockwise ? -1 : 1;\r\n\r\n    useFrame(() => {\r\n        if (propellerRef.current && active) propellerRef.current.rotation.y += 0.5 * speed * direction;\r\n        if (propRef) propRef(propellerRef.current);\r\n    });\r\n\r\n    return (\r\n        <group position={position}>\r\n            {/* Motor Housing - Adjusted size for compactness */}\r\n            <mesh castShadow receiveShadow>\r\n                <cylinderGeometry args={[0.05, 0.07, 0.1, 12]} />\r\n                <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.3} />\r\n            </mesh>\r\n            {/* Motor Top - Adjusted size for compactness */}\r\n            <mesh castShadow position={[0, 0.05, 0]}>\r\n                <cylinderGeometry args={[0.05, 0.05, 0.02, 12]} />\r\n                <meshStandardMaterial color=\"#8d99ae\" metalness={0.8} roughness={0.2} />\r\n            </mesh>\r\n            {/* Propeller */}\r\n            <group ref={propellerRef} position={[0, 0.1, 0]}>\r\n                <mesh castShadow>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.15, 0.02, -0.025, 0.15, -0.02, 0.025,\r\n                                0, 0, 0, 0.15, -0.02, 0.025, 0.3, 0, 0,\r\n                                0, 0, 0, 0.3, 0, 0, 0.15, 0.02, -0.025,\r\n                                0.15, 0.02, -0.025, 0.3, 0, 0, 0.15, -0.02, 0.025,\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n                <mesh castShadow rotation={[0, Math.PI, 0]}>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.15, 0.02, -0.025, 0.15, -0.02, 0.025,\r\n                                0, 0, 0, 0.15, -0.02, 0.025, 0.3, 0, 0,\r\n                                0, 0, 0, 0.3, 0, 0, 0.15, 0.02, -0.025,\r\n                                0.15, 0.02, -0.025, 0.3, 0, 0, 0.15, -0.02, 0.025,\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.04, 8, 8]} />\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction LandingLeg({ position }) {\r\n    return (\r\n        <mesh castShadow position={position}>\r\n            <cylinderGeometry args={[0.02, 0.02, 0.3, 8]} />\r\n            <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n        </mesh>\r\n    );\r\n}\r\n\r\n// KamikazeHUD component for first-person view\r\nexport function KamikazeHUD({ showHUD }) {\r\n    const { isFirstPerson, toggleFirstPerson } = useKamikaze();\r\n\r\n    if (!showHUD) return null;\r\n\r\n    return (\r\n        <div className=\"drone-hud kamikaze-hud\">\r\n            {/* Toggle button */}\r\n            <button\r\n                className={`first-person-toggle ${isFirstPerson ? 'active' : ''}`}\r\n                onClick={toggleFirstPerson}\r\n            >\r\n                {isFirstPerson ? 'Exit First Person' : 'First Person View'}\r\n            </button>\r\n\r\n            {/* Crosshair for first-person view */}\r\n            {isFirstPerson && (\r\n                <div className=\"crosshair\">\r\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n                        <circle cx=\"12\" cy=\"12\" r=\"2\" fill=\"white\" />\r\n                        <line x1=\"12\" y1=\"4\" x2=\"12\" y2=\"10\" stroke=\"white\" strokeWidth=\"1.25\" />\r\n                        <line x1=\"12\" y1=\"14\" x2=\"12\" y2=\"20\" stroke=\"white\" strokeWidth=\"1.25\" />\r\n                        <line x1=\"4\" y1=\"12\" x2=\"10\" y2=\"12\" stroke=\"white\" strokeWidth=\"1.25\" />\r\n                        <line x1=\"14\" y1=\"12\" x2=\"20\" y2=\"12\" stroke=\"white\" strokeWidth=\"1.25\" />\r\n                    </svg>\r\n                </div>\r\n            )}\r\n\r\n            {/* First person mode indicator */}\r\n            {isFirstPerson && (\r\n                <div className=\"fpv-indicator\">\r\n                    KAMIKAZE - FIRST PERSON VIEW\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}","import React, { useRef, useEffect, useState, useMemo } from 'react';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport { useKeyboardControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport '../../styles/drone.css';\r\nimport { WEAPON_TYPES, checkProjectileVehicleCollision } from '../../utils/WeaponPhysics';\r\nimport { triggerExplosion } from '../effects/ExplosionsManager';\r\nimport { showDamageIndicator } from '../effects/DamageIndicator';\r\nimport { Controls } from '../KeyboardControls';\r\nimport { useProjectilePool } from '../../utils/ProjectilePool';\r\nimport { DRONE_TYPES } from '../../utils/GameContext';\r\n\r\n// Constants for object pooling - reduced pool size for better performance\r\nconst POOL_SIZE = {\r\n    [WEAPON_TYPES.ANTI_TANK_MINE]: 3,\r\n    [WEAPON_TYPES.MORTAR]: 3,\r\n    [WEAPON_TYPES.RPG]: 3\r\n};\r\n\r\nexport default function Bomber() {\r\n    // References\r\n    const droneRef = useRef();\r\n    const cameraFollowRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const velocityRef = useRef(new THREE.Vector3(0, 0, 0));\r\n    const propellersRefs = useRef([]);\r\n\r\n    // Initial rotation reference - with explicit YXZ rotation order\r\n    const initialRotationRef = useRef(new THREE.Euler(0, 0, 0, 'YXZ'));\r\n\r\n    // State\r\n    const [position, setPosition] = useState([0, 10, 0]); // Start 10 units above ground\r\n    const [propellersActive, setPropellersActive] = useState(false);\r\n    const [propellersSpeed, setPropellersSpeed] = useState(0);\r\n    const [showHUD, setShowHUD] = useState(true);\r\n\r\n    // Define propeller positions\r\n    const propellerPositions = [\r\n        [0.7, 0.3, 0.7],   // Front right\r\n        [-0.7, 0.3, 0.7],  // Front left\r\n        [0.7, 0.3, -0.7],  // Rear right\r\n        [-0.7, 0.3, -0.7]  // Rear left\r\n    ];\r\n\r\n    // Weapon ammo state\r\n    const [mineAmmo, setMineAmmo] = useState(3);\r\n    const [mortarAmmo, setMortarAmmo] = useState(5);\r\n    const [rpgAmmo, setRpgAmmo] = useState(4);\r\n\r\n    // Weapon cooldown state\r\n    const [mineCooldown, setMineCooldown] = useState(false);\r\n    const [mortarCooldown, setMortarCooldown] = useState(false);\r\n    const [rpgCooldown, setRpgCooldown] = useState(false);\r\n\r\n    // Object pool for projectiles\r\n    const projectilePool = useRef({\r\n        [WEAPON_TYPES.ANTI_TANK_MINE]: [],\r\n        [WEAPON_TYPES.MORTAR]: [],\r\n        [WEAPON_TYPES.RPG]: []\r\n    });\r\n\r\n    // Active projectiles\r\n    const [activeProjectiles, setActiveProjectiles] = useState([]);\r\n\r\n    // Access scene elements\r\n    const { camera, scene } = useThree();\r\n\r\n    // Setup keyboard controls\r\n    const [subscribeKeys, getKeys] = useKeyboardControls();\r\n\r\n    // Add downward view state\r\n    const [downwardViewActive, setDownwardViewActive] = useState(false);\r\n\r\n    // Initialize object pools\r\n    useEffect(() => {\r\n        // Create initial pools for each weapon type\r\n        Object.entries(POOL_SIZE).forEach(([type, size]) => {\r\n            for (let i = 0; i < size; i++) {\r\n                projectilePool.current[type].push({\r\n                    id: `${type}-${i}`,\r\n                    position: new THREE.Vector3(),\r\n                    previousPosition: new THREE.Vector3(),\r\n                    direction: new THREE.Vector3(),\r\n                    type: type,\r\n                    speed: 0,\r\n                    life: 0,\r\n                    active: false,\r\n                    gravity: 0\r\n                });\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    // Get projectile from pool\r\n    const getProjectileFromPool = (type) => {\r\n        // Find first inactive projectile of the requested type\r\n        const pool = projectilePool.current[type];\r\n        const projectile = pool.find(p => !p.active);\r\n\r\n        if (projectile) {\r\n            projectile.active = true;\r\n            return projectile;\r\n        }\r\n\r\n        console.warn(`Pool exhausted for ${type} projectiles`);\r\n        // If pool is exhausted, create a new one (fallback)\r\n        const newProjectile = {\r\n            id: `${type}-${pool.length}`,\r\n            position: new THREE.Vector3(),\r\n            previousPosition: new THREE.Vector3(),\r\n            direction: new THREE.Vector3(),\r\n            type: type,\r\n            speed: 0,\r\n            life: 0,\r\n            active: true,\r\n            gravity: 0\r\n        };\r\n\r\n        pool.push(newProjectile);\r\n        return newProjectile;\r\n    };\r\n\r\n    // Return projectile to pool\r\n    const returnProjectileToPool = (projectile) => {\r\n        const pool = projectilePool.current[projectile.type];\r\n        const pooledProjectile = pool.find(p => p.id === projectile.id);\r\n\r\n        if (pooledProjectile) {\r\n            pooledProjectile.active = false;\r\n            // Reset other properties as needed\r\n            pooledProjectile.life = 0;\r\n        }\r\n    };\r\n\r\n    // Drone physics parameters - slightly different performance\r\n    const THRUST = 0.06; // More powerful\r\n    const MAX_SPEED = 1.0; // Faster max speed\r\n    const ROTATION_SPEED = 0.06; // Quicker rotation, but still more subtle\r\n    const FRICTION = 0.97; // Less friction\r\n    const GRAVITY = 0.003;\r\n    const LIFT_POWER = 0.04; // Stronger lift\r\n    const STRAFE_POWER = 0.05; // Power for strafing left/right - slightly stronger for this drone\r\n    const DIVE_POWER = 0.015; // Power for slight upward movement with S\r\n\r\n    useEffect(() => {\r\n        // Setup camera initial position\r\n        camera.position.set(0, 15, 20);\r\n        camera.lookAt(0, 10, 0);\r\n\r\n        // Ensure drone has proper initial rotation with correct order\r\n        if (droneRef.current) {\r\n            // Set rotation order explicitly first\r\n            droneRef.current.rotation.order = 'YXZ';\r\n\r\n            // Set individual rotation components\r\n            droneRef.current.rotation.x = initialRotationRef.current.x;\r\n            droneRef.current.rotation.y = initialRotationRef.current.y;\r\n            droneRef.current.rotation.z = initialRotationRef.current.z;\r\n        }\r\n\r\n        // Subscribe to keyboard controls\r\n        return subscribeKeys(\r\n            state => state,\r\n            state => {\r\n                // Activate propellers when any control is pressed\r\n                const { forward, backward, left, right, up, down, strafeLeft, strafeRight } = state;\r\n                if (forward || backward || left || right || up || down || strafeLeft || strafeRight) {\r\n                    setPropellersActive(true);\r\n                    setPropellersSpeed(1.0);\r\n                } else {\r\n                    setPropellersSpeed(0.5); // Idle speed when not moving\r\n                }\r\n            }\r\n        );\r\n    }, [camera, subscribeKeys]);\r\n\r\n    // Handle weapon firing\r\n    useEffect(() => {\r\n        // Handle mouse clicks for weapons\r\n        const handleMouseDown = (e) => {\r\n            switch (e.button) {\r\n                case 0: // Left mouse button\r\n                    if (mineAmmo > 0 && !mineCooldown) {\r\n                        console.log(\"Dropping mine\");\r\n                        const newAmmo = mineAmmo - 1;\r\n                        setMineAmmo(newAmmo);\r\n                        setMineCooldown(true);\r\n\r\n                        // Dispatch ammo update event\r\n                        window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n                            detail: {\r\n                                droneType: DRONE_TYPES.BOMBER,\r\n                                weaponType: 'mineAmmo',\r\n                                ammoCount: Number(newAmmo)\r\n                            }\r\n                        }));\r\n\r\n                        // Get projectile from pool\r\n                        const projectile = getProjectileFromPool(WEAPON_TYPES.ANTI_TANK_MINE);\r\n\r\n                        // Set projectile properties\r\n                        projectile.position.set(\r\n                            droneRef.current.position.x,\r\n                            droneRef.current.position.y - 0.5, // Directly below drone\r\n                            droneRef.current.position.z\r\n                        );\r\n                        // Initialize previousPosition same as current position at first\r\n                        if (!projectile.previousPosition) {\r\n                            projectile.previousPosition = new THREE.Vector3();\r\n                        }\r\n                        projectile.previousPosition.copy(projectile.position);\r\n                        projectile.direction.set(0, -1, 0); // Strictly vertical drop\r\n                        projectile.speed = 0.5; // Increased from 0.3 to 0.5 for faster falling\r\n                        projectile.life = 80;\r\n                        projectile.gravity = 0.01; // Doubled from 0.005 to 0.01 for faster acceleration\r\n\r\n                        // Add to active projectiles\r\n                        setActiveProjectiles(prev => [...prev, projectile]);\r\n\r\n                        setTimeout(() => setMineCooldown(false), 1000);\r\n                    }\r\n                    break;\r\n                case 2: // Right mouse button\r\n                    if (mortarAmmo > 0 && !mortarCooldown) {\r\n                        console.log(\"Dropping mortar\");\r\n                        const newAmmo = mortarAmmo - 1;\r\n                        setMortarAmmo(newAmmo);\r\n                        setMortarCooldown(true);\r\n\r\n                        // Dispatch ammo update event\r\n                        window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n                            detail: {\r\n                                droneType: DRONE_TYPES.BOMBER,\r\n                                weaponType: 'mortarAmmo',\r\n                                ammoCount: Number(newAmmo)\r\n                            }\r\n                        }));\r\n\r\n                        // Get projectile from pool\r\n                        const projectile = getProjectileFromPool(WEAPON_TYPES.MORTAR);\r\n\r\n                        // Set projectile properties\r\n                        projectile.position.set(\r\n                            droneRef.current.position.x,\r\n                            droneRef.current.position.y - 0.5, // Directly below drone\r\n                            droneRef.current.position.z\r\n                        );\r\n                        // Initialize previousPosition same as current position at first\r\n                        if (!projectile.previousPosition) {\r\n                            projectile.previousPosition = new THREE.Vector3();\r\n                        }\r\n                        projectile.previousPosition.copy(projectile.position);\r\n                        projectile.direction.set(0, -1, 0);\r\n                        projectile.speed = 0.5;\r\n                        projectile.life = 60;\r\n                        projectile.gravity = 0.006;\r\n\r\n                        // Add to active projectiles\r\n                        setActiveProjectiles(prev => [...prev, projectile]);\r\n\r\n                        setTimeout(() => setMortarCooldown(false), 1000);\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n\r\n        // Handle keyboard keys\r\n        const handleKeyDown = (e) => {\r\n            if (e.key === 'c' || e.key === 'C') {\r\n                if (rpgAmmo > 0 && !rpgCooldown) {\r\n                    console.log(\"Dropping RPG\");\r\n                    const newAmmo = rpgAmmo - 1;\r\n                    setRpgAmmo(newAmmo);\r\n                    setRpgCooldown(true);\r\n\r\n                    // Dispatch ammo update event\r\n                    window.dispatchEvent(new CustomEvent('ammoUpdate', {\r\n                        detail: {\r\n                            droneType: DRONE_TYPES.BOMBER,\r\n                            weaponType: 'rpgAmmo',\r\n                            ammoCount: Number(newAmmo)\r\n                        }\r\n                    }));\r\n\r\n                    // Get projectile from pool\r\n                    const projectile = getProjectileFromPool(WEAPON_TYPES.RPG);\r\n\r\n                    // Set projectile properties\r\n                    projectile.position.set(\r\n                        droneRef.current.position.x,\r\n                        droneRef.current.position.y - 0.5, // Directly below drone\r\n                        droneRef.current.position.z\r\n                    );\r\n                    // Initialize previousPosition same as current position at first\r\n                    if (!projectile.previousPosition) {\r\n                        projectile.previousPosition = new THREE.Vector3();\r\n                    }\r\n                    projectile.previousPosition.copy(projectile.position);\r\n                    projectile.direction.set(0, -1, 0);\r\n                    projectile.speed = 0.6;\r\n                    projectile.life = 40;\r\n                    projectile.gravity = 0.008;\r\n\r\n                    // Add to active projectiles\r\n                    setActiveProjectiles(prev => [...prev, projectile]);\r\n\r\n                    setTimeout(() => setRpgCooldown(false), 1000);\r\n                }\r\n            } else if (e.key === 'v' || e.key === 'V') {\r\n                setDownwardViewActive(prev => !prev);\r\n            }\r\n        };\r\n\r\n        // Prevent default right-click context menu\r\n        const handleContextMenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n\r\n        window.addEventListener('mousedown', handleMouseDown);\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        window.addEventListener('contextmenu', handleContextMenu);\r\n\r\n        return () => {\r\n            window.removeEventListener('mousedown', handleMouseDown);\r\n            window.removeEventListener('keydown', handleKeyDown);\r\n            window.removeEventListener('contextmenu', handleContextMenu);\r\n        };\r\n    }, [mineAmmo, mortarAmmo, rpgAmmo, mineCooldown, mortarCooldown, rpgCooldown]);\r\n\r\n    // Enhanced weapon impact function that triggers explosion effects\r\n    const handleWeaponImpact = (position, weaponType) => {\r\n        console.log(`Weapon impact: ${weaponType} at position [${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}]`);\r\n\r\n        // Create a position that can be cloned for custom events\r\n        const cloneablePosition = {\r\n            x: position.x,\r\n            y: position.y,\r\n            z: position.z\r\n        };\r\n\r\n        // Use setTimeout to avoid calling setState during render\r\n        setTimeout(() => {\r\n            // Create a THREE.Vector3 for any functions that need it\r\n            const positionVector = new THREE.Vector3(cloneablePosition.x, cloneablePosition.y, cloneablePosition.z);\r\n\r\n            // Trigger explosion effect\r\n            // This will now handle finding objects in range and applying damage\r\n            triggerExplosion(positionVector, weaponType);\r\n\r\n            // Show one sample damage indicator at the impact point\r\n            showDamageIndicator(positionVector, 20);\r\n        }, 0);\r\n    };\r\n\r\n    // Update projectiles with explosion effects\r\n    useFrame(() => {\r\n        // Process projectiles with object pooling\r\n        setActiveProjectiles(prevProjectiles => {\r\n            const stillActiveProjectiles = [];\r\n\r\n            for (const projectile of prevProjectiles) {\r\n                // Decrement life and remove if expired\r\n                if (projectile.life <= 0) {\r\n                    // Trigger weapon impact with explosion\r\n                    handleWeaponImpact(projectile.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile in the updated array\r\n                }\r\n\r\n                // Check for ground collision\r\n                if (projectile.position.y <= 0.1) {\r\n                    // Trigger weapon impact with explosion\r\n                    handleWeaponImpact(projectile.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile\r\n                }\r\n\r\n                // Check for vehicle collision with the improved collision detection\r\n                const vehicleHit = checkProjectileVehicleCollision(projectile, scene);\r\n                if (vehicleHit) {\r\n                    // Trigger weapon impact with explosion at the collision point\r\n                    handleWeaponImpact(vehicleHit.position, projectile.type);\r\n                    // Return to pool\r\n                    returnProjectileToPool(projectile);\r\n                    continue; // Skip this projectile\r\n                }\r\n\r\n                // Store the previous position before updating\r\n                if (!projectile.previousPosition) {\r\n                    projectile.previousPosition = new THREE.Vector3();\r\n                }\r\n                projectile.previousPosition.copy(projectile.position);\r\n\r\n                // Update position based on direction and speed\r\n                projectile.position.add(\r\n                    projectile.direction.clone().multiplyScalar(projectile.speed)\r\n                );\r\n\r\n                // Apply gravity if applicable\r\n                if (projectile.gravity) {\r\n                    projectile.direction.y -= projectile.gravity;\r\n                }\r\n\r\n                // Reduce life\r\n                projectile.life--;\r\n\r\n                // Add to still active projectiles\r\n                stillActiveProjectiles.push(projectile);\r\n            }\r\n\r\n            return stillActiveProjectiles;\r\n        });\r\n    });\r\n\r\n    useFrame((state, delta) => {\r\n        if (!droneRef.current) return;\r\n\r\n        // Get current keyboard state\r\n        const { forward, backward, left, right, up, down, strafeLeft, strafeRight, shift } = getKeys();\r\n\r\n        // Get drone's current rotation\r\n        const rotation = droneRef.current.rotation.y;\r\n\r\n        // Get directional vectors\r\n        const forwardVector = new THREE.Vector3(\r\n            -Math.sin(rotation),\r\n            0,\r\n            -Math.cos(rotation)\r\n        );\r\n\r\n        const rightVector = new THREE.Vector3(\r\n            Math.cos(rotation),\r\n            0,\r\n            -Math.sin(rotation)\r\n        );\r\n\r\n        // Calculate thrust based on controls\r\n        if (forward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(THRUST * 2)); // 2x speed for forward\r\n        }\r\n        if (backward) {\r\n            velocityRef.current.add(forwardVector.clone().multiplyScalar(-THRUST));\r\n            velocityRef.current.y += DIVE_POWER * 0.8; // Slight upward movement when pressing S\r\n        }\r\n\r\n        // Handle rotation separately from strafing\r\n        if (left) {\r\n            droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.y,\r\n                droneRef.current.rotation.y + ROTATION_SPEED * 2,\r\n                0.2\r\n            );\r\n        }\r\n        if (right) {\r\n            droneRef.current.rotation.y = THREE.MathUtils.lerp(\r\n                droneRef.current.rotation.y,\r\n                droneRef.current.rotation.y - ROTATION_SPEED * 2,\r\n                0.2\r\n            );\r\n        }\r\n\r\n        // Add strafing with A and D keys\r\n        if (strafeLeft) velocityRef.current.add(rightVector.clone().multiplyScalar(-STRAFE_POWER));\r\n        if (strafeRight) velocityRef.current.add(rightVector.clone().multiplyScalar(STRAFE_POWER));\r\n\r\n        // Handle vertical movement\r\n        if (up) {\r\n            velocityRef.current.y += LIFT_POWER;\r\n        } else if (down) {\r\n            // If shift is pressed, go down 50% faster\r\n            const downSpeed = shift ? LIFT_POWER * 1.5 : LIFT_POWER;\r\n            velocityRef.current.y -= downSpeed;\r\n        } else {\r\n            // Apply gravity when not actively going up or down\r\n            velocityRef.current.y -= GRAVITY;\r\n        }\r\n\r\n        // Apply friction to slow down over time\r\n        velocityRef.current.multiplyScalar(FRICTION);\r\n\r\n        // Limit max speed\r\n        const speed = velocityRef.current.length();\r\n        if (speed > MAX_SPEED) {\r\n            velocityRef.current.normalize().multiplyScalar(MAX_SPEED);\r\n        }\r\n\r\n        // Apply velocity to drone position\r\n        droneRef.current.position.add(velocityRef.current);\r\n\r\n        // Prevent going below the ground\r\n        if (droneRef.current.position.y < 1) {\r\n            droneRef.current.position.y = 1;\r\n            velocityRef.current.y = 0;\r\n        }\r\n\r\n        // SIMPLIFIED QUATERNION-BASED TILTING APPROACH\r\n        // Using YXZ rotation order consistently (Yaw, Pitch, Roll)\r\n\r\n        // Calculate target tilt values based on input keys\r\n        let targetForwardTilt = 0;\r\n        let targetSideTilt = 0;\r\n\r\n        // Direct forward/backward tilt based on keys - REVERSED VALUES\r\n        if (forward) targetForwardTilt = -0.3;  // Reversed: Tilt backward when W pressed\r\n        if (backward) targetForwardTilt = 0.3; // Reversed: Tilt forward when S pressed\r\n\r\n        // Direct side tilt based on strafe keys\r\n        if (strafeLeft) targetSideTilt = 0.2;  // Tilt left when A pressed\r\n        if (strafeRight) targetSideTilt = -0.2; // Tilt right when D pressed\r\n\r\n        // Keep existing yaw (y-axis rotation)\r\n        const currentYaw = droneRef.current.rotation.y;\r\n\r\n        // Get current quaternion (preserves rotation order)\r\n        const currentQuat = new THREE.Quaternion();\r\n        currentQuat.setFromEuler(droneRef.current.rotation);\r\n\r\n        // Create a target quaternion with desired tilts\r\n        const targetEuler = new THREE.Euler(targetForwardTilt, currentYaw, targetSideTilt, 'YXZ');\r\n        const targetQuat = new THREE.Quaternion();\r\n        targetQuat.setFromEuler(targetEuler);\r\n\r\n        // Smoothly interpolate between current and target quaternions\r\n        const slerpQuat = new THREE.Quaternion().copy(currentQuat);\r\n        slerpQuat.slerp(targetQuat, 0.1);\r\n\r\n        // Apply the interpolated quaternion back to the drone\r\n        droneRef.current.setRotationFromQuaternion(slerpQuat);\r\n\r\n        // Update camera follow\r\n        const targetPosition = new THREE.Vector3(\r\n            droneRef.current.position.x,\r\n            droneRef.current.position.y,\r\n            droneRef.current.position.z\r\n        );\r\n\r\n        // Fixed camera parameters\r\n        const cameraDistance = 20;\r\n        const cameraHeight = 9;\r\n\r\n        // Handle camera positioning based on view mode\r\n        if (downwardViewActive) {\r\n            // Position camera directly below the drone, looking down\r\n            camera.position.set(\r\n                droneRef.current.position.x,\r\n                droneRef.current.position.y - 3, // 3 units below the drone\r\n                droneRef.current.position.z\r\n            );\r\n            // Look directly at ground below the drone\r\n            camera.lookAt(\r\n                droneRef.current.position.x,\r\n                0, // Looking at ground level\r\n                droneRef.current.position.z\r\n            );\r\n        } else {\r\n            // Calculate camera position behind the drone\r\n            const cameraOffset = new THREE.Vector3(\r\n                Math.sin(rotation) * cameraDistance,\r\n                cameraHeight,\r\n                Math.cos(rotation) * cameraDistance\r\n            );\r\n\r\n            // Set camera position\r\n            camera.position.copy(targetPosition).add(cameraOffset);\r\n\r\n            // Make camera look at the drone\r\n            camera.lookAt(\r\n                droneRef.current.position.x,\r\n                droneRef.current.position.y + 0.1,\r\n                droneRef.current.position.z\r\n            );\r\n        }\r\n\r\n        // Update position state for external components\r\n        setPosition([\r\n            droneRef.current.position.x,\r\n            droneRef.current.position.y,\r\n            droneRef.current.position.z\r\n        ]);\r\n    });\r\n\r\n    return (\r\n        <>\r\n            <group ref={droneRef} position={position}>\r\n                {/* Main drone body - smaller hexagon design */}\r\n                <mesh castShadow receiveShadow position={[0, 0, 0]}>\r\n                    <cylinderGeometry args={[0.6, 0.6, 0.2, 6]} />\r\n                    <meshStandardMaterial color=\"#4a00e0\" metalness={0.8} roughness={0.1} />\r\n                </mesh>\r\n\r\n                {/* Six thin round black arms extending from the hexagonal body to motors */}\r\n                {[...Array(6)].map((_, i) => {\r\n                    const armLength = 1.5; // Increased from 1.2 to 1.5 (25% longer)\r\n                    const angle = Math.PI * i / 3;\r\n                    // Calculate end position for placing motors\r\n                    const endX = Math.sin(angle) * armLength;\r\n                    const endZ = Math.cos(angle) * armLength;\r\n\r\n                    return (\r\n                        <group key={i}>\r\n                            {/* Arm */}\r\n                            <group rotation={[0, angle, 0]}>\r\n                                <mesh castShadow position={[armLength / 2, 0, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                                    <cylinderGeometry args={[0.04, 0.04, armLength, 8]} />\r\n                                    <meshStandardMaterial color=\"#121212\" metalness={0.6} roughness={0.3} />\r\n                                </mesh>\r\n\r\n                                {/* Motor unit at the end of the arm, properly aligned with arm direction */}\r\n                                <group position={[armLength, 0, 0]}>\r\n                                    <PropellerUnit\r\n                                        key={`motor-${i}`}\r\n                                        position={[0, 0, 0]}\r\n                                        index={i}\r\n                                        propRef={(el) => (propellersRefs.current[i] = el)}\r\n                                        active={propellersActive}\r\n                                        speed={propellersSpeed}\r\n                                        counterClockwise={i % 2 === 1} // Alternate direction\r\n                                        scale={0.75} // 25% smaller motors and propellers\r\n                                    />\r\n                                </group>\r\n                            </group>\r\n                        </group>\r\n                    );\r\n                })}\r\n\r\n                {/* Two landing legs - one on each side */}\r\n                <group position={[0.5, -0.2, 0]} rotation={[0, Math.PI / 2, 0]}>\r\n                    {/* Main vertical strut */}\r\n                    <mesh castShadow position={[0, -0.2, 0]}>\r\n                        <cylinderGeometry args={[0.05, 0.05, 0.4, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    {/* Horizontal connector bar */}\r\n                    <mesh castShadow position={[0, -0.4, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.04, 0.04, 0.8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.5} roughness={0.5} />\r\n                    </mesh>\r\n\r\n                    {/* Two leg struts on each side */}\r\n                    <mesh castShadow position={[-0.35, -0.3, 0]} rotation={[0, 0, Math.PI / 6]}>\r\n                        <cylinderGeometry args={[0.03, 0.03, 0.3, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    <mesh castShadow position={[0.35, -0.3, 0]} rotation={[0, 0, -Math.PI / 6]}>\r\n                        <cylinderGeometry args={[0.03, 0.03, 0.3, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    {/* Foot pads */}\r\n                    <mesh castShadow position={[-0.4, -0.45, 0]}>\r\n                        <sphereGeometry args={[0.06, 8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n                    </mesh>\r\n\r\n                    <mesh castShadow position={[0.4, -0.45, 0]}>\r\n                        <sphereGeometry args={[0.06, 8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Left landing leg */}\r\n                <group position={[-0.5, -0.2, 0]} rotation={[0, -Math.PI / 2, 0]}>\r\n                    {/* Main vertical strut */}\r\n                    <mesh castShadow position={[0, -0.2, 0]}>\r\n                        <cylinderGeometry args={[0.05, 0.05, 0.4, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    {/* Horizontal connector bar */}\r\n                    <mesh castShadow position={[0, -0.4, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.04, 0.04, 0.8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.5} roughness={0.5} />\r\n                    </mesh>\r\n\r\n                    {/* Two leg struts on each side */}\r\n                    <mesh castShadow position={[-0.35, -0.3, 0]} rotation={[0, 0, Math.PI / 6]}>\r\n                        <cylinderGeometry args={[0.03, 0.03, 0.3, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    <mesh castShadow position={[0.35, -0.3, 0]} rotation={[0, 0, -Math.PI / 6]}>\r\n                        <cylinderGeometry args={[0.03, 0.03, 0.3, 8]} />\r\n                        <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    {/* Foot pads */}\r\n                    <mesh castShadow position={[-0.4, -0.45, 0]}>\r\n                        <sphereGeometry args={[0.06, 8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n                    </mesh>\r\n\r\n                    <mesh castShadow position={[0.4, -0.45, 0]}>\r\n                        <sphereGeometry args={[0.06, 8, 8]} />\r\n                        <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Anti-tank mine compartment - bottom */}\r\n                <group position={[0, -0.3, 0]}>\r\n                    <mesh castShadow receiveShadow>\r\n                        <cylinderGeometry args={[0.5, 0.5, 0.2, 12]} />\r\n                        <meshStandardMaterial color=\"#3d3d3d\" metalness={0.8} roughness={0.3} />\r\n                    </mesh>\r\n                    {/* Mines in a circular arrangement */}\r\n                    {[...Array(3)].map((_, i) => (\r\n                        <mesh\r\n                            key={i}\r\n                            position={[\r\n                                Math.sin(Math.PI * 2 * i / 3) * 0.25,\r\n                                -0.1,\r\n                                Math.cos(Math.PI * 2 * i / 3) * 0.25\r\n                            ]}\r\n                            castShadow\r\n                            receiveShadow\r\n                        >\r\n                            <cylinderGeometry args={[0.15, 0.15, 0.05, 12]} />\r\n                            <meshStandardMaterial color=\"#151515\" metalness={0.7} roughness={0.3} />\r\n                        </mesh>\r\n                    ))}\r\n                </group>\r\n\r\n                {/* Mortar launchers - mounted on left side */}\r\n                <group position={[-0.4, 0.2, 0]}>\r\n                    {/* Mortar tubes */}\r\n                    {[...Array(5)].map((_, i) => (\r\n                        <mesh\r\n                            key={i}\r\n                            position={[0, (i - 2) * 0.15, 0]}\r\n                            rotation={[0, 0, Math.PI / 2]}\r\n                            castShadow\r\n                            receiveShadow\r\n                        >\r\n                            <cylinderGeometry args={[0.08, 0.1, 0.3, 8]} />\r\n                            <meshStandardMaterial color=\"#3a3a3a\" metalness={0.7} roughness={0.4} />\r\n                        </mesh>\r\n                    ))}\r\n                    {/* Mortar shells - visible like RPGs */}\r\n                    {[...Array(5)].map((_, i) => (\r\n                        <mesh\r\n                            key={i}\r\n                            position={[-0.2, (i - 2) * 0.15, 0]}\r\n                            rotation={[0, 0, Math.PI / 2]}\r\n                            castShadow\r\n                            receiveShadow\r\n                        >\r\n                            <cylinderGeometry args={[0.06, 0.08, 0.15, 8]} />\r\n                            <meshStandardMaterial color=\"#626262\" metalness={0.7} roughness={0.3} />\r\n                        </mesh>\r\n                    ))}\r\n                </group>\r\n\r\n                {/* RPG launcher - mounted on right side */}\r\n                <group position={[0.4, 0.2, 0]}>\r\n                    {/* RPG tubes */}\r\n                    {[...Array(4)].map((_, i) => (\r\n                        <mesh\r\n                            key={i}\r\n                            position={[0, (i - 1.5) * 0.18, 0]}\r\n                            rotation={[0, 0, -Math.PI / 2]}\r\n                            castShadow\r\n                            receiveShadow\r\n                        >\r\n                            <cylinderGeometry args={[0.1, 0.12, 0.4, 8]} />\r\n                            <meshStandardMaterial color=\"#3a3a3a\" metalness={0.7} roughness={0.4} />\r\n                        </mesh>\r\n                    ))}\r\n                    {/* RPG warheads - shown as conical tips */}\r\n                    {[...Array(4)].map((_, i) => (\r\n                        <mesh\r\n                            key={i}\r\n                            position={[0.25, (i - 1.5) * 0.18, 0]}\r\n                            rotation={[0, 0, -Math.PI / 2]}\r\n                            castShadow\r\n                            receiveShadow\r\n                        >\r\n                            <coneGeometry args={[0.1, 0.3, 8]} />\r\n                            <meshStandardMaterial color=\"#626262\" metalness={0.7} roughness={0.3} />\r\n                        </mesh>\r\n                    ))}\r\n                </group>\r\n            </group>\r\n\r\n            {/* Render only active projectiles using the optimized renderer */}\r\n            <ProjectileRenderer projectiles={activeProjectiles} />\r\n        </>\r\n    );\r\n}\r\n\r\n// Optimized ProjectileRenderer for better performance\r\nfunction ProjectileRenderer({ projectiles }) {\r\n    // Use a simple shared geometry for all projectiles of the same type with low poly designs\r\n    const geometries = useMemo(() => ({\r\n        // Tank mine - low poly cylindrical mine design with detonator\r\n        [WEAPON_TYPES.ANTI_TANK_MINE]: new THREE.Group().add(\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.3, 0.3, 0.11, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#3a3a3a', metalness: 0.7, roughness: 0.3 })\r\n            ),\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.075, 0.075, 0.08, 6),\r\n                new THREE.MeshStandardMaterial({ color: '#111111', metalness: 0.7, roughness: 0.3 })\r\n            ).translateY(0.09)\r\n        ),\r\n\r\n        // Mortar - low poly mortar shell design\r\n        [WEAPON_TYPES.MORTAR]: new THREE.Group().add(\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.12, 0.12, 0.3, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#4a5568', metalness: 0.6, roughness: 0.3 })\r\n            ),\r\n            new THREE.Mesh(\r\n                new THREE.ConeGeometry(0.12, 0.18, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#2d3748', metalness: 0.7, roughness: 0.4 })\r\n            ).translateY(-0.24)\r\n        ).rotateX(Math.PI),\r\n\r\n        // RPG - low poly rocket-propelled grenade design\r\n        [WEAPON_TYPES.RPG]: new THREE.Group().add(\r\n            new THREE.Mesh(\r\n                new THREE.CylinderGeometry(0.09, 0.09, 0.38, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#2c5e1a', metalness: 0.6, roughness: 0.3 })\r\n            ),\r\n            new THREE.Mesh(\r\n                new THREE.ConeGeometry(0.15, 0.23, 8),\r\n                new THREE.MeshStandardMaterial({ color: '#1e4212', metalness: 0.7, roughness: 0.4 })\r\n            ).translateY(-0.3),\r\n            new THREE.Mesh(\r\n                new THREE.BoxGeometry(0.03, 0.06, 0.15),\r\n                new THREE.MeshStandardMaterial({ color: '#3a6e27', metalness: 0.5, roughness: 0.5 })\r\n            ).translateY(0.11).translateZ(0.12)\r\n        ).rotateX(Math.PI)\r\n    }), []);\r\n\r\n    // Remove the old shared materials since we're using custom meshes with their own materials\r\n    const ProjectileMesh = React.memo(({ projectile }) => {\r\n        // Using rotation to simulate the projectile spinning as it falls\r\n        const [rotation, setRotation] = useState([0, 0, 0]);\r\n\r\n        useFrame(() => {\r\n            // Simple rotation for projectiles to make them look more dynamic\r\n            if (projectile.type === WEAPON_TYPES.ANTI_TANK_MINE) {\r\n                setRotation([0, rotation[1] + 0.02, 0]); // Mine rotates on Y axis\r\n            } else if (projectile.type === WEAPON_TYPES.MORTAR) {\r\n                setRotation([rotation[0] + 0.03, 0, 0]); // Mortar rotates on X axis (tumbling)\r\n            } else if (projectile.type === WEAPON_TYPES.RPG) {\r\n                // RPG doesn't rotate much - just a slight wobble\r\n                setRotation([Math.sin(Date.now() * 0.01) * 0.05, 0, 0]);\r\n            }\r\n        });\r\n\r\n        return (\r\n            <group\r\n                position={[projectile.position.x, projectile.position.y, projectile.position.z]}\r\n                rotation={rotation}\r\n            >\r\n                <primitive object={geometries[projectile.type].clone()} />\r\n            </group>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <>\r\n            {projectiles.map(projectile => (\r\n                <ProjectileMesh key={projectile.id} projectile={projectile} />\r\n            ))}\r\n        </>\r\n    );\r\n}\r\n\r\n// Directly combined motor and propeller unit\r\nfunction PropellerUnit({ position, index, propRef, active = true, speed = 1.0, counterClockwise = false, scale = 1.0 }) {\r\n    const motorRef = useRef();\r\n    const propellerRef = useRef();\r\n    const direction = counterClockwise ? -1 : 1;\r\n\r\n    useFrame(() => {\r\n        if (propellerRef.current && active) {\r\n            // Spin propellers continuously, with variable speed\r\n            propellerRef.current.rotation.y += 0.5 * speed * direction;\r\n        }\r\n\r\n        if (propRef) {\r\n            propRef(propellerRef.current);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group position={position} scale={scale}>\r\n            {/* Motor housing - directly on arms */}\r\n            <mesh castShadow receiveShadow>\r\n                <cylinderGeometry args={[0.15, 0.18, 0.2, 12]} />\r\n                <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.3} />\r\n            </mesh>\r\n\r\n            {/* Motor top */}\r\n            <mesh castShadow position={[0, 0.12, 0]}>\r\n                <cylinderGeometry args={[0.12, 0.12, 0.05, 12]} />\r\n                <meshStandardMaterial color=\"#8d99ae\" metalness={0.8} roughness={0.2} />\r\n            </mesh>\r\n\r\n            {/* Propeller - using a more realistic shape with 25% smaller blades */}\r\n            <group ref={propellerRef} position={[0, 0.15, 0]}>\r\n                {/* First blade - 25% smaller */}\r\n                <mesh castShadow>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.45, 0.015, -0.075, 0.45, -0.015, 0.075,  // triangle 1\r\n                                0, 0, 0, 0.45, -0.015, 0.075, 0.9, 0, 0,        // triangle 2\r\n                                0, 0, 0, 0.9, 0, 0, 0.45, 0.015, -0.075,  // triangle 3\r\n                                0.45, 0.015, -0.075, 0.9, 0, 0, 0.45, -0.015, 0.075,  // triangle 4 (back face)\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n\r\n                {/* Second blade - rotated 180 degrees - 25% smaller */}\r\n                <mesh castShadow rotation={[0, Math.PI, 0]}>\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.5} roughness={0.6} />\r\n                    <bufferGeometry>\r\n                        <bufferAttribute\r\n                            attach=\"attributes-position\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 0, 0, 0.45, 0.015, -0.075, 0.45, -0.015, 0.075,  // triangle 1\r\n                                0, 0, 0, 0.45, -0.015, 0.075, 0.9, 0, 0,        // triangle 2\r\n                                0, 0, 0, 0.9, 0, 0, 0.45, 0.015, -0.075,  // triangle 3\r\n                                0.45, 0.015, -0.075, 0.9, 0, 0, 0.45, -0.015, 0.075,  // triangle 4 (back face)\r\n                            ])}\r\n                        />\r\n                        <bufferAttribute\r\n                            attach=\"attributes-normal\"\r\n                            count={12}\r\n                            itemSize={3}\r\n                            array={new Float32Array([\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, 1, 0, 0, 1, 0, 0, 1, 0,\r\n                                0, -1, 0, 0, -1, 0, 0, -1, 0,\r\n                            ])}\r\n                        />\r\n                    </bufferGeometry>\r\n                </mesh>\r\n\r\n                {/* Propeller center cap */}\r\n                <mesh>\r\n                    <sphereGeometry args={[0.06, 8, 8]} />\r\n                    <meshStandardMaterial color=\"#2b2d42\" metalness={0.7} roughness={0.2} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// Simplified landing leg component\r\nfunction LandingLeg({ position }) {\r\n    return (\r\n        <group position={position}>\r\n            {/* Vertical strut */}\r\n            <mesh castShadow>\r\n                <cylinderGeometry args={[0.04, 0.04, 0.6, 8]} />\r\n                <meshStandardMaterial color=\"#64748b\" metalness={0.6} roughness={0.4} />\r\n            </mesh>\r\n\r\n            {/* Foot pad */}\r\n            <mesh castShadow position={[0, -0.35, 0]}>\r\n                <sphereGeometry args={[0.08, 8, 8]} />\r\n                <meshStandardMaterial color=\"#475569\" metalness={0.4} roughness={0.6} />\r\n            </mesh>\r\n        </group>\r\n    );\r\n}\r\n\r\n// HUD component that will be used outside the Canvas\r\nexport function BomberHUD({ mineAmmo, mortarAmmo, rpgAmmo, showHUD }) {\r\n    if (!showHUD) return null;\r\n\r\n    return (\r\n        <div className=\"weapon-hud bomber-hud\">\r\n            <h2>BOMBER DRONE</h2>\r\n            <div className=\"weapon-list\">\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">MINE [{mineAmmo}]</span>\r\n                    <span className=\"weapon-key\">LMB</span>\r\n                </div>\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">MORTAR [{mortarAmmo}]</span>\r\n                    <span className=\"weapon-key\">RMB</span>\r\n                </div>\r\n                <div className=\"weapon-item\">\r\n                    <span className=\"weapon-name\">RPG [{rpgAmmo}]</span>\r\n                    <span className=\"weapon-key\">C</span>\r\n                </div>\r\n            </div>\r\n            <div className=\"view-toggle\">\r\n                <span>CAMERA VIEW TOGGLE: V</span>\r\n            </div>\r\n        </div>\r\n    );\r\n}","import React from 'react';\r\nimport { useDrones, DRONE_TYPES } from '../utils/GameContext';\r\nimport PlayerController from './player/PlayerController';\r\nimport Grenadier from './drones/Grenadier';\r\nimport Kamikaze from './drones/Kamikaze';\r\nimport Bomber from './drones/Bomber';\r\n\r\nexport default function DroneSwitcher({ world }) {\r\n  const { currentDrone } = useDrones();\r\n\r\n  // Render the appropriate drone based on the selection\r\n  switch (currentDrone) {\r\n    case DRONE_TYPES.PLAYER:\r\n      return <PlayerController world={world} />;\r\n    case DRONE_TYPES.KAMIKAZE:\r\n      return <Kamikaze />;\r\n    case DRONE_TYPES.BOMBER:\r\n      return <Bomber />;\r\n    case DRONE_TYPES.GRENADIER:\r\n    default:\r\n      return <Grenadier />;\r\n  }\r\n} ","import React from 'react';\r\n\r\nexport const TankA = (props) => (\r\n  <group {...props}>\r\n    {/* Main Hull - Using same hull as TankB */}\r\n    <mesh position={[0, 0.55, 0]}>\r\n      <boxGeometry args={[3.4, 0.9, 6.0]} />\r\n      <meshStandardMaterial color=\"#4B5320\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Lower hull/chassis - Same as TankB */}\r\n    <mesh position={[0, 0.2, 0]}>\r\n      <boxGeometry args={[3.5, 0.4, 6.1]} />\r\n      <meshStandardMaterial color=\"#485320\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Upper hull armor plating with beveled edges - Same as TankB */}\r\n    <mesh position={[0, 1.05, 0]}>\r\n      <boxGeometry args={[3.2, 0.2, 5.8]} />\r\n      <meshStandardMaterial color=\"#4D5522\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Track assemblies - left side - using TankB position */}\r\n    <group position={[-1.9, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 6.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.9]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.45, 0.45, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.91]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.395, 0.395, 0.62, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - more of them for realism */}\r\n      {[2.15, 1.5, 0.9, 0.3, -0.3, -0.9, -1.5, -2.15].map((z, i) => (\r\n        <mesh key={i} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n    </group>\r\n\r\n    {/* Track assemblies - right side (mirrored) - using TankB position */}\r\n    <group position={[1.9, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 6.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.9]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.45, 0.45, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.91]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.395, 0.395, 0.62, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - more of them for realism */}\r\n      {[2.15, 1.5, 0.9, 0.3, -0.3, -0.9, -1.5, -2.15].map((z, i) => (\r\n        <mesh key={i + 14} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n    </group>\r\n\r\n    {/* Track guards/mudguards - using TankB position and dimensions */}\r\n    <mesh position={[1.9, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 6.3]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.9, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 6.3]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Keeping TankA's original turret components but positioned for the new hull */}\r\n    {/* Turret base with realistic rotation ring */}\r\n    <mesh position={[0, 1.15, -0.5]}>\r\n      <cylinderGeometry args={[1.4, 1.4, 0.22, 24]} />\r\n      <meshStandardMaterial color=\"#4B5320\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Main turret body with angled armor */}\r\n    <mesh position={[0, 1.6, -0.5]}>\r\n      <boxGeometry args={[2.4, 0.77, 2.86]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.4} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Turret front slope */}\r\n    <mesh position={[0, 1.6, -1.8]} rotation={[-Math.PI / 6, 0, 0]}>\r\n      <boxGeometry args={[2.2, 0.77, 0.88]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.4} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Loader's hatch - now with smoother circular shape */}\r\n    <mesh position={[-0.6, 2.05, -0.2]}>\r\n      <cylinderGeometry args={[0.385, 0.385, 0.11, 24]} />\r\n      <meshStandardMaterial color=\"#3A3A3A\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Main gun assembly - adjusted position for the new hull height */}\r\n    <group position={[0, 1.6, -0.5]}>\r\n      {/* Gun mantlet */}\r\n      <mesh position={[0, 0, -1.32]}>\r\n        <boxGeometry args={[1.55, 0.88, 0.66]} />\r\n        <meshStandardMaterial color=\"#3A3A3A\" metalness={0.6} roughness={0.5} />\r\n      </mesh>\r\n\r\n      {/* Main gun barrel */}\r\n      <mesh position={[0, 0, -2.64]} rotation={[-Math.PI / 2, 0, 0]}>\r\n        <cylinderGeometry args={[0.18, 0.18, 6.05, 16]} />\r\n        <meshStandardMaterial color=\"#2A2A2A\" metalness={0.6} roughness={0.5} />\r\n      </mesh>\r\n\r\n      {/* Thermal sleeve */}\r\n      <mesh position={[0, 0, -1.98]} rotation={[-Math.PI / 2, 0, 0]}>\r\n        <cylinderGeometry args={[0.22, 0.22, 1.32, 16]} />\r\n        <meshStandardMaterial color=\"#3A3A3A\" metalness={0.4} roughness={0.7} />\r\n      </mesh>\r\n    </group>\r\n\r\n    {/* ERA blocks on hull front */}\r\n    {[-1.35, -0.8, -0.25, 0.25, 0.8, 1.35].map((x, i) => (\r\n      <mesh key={i + 32} position={[x, 0.75, 2.8]} rotation={[0, 0, 0]}>\r\n        <boxGeometry args={[0.4, 0.3, 0.2]} />\r\n        <meshStandardMaterial color=\"#5D6540\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n    ))}\r\n\r\n    {/* Side skirts - adjusted for new hull */}\r\n    <mesh position={[2.1, 0.4, 0]}>\r\n      <boxGeometry args={[0.1, 0.6, 5.8]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-2.1, 0.4, 0]}>\r\n      <boxGeometry args={[0.1, 0.6, 5.8]} />\r\n      <meshStandardMaterial color=\"#4F5D2F\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Additional side hull detail - adjusted for new hull */}\r\n    <mesh position={[1.85, 0.5, 0]}>\r\n      <boxGeometry args={[0.3, 0.6, 6.2]} />\r\n      <meshStandardMaterial color=\"#4A5128\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.85, 0.5, 0]}>\r\n      <boxGeometry args={[0.3, 0.6, 6.2]} />\r\n      <meshStandardMaterial color=\"#4A5128\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n  </group>\r\n);\r\n\r\nexport const TankB = (props) => (\r\n  <group {...props}>\r\n    {/* Main Hull - Using military green with realistic dimensions */}\r\n    <mesh position={[0, 0.55, 0]}>\r\n      <boxGeometry args={[3.4, 0.9, 6.0]} />\r\n      <meshStandardMaterial color=\"#3B4A32\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Lower hull/chassis */}\r\n    <mesh position={[0, 0.2, 0]}>\r\n      <boxGeometry args={[3.5, 0.4, 6.1]} />\r\n      <meshStandardMaterial color=\"#323D2A\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Upper hull armor plating with beveled edges */}\r\n    <mesh position={[0, 1.05, 0]}>\r\n      <boxGeometry args={[3.2, 0.2, 5.8]} />\r\n      <meshStandardMaterial color=\"#41503A\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Track assemblies - left side */}\r\n    <group position={[-1.9, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 6.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.9]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.45, 0.45, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.91]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.395, 0.395, 0.62, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - more of them for realism */}\r\n      {[2.15, 1.5, 0.9, 0.3, -0.3, -0.9, -1.5, -2.15].map((z, i) => (\r\n        <mesh key={i} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n\r\n\r\n    </group>\r\n\r\n    {/* Track assemblies - right side (mirrored) */}\r\n    <group position={[1.9, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 6.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.9]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.45, 0.45, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.91]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.395, 0.395, 0.62, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - more of them for realism */}\r\n      {[2.15, 1.5, 0.9, 0.3, -0.3, -0.9, -1.5, -2.15].map((z, i) => (\r\n        <mesh key={i + 14} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n\r\n\r\n    </group>\r\n\r\n    {/* Track guards/mudguards */}\r\n    <mesh position={[1.9, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 6.3]} />\r\n      <meshStandardMaterial color=\"#41503A\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.9, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 6.3]} />\r\n      <meshStandardMaterial color=\"#41503A\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Main turret body with improved shape */}\r\n    <mesh position={[0, 1.5, -0.2]} rotation={[0, 0, 0]}>\r\n      <boxGeometry args={[2.6, 0.6, 3.0]} />\r\n      <meshStandardMaterial color=\"#445139\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Turret front slope */}\r\n    <mesh position={[0, 1.5, -1.6]} rotation={[-Math.PI / 6, 0, 0]}>\r\n      <boxGeometry args={[2.4, 0.6, 0.8]} />\r\n      <meshStandardMaterial color=\"#465339\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Turret rear with stowage rack */}\r\n    <mesh position={[0, 1.5, 1.4]}>\r\n      <boxGeometry args={[2.4, 0.5, 0.3]} />\r\n      <meshStandardMaterial color=\"#404D39\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Loader's hatch */}\r\n    <mesh position={[-0.6, 1.85, -0.5]}>\r\n      <cylinderGeometry args={[0.4, 0.4, 0.15, 16]} />\r\n      <meshStandardMaterial color=\"#394431\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Main gun mantlet (thick armor around gun) */}\r\n    <mesh position={[0, 1.5, -1.9]}>\r\n      <boxGeometry args={[1.3, 0.7, 0.6]} />\r\n      <meshStandardMaterial color=\"#3D4935\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Main gun barrel */}\r\n    <mesh position={[0, 1.5, -3.8]} rotation={[-Math.PI / 2, 0, 0]}>\r\n      <cylinderGeometry args={[0.18, 0.18, 3.0, 16]} />\r\n      <meshStandardMaterial color=\"#2A2A2A\" metalness={0.6} roughness={0.5} />\r\n    </mesh>\r\n\r\n    {/* Thermal sleeve on barrel */}\r\n    <mesh position={[0, 1.5, -2.8]} rotation={[-Math.PI / 2, 0, 0]}>\r\n      <cylinderGeometry args={[0.22, 0.22, 1.2, 16]} />\r\n      <meshStandardMaterial color=\"#252525\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n  </group>\r\n);\r\n\r\nexport default { TankA, TankB };","import React from 'react';\r\n\r\n/* IFV Vehicle Designs */\r\nexport const IFV_A = (props) => (\r\n  <group {...props}>\r\n    {/* Base hull with realistic proportions - extended length */}\r\n    <mesh position={[0, 0.4, 0.4]}>\r\n      <boxGeometry args={[2.4, 0.6, 5.0]} />\r\n      <meshStandardMaterial color=\"#485142\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Lower hull/chassis - extended length */}\r\n    <mesh position={[0, 0.2, 0.4]}>\r\n      <boxGeometry args={[2.5, 0.4, 3.0]} />\r\n      <meshStandardMaterial color=\"#445029\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Sloped front glacis plate */}\r\n    <mesh position={[0, 0.5, -2.0]} rotation={[-Math.PI / 4, 0, 0]}>\r\n      <boxGeometry args={[2.2, 0.7, 0.8]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Upper hull structure with extended troop compartment */}\r\n    <mesh position={[0, 0.9, 0.8]}>\r\n      <boxGeometry args={[2.2, 0.6, 4.4]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.3} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Track assemblies - left side - extended length */}\r\n    <group position={[-1.3, 0.3, 0.4]}>\r\n      {/* Track body - extended length */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 5.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket - moved forward*/}\r\n      <mesh position={[0, 0, -2.5]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.35, 0.35, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel - moved backward */}\r\n      <mesh position={[0, 0, 2.5]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.32, 0.32, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - repositioned for longer track */}\r\n      {[1.8, 0.9, 0, -0.9, -1.8].map((z, i) => (\r\n        <mesh key={i} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n\r\n\r\n    </group>\r\n\r\n    {/* Track assemblies - right side - extended length */}\r\n    <group position={[1.3, 0.3, 0.4]}>\r\n      {/* Track body - extended length */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 5.2]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket - moved forward */}\r\n      <mesh position={[0, 0, -2.5]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.35, 0.35, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel - moved backward */}\r\n      <mesh position={[0, 0, 2.5]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.32, 0.32, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels - repositioned for longer track */}\r\n      {[1.8, 0.9, 0, -0.9, -1.8].map((z, i) => (\r\n        <mesh key={i + 14} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n\r\n\r\n    </group>\r\n\r\n    {/* Track guards/mudguards - extended length */}\r\n    <mesh position={[1.3, 0.65, 0.4]}>\r\n      <boxGeometry args={[0.7, 0.1, 5.3]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.3, 0.65, 0.4]}>\r\n      <boxGeometry args={[0.7, 0.1, 5.3]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Turret base with rotation ring - same position */}\r\n    <mesh position={[0, 1.2, -0.4]}>\r\n      <cylinderGeometry args={[0.9, 0.9, 0.15, 24]} />\r\n      <meshStandardMaterial color=\"#424739\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Main turret body - same position */}\r\n    <mesh position={[0, 1.5, -0.4]}>\r\n      <boxGeometry args={[1.8, 0.5, 1.6]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.4} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Turret front slope - same position */}\r\n    <mesh position={[0, 1.5, -1.1]} rotation={[-Math.PI / 6, 0, 0]}>\r\n      <boxGeometry args={[1.6, 0.5, 0.6]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.4} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Loader's hatch - similar to tanks */}\r\n    <mesh position={[-0.5, 1.8, -0.4]}>\r\n      <cylinderGeometry args={[0.28, 0.28, 0.08, 24]} />\r\n      <meshStandardMaterial color=\"#3A3A3A\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Main gun assembly - same position */}\r\n    <group position={[0, 1.5, -0.4]}>\r\n      {/* Gun mantlet */}\r\n      <mesh position={[0, 0, -0.8]}>\r\n        <boxGeometry args={[1.0, 0.6, 0.4]} />\r\n        <meshStandardMaterial color=\"#3A3A3A\" metalness={0.6} roughness={0.5} />\r\n      </mesh>\r\n\r\n      {/* Main gun */}\r\n      <mesh position={[0, 0, -2.0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n        <cylinderGeometry args={[0.12, 0.12, 2.4, 16]} />\r\n        <meshStandardMaterial color=\"#2A2A2A\" metalness={0.6} roughness={0.5} />\r\n      </mesh>\r\n\r\n      {/* Thermal sleeve */}\r\n      <mesh position={[0, 0, -1.4]} rotation={[-Math.PI / 2, 0, 0]}>\r\n        <cylinderGeometry args={[0.15, 0.15, 1.2, 16]} />\r\n        <meshStandardMaterial color=\"#3A3A3A\" metalness={0.4} roughness={0.7} />\r\n      </mesh>\r\n    </group>\r\n\r\n    {/* Troop compartment details - extended */}\r\n    {/* Side armor plates - extended */}\r\n    <mesh position={[1.2, 0.7, 0.8]}>\r\n      <boxGeometry args={[0.1, 0.8, 3.8]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.2, 0.7, 0.8]}>\r\n      <boxGeometry args={[0.1, 0.8, 3.8]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Extended rear compartment */}\r\n    <mesh position={[0, 0.9, 2.2]}>\r\n      <boxGeometry args={[2.2, 0.8, 1.6]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.3} roughness={0.6} />\r\n    </mesh>\r\n\r\n\r\n\r\n  </group>\r\n);\r\n\r\n/* IFV Design B  A modern Infantry Fighting Vehicle with realistic proportions and details */\r\nexport const IFV_B = (props) => (\r\n  <group {...props}>\r\n    {/* Main hull with realistic proportions */}\r\n    <mesh position={[0, 0.35, 0]}>\r\n      <boxGeometry args={[2.4, 0.6, 4.4]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Sloped front glacis plate */}\r\n    <mesh position={[0, 0.55, 2.0]} rotation={[Math.PI / 5, 0, 0]}>\r\n      <boxGeometry args={[2.4, 0.8, 0.8]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Upper hull with angled sides for better protection */}\r\n    <mesh position={[0, 0.8, 0.2]}>\r\n      <boxGeometry args={[2.2, 0.5, 3.6]} />\r\n      <meshStandardMaterial color=\"#515749\" metalness={0.3} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Track assemblies - left side (same as IFV_A) */}\r\n    <group position={[-1.3, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 4.4]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.1]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.35, 0.35, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.1]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.32, 0.32, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels */}\r\n      {[1.4, 0.7, 0, -0.7, -1.4].map((z, i) => (\r\n        <mesh key={i} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n    </group>\r\n\r\n    {/* Track assemblies - right side (same as IFV_A) */}\r\n    <group position={[1.3, 0.3, 0]}>\r\n      {/* Track body */}\r\n      <mesh position={[0, 0, 0]}>\r\n        <boxGeometry args={[0.6, 0.6, 4.4]} />\r\n        <meshStandardMaterial color=\"#252525\" metalness={0.3} roughness={0.8} />\r\n      </mesh>\r\n\r\n      {/* Drive sprocket */}\r\n      <mesh position={[0, 0, -2.1]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.35, 0.35, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Idler wheel */}\r\n      <mesh position={[0, 0, 2.1]} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.32, 0.32, 0.65, 16]} />\r\n        <meshStandardMaterial color=\"#1A1A1A\" metalness={0.5} roughness={0.7} />\r\n      </mesh>\r\n\r\n      {/* Road wheels */}\r\n      {[1.4, 0.7, 0, -0.7, -1.4].map((z, i) => (\r\n        <mesh key={i + 14} position={[0, -0.15, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.3, 0.3, 0.65, 16]} />\r\n          <meshStandardMaterial color=\"#202020\" metalness={0.5} roughness={0.6} />\r\n        </mesh>\r\n      ))}\r\n    </group>\r\n\r\n    {/* Track guards/mudguards (same as IFV_A) */}\r\n    <mesh position={[1.3, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 4.5]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n    <mesh position={[-1.3, 0.65, 0]}>\r\n      <boxGeometry args={[0.7, 0.1, 4.5]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.3} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Enhanced turret base with realistic ring */}\r\n    <mesh position={[0, 1.05, -0.6]}>\r\n      <cylinderGeometry args={[1.1, 1.1, 0.15, 32]} />\r\n      <meshStandardMaterial color=\"#3F4438\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Main turret body with modern angular armor */}\r\n    <mesh position={[0, 1.4, -0.6]}>\r\n      <boxGeometry args={[1.8, 0.6, 2.0]} />\r\n      <meshStandardMaterial color=\"#4A5144\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Turret front with composite armor spacing */}\r\n    <mesh position={[0, 1.4, -1.5]} rotation={[Math.PI / 8, 0, 0]}>\r\n      <boxGeometry args={[1.8, 0.6, 0.8]} />\r\n      <meshStandardMaterial color=\"#4D5446\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n    {/* Loader's hatch - similar to tanks */}\r\n    <mesh position={[-0.5, 1.7, -0.4]}>\r\n      <cylinderGeometry args={[0.28, 0.28, 0.08, 24]} />\r\n      <meshStandardMaterial color=\"#3A3A3A\" metalness={0.5} roughness={0.6} />\r\n    </mesh>\r\n\r\n    {/* Main gun with thermal sleeve */}\r\n    <mesh position={[0, 1.4, -2.4]} rotation={[Math.PI / 2, 0, 0]}>\r\n      <cylinderGeometry args={[0.15, 0.15, 2.2, 24]} />\r\n      <meshStandardMaterial color=\"#252525\" metalness={0.6} roughness={0.5} />\r\n    </mesh>\r\n\r\n    {/* Gun thermal sleeve */}\r\n    <mesh position={[0, 1.4, -1.8]} rotation={[Math.PI / 2, 0, 0]}>\r\n      <cylinderGeometry args={[0.18, 0.18, 1.0, 24]} />\r\n      <meshStandardMaterial color=\"#303030\" metalness={0.4} roughness={0.8} />\r\n    </mesh>\r\n\r\n    {/* Rear troop compartment details */}\r\n    <mesh position={[0, 1.0, 1.0]}>\r\n      <boxGeometry args={[2.0, 0.4, 1.8]} />\r\n      <meshStandardMaterial color=\"#485142\" metalness={0.4} roughness={0.7} />\r\n    </mesh>\r\n\r\n  </group>\r\n);\r\n\r\nexport default { IFV_A, IFV_B }; ","import React from 'react';\r\nimport * as THREE from 'three';\r\n\r\n// Shared materials to improve performance\r\nconst SHARED_MATERIALS = {\r\n  black: new THREE.MeshStandardMaterial({ color: \"#222\" }),\r\n  darkGray: new THREE.MeshStandardMaterial({ color: \"#444\" }),\r\n  oliveGreen: new THREE.MeshStandardMaterial({ color: \"#4d5d28\" }),\r\n  midBlue: new THREE.MeshStandardMaterial({ color: \"#3498DB\" }),\r\n  purple: new THREE.MeshStandardMaterial({ color: \"#9B59B6\" }),\r\n  headlight: new THREE.MeshStandardMaterial({\r\n    color: \"#FFFFFF\",\r\n    emissive: \"#FFFFCC\",\r\n    emissiveIntensity: 0.5\r\n  }),\r\n  windshield: new THREE.MeshStandardMaterial({\r\n    color: \"#87CEEB\",\r\n    transparent: true,\r\n    opacity: 0.7\r\n  })\r\n};\r\n\r\n/* Civilian Truck Vehicles */\r\n/* Civilian Truck 1  A simplified two-part truck with a cab and trailer */\r\nexport const CivilianTruck1 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab */}\r\n    <group position={[0, 0.75, -2.2]}>\r\n      <mesh>\r\n        <boxGeometry args={[2, 1.3, 1.8]} />\r\n        <meshStandardMaterial color=\"#778899\" />\r\n      </mesh>\r\n      {/* Windshield */}\r\n      <mesh position={[0, 0.3, -0.9]}>\r\n        <boxGeometry args={[1.6, 0.4, 0.1]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.windshield} />\r\n      </mesh>\r\n      {/* Headlights */}\r\n      <mesh position={[0, -0.3, -0.95]}>\r\n        <boxGeometry args={[1.2, 0.2, 0.05]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.headlight} />\r\n      </mesh>\r\n    </group>\r\n    {/* Cargo area */}\r\n    <group position={[0, 0.85, 0.8]}>\r\n      <mesh>\r\n        <boxGeometry args={[2.2, 1.5, 3.8]} />\r\n        <meshStandardMaterial color=\"#A9A9A9\" />\r\n      </mesh>\r\n      {/* Decorative stripe */}\r\n      <mesh position={[0, -0.4, 0]}>\r\n        <boxGeometry args={[2.25, 0.1, 3.85]} />\r\n        <meshStandardMaterial color=\"#CBD5E0\" /> {/* Light gray */}\r\n      </mesh>\r\n    </group>\r\n    {/* Wheels - thinner width */}\r\n    {[\r\n      { pos: [-1.0, 0.4, -2.2] },\r\n      { pos: [1.0, 0.4, -2.2] },\r\n      { pos: [-1.1, 0.4, 0.6] },\r\n      { pos: [1.1, 0.4, 0.6] },\r\n      { pos: [-1.1, 0.4, 2] },\r\n      { pos: [1.1, 0.4, 2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.4, 0.4, 0.22, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n\r\n    {/* Named mesh for hit detection */}\r\n    <mesh position={[0, 0, 0]} visible={false} name=\"body\">\r\n      <boxGeometry args={[2.2, 1.5, 5.0]} />\r\n      <meshStandardMaterial color=\"red\" wireframe opacity={0.1} transparent />\r\n    </mesh>\r\n  </group>\r\n);\r\n\r\n/* Civilian Truck 2  A simplified modern truck with integrated design */\r\nexport const CivilianTruck2 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab */}\r\n    <group position={[0, 0.75, -2.2]}>\r\n      <mesh>\r\n        <boxGeometry args={[2, 1.3, 1.8]} />\r\n        <meshStandardMaterial color=\"#708090\" />\r\n      </mesh>\r\n      {/* Windshield */}\r\n      <mesh position={[0, 0.3, -0.9]}>\r\n        <boxGeometry args={[1.6, 0.4, 0.1]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.windshield} />\r\n      </mesh>\r\n      {/* Headlights */}\r\n      <mesh position={[0, -0.3, -0.95]}>\r\n        <boxGeometry args={[1.2, 0.2, 0.05]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.headlight} />\r\n      </mesh>\r\n    </group>\r\n    {/* Cargo area */}\r\n    <group position={[0, 0.85, 0.8]}>\r\n      <mesh>\r\n        <boxGeometry args={[2.2, 1.5, 3.8]} />\r\n        <meshStandardMaterial color=\"#696969\" />\r\n      </mesh>\r\n      {/* Decorative stripe */}\r\n      <mesh position={[0, -0.4, 0]}>\r\n        <boxGeometry args={[2.25, 0.1, 3.85]} />\r\n        <meshStandardMaterial color=\"#CBD5E0\" /> {/* Light gray */}\r\n      </mesh>\r\n    </group>\r\n    {/* Wheels - thinner width */}\r\n    {[\r\n      { pos: [-1.0, 0.4, -2.2] },\r\n      { pos: [1.0, 0.4, -2.2] },\r\n      { pos: [-1.1, 0.4, 0.6] },\r\n      { pos: [1.1, 0.4, 0.6] },\r\n      { pos: [-1.1, 0.4, 2] },\r\n      { pos: [1.1, 0.4, 2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.4, 0.4, 0.22, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n\r\n    {/* Named mesh for hit detection */}\r\n    <mesh position={[0, 0, 0]} visible={false} name=\"body\">\r\n      <boxGeometry args={[2.2, 1.5, 5.0]} />\r\n      <meshStandardMaterial color=\"red\" wireframe opacity={0.1} transparent />\r\n    </mesh>\r\n  </group>\r\n);\r\n\r\n/* Civilian Truck 3  A design similar to Truck 2 but with different colors */\r\nexport const CivilianTruck3 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab */}\r\n    <group position={[0, 0.75, -2.2]}>\r\n      <mesh>\r\n        <boxGeometry args={[2, 1.3, 1.8]} />\r\n        <meshStandardMaterial color=\"#7D7D7D\" /> {/* Lighter grey */}\r\n      </mesh>\r\n      {/* Windshield */}\r\n      <mesh position={[0, 0.3, -0.9]}>\r\n        <boxGeometry args={[1.6, 0.4, 0.1]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.windshield} />\r\n      </mesh>\r\n      {/* Headlights */}\r\n      <mesh position={[0, -0.3, -0.95]}>\r\n        <boxGeometry args={[1.2, 0.2, 0.05]} />\r\n        <meshStandardMaterial {...SHARED_MATERIALS.headlight} />\r\n      </mesh>\r\n    </group>\r\n    {/* Cargo area */}\r\n    <group position={[0, 0.85, 0.8]}>\r\n      <mesh>\r\n        <boxGeometry args={[2.2, 1.5, 3.8]} />\r\n        <meshStandardMaterial color=\"#2C5282\" /> {/* Darker blue */}\r\n      </mesh>\r\n      {/* Decorative stripe */}\r\n      <mesh position={[0, -0.4, 0]}>\r\n        <boxGeometry args={[2.25, 0.1, 3.85]} />\r\n        <meshStandardMaterial color=\"#CBD5E0\" /> {/* Light gray */}\r\n      </mesh>\r\n    </group>\r\n    {/* Wheels - thinner width */}\r\n    {[\r\n      { pos: [-1.0, 0.4, -2.2] },\r\n      { pos: [1.0, 0.4, -2.2] },\r\n      { pos: [-1.1, 0.4, 0.6] },\r\n      { pos: [1.1, 0.4, 0.6] },\r\n      { pos: [-1.1, 0.4, 2] },\r\n      { pos: [1.1, 0.4, 2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.4, 0.4, 0.22, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n\r\n    {/* Named mesh for hit detection */}\r\n    <mesh position={[0, 0, 0]} visible={false} name=\"body\">\r\n      <boxGeometry args={[2.2, 1.5, 5.0]} />\r\n      <meshStandardMaterial color=\"red\" wireframe opacity={0.1} transparent />\r\n    </mesh>\r\n  </group>\r\n);\r\n\r\n/* Military Truck Vehicles */\r\n\r\n/* Military Truck 1  A heavily armored truck with reinforced plating and visible mechanical details */\r\nexport const MilitaryTruck1 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab section - raised slightly */}\r\n    <mesh position={[0, 0.8, -2]}>\r\n      <boxGeometry args={[1.8, 1.4, 1.8]} />\r\n      <meshStandardMaterial color=\"#556B2F\" />\r\n    </mesh>\r\n    {/* Main cargo/troop section - raised slightly */}\r\n    <mesh position={[0, 0.8, 0.8]}>\r\n      <boxGeometry args={[1.8, 1.4, 3.6]} />\r\n      <meshStandardMaterial color=\"#556B2F\" />\r\n    </mesh>\r\n    {/* Additional armor layer - fixed position to prevent z-fighting */}\r\n    <mesh position={[0, 1.51, -2]}>\r\n      <boxGeometry args={[1.7, 0.25, 1.7]} />\r\n      <meshStandardMaterial color=\"#6B8E23\" />\r\n    </mesh>\r\n    <mesh position={[0, 1.51, 0.8]}>\r\n      <boxGeometry args={[1.7, 0.25, 3.5]} />\r\n      <meshStandardMaterial color=\"#6B8E23\" />\r\n    </mesh>\r\n\r\n    {/* Side armor panels - raised slightly */}\r\n    <mesh position={[-1.0, 0.8, -2]}>\r\n      <boxGeometry args={[0.15, 1.2, 1.8]} />\r\n      <meshStandardMaterial color=\"#4d5d28\" />\r\n    </mesh>\r\n    <mesh position={[1.0, 0.8, -2]}>\r\n      <boxGeometry args={[0.15, 1.2, 1.8]} />\r\n      <meshStandardMaterial color=\"#4d5d28\" />\r\n    </mesh>\r\n    <mesh position={[-1.0, 0.8, 0.8]}>\r\n      <boxGeometry args={[0.15, 1.2, 3.6]} />\r\n      <meshStandardMaterial color=\"#4d5d28\" />\r\n    </mesh>\r\n    <mesh position={[1.0, 0.8, 0.8]}>\r\n      <boxGeometry args={[0.15, 1.2, 3.6]} />\r\n      <meshStandardMaterial color=\"#4d5d28\" />\r\n    </mesh>\r\n\r\n    {/* Smaller wheels - keeping the same height */}\r\n    {[\r\n      { pos: [-0.9, 0.4, -2] },\r\n      { pos: [0.9, 0.4, -2] },\r\n      { pos: [-0.9, 0.4, 0] },\r\n      { pos: [0.9, 0.4, 0] },\r\n      { pos: [-0.9, 0.4, 1.6] },\r\n      { pos: [0.9, 0.4, 1.6] },\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.35, 0.35, 0.25, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\n/* Military Truck 2  A simplified rugged design with less detail */\r\nexport const MilitaryTruck2 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab section - raised slightly */}\r\n    <mesh position={[0, 0.7, -2.2]}>\r\n      <boxGeometry args={[1.8, 1.2, 1.9]} />\r\n      <meshStandardMaterial color=\"#4B5320\" /> {/* Olive drab */}\r\n    </mesh>\r\n    {/* Main cargo/troop section - raised slightly */}\r\n    <mesh position={[0, 0.7, 0.9]}>\r\n      <boxGeometry args={[1.8, 1.2, 3.8]} />\r\n      <meshStandardMaterial color=\"#4B5320\" /> {/* Olive drab */}\r\n    </mesh>\r\n\r\n    {/* Armor plating overlay - raised slightly */}\r\n    <mesh position={[0, 1.4, -2.2]}>\r\n      <boxGeometry args={[1.9, 0.3, 2]} />\r\n      <meshStandardMaterial color=\"#5E6142\" /> {/* Darker olive */}\r\n    </mesh>\r\n    <mesh position={[0, 1.4, 0.9]}>\r\n      <boxGeometry args={[1.9, 0.3, 3.9]} />\r\n      <meshStandardMaterial color=\"#5E6142\" /> {/* Darker olive */}\r\n    </mesh>\r\n    {/* Reinforced bumper - raised slightly */}\r\n    <mesh position={[0, 0.5, -3.2]}>\r\n      <boxGeometry args={[1.9, 0.6, 0.2]} />\r\n      <meshStandardMaterial color=\"#3A3A3A\" /> {/* Dark gunmetal */}\r\n    </mesh>\r\n    {/* Simplified side-mounted equipment - raised slightly */}\r\n    <mesh position={[-1.0, 0.8, -2.2]}>\r\n      <boxGeometry args={[0.2, 0.4, 1.8]} />\r\n      <meshStandardMaterial color=\"#3D3D29\" /> {/* Dark khaki */}\r\n    </mesh>\r\n    <mesh position={[1.0, 0.8, -2.2]}>\r\n      <boxGeometry args={[0.2, 0.4, 1.8]} />\r\n      <meshStandardMaterial color=\"#3D3D29\" /> {/* Dark khaki */}\r\n    </mesh>\r\n    <mesh position={[-1.0, 0.8, 0.9]}>\r\n      <boxGeometry args={[0.2, 0.4, 3.6]} />\r\n      <meshStandardMaterial color=\"#3D3D29\" /> {/* Dark khaki */}\r\n    </mesh>\r\n    <mesh position={[1.0, 0.8, 0.9]}>\r\n      <boxGeometry args={[0.2, 0.4, 3.6]} />\r\n      <meshStandardMaterial color=\"#3D3D29\" /> {/* Dark khaki */}\r\n    </mesh>\r\n\r\n    {/* Front wheels - smaller - keeping the same height */}\r\n    {[\r\n      { pos: [-0.9, 0.4, -2.2] },\r\n      { pos: [0.9, 0.4, -2.2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.36, 0.36, 0.25, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n    {/* Rear wheels - dual wheel setup - smaller - keeping the same height */}\r\n    {[\r\n      { pos: [-0.9, 0.4, 0.6] },\r\n      { pos: [0.9, 0.4, 0.6] },\r\n      { pos: [-0.9, 0.4, 2] },\r\n      { pos: [0.9, 0.4, 2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i + 2} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.36, 0.36, 0.25, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\n/* Military Truck 3  A tactical truck with a reinforced top and additional equipment mounts */\r\nexport const MilitaryTruck3 = (props) => (\r\n  <group {...props}>\r\n    {/* Cab section - raised slightly */}\r\n    <mesh position={[0, 0.75, -2]}>\r\n      <boxGeometry args={[1.8, 1.1, 1.8]} />\r\n      <meshStandardMaterial color=\"#5D5D3C\" /> {/* Military tan/olive */}\r\n    </mesh>\r\n    {/* Cargo/troop section - raised slightly */}\r\n    <mesh position={[0, 0.75, 0.8]}>\r\n      <boxGeometry args={[1.8, 1.1, 3.6]} />\r\n      <meshStandardMaterial color=\"#5D5D3C\" /> {/* Military tan/olive */}\r\n    </mesh>\r\n    {/* Reinforced roof - raised slightly */}\r\n    <mesh position={[0, 1.45, -2]}>\r\n      <boxGeometry args={[1.9, 0.3, 1.9]} />\r\n      <meshStandardMaterial color=\"#6E7B58\" /> {/* Lighter olive */}\r\n    </mesh>\r\n    <mesh position={[0, 1.45, 0.8]}>\r\n      <boxGeometry args={[1.9, 0.3, 3.7]} />\r\n      <meshStandardMaterial color=\"#6E7B58\" /> {/* Lighter olive */}\r\n    </mesh>\r\n\r\n\r\n    {/* Side storage boxes - raised slightly */}\r\n    <mesh position={[-1.0, 0.7, -2]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.6]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    <mesh position={[1.0, 0.7, -2]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.6]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    <mesh position={[-1.0, 0.7, 0]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.8]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    <mesh position={[1.0, 0.7, 0]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.8]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    <mesh position={[-1.0, 0.7, 1.8]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.8]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    <mesh position={[1.0, 0.7, 1.8]}>\r\n      <boxGeometry args={[0.2, 0.5, 1.8]} />\r\n      <meshStandardMaterial color=\"#515141\" /> {/* Dark olive drab */}\r\n    </mesh>\r\n    {/* Front wheels - smaller - keeping the same height */}\r\n    {[\r\n      { pos: [-0.9, 0.4, -2] },\r\n      { pos: [0.9, 0.4, -2] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.33, 0.33, 0.25, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n    {/* Middle and rear wheels - smaller - keeping the same height */}\r\n    {[\r\n      { pos: [-0.9, 0.4, 0] },\r\n      { pos: [0.9, 0.4, 0] },\r\n      { pos: [-0.9, 0.4, 1.8] },\r\n      { pos: [0.9, 0.4, 1.8] }\r\n    ].map((wheel, i) => (\r\n      <mesh key={i + 2} position={wheel.pos} rotation={[0, 0, Math.PI / 2]}>\r\n        <cylinderGeometry args={[0.33, 0.33, 0.25, 8]} />\r\n        <meshStandardMaterial color=\"#222\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\nexport const civilianTrucks = { CivilianTruck1, CivilianTruck2, CivilianTruck3 };\r\nexport const militaryTrucks = { MilitaryTruck1, MilitaryTruck2, MilitaryTruck3 };\r\n\r\nexport default { ...civilianTrucks, ...militaryTrucks }; ","import React from 'react';\r\n\r\n/* Car Vehicles */\r\nexport const CarA = (props) => (\r\n  <group {...props}>\r\n    {/* Car body with subtle curves */}\r\n    <mesh position={[0, 0.41, 0]}>\r\n      <boxGeometry args={[1.8, 0.81, 3.6]} />\r\n      <meshStandardMaterial color=\"#0000CD\" />\r\n    </mesh>\r\n    {/* Detailed front grille */}\r\n    <mesh position={[0, 0.54, -1.71]}>\r\n      <boxGeometry args={[1.62, 0.18, 0.09]} />\r\n      <meshStandardMaterial color=\"#333\" />\r\n    </mesh>\r\n    {/* Headlights - boxGeometry style */}\r\n    {[-0.72, 0.72].map((x, i) => (\r\n      <mesh key={`hl-${i}`} position={[x, 0.61, -1.8]}>\r\n        <boxGeometry args={[0.35, 0.18, 0.08]} />\r\n        <meshStandardMaterial color=\"#FFFACD\" emissive=\"#FFFF66\" />\r\n      </mesh>\r\n    ))}\r\n    {/* Wheels */}\r\n    {[-0.95, 0.95].map((x, i) =>\r\n      [-1.35, 1.35].map((z, j) => (\r\n        <mesh key={`${i}-${j}`} position={[x, 0.22, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.25, 0.25, 0.14, 24]} />\r\n          <meshStandardMaterial color=\"#222\" />\r\n        </mesh>\r\n      ))\r\n    )}\r\n  </group>\r\n);\r\n\r\nexport const CarB = (props) => (\r\n  <group {...props}>\r\n    {/* Hatchback body with a sloping roof */}\r\n    <mesh position={[0, 0.45, 0]}>\r\n      <boxGeometry args={[1.98, 0.9, 3.78]} />\r\n      <meshStandardMaterial color=\"#1E90FF\" />\r\n    </mesh>\r\n    {/* Small front grille */}\r\n    <mesh position={[0, 0.39, -1.89]}>\r\n      <boxGeometry args={[1.3, 0.15, 0.08]} />\r\n      <meshStandardMaterial color=\"#333\" />\r\n    </mesh>\r\n    {/* Side accent stripe */}\r\n    <mesh position={[0, 0.81, 0]}>\r\n      <boxGeometry args={[1.8, 0.09, 0.09]} />\r\n      <meshStandardMaterial color=\"#FF4500\" />\r\n    </mesh>\r\n    {/* Detailed wheel setup */}\r\n    {[-1.05, 1.05].map((x, i) =>\r\n      [-1.4, 1.4].map((z, j) => (\r\n        <mesh key={`${i}-${j}`} position={[x, 0.25, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.27, 0.27, 0.15, 24]} />\r\n          <meshStandardMaterial color=\"#222\" />\r\n        </mesh>\r\n      ))\r\n    )}\r\n    {/* Headlights - boxGeometry style */}\r\n    {[-0.72, 0.72].map((x, i) => (\r\n      <mesh key={`hlb-${i}`} position={[x, 0.66, -1.89]}>\r\n        <boxGeometry args={[0.35, 0.18, 0.08]} />\r\n        <meshStandardMaterial color=\"#FFFACD\" emissive=\"#FFFF66\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\nexport const CarC = (props) => (\r\n  <group {...props}>\r\n    {/* Car body with a tapered design */}\r\n    <mesh position={[0, 0.41, 0]}>\r\n      <boxGeometry args={[1.62, 0.72, 3.42]} />\r\n      <meshStandardMaterial color=\"#FFD700\" />\r\n    </mesh>\r\n    {/* Front splitter */}\r\n    <mesh position={[0, 0.36, -1.76]}>\r\n      <boxGeometry args={[1.44, 0.09, 0.27]} />\r\n      <meshStandardMaterial color=\"#333\" />\r\n    </mesh>\r\n    {/* Rear spoiler */}\r\n    <mesh position={[0, 0.72, 1.71]} rotation={[-0.2, 0, 0]}>\r\n      <boxGeometry args={[0.9, 0.09, 0.36]} />\r\n      <meshStandardMaterial color=\"#333\" />\r\n    </mesh>\r\n    {/* Wheels */}\r\n    {[-0.9, 0.9].map((x, i) =>\r\n      [-1.3, 1.3].map((z, j) => (\r\n        <mesh key={`${i}-${j}`} position={[x, 0.22, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.25, 0.25, 0.14, 24]} />\r\n          <meshStandardMaterial color=\"#222\" />\r\n        </mesh>\r\n      ))\r\n    )}\r\n    {/* Headlights - boxGeometry style */}\r\n    {[-0.62, 0.62].map((x, i) => (\r\n      <mesh key={`hlc-${i}`} position={[x, 0.61, -1.8]}>\r\n        <boxGeometry args={[0.35, 0.18, 0.08]} />\r\n        <meshStandardMaterial color=\"#FFFACD\" emissive=\"#FFFF66\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\nexport const CarD = (props) => (\r\n  <group {...props}>\r\n    {/* SUV-style body with taller profile, adjusted to match other cars but with 20% more height */}\r\n    <mesh position={[0, 0.45, 0]}>\r\n      <boxGeometry args={[1.8, 0.97, 3.6]} />\r\n      <meshStandardMaterial color=\"#1A4731\" />\r\n    </mesh>\r\n    {/* Roof rails */}\r\n    {[-0.75, 0.75].map((x, i) => (\r\n      <mesh key={`rail-${i}`} position={[x, 0.94, 0]}>\r\n        <boxGeometry args={[0.09, 0.09, 3.0]} />\r\n        <meshStandardMaterial color=\"#444\" />\r\n      </mesh>\r\n    ))}\r\n    {/* Rugged wheel setup */}\r\n    {[-0.98, 0.98].map((x, i) =>\r\n      [-1.35, 1.35].map((z, j) => (\r\n        <mesh key={`${i}-${j}`} position={[x, 0.28, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.28, 0.28, 0.16, 24]} />\r\n          <meshStandardMaterial color=\"#111\" />\r\n        </mesh>\r\n      ))\r\n    )}\r\n    {/* Headlights - smaller and similar to other cars */}\r\n    {[-0.72, 0.72].map((x, i) => (\r\n      <mesh key={`hld-${i}`} position={[x, 0.61, -1.8]}>\r\n        <boxGeometry args={[0.35, 0.18, 0.08]} />\r\n        <meshStandardMaterial color=\"#FFFACD\" emissive=\"#FFFF66\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\nexport const CarE = (props) => (\r\n  <group {...props}>\r\n    {/* Sports coupe with low profile - even lower */}\r\n    <mesh position={[0, 0.29, 0]}>\r\n      <boxGeometry args={[1.89, 0.51, 3.78]} />\r\n      <meshStandardMaterial color=\"#8B0000\" />\r\n    </mesh>\r\n    {/* Sloped windshield */}\r\n    <mesh position={[0, 0.51, -0.72]} rotation={[0.4, 0, 0]}>\r\n      <boxGeometry args={[1.8, 0.59, 0.09]} />\r\n      <meshStandardMaterial color=\"#87CEEB\" transparent opacity={0.7} />\r\n    </mesh>\r\n    {/* Hood air intake */}\r\n    <mesh position={[0, 0.36, -1.35]}>\r\n      <boxGeometry args={[0.72, 0.07, 0.72]} />\r\n      <meshStandardMaterial color=\"#111\" />\r\n    </mesh>\r\n    {/* Performance wheels - adjusted to be more visible but smaller */}\r\n    {[-0.98, 0.98].map((x, i) =>\r\n      [-1.4, 1.4].map((z, j) => (\r\n        <mesh key={`${i}-${j}`} position={[x, 0.21, z]} rotation={[0, 0, Math.PI / 2]}>\r\n          <cylinderGeometry args={[0.22, 0.22, 0.12, 24]} />\r\n          <meshStandardMaterial color=\"#222\" />\r\n        </mesh>\r\n      ))\r\n    )}\r\n    {/* Headlights - boxGeometry style, adjusted to prevent Z-fighting */}\r\n    {[-0.72, 0.72].map((x, i) => (\r\n      <mesh key={`hle-${i}`} position={[x, 0.41, -1.88]}>\r\n        <boxGeometry args={[0.35, 0.16, 0.05]} />\r\n        <meshStandardMaterial color=\"#FFFACD\" emissive=\"#FFFF66\" />\r\n      </mesh>\r\n    ))}\r\n    {/* Dual exhausts */}\r\n    {[-0.36, 0.36].map((x, i) => (\r\n      <mesh key={`exh-${i}`} position={[x, 0.22, 1.89]}>\r\n        <cylinderGeometry args={[0.09, 0.09, 0.27, 12]} rotation={[Math.PI / 2, 0, 0]} />\r\n        <meshStandardMaterial color=\"#444\" />\r\n      </mesh>\r\n    ))}\r\n  </group>\r\n);\r\n\r\nexport default { CarA, CarB, CarC, CarD, CarE }; ","// Vehicle components index file\r\nimport TankVehicles, { TankA, TankB } from './TankVehicles';\r\nimport IFVVehicles, { IFV_A, IFV_B } from './IFVVehicles';\r\nimport TruckVehicles, {\r\n    CivilianTruck1, CivilianTruck2, CivilianTruck3,\r\n    MilitaryTruck1, MilitaryTruck2, MilitaryTruck3,\r\n    civilianTrucks, militaryTrucks\r\n} from './TruckVehicles';\r\nimport CarVehicles, { CarA, CarB, CarC, CarD, CarE } from './CarVehicles';\r\n\r\n// Grouped exports\r\nexport const Tanks = TankVehicles;\r\nexport const IFVs = IFVVehicles;\r\nexport const Trucks = TruckVehicles;\r\nexport const Cars = CarVehicles;\r\n\r\n// Individual exports\r\nexport {\r\n    // Tanks\r\n    TankA, TankB,\r\n\r\n    // IFVs\r\n    IFV_A, IFV_B,\r\n\r\n    // Trucks - Civilian\r\n    CivilianTruck1, CivilianTruck2, CivilianTruck3,\r\n    civilianTrucks,\r\n\r\n    // Trucks - Military\r\n    MilitaryTruck1, MilitaryTruck2, MilitaryTruck3,\r\n    militaryTrucks,\r\n\r\n    // Cars\r\n    CarA, CarB, CarC, CarD, CarE\r\n};\r\n\r\n// Vehicle type mapping for dynamic usage\r\nexport const VehicleTypes = {\r\n    // Tanks\r\n    tank_a: TankA,\r\n    tank_b: TankB,\r\n\r\n    // IFVs\r\n    ifv_a: IFV_A,\r\n    ifv_b: IFV_B,\r\n\r\n    // Civilian Trucks\r\n    civilian_truck_1: CivilianTruck1,\r\n    civilian_truck_2: CivilianTruck2,\r\n    civilian_truck_3: CivilianTruck3,\r\n\r\n    // Military Trucks\r\n    military_truck_1: MilitaryTruck1,\r\n    military_truck_2: MilitaryTruck2,\r\n    military_truck_3: MilitaryTruck3,\r\n\r\n    // Cars\r\n    car_a: CarA,\r\n    car_b: CarB,\r\n    car_c: CarC,\r\n    car_d: CarD,\r\n    car_e: CarE\r\n};\r\n\r\nexport default {\r\n    Tanks,\r\n    IFVs,\r\n    Trucks,\r\n    Cars,\r\n    VehicleTypes\r\n}; ","import React, { useEffect, cloneElement, Children } from 'react';\r\nimport { useVehicleHealthStore } from '../../utils/VehicleHealthSystem';\r\nimport VehicleDamageEffects from '../effects/VehicleDamageEffects';\r\n\r\n/**\r\n * Higher-order component that adds health system to vehicles\r\n * @param {React.ComponentType} VehicleComponent - The original vehicle component\r\n * @param {string} vehicleType - The type of vehicle from VehicleTypes\r\n * @returns {React.ComponentType} - Enhanced vehicle component with health system\r\n */\r\nexport const withVehicleHealth = (VehicleComponent, vehicleType) => {\r\n    return React.forwardRef((props, ref) => {\r\n        const { id, ...otherProps } = props;\r\n\r\n        // Get vehicle health management functions from the store\r\n        const {\r\n            initVehicle,\r\n            getVehicleHealth\r\n        } = useVehicleHealthStore();\r\n\r\n        // Generate a stable ID if not provided\r\n        const vehicleId = id || `vehicle-${vehicleType}-${Math.floor(Math.random() * 10000)}`;\r\n\r\n        // Initialize vehicle health on mount\r\n        useEffect(() => {\r\n            initVehicle(vehicleId, vehicleType);\r\n\r\n            // Cleanup on unmount - could add removeVehicle here if needed\r\n            // return () => removeVehicle(vehicleId);\r\n        }, [vehicleId, vehicleType]);\r\n\r\n        // Get current health state for this vehicle\r\n        const vehicleHealth = getVehicleHealth(vehicleId);\r\n\r\n        // If no health data yet, render original component\r\n        if (!vehicleHealth) {\r\n            return <VehicleComponent {...otherProps} ref={ref} />;\r\n        }\r\n\r\n        // If vehicle is destroyed, don't render anything\r\n        if (vehicleHealth.isDestroyed) {\r\n            return null;\r\n        }\r\n\r\n        // If vehicle is dead, adjust its appearance (lower to ground, etc.)\r\n        const adjustedProps = { ...otherProps };\r\n\r\n        if (vehicleHealth.isDead) {\r\n            // Adjust position to make it appear destroyed (slightly into the ground)\r\n            if (adjustedProps.position) {\r\n                const [x, y, z] = adjustedProps.position;\r\n                adjustedProps.position = [x, y - 0.15, z];\r\n            }\r\n\r\n            // Could also adjust rotation to make it appear tilted when destroyed\r\n            if (adjustedProps.rotation) {\r\n                const [x, y, z] = adjustedProps.rotation;\r\n                adjustedProps.rotation = [\r\n                    x + (Math.random() * 0.2 - 0.1),\r\n                    y,\r\n                    z + (Math.random() * 0.2 - 0.1)\r\n                ];\r\n            }\r\n        }\r\n\r\n        // Tag vehicle parts for hit detection\r\n        const processVehicleChildren = (children) => {\r\n            return Children.map(children, child => {\r\n                if (!child) return child;\r\n\r\n                // For parts specifically named (like turret, wheels, etc.)\r\n                // Add specific userData to identify them as vehicle parts\r\n                let partType = null;\r\n\r\n                // Detect part type based on name (if available)\r\n                if (child.props && child.props.name) {\r\n                    const name = child.props.name.toLowerCase();\r\n                    if (name.includes('turret')) {\r\n                        partType = 'turret';\r\n                    } else if (name.includes('track') || name.includes('tracks')) {\r\n                        partType = 'tracks';\r\n                    } else if (name.includes('wheel') || name.includes('wheels')) {\r\n                        partType = 'wheels';\r\n                    } else if (name.includes('cabin')) {\r\n                        partType = 'cabin';\r\n                    } else if (name.includes('engine')) {\r\n                        partType = 'engine';\r\n                    } else if (name.includes('cargo')) {\r\n                        partType = 'cargo';\r\n                    } else if (name.includes('rear')) {\r\n                        partType = 'rear';\r\n                    } else if (name.includes('front')) {\r\n                        partType = 'front';\r\n                    } else {\r\n                        partType = 'body';\r\n                    }\r\n                }\r\n\r\n                // Create new userData for this part\r\n                const newUserData = {\r\n                    ...(child.props.userData || {}),\r\n                    isVehiclePart: true,\r\n                    partType: partType,\r\n                    parentVehicleId: vehicleId,\r\n                    parentVehicleType: vehicleType\r\n                };\r\n\r\n                // Process any children of this part recursively\r\n                let newChildren = child.props.children;\r\n                if (newChildren) {\r\n                    newChildren = processVehicleChildren(newChildren);\r\n                }\r\n\r\n                // Clone the child with new props\r\n                return cloneElement(child, {\r\n                    ...child.props,\r\n                    userData: newUserData,\r\n                    children: newChildren\r\n                });\r\n            });\r\n        };\r\n\r\n        // Return original vehicle with damage effects on top\r\n        return (\r\n            <group ref={ref}>\r\n                <VehicleComponent\r\n                    {...adjustedProps}\r\n                    userData={{\r\n                        vehicleId,\r\n                        vehicleType,\r\n                        health: vehicleHealth.currentHealth,\r\n                        maxHealth: vehicleHealth.maxHealth,\r\n                        isDead: vehicleHealth.isDead,\r\n                        isDestroyed: vehicleHealth.isDestroyed,\r\n                        mobilityFactor: vehicleHealth.mobilityFactor,\r\n                        // Vehicle is immobile at 50% health or below\r\n                        canMove: vehicleHealth.healthPercentage > 0.5\r\n                    }}\r\n                />\r\n            </group>\r\n        );\r\n    });\r\n};\r\n\r\nexport default withVehicleHealth; ","import { withVehicleHealth } from './withVehicleHealth';\r\nimport {\r\n    TankA, TankB,\r\n    IFV_A, IFV_B,\r\n    CivilianTruck1, CivilianTruck2, CivilianTruck3,\r\n    MilitaryTruck1, MilitaryTruck2, MilitaryTruck3,\r\n    CarA, CarB, CarC, CarD, CarE\r\n} from './index';\r\n\r\n// Enhance individual vehicles with health system\r\nexport const EnhancedTankA = withVehicleHealth(TankA, 'tank_a');\r\nexport const EnhancedTankB = withVehicleHealth(TankB, 'tank_b');\r\n\r\nexport const EnhancedIFV_A = withVehicleHealth(IFV_A, 'ifv_a');\r\nexport const EnhancedIFV_B = withVehicleHealth(IFV_B, 'ifv_b');\r\n\r\nexport const EnhancedCivilianTruck1 = withVehicleHealth(CivilianTruck1, 'civilian_truck_1');\r\nexport const EnhancedCivilianTruck2 = withVehicleHealth(CivilianTruck2, 'civilian_truck_2');\r\nexport const EnhancedCivilianTruck3 = withVehicleHealth(CivilianTruck3, 'civilian_truck_3');\r\n\r\nexport const EnhancedMilitaryTruck1 = withVehicleHealth(MilitaryTruck1, 'military_truck_1');\r\nexport const EnhancedMilitaryTruck2 = withVehicleHealth(MilitaryTruck2, 'military_truck_2');\r\nexport const EnhancedMilitaryTruck3 = withVehicleHealth(MilitaryTruck3, 'military_truck_3');\r\n\r\nexport const EnhancedCarA = withVehicleHealth(CarA, 'car_a');\r\nexport const EnhancedCarB = withVehicleHealth(CarB, 'car_b');\r\nexport const EnhancedCarC = withVehicleHealth(CarC, 'car_c');\r\nexport const EnhancedCarD = withVehicleHealth(CarD, 'car_d');\r\nexport const EnhancedCarE = withVehicleHealth(CarE, 'car_e');\r\n\r\n// Group vehicles by category\r\nexport const EnhancedTanks = {\r\n    TankA: EnhancedTankA,\r\n    TankB: EnhancedTankB\r\n};\r\n\r\nexport const EnhancedIFVs = {\r\n    IFV_A: EnhancedIFV_A,\r\n    IFV_B: EnhancedIFV_B\r\n};\r\n\r\nexport const EnhancedCivilianTrucks = [\r\n    EnhancedCivilianTruck1,\r\n    EnhancedCivilianTruck2,\r\n    EnhancedCivilianTruck3\r\n];\r\n\r\nexport const EnhancedMilitaryTrucks = [\r\n    EnhancedMilitaryTruck1,\r\n    EnhancedMilitaryTruck2,\r\n    EnhancedMilitaryTruck3\r\n];\r\n\r\nexport const EnhancedCars = {\r\n    CarA: EnhancedCarA,\r\n    CarB: EnhancedCarB,\r\n    CarC: EnhancedCarC,\r\n    CarD: EnhancedCarD,\r\n    CarE: EnhancedCarE\r\n};\r\n\r\n// Vehicle type mapping for dynamic usage with health-enhanced versions\r\nexport const EnhancedVehicleTypes = {\r\n    // Tanks\r\n    tank_a: EnhancedTankA,\r\n    tank_b: EnhancedTankB,\r\n\r\n    // IFVs\r\n    ifv_a: EnhancedIFV_A,\r\n    ifv_b: EnhancedIFV_B,\r\n\r\n    // Civilian Trucks\r\n    civilian_truck_1: EnhancedCivilianTruck1,\r\n    civilian_truck_2: EnhancedCivilianTruck2,\r\n    civilian_truck_3: EnhancedCivilianTruck3,\r\n\r\n    // Military Trucks\r\n    military_truck_1: EnhancedMilitaryTruck1,\r\n    military_truck_2: EnhancedMilitaryTruck2,\r\n    military_truck_3: EnhancedMilitaryTruck3,\r\n\r\n    // Cars\r\n    car_a: EnhancedCarA,\r\n    car_b: EnhancedCarB,\r\n    car_c: EnhancedCarC,\r\n    car_d: EnhancedCarD,\r\n    car_e: EnhancedCarE\r\n};\r\n\r\nexport default EnhancedVehicleTypes; ","import React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport * as THREE from 'three';\r\nimport { VehicleTypes } from './vehicles';\r\nimport { EnhancedVehicleTypes } from './vehicles/enhancedVehicles';\r\nimport { ROAD_WIDTH, ROAD_SPACING, TOTAL_ROAD_WIDTH, ROAD_EXTENSION } from './Road';\r\nimport { ORIGINAL_TERRAIN_SIZE, HALF_WIDTH_TERRAIN_SIZE } from './Terrain';\r\nimport { useVehicleHealthStore } from '../utils/VehicleHealthSystem';\r\nimport { useMapStore } from '../utils/MapStore';\r\n\r\n// Vehicle movement speed in units per second\r\nconst SPEED_MIN = 0.216;  // Increased by 20% from 0.18\r\nconst SPEED_MAX = 0.3;    // Increased by 20% from 0.25\r\n\r\n// Special speeds for cars and civilian trucks (44% faster - increased by 15% from previous 25%)\r\nconst CAR_CIVILIAN_SPEED_MIN = SPEED_MIN * 1.44;  // 44% faster than standard (25% + 15% more)\r\nconst CAR_CIVILIAN_SPEED_MAX = SPEED_MAX * 1.44;  // 44% faster than standard (25% + 15% more)\r\n\r\n// Number of vehicles to spawn per road\r\nconst VEHICLES_PER_ROAD = 8; // Reduced from 11 to further reduce congestion\r\n\r\n// Congestion detection settings\r\nconst CONGESTION_THRESHOLD = 3; // Number of stopped vehicles in proximity required to detect congestion\r\nconst CONGESTION_PROXIMITY = 30; // How close vehicles need to be to count as congested\r\nconst CONGESTION_SPEED_THRESHOLD = 0.05; // Vehicles moving below this speed are considered stopped\r\nconst REDUCED_SPAWN_FACTOR = 0.5; // Spawn only 50% of vehicles in congested areas\r\n\r\n// Lane widths - now with 4 lanes per road\r\nconst LANE_WIDTH = ROAD_WIDTH / 4; // Each road has 4 lanes now\r\n\r\n// Define lane types\r\nconst LANE_TYPES = {\r\n    FAST: 'fast',    // Left lane (for military columns)\r\n    SLOW: 'slow'     // Right lane (for civilian vehicles)\r\n};\r\n\r\n// Vehicle dimensions (approximate average)\r\nconst VEHICLE_LENGTH = 16; // Updated for 4x scale (was 12 for 3x scale)\r\nconst MINIMUM_DISTANCE = 60; // Updated to match civilian distance\r\nconst CIVILIAN_MINIMUM_DISTANCE = 60; // Increased spacing for civilian vehicles (60 meters)\r\nconst COLUMN_VEHICLE_SPACING = 40; // Increased by 10% from 30 meters distance between vehicles in a column\r\nconst TANK_SPACING = 55; // 20% more distance for tanks (new constant)\r\nconst IFV_SPACING = 45; // 20% more distance for IFVs (new constant)\r\nconst SAFE_DISTANCE = Math.max(VEHICLE_LENGTH * 1.8, MINIMUM_DISTANCE); // Updated to match civilian safe distance\r\nconst CIVILIAN_SAFE_DISTANCE = Math.max(VEHICLE_LENGTH * 1.8, CIVILIAN_MINIMUM_DISTANCE); // Increased safe distance for civilian vehicles\r\n\r\n// Collision avoidance - now same for both military and civilian\r\nconst DETECTION_DISTANCE = SAFE_DISTANCE * 1; // Distance to start slowing down\r\nconst EMERGENCY_DISTANCE = 45; // Fixed 45 meter emergency distance as requested\r\nconst CIVILIAN_DETECTION_DISTANCE = CIVILIAN_SAFE_DISTANCE * 1; // Increased detection distance for civilian vehicles\r\nconst CIVILIAN_EMERGENCY_DISTANCE = 45; // Fixed 45 meter emergency distance for civilian vehicles\r\n\r\n// Traffic jam recovery settings\r\nconst TRAFFIC_JAM_SPEED_THRESHOLD = 0.05; // Speed below this is considered \"stopped\"\r\nconst TRAFFIC_JAM_RECOVERY_BOOST = 1.1; // Reduced from 1.2 to prevent excessive acceleration\r\nconst TRAFFIC_JAM_CHECK_INTERVAL = 500; // Check every 0.5 seconds\r\n\r\n// Delay after vehicle destruction before column resumes movement\r\nconst DESTROYED_VEHICLE_WAIT_PERIOD = 2000; // 2 seconds\r\n\r\n// Military column definitions\r\nconst MILITARY_COLUMNS = [\r\n    // Combo 1: 3 tanks, 2 IFVs, 1 military truck\r\n    {\r\n        id: 'combo1',\r\n        vehicles: [\r\n            { type: 'military_truck', count: 1 },\r\n            { type: 'ifv', count: 2 },\r\n            { type: 'tank', count: 3 },\r\n        ]\r\n    },\r\n    // Combo 2: 1 tank, 3 IFVs, 2 military trucks\r\n    {\r\n        id: 'combo2',\r\n        vehicles: [\r\n            { type: 'military_truck', count: 2 },\r\n            { type: 'ifv', count: 3 },\r\n            { type: 'tank', count: 1 }\r\n        ]\r\n    },\r\n    // Combo 3: 2 tanks, 2 IFVs, 2 military trucks\r\n    {\r\n        id: 'combo3',\r\n        vehicles: [\r\n            { type: 'military_truck', count: 2 },\r\n            { type: 'ifv', count: 2 },\r\n            { type: 'tank', count: 2 }\r\n        ]\r\n    },\r\n    // Combo 4: 1 tank, 4 IFVs, 1 military truck\r\n    {\r\n        id: 'combo4',\r\n        vehicles: [\r\n            { type: 'military_truck', count: 1 },\r\n            { type: 'ifv', count: 4 },\r\n            { type: 'tank', count: 1 }\r\n        ]\r\n    }\r\n];\r\n\r\n// Define constants to track and manage column spawning\r\nconst MAX_COLUMNS_PER_LANE = 1; // Maximum number of active columns per lane\r\nconst COLUMN_RESPAWN_DELAY = 7000; // 7 seconds delay before respawning a new column (increased from 5000)\r\n\r\n// Create reusable Vector3 and Euler objects to prevent memory leaks\r\nconst tempVector3 = new THREE.Vector3();\r\nconst tempEuler = new THREE.Euler();\r\n\r\n// Object pooling to reuse vehicle objects\r\nclass VehiclePool {\r\n    constructor() {\r\n        this.pool = [];\r\n        this.inUse = new Set();\r\n    }\r\n\r\n    get() {\r\n        // Try to get a vehicle from the pool, or create a new one if pool is empty\r\n        let vehicle = this.pool.pop();\r\n        if (!vehicle) {\r\n            vehicle = {\r\n                position: new THREE.Vector3(),\r\n                hitbox: { width: 1.0, height: 1.0, depth: 3.0 }\r\n            };\r\n        }\r\n        this.inUse.add(vehicle);\r\n        return vehicle;\r\n    }\r\n\r\n    release(vehicle) {\r\n        if (this.inUse.has(vehicle)) {\r\n            this.inUse.delete(vehicle);\r\n            this.pool.push(vehicle);\r\n        }\r\n    }\r\n\r\n    releaseAll() {\r\n        this.inUse.forEach(vehicle => {\r\n            this.pool.push(vehicle);\r\n        });\r\n        this.inUse.clear();\r\n    }\r\n}\r\n\r\n// Function to get random item from array\r\nfunction getRandomItem(array) {\r\n    return array[Math.floor(Math.random() * array.length)];\r\n}\r\n\r\n// Function to get a random vehicle of the specified type\r\nfunction getRandomVehicleOfType(type) {\r\n    const vehicleKeys = Object.keys(VehicleTypes);\r\n    let matchingVehicles = [];\r\n\r\n    if (type === 'tank') {\r\n        matchingVehicles = vehicleKeys.filter(key => key.includes('tank_'));\r\n    } else if (type === 'ifv') {\r\n        matchingVehicles = vehicleKeys.filter(key => key.includes('ifv_'));\r\n    } else if (type === 'military_truck') {\r\n        matchingVehicles = vehicleKeys.filter(key => key.includes('military_truck_'));\r\n    } else if (type === 'car') {\r\n        matchingVehicles = vehicleKeys.filter(key => key.includes('car_'));\r\n    } else if (type === 'civilian_truck') {\r\n        matchingVehicles = vehicleKeys.filter(key => key.includes('civilian_truck_'));\r\n    }\r\n\r\n    return matchingVehicles.length > 0 ? getRandomItem(matchingVehicles) : null;\r\n}\r\n\r\n// Function to check if vehicle is a car or civilian truck\r\nfunction isCarOrCivilianTruck(vehicleType) {\r\n    return vehicleType.includes('car_') || vehicleType.includes('civilian_truck_');\r\n}\r\n\r\nexport default function VehiclesOnRoad() {\r\n    const [vehicles, setVehicles] = useState([]);\r\n    const initializedRef = useRef(false);\r\n    const columnSpawnTimersRef = useRef({});\r\n    const timeoutRefsRef = useRef([]); // New ref to track all timeout IDs for cleanup\r\n    const vehiclePoolRef = useRef(new VehiclePool()); // Object pool for reusing vehicle objects\r\n    const congestionMapRef = useRef(new Map()); // Track congested road sections\r\n\r\n    // Add a ref to store references to vehicle meshes for culling\r\n    const vehicleRefsMap = useRef(new Map());\r\n\r\n    // Access vehicle health store for mobility factor and health data\r\n    const vehicleHealthStore = useVehicleHealthStore();\r\n    const getVehicleHealth = vehicleHealthStore.getVehicleHealth;\r\n\r\n    // Cache for vehicle objects by ID to avoid expensive array searches\r\n    const vehiclesById = useRef(new Map());\r\n\r\n    // Pre-compute rotations to avoid creating new Euler objects\r\n    const rotationMap = useMemo(() => {\r\n        return {\r\n            right: new THREE.Euler(0, -Math.PI / 2, 0),\r\n            left: new THREE.Euler(0, Math.PI / 2, 0)\r\n        };\r\n    }, []);\r\n\r\n    // Get current map type from store\r\n    const { currentMapType } = useMapStore();\r\n\r\n    // Get the terrain size based on the current map type\r\n    const terrainSize = useMemo(() => {\r\n        if (currentMapType === 'half-width') {\r\n            return HALF_WIDTH_TERRAIN_SIZE;\r\n        }\r\n        return { width: ORIGINAL_TERRAIN_SIZE, height: ORIGINAL_TERRAIN_SIZE };\r\n    }, [currentMapType]);\r\n\r\n    // Function to detect congestion in a road section\r\n    const detectCongestion = (allVehicles) => {\r\n        const newCongestionMap = new Map();\r\n\r\n        // Group vehicles by road sections (divide the road into 100-unit sections)\r\n        const roadSections = new Map();\r\n\r\n        // Track columns that have been completely destroyed\r\n        const destroyedColumns = new Set();\r\n        const activeColumns = new Set();\r\n\r\n        // Identify active and destroyed columns\r\n        allVehicles.forEach(vehicle => {\r\n            if (vehicle.isInColumn && vehicle.columnId) {\r\n                const healthData = getVehicleHealth(vehicle.id);\r\n                if (healthData && healthData.isDead) {\r\n                    destroyedColumns.add(vehicle.columnId);\r\n                } else {\r\n                    activeColumns.add(vehicle.columnId);\r\n                }\r\n            }\r\n        });\r\n\r\n        // Remove columns from destroyedColumns that still have active vehicles\r\n        activeColumns.forEach(activeId => {\r\n            destroyedColumns.delete(activeId);\r\n        });\r\n\r\n        allVehicles.forEach(vehicle => {\r\n            // Skip destroyed vehicles \r\n            const healthData = getVehicleHealth(vehicle.id);\r\n            if (healthData && healthData.isDead) return;\r\n\r\n            // Determine road section (divide the road into segments)\r\n            const sectionKey = `${Math.floor(vehicle.position.x / 100)}-${vehicle.road}-${vehicle.direction}`;\r\n\r\n            if (!roadSections.has(sectionKey)) {\r\n                roadSections.set(sectionKey, []);\r\n            }\r\n            roadSections.get(sectionKey).push(vehicle);\r\n        });\r\n\r\n        // Check each road section for congestion\r\n        roadSections.forEach((sectionVehicles, sectionKey) => {\r\n            // Count stopped or very slow vehicles\r\n            let stoppedCount = 0;\r\n\r\n            // Check if this section contains a lane where a column was fully destroyed\r\n            const [_, road, direction] = sectionKey.split('-');\r\n            let sectionHasDestroyedColumn = false;\r\n\r\n            sectionVehicles.forEach(vehicle => {\r\n                if (vehicle.speed < CONGESTION_SPEED_THRESHOLD) {\r\n                    stoppedCount++;\r\n                }\r\n\r\n                // Check if any vehicle in this section was part of a now-destroyed column\r\n                if (vehicle.isInColumn && destroyedColumns.has(vehicle.columnId)) {\r\n                    sectionHasDestroyedColumn = true;\r\n                }\r\n            });\r\n\r\n            // If a column in this section was completely destroyed, \r\n            // don't mark as congested to allow traffic to recover\r\n            if (sectionHasDestroyedColumn) {\r\n                return;\r\n            }\r\n\r\n            // Check if enough vehicles are stopped/slow to qualify as congestion\r\n            if (stoppedCount >= CONGESTION_THRESHOLD) {\r\n                newCongestionMap.set(sectionKey, {\r\n                    stoppedCount,\r\n                    totalVehicles: sectionVehicles.length,\r\n                    lastDetectedTime: Date.now()\r\n                });\r\n            }\r\n        });\r\n\r\n        return newCongestionMap;\r\n    };\r\n\r\n    // Initialize vehicles\r\n    useEffect(() => {\r\n        if (initializedRef.current) return;\r\n        initializedRef.current = true;\r\n\r\n        const newVehicles = [];\r\n\r\n        // For each road (upper and lower)\r\n        [-ROAD_SPACING / 2, ROAD_SPACING / 2].forEach(roadZ => {\r\n            // Define all 4 lanes for this road\r\n            const lanes = [\r\n                // Left side lanes (vehicles move in negative X direction)\r\n                {\r\n                    z: roadZ - (ROAD_WIDTH * 3 / 8), // First lane center (outer left)\r\n                    direction: -1,\r\n                    type: LANE_TYPES.FAST\r\n                },\r\n                {\r\n                    z: roadZ - (ROAD_WIDTH * 1 / 8), // Second lane center (inner left)\r\n                    direction: -1,\r\n                    type: LANE_TYPES.SLOW\r\n                },\r\n                // Right side lanes (vehicles move in positive X direction)\r\n                {\r\n                    z: roadZ + (ROAD_WIDTH * 1 / 8), // Third lane center (inner right)\r\n                    direction: 1,\r\n                    type: LANE_TYPES.SLOW\r\n                },\r\n                {\r\n                    z: roadZ + (ROAD_WIDTH * 3 / 8), // Fourth lane center (outer right)\r\n                    direction: 1,\r\n                    type: LANE_TYPES.FAST\r\n                }\r\n            ];\r\n\r\n            // Group lanes by direction and type\r\n            const fastLanes = lanes.filter(lane => lane.type === LANE_TYPES.FAST);\r\n            const slowLanes = lanes.filter(lane => lane.type === LANE_TYPES.SLOW);\r\n\r\n            // Create military columns on fast lanes (one per direction)\r\n            fastLanes.forEach(lane => {\r\n                // Choose a random column configuration\r\n                const columnConfig = getRandomItem(MILITARY_COLUMNS);\r\n                const columnId = `column-${roadZ}-${lane.z}`;\r\n\r\n                // Generate a random position along the road for the column to spawn\r\n                // Use a range within the terrain size with some padding\r\n                const randomOffset = Math.random() * (terrainSize.width * 0.7) - (terrainSize.width * 0.35);\r\n\r\n                // Starting position for the column - random point on the road\r\n                const startingX = lane.direction > 0 ?\r\n                    -terrainSize.width / 2 + 100 + randomOffset : // For positive direction\r\n                    terrainSize.width / 2 - 100 + randomOffset;  // For negative direction\r\n\r\n                let currentX = startingX;\r\n                let vehicleIndex = 0;\r\n\r\n                // Create all vehicles for this column\r\n                for (const vehicleGroup of columnConfig.vehicles) {\r\n                    for (let i = 0; i < vehicleGroup.count; i++) {\r\n                        const vehicleType = getRandomVehicleOfType(vehicleGroup.type);\r\n                        if (!vehicleType) continue;\r\n\r\n                        const vehicleId = `${columnId}-${vehicleGroup.type}-${i}`;\r\n\r\n                        // Adjust speed based on vehicle type (cars and civilian trucks are 25% faster)\r\n                        const baseSpeedMin = isCarOrCivilianTruck(vehicleType) ? CAR_CIVILIAN_SPEED_MIN : SPEED_MIN;\r\n                        const baseSpeedMax = isCarOrCivilianTruck(vehicleType) ? CAR_CIVILIAN_SPEED_MAX : SPEED_MAX;\r\n\r\n                        newVehicles.push({\r\n                            id: vehicleId,\r\n                            type: vehicleType,\r\n                            columnId: columnId,\r\n                            columnPosition: vehicleIndex,\r\n                            position: new THREE.Vector3(\r\n                                currentX,\r\n                                0.3,\r\n                                lane.z + (Math.random() * 0.2 - 0.1)\r\n                            ),\r\n                            rotation: lane.direction > 0 ? rotationMap.right : rotationMap.left,\r\n                            speed: baseSpeedMin + Math.random() * (baseSpeedMax - baseSpeedMin),\r\n                            direction: lane.direction,\r\n                            lane: lane.z,\r\n                            road: roadZ,\r\n                            laneType: lane.type,\r\n                            isInColumn: true,\r\n                            hitbox: { width: 1.33, height: 1.33, depth: 4.0 }\r\n                        });\r\n\r\n                        // Move to next vehicle position - use specific spacing based on vehicle type\r\n                        if (vehicleGroup.type === 'tank') {\r\n                            currentX += lane.direction * TANK_SPACING;\r\n                        } else if (vehicleGroup.type === 'ifv') {\r\n                            currentX += lane.direction * IFV_SPACING;\r\n                        } else {\r\n                            currentX += lane.direction * COLUMN_VEHICLE_SPACING;\r\n                        }\r\n                        vehicleIndex++;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Populate slow lanes with civilian vehicles\r\n            slowLanes.forEach(lane => {\r\n                // Check for congestion in this lane's direction and road\r\n                const roadSection = `${Math.floor(-terrainSize.width / 2 / 100)}-${roadZ}-${lane.direction}`;\r\n                const isCongested = congestionMapRef.current.has(roadSection);\r\n\r\n                // Adjust vehicle count based on congestion\r\n                let vehiclesPerLane = VEHICLES_PER_ROAD / 2; // Default - split evenly between slow lanes\r\n\r\n                if (isCongested) {\r\n                    // Reduce vehicle count in congested areas\r\n                    vehiclesPerLane = Math.floor(vehiclesPerLane * REDUCED_SPAWN_FACTOR);\r\n                    console.log(`Congestion detected in section ${roadSection}, reducing spawns to ${vehiclesPerLane}`);\r\n                }\r\n\r\n                // Track vehicle positions to ensure proper spacing\r\n                const vehiclePositions = [];\r\n\r\n                for (let i = 0; i < vehiclesPerLane; i++) {\r\n                    // Randomly choose between car and civilian truck (adjusted ratio)\r\n                    const vehicleType = Math.random() < 0.7 ?\r\n                        getRandomVehicleOfType('car') :\r\n                        getRandomVehicleOfType('civilian_truck');\r\n\r\n                    if (!vehicleType) continue;\r\n\r\n                    // Calculate position with good spacing along the road\r\n                    const segmentLength = terrainSize.width / vehiclesPerLane;\r\n                    const minSegmentLength = CIVILIAN_MINIMUM_DISTANCE * 1.5;\r\n                    const effectiveSegmentLength = Math.max(segmentLength, minSegmentLength);\r\n\r\n                    // Create a base position for this vehicle with some randomness\r\n                    let segmentStart = -terrainSize.width / 2 + (i * effectiveSegmentLength);\r\n                    let xPos = segmentStart + Math.random() * (effectiveSegmentLength * 0.6);\r\n\r\n                    // Calculate Z position with slight random variation\r\n                    const zJitter = Math.random() * 0.5 - 0.25; // Small random Z variation for visual interest\r\n                    let zPos = lane.z + zJitter;\r\n\r\n                    // Check for conflicts with existing vehicles in the same lane\r\n                    let hasConflict = false;\r\n                    let conflictResolutionAttempts = 0;\r\n                    const MAX_CONFLICT_RESOLUTION_ATTEMPTS = 5;\r\n\r\n                    // Make sure this position is not too close to other spawned vehicles\r\n                    while (conflictResolutionAttempts < MAX_CONFLICT_RESOLUTION_ATTEMPTS) {\r\n                        hasConflict = false;\r\n\r\n                        // Check against all previously placed vehicles in this lane\r\n                        for (const pos of vehiclePositions) {\r\n                            const xDistance = Math.abs(pos.x - xPos);\r\n                            const zDistance = Math.abs(pos.z - zPos);\r\n\r\n                            // If too close to another vehicle, adjust position\r\n                            if (xDistance < CIVILIAN_MINIMUM_DISTANCE && zDistance < 2.0) {\r\n                                hasConflict = true;\r\n\r\n                                // Move this vehicle further along the road\r\n                                xPos += lane.direction > 0 ? CIVILIAN_MINIMUM_DISTANCE : -CIVILIAN_MINIMUM_DISTANCE;\r\n\r\n                                // Apply small Z variation to avoid being in the exact same line\r\n                                const newZJitter = Math.random() * 0.8 - 0.4;\r\n                                zPos = lane.z + newZJitter;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        if (!hasConflict) break;\r\n                        conflictResolutionAttempts++;\r\n                    }\r\n\r\n                    // If we still have conflicts after max attempts, skip this vehicle\r\n                    if (hasConflict) continue;\r\n\r\n                    // Track this position\r\n                    vehiclePositions.push({ x: xPos, z: zPos });\r\n\r\n                    const vehicleId = `vehicle-${roadZ}-${lane.z}-${i}`;\r\n\r\n                    // Adjust hitbox dimensions based on vehicle type\r\n                    let hitbox;\r\n                    if (vehicleType.includes('car_')) {\r\n                        hitbox = { width: 2.0, height: 1.0, depth: 4.0 }; // Car hitbox - increased width\r\n                    } else if (vehicleType === 'civilian_truck_1') {\r\n                        hitbox = { width: 2.4, height: 1.5, depth: 6.5 }; // Specific hitbox for CivilianTruck1 with trailer\r\n                    } else if (vehicleType.includes('civilian_truck_')) {\r\n                        hitbox = { width: 2.2, height: 1.5, depth: 5.0 }; // Updated hitbox for civilian trucks\r\n                    } else {\r\n                        hitbox = { width: 2.0, height: 1.2, depth: 4.5 }; // Default hitbox as fallback\r\n                    }\r\n\r\n                    newVehicles.push({\r\n                        id: vehicleId,\r\n                        type: vehicleType,\r\n                        position: new THREE.Vector3(xPos, 0.3, zPos),\r\n                        rotation: lane.direction > 0 ? rotationMap.right : rotationMap.left,\r\n                        speed: CAR_CIVILIAN_SPEED_MIN + Math.random() * (CAR_CIVILIAN_SPEED_MAX - CAR_CIVILIAN_SPEED_MIN),\r\n                        direction: lane.direction,\r\n                        lane: lane.z,\r\n                        road: roadZ,\r\n                        laneType: lane.type,\r\n                        isInColumn: false,\r\n                        hitbox: hitbox,\r\n                        jamCounter: 0  // Initialize jam counter\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        // Update the cache for quick lookups\r\n        newVehicles.forEach(vehicle => {\r\n            vehiclesById.current.set(vehicle.id, vehicle);\r\n        });\r\n\r\n        setVehicles(newVehicles);\r\n\r\n        // Cleanup function for the component unmount\r\n        return () => {\r\n            // Release all vehicles back to the pool\r\n            vehiclePoolRef.current.releaseAll();\r\n\r\n            // Clear all tracked timeouts\r\n            timeoutRefsRef.current.forEach(timeoutId => {\r\n                clearTimeout(timeoutId);\r\n            });\r\n\r\n            // Clear all column spawn timers\r\n            Object.values(columnSpawnTimersRef.current).forEach(timerId => {\r\n                if (timerId) clearTimeout(timerId);\r\n            });\r\n        };\r\n    }, [rotationMap, congestionMapRef.current, terrainSize]); // Add terrainSize to dependencies\r\n\r\n    // Memory optimization: Limit the number of timeouts tracked\r\n    useEffect(() => {\r\n        // Periodically clean up completed timeouts from our tracking array\r\n        const intervalId = setInterval(() => {\r\n            // Remove nullish or completed timeouts from the array\r\n            if (timeoutRefsRef.current.length > 100) {\r\n                timeoutRefsRef.current = timeoutRefsRef.current.slice(-100);\r\n            }\r\n        }, 30000); // Every 30 seconds\r\n\r\n        // Periodically remove vehicles that have drifted too far from the road\r\n        const cleanupIntervalId = setInterval(() => {\r\n            setVehicles(prevVehicles => {\r\n                // Define the valid area boundary for cleanup (larger than rendering boundary)\r\n                const cleanup_buffer = 150; // larger buffer for cleanup\r\n                const minX = -terrainSize.width / 2 - cleanup_buffer;\r\n                const maxX = terrainSize.width / 2 + cleanup_buffer;\r\n\r\n                // Define valid Z-coordinate range (road width with buffer)\r\n                const roadHalfWidth = ROAD_WIDTH / 2;\r\n                const validZRanges = [\r\n                    // Upper road Z range\r\n                    { min: ROAD_SPACING / 2 - roadHalfWidth - 20, max: ROAD_SPACING / 2 + roadHalfWidth + 20 },\r\n                    // Lower road Z range\r\n                    { min: -ROAD_SPACING / 2 - roadHalfWidth - 20, max: -ROAD_SPACING / 2 + roadHalfWidth + 20 }\r\n                ];\r\n\r\n                // Filter out vehicles that are too far from the road\r\n                return prevVehicles.filter(vehicle => {\r\n                    // Skip removed vehicles or those in columns (handled separately)\r\n                    if (vehicle.isRemoved || vehicle.isInColumn) return true;\r\n\r\n                    // Check if vehicle is within X bounds\r\n                    const validX = vehicle.position.x >= minX && vehicle.position.x <= maxX;\r\n\r\n                    // Check if vehicle is within any valid Z range\r\n                    const validZ = validZRanges.some(range =>\r\n                        vehicle.position.z >= range.min && vehicle.position.z <= range.max\r\n                    );\r\n\r\n                    // Only keep vehicles within valid X and Z coordinates\r\n                    if (!(validX && validZ)) {\r\n                        console.log(`Removing vehicle ${vehicle.id} that drifted too far from the road`);\r\n                        // Remove the vehicle completely if it's civilian\r\n                        if (!vehicle.isInColumn) {\r\n                            return false;\r\n                        }\r\n                        // Only respawn military vehicles\r\n                        const timeoutId = setTimeout(() => {\r\n                            vehicleHealthStore.respawnVehicle(vehicle.id);\r\n                        }, 0);\r\n                        timeoutRefsRef.current.push(timeoutId);\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n            });\r\n        }, 10000); // Check every 10 seconds\r\n\r\n        return () => {\r\n            clearInterval(intervalId);\r\n            clearInterval(cleanupIntervalId);\r\n        };\r\n    }, [terrainSize]);\r\n\r\n    // Pre-compute reusable geometries and materials\r\n    const vehicleGeometries = useMemo(() => {\r\n        const geometries = {};\r\n        // Return pre-computed geometries to be reused\r\n        return geometries;\r\n    }, []);\r\n\r\n    // Memoize the vehicle detection lookup map for collision detection\r\n    const vehicleLookupMapRef = useRef(new Map());\r\n\r\n    // Update vehicle positions on each frame with memory optimization\r\n    useFrame((state, delta) => {\r\n        // Cache current time outside the loop to avoid multiple calls\r\n        const currentTime = Date.now();\r\n\r\n        setVehicles(vehicles => {\r\n            // Update congestion map every 3 seconds (not every frame to save performance)\r\n            if (currentTime % 3000 < 16) { // Run if we're within 16ms of a 3-second mark\r\n                congestionMapRef.current = detectCongestion(vehicles);\r\n            }\r\n\r\n            // Update the vehicle ID cache\r\n            vehiclesById.current.clear();\r\n            vehicles.forEach(vehicle => {\r\n                vehiclesById.current.set(vehicle.id, vehicle);\r\n            });\r\n\r\n            // Track the positions where destroyed vehicles were removed\r\n            const removedDestroyedPositions = new Map(); // Map<lane, {x, road, direction, removalTime}>\r\n\r\n            // First, check if any column is fully destroyed (all vehicles destroyed)\r\n            const activeColumns = new Set();\r\n            const columnsToRespawn = new Set();\r\n            const destroyedVehicles = new Map(); // Track destroyed vehicles by ID\r\n            const clearedDestroyedPositions = new Map(); // Track positions where a destroyed vehicle was removed and cleared\r\n            const newlyDestroyedColumns = new Map(); // Track columns with newly destroyed vehicles\r\n\r\n            // Optimize vehicle lookup for collision detection\r\n            const updateVehicleLookupMap = (vehiclesList) => {\r\n                vehicleLookupMapRef.current.clear();\r\n\r\n                vehiclesList.forEach(vehicle => {\r\n                    const key = `${Math.floor(vehicle.position.x / 10)}-${vehicle.lane}-${vehicle.direction}`;\r\n                    if (!vehicleLookupMapRef.current.has(key)) {\r\n                        vehicleLookupMapRef.current.set(key, []);\r\n                    }\r\n                    vehicleLookupMapRef.current.get(key).push(vehicle);\r\n                });\r\n            };\r\n\r\n            // More efficient collision detection that uses the map\r\n            const optimizedDetectCollisionAhead = (vehicle, allVehicles, checkDistance = SAFE_DISTANCE) => {\r\n                const sectorKey = `${Math.floor(vehicle.position.x / 10)}-${vehicle.lane}-${vehicle.direction}`;\r\n                const nextSectorKey = `${Math.floor((vehicle.position.x + (vehicle.direction * 10)) / 10)}-${vehicle.lane}-${vehicle.direction}`;\r\n\r\n                // Check more sectors ahead for better detection at high speeds\r\n                const farSectorKey = `${Math.floor((vehicle.position.x + (vehicle.direction * 20)) / 10)}-${vehicle.lane}-${vehicle.direction}`;\r\n                const veryFarSectorKey = `${Math.floor((vehicle.position.x + (vehicle.direction * 30)) / 10)}-${vehicle.lane}-${vehicle.direction}`;\r\n\r\n                // Get vehicles in current and next sectors\r\n                const sectorsToCheck = [\r\n                    vehicleLookupMapRef.current.get(sectorKey) || [],\r\n                    vehicleLookupMapRef.current.get(nextSectorKey) || [],\r\n                    vehicleLookupMapRef.current.get(farSectorKey) || [],\r\n                    vehicleLookupMapRef.current.get(veryFarSectorKey) || []\r\n                ];\r\n\r\n                // Check adjacent lanes too for civilian vehicles, but only if they're not cars\r\n                // Cars should be less affected by adjacent lanes than trucks\r\n                if (!vehicle.isInColumn) {\r\n                    // Calculate adjacent lane keys\r\n                    const laneWidth = LANE_WIDTH; // Use the defined lane width\r\n                    const adjacentLaneUp = vehicle.lane + laneWidth;\r\n                    const adjacentLaneDown = vehicle.lane - laneWidth;\r\n\r\n                    // Determine if this is a car (which should have less adjacent lane checking)\r\n                    const isCar = vehicle.type && vehicle.type.includes('car_');\r\n\r\n                    // Adjust the adjacent lane check distance based on vehicle type\r\n                    // Cars should ignore vehicles in adjacent lanes unless they're very close\r\n                    const adjacentLaneZThreshold = isCar ? 1.8 : 3.5;\r\n\r\n                    // Add vehicles from adjacent lanes to check\r\n                    const adjacentSectorKeyUp = `${Math.floor(vehicle.position.x / 10)}-${adjacentLaneUp}-${vehicle.direction}`;\r\n                    const adjacentSectorKeyDown = `${Math.floor(vehicle.position.x / 10)}-${adjacentLaneDown}-${vehicle.direction}`;\r\n                    const nextAdjacentSectorKeyUp = `${Math.floor((vehicle.position.x + (vehicle.direction * 10)) / 10)}-${adjacentLaneUp}-${vehicle.direction}`;\r\n                    const nextAdjacentSectorKeyDown = `${Math.floor((vehicle.position.x + (vehicle.direction * 10)) / 10)}-${adjacentLaneDown}-${vehicle.direction}`;\r\n\r\n                    // Store the adjacent lane vehicles in a separate array for special handling\r\n                    const adjacentLaneVehicles = [\r\n                        ...(vehicleLookupMapRef.current.get(adjacentSectorKeyUp) || []),\r\n                        ...(vehicleLookupMapRef.current.get(adjacentSectorKeyDown) || []),\r\n                        ...(vehicleLookupMapRef.current.get(nextAdjacentSectorKeyUp) || []),\r\n                        ...(vehicleLookupMapRef.current.get(nextAdjacentSectorKeyDown) || [])\r\n                    ];\r\n\r\n                    // For cars, we'll check adjacent lane vehicles separately with a narrower Z threshold\r\n                    if (isCar) {\r\n                        // We'll handle these separately below\r\n                    } else {\r\n                        // Add all adjacent vehicles to sectors to check for trucks\r\n                        sectorsToCheck.push(...adjacentLaneVehicles);\r\n                    }\r\n\r\n                    // Store the adjacent lane vehicles on the vehicle object for special handling\r\n                    vehicle.adjacentLaneVehicles = adjacentLaneVehicles;\r\n                    vehicle.adjacentLaneZThreshold = adjacentLaneZThreshold;\r\n                }\r\n\r\n                let closestDistance = Infinity;\r\n                let hasCollision = false;\r\n\r\n                // Flatten and filter vehicles\r\n                const potentialCollisions = sectorsToCheck.flat().filter(v =>\r\n                    v.id !== vehicle.id &&\r\n                    Math.abs(v.road - vehicle.road) < 0.5 &&\r\n                    v.direction === vehicle.direction // Only check vehicles going in same direction\r\n                );\r\n\r\n                // Check these filtered vehicles for collision\r\n                potentialCollisions.forEach(otherVehicle => {\r\n                    // Skip checking destroyed vehicles\r\n                    const healthData = getVehicleHealth(otherVehicle.id);\r\n                    if (healthData && healthData.isDead && healthData.isDestroyed) return;\r\n\r\n                    // Calculate Z-distance between vehicles\r\n                    const zDistance = Math.abs(otherVehicle.position.z - vehicle.position.z);\r\n\r\n                    // Only consider vehicles within a certain Z-distance (based on vehicle width)\r\n                    // Use a wider threshold for civilian vehicles to prevent side collisions\r\n                    const zThreshold = vehicle.isInColumn ? 2.0 : 3.5;\r\n\r\n                    if (zDistance < zThreshold) {\r\n                        // For right-moving vehicles\r\n                        if (vehicle.direction > 0 && otherVehicle.direction > 0) {\r\n                            // Check if other vehicle is ahead\r\n                            if (otherVehicle.position.x > vehicle.position.x) {\r\n                                const distance = otherVehicle.position.x - vehicle.position.x;\r\n\r\n                                // Use a fixed check distance that doesn't decrease with Z-distance\r\n                                // This prevents vehicles from thinking they can slip through when they can't\r\n                                if (distance < checkDistance) {\r\n                                    hasCollision = true;\r\n                                    closestDistance = Math.min(closestDistance, distance);\r\n                                }\r\n                            }\r\n                        }\r\n                        // For left-moving vehicles\r\n                        else if (vehicle.direction < 0 && otherVehicle.direction < 0) {\r\n                            // Check if other vehicle is ahead\r\n                            if (otherVehicle.position.x < vehicle.position.x) {\r\n                                const distance = vehicle.position.x - otherVehicle.position.x;\r\n\r\n                                // Use a fixed check distance that doesn't decrease with Z-distance\r\n                                if (distance < checkDistance) {\r\n                                    hasCollision = true;\r\n                                    closestDistance = Math.min(closestDistance, distance);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // Special handling for cars - check adjacent lane vehicles with a narrower Z threshold\r\n                if (!vehicle.isInColumn && vehicle.type && vehicle.type.includes('car_') && vehicle.adjacentLaneVehicles) {\r\n                    const adjacentLaneZThreshold = vehicle.adjacentLaneZThreshold || 1.8;\r\n\r\n                    vehicle.adjacentLaneVehicles.forEach(otherVehicle => {\r\n                        // Skip checking destroyed vehicles\r\n                        const healthData = getVehicleHealth(otherVehicle.id);\r\n                        if (healthData && healthData.isDead && healthData.isDestroyed) return;\r\n\r\n                        // Skip checking military columns unless they're extremely close\r\n                        if (otherVehicle.isInColumn) {\r\n                            // Calculate Z-distance between vehicles\r\n                            const zDistance = Math.abs(otherVehicle.position.z - vehicle.position.z);\r\n\r\n                            // Cars should only be affected by military columns if they're extremely close\r\n                            if (zDistance >= adjacentLaneZThreshold) {\r\n                                return; // Skip this military column vehicle\r\n                            }\r\n                        }\r\n\r\n                        // Calculate Z-distance between vehicles\r\n                        const zDistance = Math.abs(otherVehicle.position.z - vehicle.position.z);\r\n\r\n                        // Only consider vehicles within a tighter Z-distance for cars\r\n                        if (zDistance < adjacentLaneZThreshold) {\r\n                            // For right-moving vehicles\r\n                            if (vehicle.direction > 0 && otherVehicle.direction > 0) {\r\n                                // Check if other vehicle is ahead\r\n                                if (otherVehicle.position.x > vehicle.position.x) {\r\n                                    const distance = otherVehicle.position.x - vehicle.position.x;\r\n\r\n                                    // For cars, we only care about adjacent lane vehicles that are VERY close\r\n                                    if (distance < checkDistance * 0.7) {\r\n                                        hasCollision = true;\r\n                                        closestDistance = Math.min(closestDistance, distance);\r\n                                    }\r\n                                }\r\n                            }\r\n                            // For left-moving vehicles\r\n                            else if (vehicle.direction < 0 && otherVehicle.direction < 0) {\r\n                                // Check if other vehicle is ahead\r\n                                if (otherVehicle.position.x < vehicle.position.x) {\r\n                                    const distance = vehicle.position.x - otherVehicle.position.x;\r\n\r\n                                    // For cars, we only care about adjacent lane vehicles that are VERY close\r\n                                    if (distance < checkDistance * 0.7) {\r\n                                        hasCollision = true;\r\n                                        closestDistance = Math.min(closestDistance, distance);\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // Clean up our temporary properties\r\n                    delete vehicle.adjacentLaneVehicles;\r\n                    delete vehicle.adjacentLaneZThreshold;\r\n                }\r\n\r\n                // Store the closest distance for speed regulation\r\n                if (hasCollision) {\r\n                    vehicle.distanceToNext = closestDistance;\r\n                } else {\r\n                    vehicle.distanceToNext = Infinity;\r\n                }\r\n\r\n                return hasCollision;\r\n            };\r\n\r\n            // Update the lookup map for efficient collision detection\r\n            updateVehicleLookupMap(vehicles);\r\n\r\n            // Gather active column IDs and mark destroyed vehicles\r\n            vehicles.forEach(vehicle => {\r\n                if (vehicle.isInColumn && vehicle.columnId) {\r\n                    activeColumns.add(vehicle.columnId);\r\n\r\n                    // Check if this vehicle is destroyed\r\n                    const healthData = getVehicleHealth(vehicle.id);\r\n                    if (healthData && healthData.isDead) {\r\n                        destroyedVehicles.set(vehicle.id, vehicle);\r\n\r\n                        // Mark this column as having a destroyed vehicle\r\n                        if (!vehicle.hasNotifiedColumn) {\r\n                            newlyDestroyedColumns.set(vehicle.columnId, currentTime);\r\n                        }\r\n\r\n                        // If vehicle is destroyed but not yet marked for clearing, mark it with a clearing time\r\n                        if (!vehicle.clearingStarted) {\r\n                            const timeoutId = setTimeout(() => {\r\n                                setVehicles(prevVehicles => {\r\n                                    // Find all vehicles in the same column\r\n                                    const columnId = vehicle.columnId;\r\n\r\n                                    return prevVehicles.map(v => {\r\n                                        if (v.id === vehicle.id) {\r\n                                            // This is the destroyed vehicle\r\n                                            return {\r\n                                                ...v,\r\n                                                clearingStarted: true,\r\n                                                clearingTime: currentTime,\r\n                                                hasNotifiedColumn: true\r\n                                            };\r\n                                        }\r\n                                        else if (v.columnId === columnId) {\r\n                                            // This is another vehicle in the same column\r\n                                            return {\r\n                                                ...v,\r\n                                                columnHasDestroyed: true,\r\n                                                lastDestroyedTime: currentTime\r\n                                            };\r\n                                        }\r\n                                        return v;\r\n                                    });\r\n                                });\r\n                            }, 0);\r\n                            timeoutRefsRef.current.push(timeoutId);\r\n                        }\r\n\r\n                        // Mark it for removal after a delay if not already marked and vehicle is fully destroyed\r\n                        if (!vehicle.markedForRemoval && vehicle.clearingStarted && healthData.isDestroyed) {\r\n                            const timeoutId = setTimeout(() => {\r\n                                setVehicles(prevVehicles => {\r\n                                    return prevVehicles.map(v => {\r\n                                        if (v.id === vehicle.id) {\r\n                                            return {\r\n                                                ...v,\r\n                                                markedForRemoval: true\r\n                                            };\r\n                                        }\r\n                                        return v;\r\n                                    });\r\n                                });\r\n                            }, DESTROYED_VEHICLE_WAIT_PERIOD); // 2 seconds delay before removing destroyed vehicles\r\n                            timeoutRefsRef.current.push(timeoutId);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            // First, remove any destroyed column vehicles that have been marked for removal\r\n            const filteredVehicles = vehicles.filter(vehicle => {\r\n                if (vehicle.isInColumn) {\r\n                    const healthData = getVehicleHealth(vehicle.id);\r\n                    // Remove if it's destroyed AND marked for removal\r\n                    if (healthData && healthData.isDead && healthData.isDestroyed && vehicle.markedForRemoval) {\r\n                        // When removing the vehicle, add its position to the cleared positions map with a timestamp\r\n                        // This information will be used by vehicles behind it\r\n                        const laneKey = `${vehicle.columnId}-${vehicle.columnPosition}`;\r\n                        clearedDestroyedPositions.set(laneKey, {\r\n                            x: vehicle.position.x,\r\n                            lane: vehicle.lane,\r\n                            road: vehicle.road,\r\n                            columnId: vehicle.columnId,\r\n                            columnPosition: vehicle.columnPosition,\r\n                            direction: vehicle.direction,\r\n                            clearingTime: currentTime // Use current time when actually removed, not previous clearing time\r\n                        });\r\n\r\n                        // Notify all other vehicles in the column that a vehicle has been completely removed\r\n                        const timeoutId = setTimeout(() => {\r\n                            setVehicles(prevVehicles => {\r\n                                return prevVehicles.map(v => {\r\n                                    if (v.columnId === vehicle.columnId) {\r\n                                        return {\r\n                                            ...v,\r\n                                            columnHasRemoval: true,\r\n                                            lastRemovalTime: currentTime\r\n                                        };\r\n                                    }\r\n                                    return v;\r\n                                });\r\n                            });\r\n                        }, 0);\r\n                        timeoutRefsRef.current.push(timeoutId);\r\n\r\n                        return false;\r\n                    }\r\n                }\r\n                // Keep all other vehicles\r\n                return true;\r\n            });\r\n\r\n            // Then continue with the regular update process\r\n            // Group vehicles by columns for synchronized movement\r\n            const columnMap = new Map();\r\n            filteredVehicles.forEach(vehicle => {\r\n                if (vehicle.isInColumn && vehicle.columnId) {\r\n                    if (!columnMap.has(vehicle.columnId)) {\r\n                        columnMap.set(vehicle.columnId, []);\r\n                    }\r\n                    columnMap.get(vehicle.columnId).push(vehicle);\r\n                }\r\n            });\r\n\r\n            // First update individual vehicles (non-column vehicles)\r\n            const updatedVehicles = filteredVehicles.map(vehicle => {\r\n                // Skip column vehicles as they'll be updated together\r\n                if (vehicle.isInColumn) return vehicle;\r\n\r\n                // Get the vehicle's health data to adjust mobility\r\n                const healthData = getVehicleHealth(vehicle.id);\r\n\r\n                // If vehicle is dead, don't update its position\r\n                if (healthData && healthData.isDead) {\r\n                    return vehicle;\r\n                }\r\n\r\n                // Apply mobility factor from health system (if available)\r\n                const mobilityFactor = healthData ? healthData.mobilityFactor : 1.0;\r\n\r\n                // Store original speed for reference\r\n                const originalSpeed = vehicle.speed * mobilityFactor;\r\n\r\n                // Check for vehicles ahead with the new distances\r\n                // Use different distance thresholds for civilian vehicles\r\n                let speed = originalSpeed;\r\n\r\n                if (!vehicle.isInColumn) {\r\n                    // Check if vehicle is in a potential traffic jam (very slow for several frames)\r\n                    if (!vehicle.jamCounter) vehicle.jamCounter = 0;\r\n                    if (!vehicle.lastJamCheck) vehicle.lastJamCheck = currentTime;\r\n\r\n                    // Only update jam status periodically to avoid rapid changes\r\n                    if (currentTime - vehicle.lastJamCheck > TRAFFIC_JAM_CHECK_INTERVAL) {\r\n                        if (vehicle.speed < TRAFFIC_JAM_SPEED_THRESHOLD) {\r\n                            vehicle.jamCounter++;\r\n                        } else {\r\n                            // Reset jam counter if moving at decent speed\r\n                            vehicle.jamCounter = Math.max(0, vehicle.jamCounter - 2); // Faster recovery\r\n                        }\r\n                        vehicle.lastJamCheck = currentTime;\r\n                    }\r\n\r\n                    // Determine if in traffic jam\r\n                    const isInTrafficJam = vehicle.jamCounter > 5;\r\n\r\n                    // Get the actual distance to the next vehicle\r\n                    const hasCollisionEmergency = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_EMERGENCY_DISTANCE);\r\n                    const hasMinimumDistance = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_MINIMUM_DISTANCE);\r\n                    const hasCollisionWarning = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_DETECTION_DISTANCE);\r\n\r\n                    // Store the previous speed for acceleration control\r\n                    if (!vehicle.previousSpeed) vehicle.previousSpeed = vehicle.speed;\r\n\r\n                    // Determine appropriate speed for civilian vehicles with traffic jam recovery\r\n                    let targetSpeed;\r\n                    if (hasCollisionEmergency) {\r\n                        // Emergency stop - too close\r\n                        targetSpeed = 0;\r\n                    } else if (hasMinimumDistance) {\r\n                        // Strong slowing down when below minimum distance\r\n                        const distanceFactor = Math.max(0, (vehicle.distanceToNext - CIVILIAN_EMERGENCY_DISTANCE)) /\r\n                            (CIVILIAN_MINIMUM_DISTANCE - CIVILIAN_EMERGENCY_DISTANCE);\r\n                        // More aggressive braking for close vehicles\r\n                        targetSpeed = originalSpeed * Math.max(0.02, Math.min(0.1, distanceFactor * 0.1));\r\n                    } else if (hasCollisionWarning) {\r\n                        // Gradual slow down based on distance\r\n                        const distanceFactor = Math.max(0, (vehicle.distanceToNext - CIVILIAN_MINIMUM_DISTANCE)) /\r\n                            (CIVILIAN_DETECTION_DISTANCE - CIVILIAN_MINIMUM_DISTANCE);\r\n                        // More aggressive deceleration curve\r\n                        targetSpeed = originalSpeed * Math.max(0.2, Math.min(0.8, distanceFactor));\r\n                    } else {\r\n                        // No obstacles ahead - recover speed\r\n                        targetSpeed = originalSpeed;\r\n\r\n                        // Apply boost if recovering from traffic jam\r\n                        // Only boost if we have significant space ahead (more than detection distance)\r\n                        if (isInTrafficJam && vehicle.distanceToNext > CIVILIAN_DETECTION_DISTANCE * 1.5) {\r\n                            targetSpeed *= TRAFFIC_JAM_RECOVERY_BOOST;\r\n                        }\r\n                    }\r\n\r\n                    // Smoother, more responsive deceleration\r\n                    const accelerationRate = targetSpeed > vehicle.speed ? 0.08 : 0.25; // Even faster deceleration than before\r\n                    speed = vehicle.speed + (targetSpeed - vehicle.speed) * accelerationRate;\r\n\r\n                    // Store current speed for next frame\r\n                    vehicle.previousSpeed = speed;\r\n                } else {\r\n                    // Military column vehicles - now using same distances as civilians\r\n                    const hasCollisionEmergency = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_EMERGENCY_DISTANCE);\r\n                    const hasMinimumDistance = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_MINIMUM_DISTANCE);\r\n                    const hasCollisionWarning = optimizedDetectCollisionAhead(vehicle, filteredVehicles, CIVILIAN_DETECTION_DISTANCE);\r\n\r\n                    // Determine appropriate speed for military vehicles - using civilian distance factors\r\n                    if (hasCollisionEmergency) {\r\n                        // Emergency stop - too close\r\n                        speed = 0;\r\n                    } else if (hasMinimumDistance) {\r\n                        // Strong slowing down when below minimum distance\r\n                        const distanceFactor = Math.max(0, (vehicle.distanceToNext - CIVILIAN_EMERGENCY_DISTANCE)) /\r\n                            (CIVILIAN_MINIMUM_DISTANCE - CIVILIAN_EMERGENCY_DISTANCE);\r\n                        // More aggressive braking for close vehicles\r\n                        speed = originalSpeed * Math.max(0.02, Math.min(0.1, distanceFactor * 0.1));\r\n                    } else if (hasCollisionWarning) {\r\n                        // Gradual slow down based on distance\r\n                        const distanceFactor = Math.max(0, (vehicle.distanceToNext - CIVILIAN_MINIMUM_DISTANCE)) /\r\n                            (CIVILIAN_DETECTION_DISTANCE - CIVILIAN_MINIMUM_DISTANCE);\r\n                        // More aggressive deceleration curve\r\n                        speed = originalSpeed * Math.max(0.2, Math.min(0.8, distanceFactor));\r\n                    }\r\n                }\r\n\r\n                // Calculate the new position with smoother acceleration/deceleration\r\n                const speedChange = Math.min(Math.abs(speed - vehicle.speed), 0.01); // Limit speed change per frame\r\n                const newSpeed = speed > vehicle.speed\r\n                    ? vehicle.speed + speedChange\r\n                    : vehicle.speed - speedChange;\r\n\r\n                const newX = vehicle.position.x + (newSpeed * vehicle.direction * delta * 60);\r\n\r\n                // Calculate the new position by modifying existing Vector3 instead of creating a new one\r\n                if (vehicle.direction > 0 && newX > terrainSize.width / 2) {\r\n                    // Reset to the beginning of the road (right direction vehicles)\r\n                    tempVector3.set(-terrainSize.width / 2, 0.3, vehicle.position.z);\r\n                    vehicle.position.copy(tempVector3);\r\n                    return {\r\n                        ...vehicle,\r\n                        speed: vehicle.speed\r\n                    };\r\n                } else if (vehicle.direction < 0 && newX < -terrainSize.width / 2) {\r\n                    // Reset to the beginning of the road (left direction vehicles)\r\n                    tempVector3.set(terrainSize.width / 2, 0.3, vehicle.position.z);\r\n                    vehicle.position.copy(tempVector3);\r\n                    return {\r\n                        ...vehicle,\r\n                        speed: vehicle.speed\r\n                    };\r\n                }\r\n\r\n                // Update position by modifying the existing object\r\n                tempVector3.set(newX, vehicle.position.y, vehicle.position.z);\r\n\r\n                // Only run one collision detection - remove this redundant section\r\n                return {\r\n                    ...vehicle,\r\n                    position: tempVector3.clone(), // Need to clone here since we're returning a new object\r\n                    speed: newSpeed\r\n                };\r\n            });\r\n\r\n            // Update lookup cache for new vehicle states\r\n            updatedVehicles.forEach(vehicle => {\r\n                vehiclesById.current.set(vehicle.id, vehicle);\r\n            });\r\n\r\n            // Now update column vehicles together\r\n            columnMap.forEach((columnVehicles, columnId) => {\r\n                // Sort by column position\r\n                columnVehicles.sort((a, b) => a.columnPosition - b.columnPosition);\r\n\r\n                if (columnVehicles.length === 0) return;\r\n\r\n                // Find the first non-destroyed vehicle to act as the lead\r\n                let leadVehicleIndex = 0;\r\n                let leadVehicle = columnVehicles[leadVehicleIndex];\r\n                let leadVehicleHealth = getVehicleHealth(leadVehicle.id);\r\n\r\n                // If the first vehicle is destroyed, find the next available vehicle to lead\r\n                while (leadVehicleIndex < columnVehicles.length - 1 &&\r\n                    leadVehicleHealth && leadVehicleHealth.isDead) {\r\n                    leadVehicleIndex++;\r\n                    leadVehicle = columnVehicles[leadVehicleIndex];\r\n                    leadVehicleHealth = getVehicleHealth(leadVehicle.id);\r\n                }\r\n\r\n                // If all vehicles are destroyed, the column can't move\r\n                if (leadVehicleHealth && leadVehicleHealth.isDead) {\r\n                    // Find the next non-destroyed vehicle to be the new lead\r\n                    // Instead of stopping the column, look for another vehicle to lead\r\n                    let newLeadFound = false;\r\n                    let newLeadVehicleIndex = -1;\r\n\r\n                    // Try to find any non-destroyed vehicle to be the new lead\r\n                    for (let i = 0; i < columnVehicles.length; i++) {\r\n                        const potentialLeadHealth = getVehicleHealth(columnVehicles[i].id);\r\n                        if (!(potentialLeadHealth && potentialLeadHealth.isDead)) {\r\n                            newLeadVehicleIndex = i;\r\n                            newLeadFound = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (newLeadFound) {\r\n                        // Update lead vehicle to the newly found non-destroyed vehicle\r\n                        leadVehicleIndex = newLeadVehicleIndex;\r\n                        leadVehicle = columnVehicles[leadVehicleIndex];\r\n                        leadVehicleHealth = getVehicleHealth(leadVehicle.id);\r\n                    } else {\r\n                        // All vehicles are destroyed, but we'll continue moving the column\r\n                        // Use the original lead vehicle's properties for movement calculation\r\n                        leadVehicle = columnVehicles[0];\r\n                    }\r\n                }\r\n\r\n                // Replace the lead vehicle concept with a column-wide movement strategy\r\n                // Instead of following a leader, vehicles maintain their original positions\r\n\r\n                // Find any non-destroyed vehicle to serve as a reference point\r\n                let referenceVehicle = null;\r\n                let referenceVehicleHealth = null;\r\n                let hasActiveVehicle = false;\r\n\r\n                for (const vehicle of columnVehicles) {\r\n                    const health = getVehicleHealth(vehicle.id);\r\n                    if (!(health && health.isDead)) {\r\n                        referenceVehicle = vehicle;\r\n                        referenceVehicleHealth = health;\r\n                        hasActiveVehicle = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // Initialize column speed here with a default value\r\n                const initialSpeed = SPEED_MIN;\r\n                let columnSpeed = initialSpeed;\r\n\r\n                // If we have an active vehicle, use its speed as reference\r\n                if (hasActiveVehicle) {\r\n                    // Use the health of reference vehicle for mobility factor\r\n                    const mobilityFactor = referenceVehicleHealth ? referenceVehicleHealth.mobilityFactor : 1.0;\r\n                    const baseSpeed = referenceVehicle.speed * mobilityFactor;\r\n                    columnSpeed = baseSpeed;\r\n                }\r\n\r\n                // Filter to active vehicles for processing\r\n                const activeColumnVehicles = columnVehicles.filter(vehicle => {\r\n                    const health = getVehicleHealth(vehicle.id);\r\n                    return !(health && health.isDead);\r\n                });\r\n\r\n                // Check if any vehicles in the column were destroyed and track timing\r\n                let columnHasDestroyed = false;\r\n                let lastDestroyedTime = null;\r\n\r\n                // Create a map of destroyed vehicles by position to make lookups faster\r\n                const destroyedVehicleMap = new Map();\r\n\r\n                for (const veh of columnVehicles) {\r\n                    const health = getVehicleHealth(veh.id);\r\n                    if (health && health.isDead) {\r\n                        columnHasDestroyed = true;\r\n                        destroyedVehicleMap.set(veh.columnPosition, veh);\r\n\r\n                        // If this vehicle was just destroyed, update the destroyed time\r\n                        if (!veh.wasMarkedDestroyed) {\r\n                            lastDestroyedTime = currentTime;\r\n                            // Mark the vehicle so we don't update the time again\r\n                            const updateIdx = updatedVehicles.findIndex(v => v.id === veh.id);\r\n                            if (updateIdx !== -1) {\r\n                                updatedVehicles[updateIdx] = {\r\n                                    ...updatedVehicles[updateIdx],\r\n                                    wasMarkedDestroyed: true,\r\n                                    clearingTime: currentTime\r\n                                };\r\n                            }\r\n                        } else if (veh.clearingTime && (!lastDestroyedTime || veh.clearingTime > lastDestroyedTime)) {\r\n                            lastDestroyedTime = veh.clearingTime;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Update all vehicles in this column with the destroyed status\r\n                if (columnHasDestroyed && lastDestroyedTime) {\r\n                    columnVehicles.forEach(veh => {\r\n                        const updateIdx = updatedVehicles.findIndex(v => v.id === veh.id);\r\n                        if (updateIdx !== -1) {\r\n                            updatedVehicles[updateIdx] = {\r\n                                ...updatedVehicles[updateIdx],\r\n                                columnHasDestroyed: true,\r\n                                lastDestroyedTime: lastDestroyedTime\r\n                            };\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // Apply collision avoidance based on the frontmost active vehicle\r\n                const frontmostActiveVehicle = activeColumnVehicles.reduce((front, current) => {\r\n                    // For positive direction, higher X is more forward\r\n                    // For negative direction, lower X is more forward\r\n                    if (referenceVehicle.direction > 0) {\r\n                        return current.position.x > front.position.x ? current : front;\r\n                    } else {\r\n                        return current.position.x < front.position.x ? current : front;\r\n                    }\r\n                }, activeColumnVehicles[0] || columnVehicles[0]); // Fallback to first column vehicle if no active vehicles\r\n\r\n                // Check for obstacles ahead using civilian distances for better safety\r\n                const hasCollisionEmergency = optimizedDetectCollisionAhead(frontmostActiveVehicle, updatedVehicles, CIVILIAN_EMERGENCY_DISTANCE);\r\n                const hasMinimumDistance = optimizedDetectCollisionAhead(frontmostActiveVehicle, updatedVehicles, CIVILIAN_MINIMUM_DISTANCE);\r\n                const hasCollisionWarning = optimizedDetectCollisionAhead(frontmostActiveVehicle, updatedVehicles, CIVILIAN_DETECTION_DISTANCE);\r\n\r\n                // Adjust speed based on conditions\r\n                if (hasCollisionEmergency) {\r\n                    columnSpeed = 0;\r\n                } else if (hasMinimumDistance) {\r\n                    const distanceFactor = (frontmostActiveVehicle.distanceToNext - CIVILIAN_EMERGENCY_DISTANCE) /\r\n                        (CIVILIAN_MINIMUM_DISTANCE - CIVILIAN_EMERGENCY_DISTANCE);\r\n                    columnSpeed = columnSpeed * Math.max(0.05, distanceFactor * 0.1);\r\n                } else if (hasCollisionWarning) {\r\n                    const distanceFactor = (frontmostActiveVehicle.distanceToNext - CIVILIAN_MINIMUM_DISTANCE) /\r\n                        (CIVILIAN_DETECTION_DISTANCE - CIVILIAN_MINIMUM_DISTANCE);\r\n                    columnSpeed = columnSpeed * Math.max(0.3, distanceFactor);\r\n                }\r\n\r\n                // Ensure column keeps moving even with destroyed vehicles\r\n                if (columnHasDestroyed && !hasCollisionEmergency) {\r\n                    columnSpeed = Math.max(columnSpeed, SPEED_MIN);\r\n                }\r\n\r\n                // Smooth acceleration/deceleration\r\n                const speedChange = Math.min(Math.abs(columnSpeed - (hasActiveVehicle ? referenceVehicle.speed : SPEED_MIN)), 0.01);\r\n                const newColumnSpeed = columnSpeed > (hasActiveVehicle ? referenceVehicle.speed : SPEED_MIN)\r\n                    ? (hasActiveVehicle ? referenceVehicle.speed : SPEED_MIN) + speedChange\r\n                    : (hasActiveVehicle ? referenceVehicle.speed : SPEED_MIN) - speedChange;\r\n\r\n                // Calculate movement for all vehicles\r\n                columnVehicles.forEach(vehicle => {\r\n                    const updatedVehicleIndex = updatedVehicles.findIndex(v => v.id === vehicle.id);\r\n                    if (updatedVehicleIndex === -1) return;\r\n\r\n                    // Skip processing destroyed vehicles\r\n                    const vehicleHealth = getVehicleHealth(vehicle.id);\r\n                    if (vehicleHealth && vehicleHealth.isDead) return;\r\n\r\n                    // Check if the column needs to wait for destroyed vehicles\r\n                    const shouldWaitInPlace = columnHasDestroyed && lastDestroyedTime &&\r\n                        currentTime - lastDestroyedTime < DESTROYED_VEHICLE_WAIT_PERIOD;\r\n\r\n                    // Find if there are any destroyed vehicles ahead of this one by comparing positions\r\n                    let hasDestroyedVehicleAhead = false;\r\n\r\n                    // More efficient check: directly compare positions to find destroyed vehicles ahead\r\n                    for (const [position, destroyedVehicle] of destroyedVehicleMap.entries()) {\r\n                        // For positive direction: destroyed vehicle is ahead if its x position is greater\r\n                        // For negative direction: destroyed vehicle is ahead if its x position is smaller\r\n                        if ((vehicle.direction > 0 && destroyedVehicle.position.x > vehicle.position.x) ||\r\n                            (vehicle.direction < 0 && destroyedVehicle.position.x < vehicle.position.x)) {\r\n\r\n                            // Check if there's a destroyed vehicle ahead that's still in the wait period\r\n                            const timeSinceDestroyed = destroyedVehicle.clearingTime ?\r\n                                (currentTime - destroyedVehicle.clearingTime) : 0;\r\n\r\n                            if (timeSinceDestroyed < DESTROYED_VEHICLE_WAIT_PERIOD) {\r\n                                hasDestroyedVehicleAhead = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Only wait if there's a destroyed vehicle directly ahead AND we're in the wait period\r\n                    // Otherwise, continue moving\r\n                    if (shouldWaitInPlace && hasDestroyedVehicleAhead) {\r\n                        // Keep the vehicle in place during the wait period\r\n                        tempVector3.set(vehicle.position.x, vehicle.position.y, vehicle.position.z);\r\n                        updatedVehicles[updatedVehicleIndex] = {\r\n                            ...vehicle,\r\n                            position: tempVector3.clone(),\r\n                            speed: 0,\r\n                            columnHasDestroyed,\r\n                            lastDestroyedTime,\r\n                            waitingForVehicleAhead: true\r\n                        };\r\n                    } else {\r\n                        // Move the vehicle forward - either it's ahead of any destroyed vehicles,\r\n                        // or there is no need to wait anymore\r\n\r\n                        // For vehicles that were waiting, add a small boost to catch up with the formation\r\n                        const catchUpBoost = vehicle.waitingForVehicleAhead ? 1.2 : 1.0;\r\n\r\n                        // Calculate the position offset from a baseline column position\r\n                        const xMovement = newColumnSpeed * vehicle.direction * delta * 60 * catchUpBoost;\r\n\r\n                        // Calculate new position, preserving the exact formation\r\n                        tempVector3.set(\r\n                            vehicle.position.x + xMovement,\r\n                            vehicle.position.y,\r\n                            vehicle.position.z\r\n                        );\r\n\r\n                        updatedVehicles[updatedVehicleIndex] = {\r\n                            ...vehicle,\r\n                            position: tempVector3.clone(),\r\n                            speed: newColumnSpeed * catchUpBoost,\r\n                            columnHasDestroyed,\r\n                            lastDestroyedTime,\r\n                            waitingForVehicleAhead: false\r\n                        };\r\n                    }\r\n                });\r\n\r\n                // Check if column has reached the end of the road\r\n                const frontmostX = frontmostActiveVehicle.position.x + (newColumnSpeed * frontmostActiveVehicle.direction * delta * 60);\r\n\r\n                if (frontmostActiveVehicle.direction > 0 && frontmostX > terrainSize.width / 2 ||\r\n                    frontmostActiveVehicle.direction < 0 && frontmostX < -terrainSize.width / 2) {\r\n\r\n                    // Remove the column from the scene\r\n                    columnVehicles.forEach((vehicle) => {\r\n                        const updatedVehicleIndex = updatedVehicles.findIndex(v => v.id === vehicle.id);\r\n                        if (updatedVehicleIndex !== -1) {\r\n                            updatedVehicles[updatedVehicleIndex] = {\r\n                                ...vehicle,\r\n                                isRemoved: true\r\n                            };\r\n                        }\r\n                    });\r\n\r\n                    // Schedule a new column to spawn\r\n                    scheduleColumnRespawn(frontmostActiveVehicle.lane, frontmostActiveVehicle.direction);\r\n                }\r\n            });\r\n\r\n            // Handle cleanup of removed vehicles and respawning\r\n            const processedVehicles = updatedVehicles.filter(vehicle => {\r\n                if (!vehicle) return false; // Skip null vehicles\r\n                if (vehicle.isRemoved) return false;\r\n\r\n                // Skip column vehicles as they're handled differently\r\n                if (vehicle.isInColumn) return true;\r\n\r\n                const healthData = getVehicleHealth(vehicle.id);\r\n\r\n                if (healthData && healthData.isDead && healthData.isDestroyed) {\r\n                    // Skip respawning for civilian vehicles\r\n                    if (!vehicle.isInColumn) {\r\n                        return false; // Remove the civilian vehicle completely\r\n                    }\r\n\r\n                    // For military columns, keep the existing respawn logic\r\n                    const randomOffset = Math.random() * (terrainSize.width * 0.4);\r\n                    const respawnPosition = vehicle.direction > 0 ?\r\n                        -terrainSize.width / 2 + randomOffset :\r\n                        terrainSize.width / 2 + randomOffset;\r\n\r\n                    const vehiclesAtStartingPoint = updatedVehicles.filter(v =>\r\n                        v && v.id !== vehicle.id && // Add null check\r\n                        v.direction === vehicle.direction &&\r\n                        v.lane === vehicle.lane &&\r\n                        v.road === vehicle.road &&\r\n                        ((vehicle.direction > 0 &&\r\n                            v.position.x > respawnPosition &&\r\n                            v.position.x < respawnPosition + MINIMUM_DISTANCE * 2.5) ||\r\n                            (vehicle.direction < 0 &&\r\n                                v.position.x < respawnPosition &&\r\n                                v.position.x > respawnPosition - MINIMUM_DISTANCE * 2.5))\r\n                    );\r\n\r\n                    const respawnOffset = vehiclesAtStartingPoint.length > 0\r\n                        ? (vehicle.direction > 0 ? -MINIMUM_DISTANCE * 2.5 : MINIMUM_DISTANCE * 2.5)\r\n                        : 0;\r\n\r\n                    const respawnedVehicle = {\r\n                        ...vehicle,\r\n                        position: new THREE.Vector3(\r\n                            respawnPosition + respawnOffset,\r\n                            0.3,\r\n                            vehicle.position.z\r\n                        ),\r\n                        speed: SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN)\r\n                    };\r\n\r\n                    // Reset the vehicle's health in the health system only for military vehicles\r\n                    const timeoutId = setTimeout(() => {\r\n                        vehicleHealthStore.respawnVehicle(vehicle.id);\r\n                    }, 0);\r\n                    timeoutRefsRef.current.push(timeoutId);\r\n\r\n                    return respawnedVehicle;\r\n                }\r\n\r\n                return true;\r\n            }).filter(Boolean); // Remove any remaining null values\r\n\r\n            // Add in new columns from the spawn queue\r\n            const newColumns = processColumnSpawnQueue();\r\n            if (newColumns.length > 0) {\r\n                processedVehicles.push(...newColumns);\r\n            }\r\n\r\n            return processedVehicles;\r\n        });\r\n    });\r\n\r\n    // Function to schedule a column respawn with proper timeout tracking\r\n    function scheduleColumnRespawn(lane, direction) {\r\n        const laneKey = `${lane}-${direction}`;\r\n\r\n        // Only schedule if there isn't already a pending spawn\r\n        if (!columnSpawnTimersRef.current[laneKey]) {\r\n            const timeoutId = setTimeout(() => {\r\n                // Clear the timer reference\r\n                columnSpawnTimersRef.current[laneKey] = null;\r\n\r\n                // Add this lane to the queue for respawning a column\r\n                // The actual spawning will happen in the next frame update\r\n                setVehicles(vehicles => {\r\n                    // Directly add the new column here\r\n                    return [...vehicles, ...createNewColumn(lane, direction)];\r\n                });\r\n            }, COLUMN_RESPAWN_DELAY);\r\n\r\n            // Store the timeout ID for cleanup\r\n            columnSpawnTimersRef.current[laneKey] = timeoutId;\r\n            timeoutRefsRef.current.push(timeoutId);\r\n        }\r\n    }\r\n\r\n    // Function to process any pending column spawns\r\n    function processColumnSpawnQueue() {\r\n        // This is now handled by the setTimeout callbacks\r\n        return [];\r\n    }\r\n\r\n    // Function to create a new column with optimized object creation\r\n    function createNewColumn(lane, direction) {\r\n        const newVehicles = [];\r\n        const columnConfig = getRandomItem(MILITARY_COLUMNS);\r\n        const newColumnId = `column-${Math.random().toString(36).substring(2, 9)}`;\r\n\r\n        // Generate a random position along the road for the column to spawn\r\n        // Use a range within the terrain size with some padding\r\n        const randomOffset = Math.random() * (terrainSize.width * 0.7) - (terrainSize.width * 0.35);\r\n\r\n        // Starting position for the new column - random point on the road\r\n        const startingX = direction > 0 ?\r\n            -terrainSize.width / 2 + 100 + randomOffset : // For positive direction\r\n            terrainSize.width / 2 - 100 + randomOffset;  // For negative direction\r\n\r\n        // Get road from lane position (extract Z coordinate)\r\n        const roadZ = Math.abs(lane) < ROAD_WIDTH ? -ROAD_SPACING / 2 : ROAD_SPACING / 2;\r\n\r\n        let currentX = startingX;\r\n        let vehicleIndex = 0;\r\n\r\n        // Create all vehicles for the new column\r\n        for (const vehicleGroup of columnConfig.vehicles) {\r\n            for (let i = 0; i < vehicleGroup.count; i++) {\r\n                const vehicleType = getRandomVehicleOfType(vehicleGroup.type);\r\n                if (!vehicleType) continue;\r\n\r\n                const vehicleId = `${newColumnId}-${vehicleGroup.type}-${i}`;\r\n\r\n                // Get a vehicle from the pool\r\n                const vehicle = vehiclePoolRef.current.get();\r\n\r\n                // Configure the vehicle\r\n                vehicle.id = vehicleId;\r\n                vehicle.type = vehicleType;\r\n                vehicle.columnId = newColumnId;\r\n                vehicle.columnPosition = vehicleIndex;\r\n                vehicle.position.set(\r\n                    currentX,\r\n                    0.3,\r\n                    lane + (Math.random() * 0.2 - 0.1)\r\n                );\r\n                vehicle.rotation = direction > 0 ? rotationMap.right : rotationMap.left;\r\n                vehicle.speed = SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN) * 0.5;\r\n                vehicle.direction = direction;\r\n                vehicle.lane = lane;\r\n                vehicle.road = roadZ;\r\n                vehicle.laneType = LANE_TYPES.FAST;\r\n                vehicle.isInColumn = true;\r\n                vehicle.hitbox = { width: 1.33, height: 1.33, depth: 4.0 };\r\n\r\n                // Add to new vehicles\r\n                newVehicles.push(vehicle);\r\n\r\n                // Move to next vehicle position - use specific spacing based on vehicle type\r\n                if (vehicleGroup.type === 'tank') {\r\n                    currentX += direction * TANK_SPACING;\r\n                } else if (vehicleGroup.type === 'ifv') {\r\n                    currentX += direction * IFV_SPACING;\r\n                } else {\r\n                    currentX += direction * COLUMN_VEHICLE_SPACING;\r\n                }\r\n                vehicleIndex++;\r\n            }\r\n        }\r\n\r\n        return newVehicles;\r\n    }\r\n\r\n    // Add useFrame for distance-based culling similar to EnvironmentObjects\r\n    const { camera } = useThree();\r\n    useFrame(() => {\r\n        const cameraPosition = camera.position;\r\n        const FAR_DISTANCE = 1200; // Set slightly higher than environment objects to avoid pop-in\r\n\r\n        // Apply distance-based culling to vehicles\r\n        vehicleRefsMap.current.forEach((vehicleRef, vehicleId) => {\r\n            if (vehicleRef && vehicleRef.current) {\r\n                // Get the vehicle position\r\n                const position = vehicleRef.current.position;\r\n\r\n                // Calculate distance from camera\r\n                const distanceToCamera = new THREE.Vector3(\r\n                    position.x,\r\n                    position.y,\r\n                    position.z\r\n                ).distanceTo(cameraPosition);\r\n\r\n                // Set visibility based on distance\r\n                vehicleRef.current.visible = (distanceToCamera < FAR_DISTANCE);\r\n            }\r\n        });\r\n    });\r\n\r\n    // Memoize the rendering of vehicles to reduce unnecessary re-renders\r\n    const renderVehicles = useMemo(() => {\r\n        // Clear old references for vehicles that no longer exist\r\n        const currentVehicleIds = new Set(vehicles.map(v => v.id));\r\n        vehicleRefsMap.current.forEach((_, id) => {\r\n            if (!currentVehicleIds.has(id)) {\r\n                vehicleRefsMap.current.delete(id);\r\n            }\r\n        });\r\n\r\n        return vehicles\r\n            // Filter out vehicles outside the visible area - only render vehicles within the terrain bounds\r\n            .filter((vehicle) => {\r\n                // Define the visible area boundary with a small buffer\r\n                const buffer = 50; // buffer in units beyond the terrain edge\r\n                const minX = -terrainSize.width / 2 - buffer;\r\n                const maxX = terrainSize.width / 2 + buffer;\r\n\r\n                // Define valid Z-coordinate range (road width)\r\n                const roadHalfWidth = ROAD_WIDTH / 2;\r\n                const validZRanges = [\r\n                    // Upper road Z range\r\n                    { min: ROAD_SPACING / 2 - roadHalfWidth - 5, max: ROAD_SPACING / 2 + roadHalfWidth + 5 },\r\n                    // Lower road Z range\r\n                    { min: -ROAD_SPACING / 2 - roadHalfWidth - 5, max: -ROAD_SPACING / 2 + roadHalfWidth + 5 }\r\n                ];\r\n\r\n                // Check if vehicle is within X bounds\r\n                const validX = vehicle.position.x >= minX && vehicle.position.x <= maxX;\r\n\r\n                // Check if vehicle is within any valid Z range\r\n                const validZ = validZRanges.some(range =>\r\n                    vehicle.position.z >= range.min && vehicle.position.z <= range.max\r\n                );\r\n\r\n                // Only render vehicles within valid X and Z coordinates\r\n                return validX && validZ;\r\n            })\r\n            .map((vehicle) => {\r\n                // Get health data for visual effects from our pre-fetched function\r\n                const healthData = getVehicleHealth(vehicle.id);\r\n\r\n                // Use the enhanced vehicle component with health system\r\n                const VehicleComponent = EnhancedVehicleTypes[vehicle.type];\r\n\r\n                // Create a ref for this vehicle if it doesn't exist yet\r\n                if (!vehicleRefsMap.current.has(vehicle.id)) {\r\n                    vehicleRefsMap.current.set(vehicle.id, React.createRef());\r\n                }\r\n\r\n                // Get the ref for this vehicle\r\n                const vehicleRef = vehicleRefsMap.current.get(vehicle.id);\r\n\r\n                return (\r\n                    <group\r\n                        key={vehicle.id}\r\n                        ref={vehicleRef}\r\n                        position={[vehicle.position.x, vehicle.position.y, vehicle.position.z]}\r\n                        rotation={[vehicle.rotation.x, vehicle.rotation.y, vehicle.rotation.z]}\r\n                        userData={{\r\n                            vehicleId: vehicle.id,\r\n                            vehicleType: vehicle.type,\r\n                            isVehicle: true,\r\n                            isInColumn: vehicle.isInColumn,\r\n                            columnId: vehicle.columnId,\r\n                            hitbox: {\r\n                                width: vehicle.hitbox?.width || 1.0,\r\n                                height: vehicle.hitbox?.height || 1.0,\r\n                                depth: vehicle.hitbox?.depth || 3.0\r\n                            }\r\n                        }}\r\n                        name={`vehicle-${vehicle.id}`}\r\n                    >\r\n                        {/* Enhanced Vehicle Type Component with hitbox information */}\r\n                        <VehicleComponent\r\n                            id={vehicle.id}\r\n                            scale={[4, 4, 4]}\r\n                            userData={{\r\n                                vehicleId: vehicle.id,\r\n                                vehicleType: vehicle.type,\r\n                                isVehicle: true\r\n                            }}\r\n                        />\r\n\r\n                        {/* DEBUG: Visual hitbox representation - disabled in production */}\r\n                        {false && (\r\n                            <mesh\r\n                                visible={true}\r\n                                position={[0, vehicle.hitbox?.height / 2 || 0.5, 0]}\r\n                                userData={{\r\n                                    isVehicleHitbox: true,\r\n                                    parentVehicleId: vehicle.id\r\n                                }}\r\n                            >\r\n                                <boxGeometry args={[\r\n                                    vehicle.hitbox?.depth || 4.0,\r\n                                    vehicle.hitbox?.height || 1.33,\r\n                                    vehicle.hitbox?.width || 1.33\r\n                                ]} />\r\n                                <meshBasicMaterial color=\"red\" wireframe={true} opacity={0.5} transparent={true} />\r\n                            </mesh>\r\n                        )}\r\n                    </group>\r\n                );\r\n            });\r\n    }, [vehicles, getVehicleHealth, terrainSize]);\r\n\r\n    return <>{renderVehicles}</>;\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { useThree } from '@react-three/fiber';\r\n\r\n/**\r\n * Component for handling vehicle selection via raycasting in the 3D scene\r\n * Does not render any UI elements directly\r\n */\r\nconst VehicleSelector = ({ onSelectVehicle }) => {\r\n    const { scene, camera, gl, raycaster } = useThree();\r\n\r\n    // Set up click handler for selecting vehicles\r\n    useEffect(() => {\r\n        const handleClick = (event) => {\r\n            // Calculate mouse position in normalized device coordinates\r\n            const canvas = gl.domElement;\r\n            const rect = canvas.getBoundingClientRect();\r\n\r\n            const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n            const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n            // Update raycaster with mouse position and camera\r\n            raycaster.setFromCamera({ x, y }, camera);\r\n\r\n            // Find intersected objects\r\n            const intersects = raycaster.intersectObjects(scene.children, true);\r\n\r\n            // Look for vehicle objects\r\n            let found = false;\r\n\r\n            for (let i = 0; i < intersects.length; i++) {\r\n                const object = intersects[i].object;\r\n\r\n                // Go up the parent chain to find object with userData containing vehicleId\r\n                let currentObject = object;\r\n                while (currentObject) {\r\n                    if (currentObject.userData && currentObject.userData.vehicleId) {\r\n                        onSelectVehicle(currentObject.userData.vehicleId);\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                    currentObject = currentObject.parent;\r\n                }\r\n\r\n                if (found) break;\r\n            }\r\n\r\n            // If no vehicle was clicked, deselect is handled by onPointerMissed in Canvas\r\n        };\r\n\r\n        // Add click event listener to canvas\r\n        const canvasElement = gl.domElement;\r\n        canvasElement.addEventListener('click', handleClick);\r\n\r\n        return () => {\r\n            canvasElement.removeEventListener('click', handleClick);\r\n        };\r\n    }, [scene, camera, gl, raycaster, onSelectVehicle]);\r\n\r\n    // This component doesn't render anything directly\r\n    return null;\r\n};\r\n\r\nexport default VehicleSelector; ","import React, { useEffect, useMemo } from 'react';\r\nimport { useThree } from '@react-three/fiber';\r\nimport { Environment, Sky } from '@react-three/drei';\r\nimport { FogExp2 } from 'three';\r\nimport OriginalTerrain from './terrain/OriginalTerrain';\r\nimport Road from '../Road';\r\nimport OriginalEnvironmentObjects from './objects/OriginalEnvironmentObjects';\r\nimport DroneSwitcher from '../DroneSwitcher';\r\nimport VehiclesOnRoad from '../VehiclesOnRoad';\r\nimport ExplosionsManager from '../effects/ExplosionsManager';\r\nimport ShotgunEffectsManager from '../effects/ShotgunEffectsManager';\r\nimport { DamageIndicatorsManager } from '../effects/DamageIndicator';\r\nimport VehicleSelector from '../VehicleSelector';\r\n\r\n// OriginalMap - The green, grassy map with plenty of trees and vegetation\r\nexport default function OriginalMap() {\r\n    const { scene, camera } = useThree();\r\n\r\n    useEffect(() => {\r\n        // Create exponential fog for the original map\r\n        scene.fog = new FogExp2('#b5d3e7', 0.00085);\r\n\r\n        // Set camera position for original map\r\n        camera.position.set(0, 20, 100);\r\n        camera.updateProjectionMatrix();\r\n\r\n        return () => {\r\n            // Cleanup if needed when map is unmounted\r\n        };\r\n    }, [scene, camera]);\r\n\r\n    // Sky attributes for original map\r\n    const skyProps = useMemo(() => ({\r\n        distance: 450000,\r\n        sunPosition: [0, 1, 0],\r\n        inclination: 0.5,\r\n        azimuth: 0.25\r\n    }), []);\r\n\r\n    return (\r\n        <>\r\n            {/* Environmental lighting */}\r\n            <Environment preset=\"sunset\" />\r\n\r\n            {/* Sky */}\r\n            <Sky\r\n                distance={skyProps.distance}\r\n                sunPosition={skyProps.sunPosition}\r\n                inclination={skyProps.inclination}\r\n                azimuth={skyProps.azimuth}\r\n            />\r\n\r\n            {/* Directional light */}\r\n            <directionalLight\r\n                position={[50, 50, 25]}\r\n                intensity={1.5}\r\n                shadow-mapSize={[2048, 2048]}\r\n                shadow-camera-left={-1000}\r\n                shadow-camera-right={1000}\r\n                shadow-camera-top={1000}\r\n                shadow-camera-bottom={-1000}\r\n                shadow-camera-near={0.1}\r\n                shadow-camera-far={2000}\r\n            />\r\n\r\n            {/* Ambient light */}\r\n            <ambientLight intensity={0.2} />\r\n\r\n            {/* Original terrain */}\r\n            <OriginalTerrain />\r\n\r\n            {/* Road network */}\r\n            <Road mapType=\"original\" />\r\n\r\n            {/* Environment objects specific to original map */}\r\n            <OriginalEnvironmentObjects />\r\n\r\n            {/* Vehicles and game elements that are common across maps */}\r\n            <VehiclesOnRoad />\r\n            <DroneSwitcher />\r\n            <ExplosionsManager />\r\n            <ShotgunEffectsManager />\r\n            <DamageIndicatorsManager />\r\n            <VehicleSelector />\r\n        </>\r\n    );\r\n} ","import React, { useMemo, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\n\r\n// Constants for desert terrain configuration\r\nexport const DESERT_TERRAIN_SIZE = 2000; // 2000m x 2000m\r\nconst CHUNK_SIZE = 205; // Increased from 200 to add slight overlap\r\nconst OVERLAP_FACTOR = 5; // 5 units of overlap between chunks\r\n\r\nexport default function DesertTerrain() {\r\n    // Calculate chunks count\r\n    const terrainSize = DESERT_TERRAIN_SIZE;\r\n    const chunksCount = useMemo(() => {\r\n        const count = Math.ceil(terrainSize / (CHUNK_SIZE - OVERLAP_FACTOR));\r\n        return { x: count, z: count };\r\n    }, [terrainSize]);\r\n\r\n    const SEGMENTS = 200; // Segment resolution for the entire terrain\r\n    const segmentsPerChunk = useMemo(() => ({\r\n        x: Math.floor(SEGMENTS / chunksCount.x),\r\n        z: Math.floor(SEGMENTS / chunksCount.z)\r\n    }), [chunksCount]);\r\n\r\n    // Add some noise to the terrain to create sand dune effect\r\n    const planeGeometry = useMemo(() => {\r\n        const geometry = new THREE.PlaneGeometry(\r\n            CHUNK_SIZE,\r\n            CHUNK_SIZE,\r\n            segmentsPerChunk.x,\r\n            segmentsPerChunk.z\r\n        );\r\n\r\n        // Create sand dune effect by adding subtle height variation\r\n        // This creates the appearance of rolling sand dunes\r\n        const vertices = geometry.attributes.position.array;\r\n        for (let i = 0; i < vertices.length; i += 3) {\r\n            const x = vertices[i];\r\n            const z = vertices[i + 2];\r\n\r\n            // Create sand dune effect\r\n            const noise1 = Math.sin(x * 0.05) * Math.cos(z * 0.05) * 2;\r\n            const noise2 = Math.sin(x * 0.1 + 0.3) * Math.sin(z * 0.1 + 0.1) * 1.5;\r\n            const noise3 = Math.cos(x * 0.2 + 1.1) * Math.sin(z * 0.15 + 0.5) * 1;\r\n\r\n            // Apply smoother, more rounded dunes for a desert\r\n            vertices[i + 1] = noise1 + noise2 + noise3;\r\n        }\r\n\r\n        // Update normals for proper lighting\r\n        geometry.computeVertexNormals();\r\n\r\n        return geometry;\r\n    }, [segmentsPerChunk]);\r\n\r\n    // Sandy material for desert terrain\r\n    const planeMaterial = useMemo(() => {\r\n        return new THREE.MeshStandardMaterial({\r\n            color: '#DEB887', // Sandy color\r\n            roughness: 0.9,\r\n            metalness: 0.05,\r\n            flatShading: false // Disable for smoother appearance\r\n        });\r\n    }, []);\r\n\r\n    // Use instanced mesh for efficient rendering of multiple chunks\r\n    const instancedMeshRef = useRef();\r\n    const tempObject = useMemo(() => new THREE.Object3D(), []);\r\n\r\n    // Create the chunks based on the terrain size\r\n    const chunks = useMemo(() => {\r\n        const result = [];\r\n        const halfSize = terrainSize / 2;\r\n        const chunkOffset = (CHUNK_SIZE - OVERLAP_FACTOR) / 2;\r\n\r\n        for (let x = 0; x < chunksCount.x; x++) {\r\n            for (let z = 0; z < chunksCount.z; z++) {\r\n                result.push({\r\n                    position: [\r\n                        -halfSize + x * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset,\r\n                        0,\r\n                        -halfSize + z * (CHUNK_SIZE - OVERLAP_FACTOR) + chunkOffset\r\n                    ],\r\n                    rotation: [-Math.PI / 2, 0, 0] // Rotate to make it horizontal\r\n                });\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }, [terrainSize, chunksCount]);\r\n\r\n    // Setup the instanced mesh on the first render\r\n    useFrame(() => {\r\n        if (instancedMeshRef.current) {\r\n            chunks.forEach((chunk, i) => {\r\n                const [x, y, z] = chunk.position;\r\n                const [rx, ry, rz] = chunk.rotation;\r\n\r\n                tempObject.position.set(x, y, z);\r\n                tempObject.rotation.set(rx, ry, rz);\r\n                tempObject.updateMatrix();\r\n\r\n                instancedMeshRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n\r\n            instancedMeshRef.current.instanceMatrix.needsUpdate = true;\r\n\r\n            // Only need to run this once to set up the instances\r\n            return null;\r\n        }\r\n    }, [chunks]);\r\n\r\n    return (\r\n        <instancedMesh\r\n            ref={instancedMeshRef}\r\n            args={[planeGeometry, planeMaterial, chunks.length]}\r\n            receiveShadow\r\n        />\r\n    );\r\n} ","import React, { useMemo, useRef, useEffect } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame, useThree } from '@react-three/fiber';\r\nimport { DESERT_TERRAIN_SIZE } from '../terrain/DesertTerrain';\r\n\r\n// Constants for desert environment objects\r\nconst ROAD_WIDTH = 140;\r\nconst ROAD_SPACING = 300;\r\nconst MIN_SCALE = 1.2;\r\nconst MAX_SCALE = 1.8;\r\n\r\n// Tree type definitions\r\nconst TREE_TYPES = {\r\n    PINE: 'pine',\r\n    OAK: 'oak',\r\n    PALM: 'palm',\r\n    BIRCH: 'birch'\r\n};\r\n\r\n// Spatial hash grid for efficient object placement\r\nclass SpatialHashGrid {\r\n    constructor(bounds, dimensions) {\r\n        this.bounds = bounds;\r\n        this.dimensions = dimensions;\r\n        this.cells = {};\r\n    }\r\n\r\n    // Calculate the cell coordinates for a position\r\n    getCell(position) {\r\n        const { min, max } = this.bounds;\r\n        const cellX = Math.floor((position.x - min.x) / (max.x - min.x) * this.dimensions.x);\r\n        const cellZ = Math.floor((position.z - min.z) / (max.z - min.z) * this.dimensions.z);\r\n        return { x: cellX, z: cellZ };\r\n    }\r\n\r\n    // Get cell key for hashing\r\n    getCellKey(cell) {\r\n        return `${cell.x},${cell.z}`;\r\n    }\r\n\r\n    // Add object to grid\r\n    insert(position, object) {\r\n        const cell = this.getCell(position);\r\n        const key = this.getCellKey(cell);\r\n\r\n        if (!this.cells[key]) {\r\n            this.cells[key] = [];\r\n        }\r\n        this.cells[key].push({ position, object });\r\n    }\r\n\r\n    // Find objects near a position\r\n    query(position, radius) {\r\n        const result = [];\r\n        const center = this.getCell(position);\r\n\r\n        // Calculate how many cells we need to check based on radius\r\n        const cellRadius = Math.ceil(radius / Math.min(\r\n            (this.bounds.max.x - this.bounds.min.x) / this.dimensions.x,\r\n            (this.bounds.max.z - this.bounds.min.z) / this.dimensions.z\r\n        ));\r\n\r\n        // Check all cells within cell radius\r\n        for (let x = -cellRadius; x <= cellRadius; x++) {\r\n            for (let z = -cellRadius; z <= cellRadius; z++) {\r\n                const cell = { x: center.x + x, z: center.z + z };\r\n                const key = this.getCellKey(cell);\r\n\r\n                if (this.cells[key]) {\r\n                    for (const item of this.cells[key]) {\r\n                        const dx = item.position.x - position.x;\r\n                        const dz = item.position.z - position.z;\r\n                        const distance = Math.sqrt(dx * dx + dz * dz);\r\n\r\n                        if (distance <= radius) {\r\n                            result.push(item.object);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n// Generate a deterministic random number based on seed\r\nfunction seededRandom(seed) {\r\n    const x = Math.sin(seed) * 10000;\r\n    return x - Math.floor(x);\r\n}\r\n\r\n// Generate desert environment objects with a focus on arid landscape\r\nexport default function DesertEnvironmentObjects() {\r\n    const terrainSize = DESERT_TERRAIN_SIZE;\r\n    const seed = 54321; // Different seed for desert to ensure a different layout\r\n\r\n    // Setup spatial grid\r\n    const halfWidth = terrainSize / 2;\r\n    const halfHeight = terrainSize / 2;\r\n\r\n    // Use a fixed seed for deterministic generation\r\n    const { trees, rocks, bushes, cacti, largeBush } = useMemo(() => {\r\n        // Initialize spatial hash grid for position checking\r\n        const bounds = {\r\n            min: { x: -halfWidth, z: -halfHeight },\r\n            max: { x: halfWidth, z: halfHeight }\r\n        };\r\n        const grid = new SpatialHashGrid(bounds, { x: 20, z: 20 });\r\n\r\n        // Check if a position is on the road\r\n        const isOnRoad = (x, z) => {\r\n            return (\r\n                Math.abs(z - ROAD_SPACING / 2) < ROAD_WIDTH / 2 ||\r\n                Math.abs(z + ROAD_SPACING / 2) < ROAD_WIDTH / 2\r\n            );\r\n        };\r\n\r\n        // Generate fixed positions for each object type with spatial constraints\r\n        const trees = { pine: [], oak: [], palm: [], birch: [] };\r\n        const rocks = [];\r\n        const bushes = [];\r\n        const cacti = [];\r\n\r\n        // Minimum required distance between objects to avoid overlapping\r\n        const MIN_DISTANCE = 12;\r\n\r\n        // Function to check if position is valid (not on road, not too close to other objects)\r\n        const isPositionValid = (x, z, radius) => {\r\n            if (isOnRoad(x, z)) return false;\r\n\r\n            // Add a safety margin around roads\r\n            const roadMargin = 10;\r\n            if (\r\n                Math.abs(z - ROAD_SPACING / 2) < (ROAD_WIDTH / 2) + roadMargin ||\r\n                Math.abs(z + ROAD_SPACING / 2) < (ROAD_WIDTH / 2) + roadMargin\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            // Check spatial grid for nearby objects\r\n            const pos = { x, z };\r\n            const nearby = grid.query(pos, radius);\r\n            return nearby.length === 0;\r\n        };\r\n\r\n        // Function to add an object at a valid position with deterministic randomness\r\n        const addObject = (collection, objectType, baseIndex, count, minDistance) => {\r\n            for (let i = 0; i < count; i++) {\r\n                const seedValue = seed + baseIndex + i;\r\n\r\n                // Use deterministic random values\r\n                const randX = seededRandom(seedValue * 1.1);\r\n                const randZ = seededRandom(seedValue * 2.3);\r\n                const randScale = seededRandom(seedValue * 3.7);\r\n                const randRotation = seededRandom(seedValue * 4.5);\r\n                const randType = Math.floor(seededRandom(seedValue * 5.9) * 4);\r\n\r\n                // Calculate position using deterministic randomness\r\n                const x = randX * terrainSize - halfWidth;\r\n                const z = randZ * terrainSize - halfHeight;\r\n\r\n                // Skip if position is invalid (deterministic skipping)\r\n                if (!isPositionValid(x, z, minDistance)) continue;\r\n\r\n                // Create object with properties\r\n                const scale = MIN_SCALE + randScale * (MAX_SCALE - MIN_SCALE);\r\n                const rotation = randRotation * Math.PI * 2;\r\n                const position = new THREE.Vector3(x, 0, z);\r\n\r\n                const object = {\r\n                    position: [x, 0, z],\r\n                    scale,\r\n                    rotation,\r\n                    type: randType\r\n                };\r\n\r\n                // Add to collection based on object type\r\n                if (objectType === 'tree') {\r\n                    const treeTypeName = Object.values(TREE_TYPES)[randType];\r\n                    trees[treeTypeName].push(object);\r\n                } else if (objectType === 'rock') {\r\n                    rocks.push(object);\r\n                } else if (objectType === 'bush') {\r\n                    bushes.push(object);\r\n                } else if (objectType === 'cactus') {\r\n                    cacti.push(object);\r\n                }\r\n\r\n                // Insert into spatial grid\r\n                grid.insert({ x, z }, object);\r\n            }\r\n        };\r\n\r\n        // Setup desert environment with fewer trees, more rocks and cacti\r\n        const treeCount = 80;      // Very few trees in desert\r\n        const rockCount = 300;     // Many rocks in desert\r\n        const bushCount = 100;     // Fewer bushes, more sparse\r\n        const cactusCount = 150;   // Add cacti for desert theme\r\n\r\n        // Generate fixed number of objects with deterministic positioning\r\n        addObject(trees, 'tree', 0, treeCount, MIN_DISTANCE);\r\n        addObject(rocks, 'rock', 10000, rockCount, MIN_DISTANCE / 3);\r\n        addObject(bushes, 'bush', 20000, bushCount, MIN_DISTANCE / 3);\r\n        addObject(cacti, 'cactus', 30000, cactusCount, MIN_DISTANCE);\r\n\r\n        // Special large rock formation (instead of a bush) for desert theme\r\n        const specialSeed = seed * 9876;\r\n        const specialX = seededRandom(specialSeed) * terrainSize - halfWidth;\r\n        const specialZ = seededRandom(specialSeed + 100) * terrainSize - halfHeight;\r\n\r\n        let largeBush = null;\r\n        if (!isOnRoad(specialX, specialZ)) {\r\n            largeBush = {\r\n                position: [specialX, 0, specialZ],\r\n                scale: 4.0,\r\n                rotation: seededRandom(specialSeed + 200) * Math.PI * 2\r\n            };\r\n        }\r\n\r\n        return { trees, rocks, bushes, cacti, largeBush };\r\n    }, [halfWidth, halfHeight, terrainSize]);\r\n\r\n    const { camera } = useThree();\r\n\r\n    // References to our instanced meshes\r\n    const treeRefs = {\r\n        pine: { trunk: useRef(), foliage: useRef() },\r\n        oak: { trunk: useRef(), foliage: useRef() },\r\n        palm: { trunk: useRef(), foliage: useRef() },\r\n        birch: { trunk: useRef(), foliage: useRef() }\r\n    };\r\n\r\n    const rocksRef = useRef();\r\n    const bushesRef = useRef();\r\n    const cactiRef = useRef();\r\n    const largeBushRef = useRef();\r\n\r\n    // Create a frustum for culling\r\n    const frustum = useMemo(() => new THREE.Frustum(), []);\r\n    const projScreenMatrix = useMemo(() => new THREE.Matrix4(), []);\r\n    const tempObject = useMemo(() => new THREE.Object3D(), []);\r\n\r\n    // Materials for desert environment - dry, pale colors\r\n    const treeMaterials = useMemo(() => ({\r\n        pine: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#8B4513',\r\n                roughness: 0.9,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#8B8B65', // Pale olive\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            })\r\n        },\r\n        oak: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#654321',\r\n                roughness: 0.9,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#9B9B65', // Pale brown-green\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            })\r\n        },\r\n        palm: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#A0522D',\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#A8C27D', // Pale green\r\n                roughness: 0.9,\r\n                flatShading: true\r\n            })\r\n        },\r\n        birch: {\r\n            trunk: new THREE.MeshStandardMaterial({\r\n                color: '#F5F5DC',\r\n                roughness: 0.7,\r\n                flatShading: true\r\n            }),\r\n            foliage: new THREE.MeshStandardMaterial({\r\n                color: '#D3D3A4', // Pale yellow-green\r\n                roughness: 0.8,\r\n                flatShading: true\r\n            })\r\n        }\r\n    }), []);\r\n\r\n    // Desert rocks - more reddish-orange\r\n    const rockMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#B8860B', // Dark goldenrod\r\n            roughness: 1.0,\r\n            flatShading: true\r\n        }),\r\n        []);\r\n\r\n    // Desert bushes - dried out\r\n    const bushMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#8B8B6A', // Dried beige-green\r\n            roughness: 0.9,\r\n            flatShading: true\r\n        }),\r\n        []);\r\n\r\n    // Cactus material\r\n    const cactusMaterial = useMemo(() =>\r\n        new THREE.MeshStandardMaterial({\r\n            color: '#4C7F50', // Cactus green\r\n            roughness: 0.8,\r\n            flatShading: true\r\n        }),\r\n        []);\r\n\r\n    // Create optimized geometries\r\n    const rockGeometry = useMemo(() => new THREE.IcosahedronGeometry(1, 0), []);\r\n    const bushGeometry = useMemo(() => new THREE.SphereGeometry(2, 6, 4), []);\r\n    const cactusGeometry = useMemo(() => new THREE.CylinderGeometry(0.8, 1.2, 5, 8, 4), []);\r\n\r\n    // Tree dimension presets\r\n    const treeDimensions = useMemo(() => ({\r\n        pine: {\r\n            trunkHeight: 4.8,\r\n            trunkRadius: 0.75,\r\n            foliageOffset: 4.8\r\n        },\r\n        oak: {\r\n            trunkHeight: 4.5,\r\n            trunkRadius: 0.975,\r\n            foliageOffset: 3\r\n        },\r\n        palm: {\r\n            trunkHeight: 7.5,\r\n            trunkRadius: 0.525,\r\n            foliageOffset: 7.5\r\n        },\r\n        birch: {\r\n            trunkHeight: 6.75,\r\n            trunkRadius: 0.4875,\r\n            foliageOffset: 4.5\r\n        }\r\n    }), []);\r\n\r\n    // Create simplified LOD geometries\r\n    const treeGeometries = useMemo(() => {\r\n        // Create high detail geometries\r\n        const highDetail = {\r\n            pine: {\r\n                trunk: new THREE.CylinderGeometry(0.6, 0.75, 4.8, 8, 3),\r\n                foliage: new THREE.ConeGeometry(3, 9.6, 8, 4)\r\n            },\r\n            oak: {\r\n                trunk: new THREE.CylinderGeometry(0.9, 1.05, 4.5, 10, 4),\r\n                foliage: new THREE.SphereGeometry(3.75, 12, 10)\r\n            },\r\n            palm: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.6, 7.5, 8, 5),\r\n                foliage: new THREE.DodecahedronGeometry(3.75, 1)\r\n            },\r\n            birch: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.53, 6.75, 9, 4),\r\n                foliage: new THREE.OctahedronGeometry(3, 2)\r\n            }\r\n        };\r\n\r\n        // Create low detail geometries\r\n        const lowDetail = {\r\n            pine: {\r\n                trunk: new THREE.CylinderGeometry(0.6, 0.75, 4.8, 4, 1),\r\n                foliage: new THREE.ConeGeometry(3, 9.6, 5, 1)\r\n            },\r\n            oak: {\r\n                trunk: new THREE.CylinderGeometry(0.9, 1.05, 4.5, 6, 1),\r\n                foliage: new THREE.SphereGeometry(3.75, 6, 4)\r\n            },\r\n            palm: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.6, 7.5, 4, 1),\r\n                foliage: new THREE.DodecahedronGeometry(3.75, 0)\r\n            },\r\n            birch: {\r\n                trunk: new THREE.CylinderGeometry(0.45, 0.53, 6.75, 5, 1),\r\n                foliage: new THREE.OctahedronGeometry(3, 0)\r\n            }\r\n        };\r\n\r\n        return { highDetail, lowDetail };\r\n    }, []);\r\n\r\n    // Setup instanced mesh matrices\r\n    useEffect(() => {\r\n        // Setup trees for each type with proper positioning\r\n        Object.entries(trees).forEach(([treeType, positions]) => {\r\n            if (!positions.length) return;\r\n\r\n            const {\r\n                trunkHeight,\r\n                trunkRadius,\r\n                foliageOffset\r\n            } = treeDimensions[treeType];\r\n\r\n            // Setup trunk matrices\r\n            const trunkRef = treeRefs[treeType].trunk;\r\n            if (trunkRef.current && positions.length > 0) {\r\n                positions.forEach((tree, i) => {\r\n                    const [x, y, z] = tree.position;\r\n                    const scale = tree.scale;\r\n\r\n                    const scaledTrunkHeight = trunkHeight * scale;\r\n                    const trunkY = scaledTrunkHeight / 2;\r\n\r\n                    tempObject.position.set(x, trunkY, z);\r\n                    tempObject.rotation.set(0, tree.rotation, 0);\r\n                    tempObject.scale.set(scale, scale, scale);\r\n                    tempObject.updateMatrix();\r\n\r\n                    trunkRef.current.setMatrixAt(i, tempObject.matrix);\r\n                });\r\n                trunkRef.current.instanceMatrix.needsUpdate = true;\r\n                trunkRef.current.computeBoundingSphere();\r\n                if (trunkRef.current.boundingSphere) {\r\n                    trunkRef.current.boundingSphere.radius *= 1.5;\r\n                }\r\n            }\r\n\r\n            // Setup foliage matrices\r\n            const foliageRef = treeRefs[treeType].foliage;\r\n            if (foliageRef.current && positions.length > 0) {\r\n                positions.forEach((tree, i) => {\r\n                    const [x, y, z] = tree.position;\r\n                    const scale = tree.scale;\r\n\r\n                    // Scale foliage position\r\n                    const scaledFoliageOffset = foliageOffset * scale;\r\n\r\n                    // Determine foliage position based on tree type\r\n                    let foliageY;\r\n                    switch (treeType) {\r\n                        case 'pine':\r\n                            foliageY = scaledFoliageOffset + (4.8 * scale);\r\n                            break;\r\n                        case 'birch':\r\n                            foliageY = scaledFoliageOffset + (2.25 * scale);\r\n                            break;\r\n                        case 'oak':\r\n                        case 'palm':\r\n                        default:\r\n                            foliageY = scaledFoliageOffset + (1.5 * scale);\r\n                    }\r\n\r\n                    tempObject.position.set(x, foliageY, z);\r\n                    tempObject.rotation.set(0, tree.rotation, 0);\r\n                    tempObject.scale.setScalar(scale);\r\n                    tempObject.updateMatrix();\r\n\r\n                    foliageRef.current.setMatrixAt(i, tempObject.matrix);\r\n                });\r\n                foliageRef.current.instanceMatrix.needsUpdate = true;\r\n                foliageRef.current.computeBoundingSphere();\r\n                if (foliageRef.current.boundingSphere) {\r\n                    foliageRef.current.boundingSphere.radius *= 1.5;\r\n                }\r\n            }\r\n        });\r\n\r\n        // Setup rocks\r\n        if (rocksRef.current && rocks.length > 0) {\r\n            rocks.forEach((rock, i) => {\r\n                const [x, y, z] = rock.position;\r\n                const scale = rock.scale;\r\n                const objectY = 0.5 * scale;\r\n\r\n                tempObject.position.set(x, objectY, z);\r\n                tempObject.rotation.set(0, rock.rotation, 0);\r\n                tempObject.scale.setScalar(scale);\r\n                tempObject.updateMatrix();\r\n\r\n                rocksRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n            rocksRef.current.instanceMatrix.needsUpdate = true;\r\n            rocksRef.current.computeBoundingSphere();\r\n            if (rocksRef.current.boundingSphere) {\r\n                rocksRef.current.boundingSphere.radius *= 1.5;\r\n            }\r\n        }\r\n\r\n        // Setup bushes\r\n        if (bushesRef.current && bushes.length > 0) {\r\n            bushes.forEach((bush, i) => {\r\n                const [x, y, z] = bush.position;\r\n                const scale = bush.scale;\r\n                const objectY = 2 * scale * 0.5;\r\n\r\n                tempObject.position.set(x, objectY, z);\r\n                tempObject.rotation.set(0, bush.rotation, 0);\r\n                tempObject.scale.setScalar(scale);\r\n                tempObject.updateMatrix();\r\n\r\n                bushesRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n            bushesRef.current.instanceMatrix.needsUpdate = true;\r\n            bushesRef.current.computeBoundingSphere();\r\n            if (bushesRef.current.boundingSphere) {\r\n                bushesRef.current.boundingSphere.radius *= 1.5;\r\n            }\r\n        }\r\n\r\n        // Setup cacti\r\n        if (cactiRef.current && cacti.length > 0) {\r\n            cacti.forEach((cactus, i) => {\r\n                const [x, y, z] = cactus.position;\r\n                const scale = cactus.scale;\r\n                const objectY = 2.5 * scale;\r\n\r\n                tempObject.position.set(x, objectY, z);\r\n                tempObject.rotation.set(0, cactus.rotation, 0);\r\n                tempObject.scale.setScalar(scale);\r\n                tempObject.updateMatrix();\r\n\r\n                cactiRef.current.setMatrixAt(i, tempObject.matrix);\r\n            });\r\n            cactiRef.current.instanceMatrix.needsUpdate = true;\r\n            cactiRef.current.computeBoundingSphere();\r\n            if (cactiRef.current.boundingSphere) {\r\n                cactiRef.current.boundingSphere.radius *= 1.5;\r\n            }\r\n        }\r\n\r\n        // Setup large bush/rock\r\n        if (largeBushRef.current && largeBush) {\r\n            const [x, y, z] = largeBush.position;\r\n            const scale = largeBush.scale;\r\n            const objectY = 2 * scale * 0.5;\r\n\r\n            tempObject.position.set(x, objectY, z);\r\n            tempObject.rotation.set(0, largeBush.rotation, 0);\r\n            tempObject.scale.setScalar(scale);\r\n            tempObject.updateMatrix();\r\n\r\n            largeBushRef.current.matrix.copy(tempObject.matrix);\r\n            largeBushRef.current.matrixAutoUpdate = false;\r\n            // Regular meshes don't have computeBoundingSphere method\r\n            // Create a manual bounding sphere for distance checks\r\n            if (!largeBushRef.current.boundingSphere) {\r\n                largeBushRef.current.boundingSphere = new THREE.Sphere(\r\n                    new THREE.Vector3(x, objectY, z),\r\n                    2 * scale // Approximate radius based on scale\r\n                );\r\n            }\r\n        }\r\n    }, [trees, rocks, bushes, cacti, largeBush, treeDimensions, tempObject]);\r\n\r\n    // Distance-based culling for performance\r\n    useFrame(({ camera }) => {\r\n        const cameraPosition = camera.position;\r\n        const FAR_DISTANCE = 1000;\r\n        const MID_DISTANCE = 500;\r\n\r\n        // Apply culling for trees\r\n        Object.entries(treeRefs).forEach(([treeType, refs]) => {\r\n            if (!refs.trunk.current || !refs.trunk.current.boundingSphere ||\r\n                !refs.foliage.current || !refs.foliage.current.boundingSphere) {\r\n                return;\r\n            }\r\n\r\n            const trunkDistance = refs.trunk.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            const foliageDistance = refs.foliage.current.boundingSphere.center.distanceTo(cameraPosition);\r\n\r\n            refs.trunk.current.visible = (trunkDistance < FAR_DISTANCE);\r\n            refs.foliage.current.visible = (foliageDistance < FAR_DISTANCE);\r\n        });\r\n\r\n        // Apply culling for rocks and bushes\r\n        if (rocksRef.current && rocksRef.current.boundingSphere) {\r\n            const rocksDistance = rocksRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            rocksRef.current.visible = (rocksDistance < FAR_DISTANCE);\r\n        }\r\n\r\n        if (bushesRef.current && bushesRef.current.boundingSphere) {\r\n            const bushesDistance = bushesRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            bushesRef.current.visible = (bushesDistance < FAR_DISTANCE);\r\n        }\r\n\r\n        // Apply culling for cacti\r\n        if (cactiRef.current && cactiRef.current.boundingSphere) {\r\n            const cactiDistance = cactiRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            cactiRef.current.visible = (cactiDistance < FAR_DISTANCE);\r\n        }\r\n\r\n        // Large bush/rock - individual mesh\r\n        if (largeBushRef.current && largeBushRef.current.boundingSphere) {\r\n            const largeDistance = largeBushRef.current.boundingSphere.center.distanceTo(cameraPosition);\r\n            largeBushRef.current.visible = (largeDistance < FAR_DISTANCE);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            {/* All tree types with proper culling */}\r\n            {Object.entries(trees).map(([treeType, positions]) => {\r\n                if (!positions.length) return null;\r\n\r\n                // Get tree geometries\r\n                const highGeo = treeGeometries.highDetail[treeType];\r\n                const treeMat = treeMaterials[treeType];\r\n\r\n                return (\r\n                    <group key={treeType}>\r\n                        <instancedMesh\r\n                            ref={treeRefs[treeType].trunk}\r\n                            args={[null, null, positions.length]}\r\n                            frustumCulled={true}\r\n                        >\r\n                            <primitive object={highGeo.trunk} />\r\n                            <primitive object={treeMat.trunk} />\r\n                        </instancedMesh>\r\n\r\n                        <instancedMesh\r\n                            ref={treeRefs[treeType].foliage}\r\n                            args={[null, null, positions.length]}\r\n                            frustumCulled={true}\r\n                        >\r\n                            <primitive object={highGeo.foliage} />\r\n                            <primitive object={treeMat.foliage} />\r\n                        </instancedMesh>\r\n                    </group>\r\n                );\r\n            })}\r\n\r\n            {/* Rocks with instanced mesh */}\r\n            <instancedMesh\r\n                ref={rocksRef}\r\n                args={[rockGeometry, rockMaterial, rocks.length]}\r\n                frustumCulled={true}\r\n            />\r\n\r\n            {/* Bushes with instanced mesh */}\r\n            <instancedMesh\r\n                ref={bushesRef}\r\n                args={[bushGeometry, bushMaterial, bushes.length]}\r\n                frustumCulled={true}\r\n            />\r\n\r\n            {/* Cacti with instanced mesh */}\r\n            <instancedMesh\r\n                ref={cactiRef}\r\n                args={[cactusGeometry, cactusMaterial, cacti.length]}\r\n                frustumCulled={true}\r\n            />\r\n\r\n            {/* Special Large Rock Formation */}\r\n            {largeBush && (\r\n                <mesh\r\n                    ref={largeBushRef}\r\n                    frustumCulled={true}\r\n                >\r\n                    <sphereGeometry args={[2, 10, 8]} />\r\n                    <meshStandardMaterial\r\n                        color=\"#8B8B6A\"\r\n                        roughness={0.9}\r\n                        metalness={0.05}\r\n                        flatShading={true}\r\n                    />\r\n                </mesh>\r\n            )}\r\n        </group>\r\n    );\r\n} ","import React, { useEffect, useMemo } from 'react';\r\nimport { useThree } from '@react-three/fiber';\r\nimport { Environment, Sky } from '@react-three/drei';\r\nimport { FogExp2 } from 'three';\r\nimport DesertTerrain from './terrain/DesertTerrain';\r\nimport Road from '../Road';\r\nimport DesertEnvironmentObjects from './objects/DesertEnvironmentObjects';\r\nimport DroneSwitcher from '../DroneSwitcher';\r\nimport VehiclesOnRoad from '../VehiclesOnRoad';\r\nimport ExplosionsManager from '../effects/ExplosionsManager';\r\nimport ShotgunEffectsManager from '../effects/ShotgunEffectsManager';\r\nimport { DamageIndicatorsManager } from '../effects/DamageIndicator';\r\nimport VehicleSelector from '../VehicleSelector';\r\n\r\n// DesertMap - A sandy, arid desert with sparse vegetation, cacti, and more rocks\r\nexport default function DesertMap() {\r\n    const { scene, camera } = useThree();\r\n\r\n    useEffect(() => {\r\n        // Create dusty exponential fog for the desert map\r\n        scene.fog = new FogExp2('#e6d9c9', 0.0009);\r\n\r\n        // Set camera position for desert map\r\n        camera.position.set(0, 25, 90);\r\n        camera.updateProjectionMatrix();\r\n\r\n        return () => {\r\n            // Cleanup if needed when map is unmounted\r\n        };\r\n    }, [scene, camera]);\r\n\r\n    // Sky attributes for desert map - more orange/yellow tones\r\n    const skyProps = useMemo(() => ({\r\n        distance: 450000,\r\n        sunPosition: [0.5, 0.8, 0],\r\n        inclination: 0.6,\r\n        azimuth: 0.35\r\n    }), []);\r\n\r\n    return (\r\n        <>\r\n            {/* Environmental lighting */}\r\n            <Environment preset=\"sunset\" />\r\n\r\n            {/* Sky with desert atmosphere */}\r\n            <Sky\r\n                distance={skyProps.distance}\r\n                sunPosition={skyProps.sunPosition}\r\n                inclination={skyProps.inclination}\r\n                azimuth={skyProps.azimuth}\r\n            />\r\n\r\n            {/* Directional light - stronger in desert */}\r\n            <directionalLight\r\n                position={[50, 50, 25]}\r\n                intensity={1.8}\r\n                shadow-mapSize={[2048, 2048]}\r\n                shadow-camera-left={-1000}\r\n                shadow-camera-right={1000}\r\n                shadow-camera-top={1000}\r\n                shadow-camera-bottom={-1000}\r\n                shadow-camera-near={0.1}\r\n                shadow-camera-far={2000}\r\n            />\r\n\r\n            {/* Ambient light */}\r\n            <ambientLight intensity={0.15} />\r\n\r\n            {/* Desert terrain */}\r\n            <DesertTerrain />\r\n\r\n            {/* Road network */}\r\n            <Road mapType=\"desert\" />\r\n\r\n            {/* Environment objects specific to desert map */}\r\n            <DesertEnvironmentObjects />\r\n\r\n            {/* Vehicles and game elements that are common across maps */}\r\n            <VehiclesOnRoad />\r\n            <DroneSwitcher />\r\n            <ExplosionsManager />\r\n            <ShotgunEffectsManager />\r\n            <DamageIndicatorsManager />\r\n            <VehicleSelector />\r\n        </>\r\n    );\r\n} ","import React from 'react';\r\nimport { useMapStore } from '../utils/MapStore';\r\nimport OriginalMap from './maps/OriginalMap';\r\nimport DesertMap from './maps/DesertMap';\r\n\r\n// This component handles loading the appropriate map based on the current selection\r\nconst MapContainer = () => {\r\n    const { currentMapType } = useMapStore();\r\n\r\n    // Render a different map component based on the selected map type\r\n    const renderMap = () => {\r\n        switch (currentMapType) {\r\n            case 'desert':\r\n                return <DesertMap />;\r\n            case 'original':\r\n            default:\r\n                return <OriginalMap />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {renderMap()}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default MapContainer; ","import React from 'react';\r\nimport MapContainer from './MapContainer';\r\nimport VehicleSelector from './VehicleSelector';\r\n\r\nexport default function Scene({ onSelectVehicle }) {\r\n    return (\r\n        <>\r\n            {/* MapContainer loads the appropriate map based on the current selection */}\r\n            <MapContainer />\r\n\r\n            {/* Vehicle selection system (no UI rendering) */}\r\n            <VehicleSelector onSelectVehicle={onSelectVehicle} />\r\n        </>\r\n    );\r\n} ","import React, { useEffect } from 'react';\r\nimport { useKeyboardControls } from '@react-three/drei';\r\nimport { useDrones, DRONE_TYPES } from '../utils/GameContext';\r\nimport { Controls } from './KeyboardControls';\r\nimport '../styles/droneSelector.css';\r\n\r\nexport default function DroneSelector() {\r\n    const { currentDrone, switchDrone } = useDrones();\r\n    const [subscribeKeys] = useKeyboardControls();\r\n\r\n    // Handle keyboard selection\r\n    useEffect(() => {\r\n        return subscribeKeys((state) => {\r\n            if (state[Controls.selectDrone1]) switchDrone(DRONE_TYPES.GRENADIER);\r\n            if (state[Controls.selectDrone2]) switchDrone(DRONE_TYPES.KAMIKAZE);\r\n            if (state[Controls.selectDrone3]) switchDrone(DRONE_TYPES.BOMBER);\r\n            if (state[Controls.selectDrone4]) switchDrone(DRONE_TYPES.PLAYER);\r\n        });\r\n    }, [subscribeKeys, switchDrone]);\r\n\r\n    return (\r\n        <div className=\"drone-selector\">\r\n            <div className=\"selector-heading\">Select Drone</div>\r\n            <div className=\"selector-options\">\r\n                <button\r\n                    className={`selector-button ${currentDrone === DRONE_TYPES.GRENADIER ? 'active' : ''}`}\r\n                    onClick={() => switchDrone(DRONE_TYPES.GRENADIER)}\r\n                >\r\n                    <div className=\"icon grenadier\"></div>\r\n                    <div>Grenadier</div>\r\n                    <div className=\"key-hint\">1</div>\r\n                </button>\r\n\r\n                <button\r\n                    className={`selector-button ${currentDrone === DRONE_TYPES.KAMIKAZE ? 'active' : ''}`}\r\n                    onClick={() => switchDrone(DRONE_TYPES.KAMIKAZE)}\r\n                >\r\n                    <div className=\"icon kamikaze\"></div>\r\n                    <div>Kamikaze</div>\r\n                    <div className=\"key-hint\">2</div>\r\n                </button>\r\n\r\n                <button\r\n                    className={`selector-button ${currentDrone === DRONE_TYPES.BOMBER ? 'active' : ''}`}\r\n                    onClick={() => switchDrone(DRONE_TYPES.BOMBER)}\r\n                >\r\n                    <div className=\"icon bomber\"></div>\r\n                    <div>Bomber</div>\r\n                    <div className=\"key-hint\">3</div>\r\n                </button>\r\n\r\n                <button\r\n                    className={`selector-button ${currentDrone === DRONE_TYPES.PLAYER ? 'active' : ''}`}\r\n                    onClick={() => switchDrone(DRONE_TYPES.PLAYER)}\r\n                >\r\n                    <div className=\"icon player\"></div>\r\n                    <div>Player</div>\r\n                    <div className=\"key-hint\">4</div>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n} ","import React, { useState, useEffect } from 'react';\r\nimport { useVehicleHealthStore } from '../../utils/VehicleHealthSystem';\r\nimport { getWeaponName } from '../../utils/WeaponPhysics';\r\n\r\n/**\r\n * HUD component to display selected vehicle's health information\r\n */\r\nconst VehicleHealthHUD = ({ selectedVehicleId }) => {\r\n    const [healthInfo, setHealthInfo] = useState(null);\r\n    const getVehicleHealth = useVehicleHealthStore(state => state.getVehicleHealth);\r\n\r\n    // Update health info when selectedVehicleId changes\r\n    useEffect(() => {\r\n        if (!selectedVehicleId) {\r\n            setHealthInfo(null);\r\n            return;\r\n        }\r\n\r\n        // Get initial health data\r\n        updateHealthInfo();\r\n\r\n        // Set up interval to periodically update health info\r\n        const interval = setInterval(updateHealthInfo, 500);\r\n\r\n        return () => clearInterval(interval);\r\n\r\n        function updateHealthInfo() {\r\n            const health = getVehicleHealth(selectedVehicleId);\r\n            setHealthInfo(health);\r\n        }\r\n    }, [selectedVehicleId, getVehicleHealth]);\r\n\r\n    if (!healthInfo) {\r\n        return null;\r\n    }\r\n\r\n    // Calculate health percentage for display\r\n    const healthPercent = Math.floor((healthInfo.currentHealth / healthInfo.maxHealth) * 100);\r\n\r\n    // Determine color based on health level\r\n    const getHealthColor = () => {\r\n        if (healthPercent > 70) return '#44ff44'; // Green\r\n        if (healthPercent > 40) return '#ffff44'; // Yellow\r\n        if (healthPercent > 20) return '#ff8844'; // Orange\r\n        return '#ff4444'; // Red\r\n    };\r\n\r\n    // Get a description of the vehicle's status\r\n    const getStatusDescription = () => {\r\n        if (healthInfo.isDead) return 'DESTROYED';\r\n        if (healthInfo.isCritical) return 'CRITICAL';\r\n        if (healthPercent < 60) return 'DAMAGED';\r\n        return 'OPERATIONAL';\r\n    };\r\n\r\n    return (\r\n        <div className=\"vehicle-health-hud\">\r\n            <h3>Vehicle Status: {healthInfo.type.replace(/_/g, ' ').toUpperCase()}</h3>\r\n\r\n            <div className=\"health-bar-container\">\r\n                <div className=\"health-bar-label\">\r\n                    Health: {healthPercent}%\r\n                </div>\r\n                <div className=\"health-bar-outer\">\r\n                    <div\r\n                        className=\"health-bar-inner\"\r\n                        style={{\r\n                            width: `${healthPercent}%`,\r\n                            backgroundColor: getHealthColor()\r\n                        }}\r\n                    />\r\n                </div>\r\n                <div className=\"health-status\">\r\n                    Status: {getStatusDescription()}\r\n                </div>\r\n            </div>\r\n\r\n            {healthInfo.mobilityFactor < 1 && (\r\n                <div className=\"mobility-info\">\r\n                    Mobility: {Math.floor(healthInfo.mobilityFactor * 100)}%\r\n                </div>\r\n            )}\r\n\r\n            {healthInfo.visualEffects.length > 0 && (\r\n                <div className=\"damage-effects\">\r\n                    Active Effects: {healthInfo.visualEffects.join(', ')}\r\n                </div>\r\n            )}\r\n\r\n            {healthInfo.damageLog.length > 0 && (\r\n                <div className=\"damage-log\">\r\n                    <h4>Recent Damage:</h4>\r\n                    <ul>\r\n                        {healthInfo.damageLog.slice(-3).map((event, index) => (\r\n                            <li key={index}>\r\n                                {event.weaponType ? getWeaponName(event.weaponType) : 'Unknown'} -\r\n                                {Math.floor(event.finalDamage)} damage\r\n                                {event.hitLocation && ` (${event.hitLocation})`}\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VehicleHealthHUD;\r\n\r\n// CSS for the component\r\nexport const VehicleHealthHUDStyles = `\r\n  .vehicle-health-hud {\r\n    position: absolute;\r\n    bottom: 20px;\r\n    left: 20px;\r\n    background-color: rgba(0, 0, 0, 0.7);\r\n    border: 1px solid #444;\r\n    border-radius: 5px;\r\n    padding: 15px;\r\n    color: white;\r\n    font-family: 'Arial', sans-serif;\r\n    width: 300px;\r\n    z-index: 1000;\r\n  }\r\n  \r\n  .vehicle-health-hud h3 {\r\n    margin: 0 0 10px 0;\r\n    font-size: 16px;\r\n    text-transform: uppercase;\r\n    letter-spacing: 1px;\r\n  }\r\n  \r\n  .health-bar-container {\r\n    margin-bottom: 10px;\r\n  }\r\n  \r\n  .health-bar-label {\r\n    margin-bottom: 5px;\r\n    font-size: 14px;\r\n  }\r\n  \r\n  .health-bar-outer {\r\n    height: 20px;\r\n    background-color: #333;\r\n    border-radius: 10px;\r\n    overflow: hidden;\r\n  }\r\n  \r\n  .health-bar-inner {\r\n    height: 100%;\r\n    transition: width 0.3s ease, background-color 0.3s ease;\r\n  }\r\n  \r\n  .health-status {\r\n    margin-top: 5px;\r\n    font-weight: bold;\r\n    font-size: 14px;\r\n  }\r\n  \r\n  .mobility-info {\r\n    margin-top: 8px;\r\n    font-size: 14px;\r\n    color: #ffaa00;\r\n  }\r\n  \r\n  .damage-effects {\r\n    margin-top: 8px;\r\n    font-size: 14px;\r\n    color: #ff6666;\r\n  }\r\n  \r\n  .damage-log {\r\n    margin-top: 10px;\r\n  }\r\n  \r\n  .damage-log h4 {\r\n    margin: 0 0 5px 0;\r\n    font-size: 14px;\r\n  }\r\n  \r\n  .damage-log ul {\r\n    margin: 0;\r\n    padding: 0 0 0 20px;\r\n    font-size: 12px;\r\n  }\r\n  \r\n  .damage-log li {\r\n    margin-bottom: 2px;\r\n  }\r\n`; ","import React from 'react';\r\nimport './ControlsList.css';\r\nimport { useDrones, DRONE_TYPES } from '../../utils/GameContext';\r\n\r\nexport default function ControlsList() {\r\n    const { currentDrone } = useDrones();\r\n\r\n    // Base controls always shown\r\n    const baseControls = [\r\n        { key: 'W', action: 'Move Forward' },\r\n        { key: 'S', action: 'Move Backward' },\r\n        { key: 'A', action: 'Strafe Left' },\r\n        { key: 'D', action: 'Strafe Right' },\r\n        { key: 'Q', action: 'Turn Left' },\r\n        { key: 'E', action: 'Turn Right' },\r\n        { key: 'SPACE', action: 'Move Up' },\r\n        { key: 'SHIFT', action: 'Move Down' },\r\n        { key: '1', action: 'Select Grenadier' },\r\n        { key: '2', action: 'Select Kamikaze' },\r\n        { key: '3', action: 'Select Bomber' }\r\n    ];\r\n\r\n    // Drone-specific controls\r\n    const droneSpecificControls = {\r\n        [DRONE_TYPES.KAMIKAZE]: [\r\n            { key: 'V', action: 'Toggle First Person View' },\r\n            { key: 'MOUSE', action: 'Control Direction (in FPV)' }\r\n        ],\r\n        [DRONE_TYPES.GRENADIER]: [],\r\n        [DRONE_TYPES.BOMBER]: []\r\n    };\r\n\r\n    // Combine base controls with drone-specific ones\r\n    const controls = [...baseControls, ...(droneSpecificControls[currentDrone] || [])];\r\n\r\n    return (\r\n        <div className=\"controls-list\">\r\n            <div className=\"controls-heading\">Controls</div>\r\n            <div className=\"controls-items\">\r\n                {controls.map((control, index) => (\r\n                    <div key={index} className=\"control-item\">\r\n                        <span className=\"key\">{control.key}</span>\r\n                        <span className=\"action\">{control.action}</span>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n} ","import React, { useState, useEffect } from 'react';\r\nimport { useDrones, DRONE_TYPES } from '../utils/GameContext';\r\nimport { BomberHUD } from './drones/Bomber';\r\nimport { GrenadierHUD } from './drones/Grenadier';\r\nimport { KamikazeHUD } from './drones/Kamikaze';\r\n\r\nexport default function DroneHUDs() {\r\n    const { currentDrone } = useDrones();\r\n    const showHUD = true; // Always show HUD\r\n\r\n    // Weapon ammo states - in a real app these would be shared with the drone components\r\n    const [bomberAmmo, setBomberAmmo] = useState({\r\n        mineAmmo: 3,\r\n        mortarAmmo: 5,\r\n        rpgAmmo: 4\r\n    });\r\n\r\n    const [grenadierAmmo, setGrenadierAmmo] = useState({\r\n        shotgunAmmo: 12,\r\n        grenadeAmmo: 6,\r\n        dartAmmo: 9\r\n    });\r\n\r\n    // Listen for weapon-related events from window\r\n    useEffect(() => {\r\n        // Event listeners to update ammo counts\r\n        const handleAmmoUpdate = (e) => {\r\n            const { droneType, weaponType, ammoCount } = e.detail;\r\n\r\n            if (droneType === DRONE_TYPES.BOMBER) {\r\n                setBomberAmmo(prev => ({\r\n                    ...prev,\r\n                    [weaponType]: ammoCount\r\n                }));\r\n            } else if (droneType === DRONE_TYPES.GRENADIER) {\r\n                setGrenadierAmmo(prev => ({\r\n                    ...prev,\r\n                    [weaponType]: ammoCount\r\n                }));\r\n            }\r\n        };\r\n\r\n        window.addEventListener('ammoUpdate', handleAmmoUpdate);\r\n\r\n        return () => {\r\n            window.removeEventListener('ammoUpdate', handleAmmoUpdate);\r\n        };\r\n    }, []);\r\n\r\n    // Render the appropriate HUD based on the current drone\r\n    switch (currentDrone) {\r\n        case DRONE_TYPES.BOMBER:\r\n            return (\r\n                <BomberHUD\r\n                    mineAmmo={bomberAmmo.mineAmmo}\r\n                    mortarAmmo={bomberAmmo.mortarAmmo}\r\n                    rpgAmmo={bomberAmmo.rpgAmmo}\r\n                    showHUD={showHUD}\r\n                />\r\n            );\r\n        case DRONE_TYPES.GRENADIER:\r\n            return (\r\n                <GrenadierHUD\r\n                    shotgunAmmo={grenadierAmmo.shotgunAmmo}\r\n                    grenadeAmmo={grenadierAmmo.grenadeAmmo}\r\n                    dartAmmo={grenadierAmmo.dartAmmo}\r\n                    showHUD={showHUD}\r\n                />\r\n            );\r\n        case DRONE_TYPES.KAMIKAZE:\r\n            return (\r\n                <KamikazeHUD\r\n                    showHUD={showHUD}\r\n                />\r\n            );\r\n        default:\r\n            return null;\r\n    }\r\n} ","import React from 'react';\r\nimport { useMapStore } from '../utils/MapStore';\r\n\r\nconst MapSelector = () => {\r\n    const { currentMapType, setMapType } = useMapStore();\r\n\r\n    return (\r\n        <div className=\"map-selector\">\r\n            <button\r\n                className={`map-button ${currentMapType === 'original' ? 'active' : ''}`}\r\n                onClick={() => setMapType('original')}\r\n            >\r\n                Original Map\r\n            </button>\r\n            <button\r\n                className={`map-button ${currentMapType === 'desert' ? 'active' : ''}`}\r\n                onClick={() => setMapType('desert')}\r\n            >\r\n                Desert Map\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MapSelector; ","import React, { Suspense, useState } from 'react';\r\nimport { Canvas } from '@react-three/fiber';\r\nimport { Stats } from '@react-three/drei';\r\nimport Scene from './components/Scene';\r\nimport KeyboardControls from './components/KeyboardControls';\r\nimport DroneSelector from './components/DroneSelector';\r\nimport VehicleHealthHUD from './components/ui/VehicleHealthHUD';\r\nimport ControlsList from './components/ui/ControlsList';\r\nimport DroneHUDs from './components/DroneHUDs';\r\nimport MapSelector from './components/MapSelector';\r\nimport './styles/MapSelector.css';\r\n\r\nexport default function App() {\r\n    // State for the selected vehicle\r\n    const [selectedVehicleId, setSelectedVehicleId] = useState(null);\r\n\r\n    // Shared configuration\r\n    const canvasConfig = {\r\n        shadows: true,\r\n        camera: { position: [0, 20, 100], fov: 50 },\r\n        dpr: [0.75, 1], // Lower resolution for better performance\r\n        onPointerMissed: () => setSelectedVehicleId(null) // Deselect when clicking empty space\r\n    };\r\n\r\n    return (\r\n        <div style={{ width: '100%', height: '100vh' }}>\r\n            <KeyboardControls>\r\n                <Canvas {...canvasConfig}>\r\n                    <color attach=\"background\" args={['#87CEEB']} />\r\n                    <fog attach=\"fog\" args={['#87CEEB', 100, 1000]} />\r\n\r\n                    <Suspense fallback={null}>\r\n                        <Scene onSelectVehicle={setSelectedVehicleId} />\r\n                    </Suspense>\r\n\r\n                    {process.env.NODE_ENV === 'development' && <Stats />}\r\n                </Canvas>\r\n\r\n                {/* UI Layer outside the Canvas */}\r\n                <div className=\"ui-layer\">\r\n                    <ControlsList />\r\n                    <DroneSelector />\r\n                    <MapSelector />\r\n                    <VehicleHealthHUD selectedVehicleId={selectedVehicleId} />\r\n                    <DroneHUDs />\r\n                </div>\r\n            </KeyboardControls>\r\n        </div>\r\n    );\r\n} ","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App.jsx';\r\nimport './index.css';\r\nimport './styles/drone.css';\r\nimport { GameProvider } from './utils/GameContext';\r\n\r\nReactDOM.createRoot(document.getElementById('root')).render(\r\n    <React.StrictMode>\r\n        <GameProvider>\r\n            <App />\r\n        </GameProvider>\r\n    </React.StrictMode>\r\n); "],"names":["useMapStore","create","set","currentMapType","mapData","original","name","terrainSize","type","loaded","desert","setMapType","mapType","state","CHUNK_SIZE","OriginalTerrain","chunksCount","useMemo","count","Math","ceil","x","z","segmentsPerChunk","floor","planeGeometry","THREE.PlaneGeometry","planeMaterial","THREE.MeshStandardMaterial","color","roughness","metalness","flatShading","instancedMeshRef","useRef","tempObject","THREE.Object3D","chunks","result","push","position","rotation","PI","useFrame","current","forEach","chunk","i","y","rx","ry","rz","updateMatrix","setMatrixAt","matrix","instanceMatrix","needsUpdate","jsxRuntimeExports","jsx","ref","args","length","receiveShadow","ORIGINAL_TERRAIN_SIZE","HALF_WIDTH_TERRAIN_SIZE","width","height","ROAD_WIDTH","LANE_MARKER_WIDTH","Road","roadGeometry","roadExtensionGeometry","asphaltColor","asphaltMaterial","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","centerLineMaterial","sideLineMaterial","roadstripeColor","roadsideStripeMaterial","laneMarkers","markers","roadLength","totalMarkers","startOffset","markerPosition","LANE_MARKER_LENGTH","SingleRoad","zPosition","jsxs","children","geometry","material","object","TOTAL_ROAD_WIDTH","map","marker","index","Fragment","ROAD_SPACING","TREE_TYPES","PINE","OAK","PALM","BIRCH","SpatialHashGrid$1","constructor","bounds","dimensions","this","cells","getCell","min","max","getCellKey","cell","insert","key","query","radius","center","cellRadius","item","dx","dz","sqrt","seededRandom","seed","sin","OriginalEnvironmentObjects","halfWidth","halfHeight","trees","rocks","bushes","largeBush","grid","SpatialHashGrid","isOnRoad","abs","pine","oak","palm","birch","isPositionValid","pos","addObject","collection","objectType","baseIndex","minDistance","seedValue","randX","randZ","randScale","randRotation","randType","scale","THREE.Vector3","treeTypeName","Object","values","trees2","MIN_DISTANCE","specialSeed","specialX","specialZ","largeBush2","camera","useThree","treeRefs","trunk","foliage","rocksRef","bushesRef","largeBushRef","THREE.Frustum","THREE.Matrix4","treeMaterials","rockMaterial","bushMaterial","rockGeometry","THREE.IcosahedronGeometry","bushGeometry","THREE.SphereGeometry","treeDimensions","trunkHeight","trunkRadius","foliageOffset","treeGeometries","highDetail","THREE.CylinderGeometry","THREE.ConeGeometry","THREE.DodecahedronGeometry","THREE.OctahedronGeometry","lowDetail","useEffect","entries","treeType","positions","trunkRef","tree","trunkY","computeBoundingSphere","boundingSphere","foliageRef","scaledFoliageOffset","foliageY","setScalar","rock","objectY","bush","copy","matrixAutoUpdate","THREE.Sphere","cameraPosition","FAR_DISTANCE","refs","trunkDistance","distanceTo","foliageDistance","visible","rocksDistance","bushesDistance","largeDistance","highGeo","treeMat","frustumCulled","DRONE_TYPES","GameContext","createContext","GameProvider","currentDrone","setCurrentDrone","useState","isFirstPerson","setIsFirstPerson","value","switchDrone","droneType","toggleFirstPerson","prev","Provider","useDrones","context","useContext","Error","useKamikaze","Controls","KeyboardControls","keys","DreiKeyboardControls","PlayerController","world","playerRef","cameraRef","bulletRef","subscribeKeys","getKeys","useKeyboardControls","velocity","health","setHealth","canShoot","setCanShoot","useHelper","THREE.BoxHelper","delta","player","originalPosition","clone","bulletDirection","applyQuaternion","quaternion","bullet","add","multiplyScalar","direction","createdAt","Date","now","setTimeout","shoot","moveVector","applyMatrix4","makeRotationY","newPosition","lookAt","filter","updatePlayerPosition","PerspectiveCamera","makeDefault","fov","emissive","Html","style","backgroundColor","border","borderRadius","overflow","transform","transition","VEHICLE_HEALTH_DEFAULTS","TANK","maxHealth","criticalThreshold","visualDamageStages","hitboxSize","hitLocations","turret","damageMultiplier","tracks","mobilityEffect","rear","front","body","IFV","wheels","MILITARY_TRUCK","cabin","cargo","engine","CIVILIAN_TRUCK","CAR","VEHICLE_CATEGORY_MAP","tank_a","tank_b","ifv_a","ifv_b","civilian_truck_1","civilian_truck_2","civilian_truck_3","military_truck_1","military_truck_2","military_truck_3","car_a","car_b","car_c","car_d","car_e","useVehicleHealthStore","get","vehicleHealth","respawnTimers","initVehicle","vehicleId","vehicleType","category","healthDefaults","id","currentHealth","isDead","isDestroyed","isCritical","mobilityFactor","visualEffects","damageLog","applyDamage","rawDamage","hitLocation","weaponType","vehicle","locationData","finalDamage","newHealth","healthPercentage","stage","threshold","effects","newMobilityFactor","damageEvent","timestamp","healthBefore","healthAfter","updatedVehicle","destroyVehicle","updatedTimers","respawnTimer","respawnVehicle","repairVehicle","amount","removeVehicle","clearTimeout","_","remainingVehicles","__","remainingTimers","getVehicleHealth","getState","window","currentFps","fpsHistory","lowFpsWarning","frameCount","lastFpsUpdateTime","updateFps","performance","elapsed","instantFps","shift","avgFps","reduce","sum","fps","every","persistentLowFpsWarning","dispatchEvent","CustomEvent","detail","averageFps","requestAnimationFrame","WEAPON_TYPES","DAMAGE_PROFILES","WEAPON_TYPES_ANTI_TANK_MINE","innerRadius","outerRadius","innerDamage","outerDamage","falloff","explodesOnImpact","visualEffect","duration","intensity","secondaryEffects","debris","size","smoke","volume","shockwave","WEAPON_TYPES_RPG","tracer","WEAPON_TYPES_MORTAR","dustCloud","WEAPON_TYPES_DART","energyField","WEAPON_TYPES_GRENADE","fragments","WEAPON_TYPES_SHOTGUN","shape","coneAngle","muzzleFlash","WEAPON_TYPES_KAMIKAZE","calculateDamage","explosionPosition","targetPosition","profile","dy","distanceSquared","ratio","pow","applyExplosionDamage","targets","outerRadiusSquared","potentialTargets","target","processBatch","startIndex","batchSize","endIndex","userData","processVehicleTarget","takeDamage","damage","hit","projectilePosition","vehicleCategory","boundingBoxCenter","vehicleMatrix","makeRotationFromEuler","THREE.Euler","halfExtents","THREE.Box3","sub","containsPoint","localPos","inverseMatrix","invert","location","distanceFromCenter","checkVehicleHit","getWeaponName","createVehicleHitbox","hitbox","depth","halfDepth","isAlongX","xExtent","zExtent","lineBoxIntersection","line","box","start","end","subVectors","normalize","ray","THREE.Ray","intersectBox","checkProjectileVehicleCollision","projectile","scene","previousPosition","simpleCheckResult","collectVehiclesAtPoint","results","isVehiclePart","setFromObject","vehicleObject","partType","parent","child","hitVehicles","checkSimpleVehicleCollision","rayLength","searchRadius","searchCenter","raycaster","THREE.Raycaster","params","Line","Points","collectNearbyVehicles","objects","distanceToSquared","includes","nearbyVehicles","isVehicle","THREE.Line3","intersects","intersectObjects","closestIntersection","hitObject","hitPoint","point","sharedGeometries","sphere","smallSphere","THREE.BoxGeometry","sharedMaterials","fireballBase","transparent","THREE.Color","debrisBase","smokeBase","flashBase","THREE.MeshBasicMaterial","explosionProperties","fireballColor","smokeColor","debrisColor","dustColor","lightIntensity","lightColor","default","PARTICLE_TYPES","ANIM_CONSTANTS","vectorPool","_pool","pop","release","vector","Explosion","onComplete","groupRef","progress","setProgress","setSize","opacity","setOpacity","lifespan","setLifespan","lastProgressUpdate","lastSizeUpdate","materials","props","fireballMaterial","debrisMaterial","smokeMaterial","dustMaterial","fireball","dust","flash","explosionProps","particles","totalDebris","totalSmoke","debrisSize","smokeDuration","twoPI","angle","random","speed","life","cos","active","spawnDelay","rotationSpeed","originalSize","targetOpacity","initialLife","distance","shockwaveCount","dustCount","generateParticles","dispose","newProgress","updateMaterials","growthProgress","growthRate","newSize","chunkSize","particleCount","j","particle","particleProgress","updateShockwaveParticle","updateDustParticle","updateSmokeParticle","updateDebrisParticle","updateParticlesBatch","error","console","resetParticles","activeParticles","PARTICLE_TYPES_DEBRIS","PARTICLE_TYPES_SMOKE","PARTICLE_TYPES_DUST","PARTICLE_TYPES_SHOCKWAVE","emissiveIntensity","attach","ParticleGroup","decay","toArray","getGeometryForParticle","currentRadius","buoyancyFactor","ExplosionsManager","explosions","setExplosions","objectsCacheRef","Map","explosionTimestampsRef","lastShotgunProcessTimeRef","objectsCacheForShotgunRef","updateObjectCache","newCache","processObject","parentVehicleId","isMesh","intervalId","setInterval","clearInterval","handleExplosion","event","damageRadius","cacheKey","objectsInRange","has","objectsInRange2","findObjectsInRadius","oldestKey","Array","from","delete","requestIdleCallback","explosionEffect","fpsAdjustment","noVisual","startTime","shotgunSpecificAdjustment","visual","debrisCount","_a","smokeVolume","_b","_c","_d","quality","createExplosionEffect","explosionId","toString","substr","addEventListener","removeEventListener","cleanupInterval","stuckExplosionsFound","validIds","explosion","searchPosition","radiusSquared","checkObject","worldPosition","getWorldPosition","removeExplosion","triggerExplosion","DamageIndicatorsManager","indicators","setIndicators","React","handleDamage","ShotgunMuzzleFlash","isImpact","setLife","flashRef","particlesRef","particleCountMultiplier","impactMultiplier","pelletCount","spread","timer","defaultDir","targetDir","THREE.Quaternion","setFromUnitVectors","euler","setFromQuaternion","ShotgunEffectsManager","muzzleFlashes","setMuzzleFlashes","pendingFlashesRef","processingBatchRef","lastProcessTimeRef","processPendingFlashes","batchLimit","flashesToProcess","slice","queueMuzzleFlash","handleShotgunFire","throttleTime","log","handleWeaponImpact","handlePersistentLowFps","removeMuzzleFlash","POOL_SIZE","Grenadier","droneRef","velocityRef","propellersRefs","initialRotationRef","setPosition","propellersActive","setPropellersActive","propellersSpeed","setPropellersSpeed","shotgunAmmo","setShotgunAmmo","grenadeAmmo","setGrenadeAmmo","dartAmmo","setDartAmmo","shotgunCooldown","setShotgunCooldown","grenadeCooldown","setGrenadeCooldown","dartCooldown","setDartCooldown","projectilePool","activeProjectiles","setActiveProjectiles","downwardViewActive","setDownwardViewActive","showHUD","setShowHUD","gravity","LIFT_POWER","getProjectileFromPool","pool","find","p","warn","newProjectile","returnProjectileToPool","pooledProjectile","fireShotgun","useCallback","newAmmo","ammoCount","Number","forward","triggerShotgunFire","spreadFactor","order","backward","left","right","up","down","strafeLeft","strafeRight","handleMouseDown","e","button","currentPosition","dropGrenade","handleKeyDown","dropDart","handleContextMenu","preventDefault","toFixed","cloneablePosition","prevProjectiles","stillActiveProjectiles","vehicleHit","forwardVector","rightVector","THRUST","DIVE_POWER","THREE.MathUtils","lerp","ROTATION_SPEED","downSpeed","targetForwardTilt","targetSideTilt","currentYaw","currentQuat","setFromEuler","targetEuler","targetQuat","slerpQuat","slerp","setRotationFromQuaternion","cameraOffset","castShadow","LandingLeg","PropellerUnit","propRef","el","counterClockwise","ProjectileRenderer","projectiles","propellerRef","itemSize","array","Float32Array","geometries","THREE.Group","THREE.Mesh","translateY","THREE.TorusGeometry","translateX","rotateX","rotateY","ProjectileMesh","memo","setRotation","projectilesByType","grouped","typeProjectiles","GrenadierHUD","className","Kamikaze","previousPositionRef","collisionOccurred","mousePos","gl","handleMouseMove","clientX","innerWidth","clientY","innerHeight","code","targetRotationY","pitchAmount","hitPosition","fpOffset","fpDirection","cameraDistance","cameraHeight","KamikazeHUD","onClick","viewBox","cx","cy","r","fill","x1","y1","x2","y2","stroke","strokeWidth","Bomber","mineAmmo","setMineAmmo","mortarAmmo","setMortarAmmo","rpgAmmo","setRpgAmmo","mineCooldown","setMineCooldown","mortarCooldown","setMortarCooldown","rpgCooldown","setRpgCooldown","armLength","translateZ","BomberHUD","DroneSwitcher","TankA","TankB","IFV_A","IFV_B","SHARED_MATERIALS","CivilianTruck1","wheel","wireframe","CivilianTruck2","CivilianTruck3","MilitaryTruck1","MilitaryTruck2","MilitaryTruck3","CarA","CarB","CarC","CarD","CarE","VehicleTypes","withVehicleHealth","VehicleComponent","forwardRef","otherProps","adjustedProps","canMove","EnhancedVehicleTypes","SPEED_MIN","SPEED_MAX","CAR_CIVILIAN_SPEED_MIN","LANE_TYPES","CIVILIAN_MINIMUM_DISTANCE","SAFE_DISTANCE","VEHICLE_LENGTH","CIVILIAN_DETECTION_DISTANCE","CIVILIAN_EMERGENCY_DISTANCE","DESTROYED_VEHICLE_WAIT_PERIOD","MILITARY_COLUMNS","vehicles","tempVector3","VehiclePool","inUse","Set","releaseAll","clear","getRandomItem","getRandomVehicleOfType","vehicleKeys","matchingVehicles","isCarOrCivilianTruck","VehiclesOnRoad","setVehicles","initializedRef","columnSpawnTimersRef","timeoutRefsRef","vehiclePoolRef","congestionMapRef","vehicleRefsMap","vehicleHealthStore","vehiclesById","rotationMap","newVehicles","roadZ","lanes","fastLanes","lane","slowLanes","columnConfig","columnId","randomOffset","currentX","vehicleIndex","vehicleGroup","baseSpeedMin","baseSpeedMax","columnPosition","road","laneType","isInColumn","roadSection","vehiclesPerLane","VEHICLES_PER_ROAD","vehiclePositions","segmentLength","minSegmentLength","effectiveSegmentLength","xPos","zJitter","zPos","hasConflict","conflictResolutionAttempts","MAX_CONFLICT_RESOLUTION_ATTEMPTS","xDistance","zDistance","newZJitter","jamCounter","timeoutId","timerId","cleanupIntervalId","prevVehicles","minX","maxX","validZRanges","isRemoved","validX","validZ","some","range","vehicleLookupMapRef","createNewColumn","newColumnId","substring","startingX","currentTime","allVehicles","newCongestionMap","roadSections","destroyedColumns","activeColumns","healthData","activeId","sectionKey","sectionVehicles","stoppedCount","split","sectionHasDestroyedColumn","totalVehicles","lastDetectedTime","detectCongestion","vehicles2","destroyedVehicles","clearedDestroyedPositions","newlyDestroyedColumns","optimizedDetectCollisionAhead","checkDistance","sectorKey","nextSectorKey","farSectorKey","veryFarSectorKey","sectorsToCheck","laneWidth","adjacentLaneUp","adjacentLaneDown","isCar","adjacentLaneZThreshold","adjacentSectorKeyUp","adjacentSectorKeyDown","nextAdjacentSectorKeyUp","nextAdjacentSectorKeyDown","adjacentLaneVehicles","closestDistance","Infinity","hasCollision","flat","v","otherVehicle","distanceToNext","vehiclesList","hasNotifiedColumn","clearingStarted","clearingTime","columnHasDestroyed","lastDestroyedTime","markedForRemoval","filteredVehicles","laneKey","columnHasRemoval","lastRemovalTime","columnMap","updatedVehicles","originalSpeed","hasCollisionEmergency","hasMinimumDistance","hasCollisionWarning","distanceFactor","lastJamCheck","isInTrafficJam","targetSpeed","previousSpeed","accelerationRate","speedChange","newSpeed","newX","columnVehicles","sort","a","b","leadVehicleIndex","leadVehicle","leadVehicleHealth","newLeadFound","newLeadVehicleIndex","potentialLeadHealth","referenceVehicle","referenceVehicleHealth","hasActiveVehicle","columnSpeed","activeColumnVehicles","destroyedVehicleMap","veh","wasMarkedDestroyed","updateIdx","findIndex","frontmostActiveVehicle","newColumnSpeed","updatedVehicleIndex","shouldWaitInPlace","hasDestroyedVehicleAhead","destroyedVehicle","waitingForVehicleAhead","catchUpBoost","xMovement","frontmostX","scheduleColumnRespawn","processedVehicles","respawnPosition","respawnOffset","MINIMUM_DISTANCE","respawnedVehicle","Boolean","newColumns","vehicleRef","distanceToCamera","renderVehicles","currentVehicleIds","createRef","VehicleSelector","onSelectVehicle","handleClick","rect","domElement","getBoundingClientRect","top","setFromCamera","found","currentObject","canvasElement","OriginalMap","fog","FogExp2","updateProjectionMatrix","skyProps","sunPosition","inclination","azimuth","Environment","preset","Sky","DesertTerrain","vertices","attributes","noise1","noise2","noise3","computeVertexNormals","DesertEnvironmentObjects","cacti","cactiRef","cactusMaterial","cactusGeometry","cactus","cactiDistance","DesertMap","MapContainer","Scene","DroneSelector","VehicleHealthHUD","selectedVehicleId","healthInfo","setHealthInfo","updateHealthInfo","interval","healthPercent","replace","toUpperCase","join","ControlsList","controls","action","DRONE_TYPES_KAMIKAZE","DRONE_TYPES_GRENADIER","DRONE_TYPES_BOMBER","control","DroneHUDs","bomberAmmo","setBomberAmmo","grenadierAmmo","setGrenadierAmmo","handleAmmoUpdate","MapSelector","App","setSelectedVehicleId","canvasConfig","shadows","dpr","onPointerMissed","Canvas","Suspense","fallback","ReactDOM","createRoot","document","getElementById","render","StrictMode"],"mappings":"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"}