import{u as e,j as t,a as s,K as o,b as r,c as n,P as i,H as a,E as c,S as l,C as d,d as h}from"./three-ecosystem-Drh4tasy.js";import{r as u,R as m}from"./vendor-BexhPDQK.js";import{c as p}from"./utils-pntpxyXn.js";import{s as x,a2 as g,a3 as f,a4 as j,a5 as y,I as w,a6 as M,a7 as b,a8 as S,a9 as v,aa as k,ab as A,c as I,ac as D,ad as G,ae as E,R as z,af as P,ag as C,k as F,x as R,ah as T,ai as _,aj as N,ak as L,M as $,al as O,am as H}from"./three-core-DCwiNdfK.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const B=p((e=>({currentMapType:"original",mapData:{original:{name:"Original Map",terrainSize:2e3,type:"grassland",loaded:!1},desert:{name:"Desert Map",terrainSize:2e3,type:"desert",loaded:!1}},setMapType:t=>e({currentMapType:t,mapData:e=>({...e.mapData,[t]:{...e.mapData[t],loaded:!0}})})}))),V=205;function U(){const s=2e3,o=u.useMemo((()=>{const e=Math.ceil(10);return{x:e,z:e}}),[s]),r=u.useMemo((()=>({x:Math.floor(200/o.x),z:Math.floor(200/o.z)})),[o]),n=u.useMemo((()=>new x(V,V,r.x,r.z)),[r]),i=u.useMemo((()=>new g({color:"#4d7f38",roughness:.8,metalness:.1,flatShading:!1})),[]),a=u.useRef(),c=u.useMemo((()=>new f),[]),l=u.useMemo((()=>{const e=[];for(let t=0;t<o.x;t++)for(let s=0;s<o.z;s++)e.push({position:[200*t-1e3+100,0,200*s-1e3+100],rotation:[-Math.PI/2,0,0]});return e}),[s,o]);return e((()=>{if(a.current)return l.forEach(((e,t)=>{const[s,o,r]=e.position,[n,i,l]=e.rotation;c.position.set(s,o,r),c.rotation.set(n,i,l),c.updateMatrix(),a.current.setMatrixAt(t,c.matrix)})),a.current.instanceMatrix.needsUpdate=!0,null}),[l]),t.jsx("instancedMesh",{ref:a,args:[n,i,l.length],receiveShadow:!0})}const K=2e3,Y={width:1e3,height:K},X=88,W=.75;function q({mapType:e="original"}){const{currentMapType:s}=B(),o=u.useMemo((()=>"half-width"===e?Y:{width:K,height:K}),[e]),r=u.useMemo((()=>new x(o.width,X,1,1)),[o]),n=u.useMemo((()=>new x(o.width,8,1,1)),[o]),i=u.useMemo((()=>"desert"===e?"#444444":"#333333"),[e]),a=u.useMemo((()=>new g({color:i,roughness:.7,metalness:.1,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:1})),[i]),c=u.useMemo((()=>new g({color:"#FFCC00",roughness:.5,metalness:.1,polygonOffset:!0,polygonOffsetFactor:-2,polygonOffsetUnits:1})),[]),l=u.useMemo((()=>new g({color:"#FFFFFF",roughness:.5,metalness:.1,polygonOffset:!0,polygonOffsetFactor:-2,polygonOffsetUnits:1})),[]),d=u.useMemo((()=>"desert"===e?"#A67F4E":"#8B5A2B"),[e]),h=u.useMemo((()=>new g({color:d,roughness:.85,metalness:.02,polygonOffset:!0,polygonOffsetFactor:-1.5,polygonOffsetUnits:1})),[d]),m=u.useMemo((()=>{const e=[],t=o.width,s=Math.floor(t/15),r=-t/2;for(let o=0;o<s;o++){const t=r+15*o+2.5;e.push({position:t})}return e}),[o]),p=({zPosition:e})=>t.jsxs("group",{position:[0,.5,e],children:[t.jsx("mesh",{geometry:r,material:a,rotation:[-Math.PI/2,0,0]}),t.jsxs("mesh",{position:[0,0,-48],rotation:[-Math.PI/2,0,0],children:[t.jsx("primitive",{object:n}),t.jsx("primitive",{object:a})]}),t.jsxs("mesh",{position:[0,0,48],rotation:[-Math.PI/2,0,0],children:[t.jsx("primitive",{object:n}),t.jsx("primitive",{object:a})]}),t.jsxs("mesh",{position:[0,.01,-56.5],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[o.width,9]}),t.jsx("primitive",{object:h})]}),t.jsxs("mesh",{position:[0,.01,56.5],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[o.width,9]}),t.jsx("primitive",{object:h})]}),t.jsxs("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[o.width,W]}),t.jsx("primitive",{object:c})]}),t.jsxs("mesh",{position:[0,.02,-43.5],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[o.width,W]}),t.jsx("primitive",{object:l})]}),t.jsxs("mesh",{position:[0,.02,43.5],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[o.width,W]}),t.jsx("primitive",{object:l})]}),m.map(((e,s)=>t.jsxs("mesh",{position:[e.position,.02,-22],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[5,W]}),t.jsx("primitive",{object:l})]},`left-outer-${s}`))),m.map(((e,s)=>t.jsxs("mesh",{position:[e.position,.02,22],rotation:[-Math.PI/2,0,0],children:[t.jsx("planeGeometry",{args:[5,W]}),t.jsx("primitive",{object:l})]},`right-outer-${s}`)))]});return t.jsxs(t.Fragment,{children:[t.jsx(p,{zPosition:150}),t.jsx(p,{zPosition:-150})]})}const Z={PINE:"pine",OAK:"oak",PALM:"palm",BIRCH:"birch"};let Q=class{constructor(e,t){this.bounds=e,this.dimensions=t,this.cells={}}getCell(e){const{min:t,max:s}=this.bounds;return{x:Math.floor((e.x-t.x)/(s.x-t.x)*this.dimensions.x),z:Math.floor((e.z-t.z)/(s.z-t.z)*this.dimensions.z)}}getCellKey(e){return`${e.x},${e.z}`}insert(e,t){const s=this.getCell(e),o=this.getCellKey(s);this.cells[o]||(this.cells[o]=[]),this.cells[o].push({position:e,object:t})}query(e,t){const s=[],o=this.getCell(e),r=Math.ceil(t/Math.min((this.bounds.max.x-this.bounds.min.x)/this.dimensions.x,(this.bounds.max.z-this.bounds.min.z)/this.dimensions.z));for(let n=-r;n<=r;n++)for(let i=-r;i<=r;i++){const r={x:o.x+n,z:o.z+i},a=this.getCellKey(r);if(this.cells[a])for(const o of this.cells[a]){const r=o.position.x-e.x,n=o.position.z-e.z;Math.sqrt(r*r+n*n)<=t&&s.push(o.object)}}return s}};function J(e){const t=1e4*Math.sin(e);return t-Math.floor(t)}function ee(){const o=2e3,r=1e3,n=1e3,{trees:i,rocks:a,bushes:c,largeBush:l}=u.useMemo((()=>{const e=new Q({min:{x:-1e3,z:-1e3},max:{x:r,z:n}},{x:20,z:20}),t=(e,t)=>Math.abs(t-150)<70||Math.abs(t+150)<70,s={pine:[],oak:[],palm:[],birch:[]},i=[],a=[],c=(s,o,r)=>{if(t(0,o))return!1;if(Math.abs(o-150)<80||Math.abs(o+150)<80)return!1;const n={x:s,z:o};return 0===e.query(n,r).length},l=(t,l,d,h,u)=>{for(let m=0;m<h;m++){const t=12345+d+m,h=J(1.1*t),p=J(2.3*t),x=J(3.7*t),g=J(4.5*t),f=Math.floor(4*J(5.9*t)),j=h*o-r,y=p*o-n;if(!c(j,y,u))continue;const w=1.2+x*(1.8-1.2),M=g*Math.PI*2;new I(j,0,y);const b={position:[j,0,y],scale:w,rotation:M,type:f};if("tree"===l){const e=Object.values(Z)[f];s[e].push(b)}else"rock"===l?i.push(b):"bush"===l&&a.push(b);e.insert({x:j,z:y},b)}};l(0,"tree",0,600,12),l(0,"rock",1e4,150,4),l(0,"bush",2e4,300,4);const d=121919220,h=J(d)*o-r,u=J(121919320)*o-n;let m=null;return t(0,u)||(m={position:[h,0,u],scale:4,rotation:J(121919420)*Math.PI*2}),{trees:s,rocks:i,bushes:a,largeBush:m}}),[r,n,o]),{camera:d}=s(),h={pine:{trunk:u.useRef(),foliage:u.useRef()},oak:{trunk:u.useRef(),foliage:u.useRef()},palm:{trunk:u.useRef(),foliage:u.useRef()},birch:{trunk:u.useRef(),foliage:u.useRef()}},m=u.useRef(),p=u.useRef(),x=u.useRef();u.useMemo((()=>new j),[]),u.useMemo((()=>new y),[]);const D=u.useMemo((()=>new f),[]),G=u.useMemo((()=>({pine:{trunk:new g({color:"#8B4513",roughness:.8,flatShading:!0}),foliage:new g({color:"#2E8B57",roughness:.7,flatShading:!0})},oak:{trunk:new g({color:"#654321",roughness:.9,flatShading:!0}),foliage:new g({color:"#228B22",roughness:.6,flatShading:!0})},palm:{trunk:new g({color:"#A0522D",roughness:.7,flatShading:!0}),foliage:new g({color:"#32CD32",roughness:.8,flatShading:!0})},birch:{trunk:new g({color:"#F5F5DC",roughness:.6,flatShading:!0}),foliage:new g({color:"#ADFF2F",roughness:.7,flatShading:!0})}})),[]),E=u.useMemo((()=>new g({color:"#7D7D7D",roughness:1,flatShading:!0})),[]),z=u.useMemo((()=>new g({color:"#3A5F0B",roughness:.7,flatShading:!0})),[]),P=u.useMemo((()=>new w(1,0)),[]),C=u.useMemo((()=>new M(2,6,4)),[]),F=u.useMemo((()=>({pine:{trunkHeight:4.8,trunkRadius:.75,foliageOffset:4.8},oak:{trunkHeight:4.5,trunkRadius:.975,foliageOffset:3},palm:{trunkHeight:7.5,trunkRadius:.525,foliageOffset:7.5},birch:{trunkHeight:6.75,trunkRadius:.4875,foliageOffset:4.5}})),[]),R=u.useMemo((()=>({highDetail:{pine:{trunk:new S(.6,.75,4.8,8,3),foliage:new k(3,9.6,8,4)},oak:{trunk:new S(.9,1.05,4.5,10,4),foliage:new M(3.75,12,10)},palm:{trunk:new S(.45,.6,7.5,8,5),foliage:new v(3.75,1)},birch:{trunk:new S(.45,.53,6.75,9,4),foliage:new b(3,2)}},lowDetail:{pine:{trunk:new S(.6,.75,4.8,4,1),foliage:new k(3,9.6,5,1)},oak:{trunk:new S(.9,1.05,4.5,6,1),foliage:new M(3.75,6,4)},palm:{trunk:new S(.45,.6,7.5,4,1),foliage:new v(3.75,0)},birch:{trunk:new S(.45,.53,6.75,5,1),foliage:new b(3,0)}}})),[]);return u.useEffect((()=>{if(Object.entries(i).forEach((([e,t])=>{if(!t.length)return;const{trunkHeight:s,trunkRadius:o,foliageOffset:r}=F[e],n=h[e].trunk;n.current&&t.length>0&&(t.forEach(((e,t)=>{const[o,r,i]=e.position,a=e.scale,c=s*a/2;D.position.set(o,c,i),D.rotation.set(0,e.rotation,0),D.scale.set(a,a,a),D.updateMatrix(),n.current.setMatrixAt(t,D.matrix)})),n.current.instanceMatrix.needsUpdate=!0,n.current.computeBoundingSphere(),n.current.boundingSphere&&(n.current.boundingSphere.radius*=1.5));const i=h[e].foliage;i.current&&t.length>0&&(t.forEach(((t,s)=>{const[o,n,a]=t.position,c=t.scale,l=r*c;let d;switch(e){case"pine":d=l+4.8*c;break;case"birch":d=l+2.25*c;break;default:d=l+1.5*c}D.position.set(o,d,a),D.rotation.set(0,t.rotation,0),D.scale.setScalar(c),D.updateMatrix(),i.current.setMatrixAt(s,D.matrix)})),i.current.instanceMatrix.needsUpdate=!0,i.current.computeBoundingSphere(),i.current.boundingSphere&&(i.current.boundingSphere.radius*=1.5))})),m.current&&a.length>0&&(a.forEach(((e,t)=>{const[s,o,r]=e.position,n=e.scale,i=.5*n;D.position.set(s,i,r),D.rotation.set(0,e.rotation,0),D.scale.setScalar(n),D.updateMatrix(),m.current.setMatrixAt(t,D.matrix)})),m.current.instanceMatrix.needsUpdate=!0,m.current.computeBoundingSphere(),m.current.boundingSphere&&(m.current.boundingSphere.radius*=1.5)),p.current&&c.length>0&&(c.forEach(((e,t)=>{const[s,o,r]=e.position,n=e.scale,i=2*n*.5;D.position.set(s,i,r),D.rotation.set(0,e.rotation,0),D.scale.setScalar(n),D.updateMatrix(),p.current.setMatrixAt(t,D.matrix)})),p.current.instanceMatrix.needsUpdate=!0,p.current.computeBoundingSphere(),p.current.boundingSphere&&(p.current.boundingSphere.radius*=1.5)),x.current&&l){const[e,t,s]=l.position,o=l.scale,r=2*o*.5;D.position.set(e,r,s),D.rotation.set(0,l.rotation,0),D.scale.setScalar(o),D.updateMatrix(),x.current.matrix.copy(D.matrix),x.current.matrixAutoUpdate=!1,x.current.boundingSphere||(x.current.boundingSphere=new A(new I(e,r,s),2*o))}}),[i,a,c,l,F,D]),e((({camera:e})=>{const t=e.position,s=1e3;if(Object.entries(h).forEach((([e,o])=>{if(!(o.trunk.current&&o.trunk.current.boundingSphere&&o.foliage.current&&o.foliage.current.boundingSphere))return;const r=o.trunk.current.boundingSphere.center.distanceTo(t),n=o.foliage.current.boundingSphere.center.distanceTo(t);o.trunk.current.visible=r<s,o.foliage.current.visible=n<s})),m.current&&m.current.boundingSphere){const e=m.current.boundingSphere.center.distanceTo(t);m.current.visible=e<s}if(p.current&&p.current.boundingSphere){const e=p.current.boundingSphere.center.distanceTo(t);p.current.visible=e<s}if(x.current&&x.current.boundingSphere){const e=x.current.boundingSphere.center.distanceTo(t);x.current.visible=e<s}})),t.jsxs("group",{children:[Object.entries(i).map((([e,s])=>{if(!s.length)return null;const o=R.highDetail[e],r=G[e];return t.jsxs("group",{children:[t.jsxs("instancedMesh",{ref:h[e].trunk,args:[null,null,s.length],frustumCulled:!0,children:[t.jsx("primitive",{object:o.trunk}),t.jsx("primitive",{object:r.trunk})]}),t.jsxs("instancedMesh",{ref:h[e].foliage,args:[null,null,s.length],frustumCulled:!0,children:[t.jsx("primitive",{object:o.foliage}),t.jsx("primitive",{object:r.foliage})]})]},e)})),t.jsx("instancedMesh",{ref:m,args:[P,E,a.length],frustumCulled:!0}),t.jsx("instancedMesh",{ref:p,args:[C,z,c.length],frustumCulled:!0}),l&&t.jsxs("mesh",{ref:x,frustumCulled:!0,children:[t.jsx("sphereGeometry",{args:[2,10,8]}),t.jsx("meshStandardMaterial",{color:"#2D5B0A",roughness:.6,metalness:.1,flatShading:!0})]})]})}const te="PLAYER",se="GRENADIER",oe="KAMIKAZE",re="BOMBER",ne=u.createContext();function ie({children:e}){const[s,o]=u.useState(se),[r,n]=u.useState(!1),i={currentDrone:s,switchDrone:e=>{o(e)},isFirstPerson:r,toggleFirstPerson:()=>{n((e=>!e))}};return t.jsx(ne.Provider,{value:i,children:e})}function ae(){const e=u.useContext(ne);if(void 0===e)throw new Error("useDrones must be used within a GameProvider");return{currentDrone:e.currentDrone,switchDrone:e.switchDrone}}function ce(){const e=u.useContext(ne);if(void 0===e)throw new Error("useKamikaze must be used within a GameProvider");return{isFirstPerson:e.isFirstPerson,toggleFirstPerson:e.toggleFirstPerson}}const le="forward",de="backward",he="left",ue="right",me="up",pe="down",xe="strafeLeft",ge="strafeRight",fe="selectDrone1",je="selectDrone2",ye="selectDrone3",we="selectDrone4",Me="toggleFirstPerson";function be({children:e}){const s=[{name:le,keys:["KeyW"]},{name:de,keys:["KeyS"]},{name:he,keys:["KeyQ"]},{name:ue,keys:["KeyE"]},{name:me,keys:["Space"]},{name:pe,keys:["ShiftLeft"]},{name:xe,keys:["KeyA"]},{name:ge,keys:["KeyD"]},{name:fe,keys:["Digit1"]},{name:je,keys:["Digit2"]},{name:ye,keys:["Digit3"]},{name:we,keys:["Digit4"]},{name:Me,keys:["KeyV"]}];return t.jsx(o,{map:s,children:e})}const Se=({world:s})=>{const o=u.useRef(),c=u.useRef(),l=u.useRef([]),[d,h]=r(),m=u.useRef(new I),[p,x]=u.useState(100),[g,f]=u.useState(!0),{isFirstPerson:j}=ce();n(o,D,"cyan");return e(((e,t)=>{const r=h(),n=o.current;if(!n)return;const i=n.position.clone();m.current.set(0,0,0),r[le]&&(m.current.z-=8*t),r[de]&&(m.current.z+=8*t),r[xe]&&(m.current.x-=8*t),r[ge]&&(m.current.x+=8*t),r[he]&&(n.rotation.y+=.03),r[ue]&&(n.rotation.y-=.03),r[me]&&(()=>{if(!g)return;const e=o.current,t=new I(0,0,-1).applyQuaternion(e.quaternion),s={position:e.position.clone().add(t.multiplyScalar(1)),direction:t,createdAt:Date.now()};l.current.push(s),f(!1),setTimeout((()=>f(!0)),250)})();const a=m.current.applyMatrix4((new y).makeRotationY(n.rotation.y)),d=i.clone().add(a);var u;u=d,Math.abs(u.x)>50||Math.abs(u.z)>50||n.position.copy(d),c.current&&(j?c.current.position.set(0,.5,0):(c.current.position.set(0,5,10),c.current.lookAt(n.position)));const p=Date.now();l.current=l.current.filter((e=>(e.position.add(e.direction.clone().multiplyScalar(30*t)),p-e.createdAt<2e3))),(null==s?void 0:s.updatePlayerPosition)&&s.updatePlayerPosition(n.position.x,n.position.z,n.rotation.y)})),t.jsxs("group",{ref:o,children:[t.jsx(i,{ref:c,makeDefault:j,fov:75}),!j&&t.jsxs(t.Fragment,{children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("cylinderGeometry",{args:[.5,.5,1.8,32]}),t.jsx("meshStandardMaterial",{color:"#4CAF50"})]}),t.jsxs("mesh",{position:[0,1.2,0],children:[t.jsx("sphereGeometry",{args:[.3,32,32]}),t.jsx("meshStandardMaterial",{color:"#4CAF50"})]}),t.jsxs("mesh",{position:[.3,.5,-.5],rotation:[0,0,0],children:[t.jsx("boxGeometry",{args:[.1,.1,1]}),t.jsx("meshStandardMaterial",{color:"#333333"})]})]}),l.current.map(((e,s)=>t.jsxs("mesh",{position:e.position,children:[t.jsx("sphereGeometry",{args:[.1,8,8]}),t.jsx("meshStandardMaterial",{color:"yellow",emissive:"orange"})]},s))),t.jsx(a,{position:[0,2,0],children:t.jsx("div",{style:{width:"100px",height:"10px",backgroundColor:"#333",border:"1px solid #666",borderRadius:"5px",overflow:"hidden",transform:"translateX(-50%)"},children:t.jsx("div",{style:{width:`${p}%`,height:"100%",backgroundColor:p>30?"#4CAF50":"#ff0000",transition:"width 0.3s ease-in-out"}})})})]})},ve={TANK:{maxHealth:100,criticalThreshold:.5,visualDamageStages:[],hitboxSize:new I(2.4,1,3.2),hitLocations:{turret:{damageMultiplier:1.2},tracks:{damageMultiplier:.8,mobilityEffect:.5},rear:{damageMultiplier:1.5},front:{damageMultiplier:.6},body:{damageMultiplier:1}}},IFV:{maxHealth:70,criticalThreshold:.5,visualDamageStages:[],hitboxSize:new I(2,.9,3),hitLocations:{turret:{damageMultiplier:1.2},wheels:{damageMultiplier:.8,mobilityEffect:.4},rear:{damageMultiplier:1.3},front:{damageMultiplier:.7},body:{damageMultiplier:1}}},MILITARY_TRUCK:{maxHealth:50,criticalThreshold:.5,visualDamageStages:[],hitboxSize:new I(1.7,1.4,3.2),hitLocations:{cabin:{damageMultiplier:1.1},wheels:{damageMultiplier:.9,mobilityEffect:.5},cargo:{damageMultiplier:.8},engine:{damageMultiplier:1.4},body:{damageMultiplier:1}}},CIVILIAN_TRUCK:{maxHealth:30,criticalThreshold:.5,visualDamageStages:[],hitboxSize:new I(1.7,1.4,3.2),hitLocations:{cabin:{damageMultiplier:1.2},wheels:{damageMultiplier:1,mobilityEffect:.7},cargo:{damageMultiplier:.9},engine:{damageMultiplier:1.5},body:{damageMultiplier:1}}},CAR:{maxHealth:20,criticalThreshold:.5,visualDamageStages:[],hitboxSize:new I(1.4,.8,2.2),hitLocations:{cabin:{damageMultiplier:1.2},wheels:{damageMultiplier:1,mobilityEffect:.8},engine:{damageMultiplier:1.5},body:{damageMultiplier:1}}}},ke={tank_a:"TANK",tank_b:"TANK",ifv_a:"IFV",ifv_b:"IFV",civilian_truck_1:"CIVILIAN_TRUCK",civilian_truck_2:"CIVILIAN_TRUCK",civilian_truck_3:"CIVILIAN_TRUCK",military_truck_1:"MILITARY_TRUCK",military_truck_2:"MILITARY_TRUCK",military_truck_3:"MILITARY_TRUCK",car_a:"CAR",car_b:"CAR",car_c:"CAR",car_d:"CAR",car_e:"CAR"},Ae=p(((e,t)=>({vehicleHealth:{},respawnTimers:{},initVehicle:(t,s)=>{e((e=>{if(e.vehicleHealth[t])return e;const o=ke[s],r=ve[o];return{vehicleHealth:{...e.vehicleHealth,[t]:{id:t,type:s,category:o,currentHealth:r.maxHealth,maxHealth:r.maxHealth,isDead:!1,isDestroyed:!1,isCritical:!1,mobilityFactor:1,visualEffects:[],hitboxSize:r.hitboxSize,damageLog:[]}}}}))},applyDamage:(s,o,r=null,n=null)=>{e((e=>{const i=e.vehicleHealth[s];if(!i||i.isDead||i.isDestroyed)return e;const a=i.category,c=ve[a];let l=1,d=0;if(r&&c.hitLocations[r]){const e=c.hitLocations[r];l=e.damageMultiplier,d=e.mobilityEffect||0}const h=o*l,u=Math.max(0,i.currentHealth-h),m=u/i.maxHealth,p=[];c.visualDamageStages.forEach((e=>{m<=e.threshold&&p.push(...e.effects)})),u<=0&&p.push("GREYED_OUT");const x=m<=c.criticalThreshold,g=u<=0;let f=i.mobilityFactor;m<=.5?f=0:d>0&&(f=Math.max(.1,f-d));const j={timestamp:Date.now(),rawDamage:o,finalDamage:h,hitLocation:r,weaponType:n,healthBefore:i.currentHealth,healthAfter:u},y={...i,currentHealth:u,healthPercentage:m,isDead:g,isCritical:x,mobilityFactor:g?0:f,visualEffects:p,damageLog:[...i.damageLog,j]};return g&&!i.isDead&&setTimeout((()=>{t().destroyVehicle(s)}),1500),{vehicleHealth:{...e.vehicleHealth,[s]:y}}}))},destroyVehicle:s=>{e((e=>{const o=e.vehicleHealth[s];if(!o||o.isDestroyed)return e;let r=e.respawnTimers;if("CAR"!==o.category&&"CIVILIAN_TRUCK"!==o.category){const o=setTimeout((()=>{t().respawnVehicle(s)}),3e4);r={...e.respawnTimers,[s]:o}}return{vehicleHealth:{...e.vehicleHealth,[s]:{...o,isDestroyed:!0}},respawnTimers:r}}))},respawnVehicle:t=>{e((e=>{const s=e.vehicleHealth[t];if(!s)return e;const o=s.category,r=ve[o];return{vehicleHealth:{...e.vehicleHealth,[t]:{...s,currentHealth:r.maxHealth,maxHealth:r.maxHealth,isDead:!1,isDestroyed:!1,isCritical:!1,mobilityFactor:1,visualEffects:[],damageLog:[]}}}}))},repairVehicle:(t,s=null)=>{e((e=>{const o=e.vehicleHealth[t];if(!o||o.isDestroyed)return e;const r=s?Math.min(o.maxHealth,o.currentHealth+s):o.maxHealth,n=r/o.maxHealth,i=ve[o.category];return{vehicleHealth:{...e.vehicleHealth,[t]:{...o,currentHealth:r,healthPercentage:n,isDead:!1,isCritical:n<=i.criticalThreshold,mobilityFactor:1,visualEffects:[]}}}}))},removeVehicle:t=>{e((e=>{e.respawnTimers[t]&&clearTimeout(e.respawnTimers[t]);const{[t]:s,...o}=e.vehicleHealth,{[t]:r,...n}=e.respawnTimers;return{vehicleHealth:o,respawnTimers:n}}))},getVehicleHealth:e=>Ae.getState().vehicleHealth[e]})));window.currentFps=60,window.fpsHistory=[],window.lowFpsWarning=!1;let Ie=0,De=0;if("undefined"!=typeof window){const e=()=>{const t=performance.now(),s=t-De;if(s>=500){const e=Ie*(1e3/s);window.fpsHistory.push(e),window.fpsHistory.length>5&&window.fpsHistory.shift();const o=window.fpsHistory.reduce(((e,t)=>e+t),0)/window.fpsHistory.length;window.currentFps=o,o<30?(window.lowFpsWarning=!0,window.fpsHistory.every((e=>e<30))&&(window.persistentLowFpsWarning||(window.persistentLowFpsWarning=!0,window.dispatchEvent(new CustomEvent("persistentLowFps",{detail:{averageFps:o}}))))):(window.lowFpsWarning=!1,window.persistentLowFpsWarning=!1),De=t,Ie=0}else Ie++;requestAnimationFrame(e)};requestAnimationFrame(e)}const Ge="ANTI_TANK_MINE",Ee="RPG",ze="MORTAR",Pe="DART",Ce="GRENADE",Fe="SHOTGUN",Re="KAMIKAZE",Te={[Ge]:{innerRadius:8,outerRadius:20,innerDamage:30,outerDamage:10,falloff:"EXPONENTIAL",explodesOnImpact:!0,visualEffect:{radius:4,duration:10,color:16733440,intensity:2.5,secondaryEffects:{debris:{count:45,size:1.2},smoke:{volume:2,duration:1.8},shockwave:!0}}},[Ee]:{innerRadius:6,outerRadius:15,innerDamage:25,outerDamage:8,falloff:"EXPONENTIAL",explodesOnImpact:!0,visualEffect:{radius:3,duration:10,color:16724736,intensity:.7,secondaryEffects:{debris:{count:35,size:.8},smoke:{volume:1.5,duration:1.3},shockwave:!0,tracer:!0}}},[ze]:{innerRadius:10,outerRadius:25,innerDamage:20,outerDamage:12,falloff:"EXPONENTIAL",explodesOnImpact:!0,visualEffect:{radius:3,duration:10,color:2236962,intensity:1.4,secondaryEffects:{debris:{count:60,size:1.5},smoke:{volume:2.5,duration:2},shockwave:!0,dustCloud:!0}}},[Pe]:{innerRadius:5,outerRadius:12,innerDamage:22,outerDamage:8,falloff:"LINEAR",explodesOnImpact:!0,visualEffect:{radius:2,duration:20,color:65535,intensity:1.5,secondaryEffects:{debris:{count:20,size:.5},smoke:{volume:1,duration:1},energyField:!0}}},[Ce]:{innerRadius:10,outerRadius:25,innerDamage:30,outerDamage:12,falloff:"EXPONENTIAL",explodesOnImpact:!0,visualEffect:{radius:2.5,duration:35,color:16755200,intensity:2.5,secondaryEffects:{debris:{count:50,size:.9},smoke:{volume:2,duration:1.8},shockwave:!0,fragments:!0}}},[Fe]:{innerRadius:4,outerRadius:10,innerDamage:18,outerDamage:6,falloff:"EXPONENTIAL",shape:"CONE",coneAngle:Math.PI/6,explodesOnImpact:!0,visualEffect:{radius:3,duration:15,color:16777130,intensity:1.5,shape:"CONE",coneAngle:Math.PI/6,secondaryEffects:{debris:{count:20,size:.3},smoke:{volume:.8,duration:.6},muzzleFlash:!0}}},[Re]:{innerRadius:15,outerRadius:25,innerDamage:80,outerDamage:50,falloff:"EXPONENTIAL",explodesOnImpact:!0,visualEffect:{radius:5,duration:15,color:16711680,intensity:3,secondaryEffects:{debris:{count:60,size:1.5},smoke:{volume:2.5,duration:2},shockwave:!0,fragments:!0,dustCloud:!0}}}};function _e(e,t,s){const o=Te[e];if(!o)return 0;const r=t.x-s.x,n=t.y-s.y,i=t.z-s.z,a=r*r+n*n+i*i;e===Fe&&o.shape;if(a>o.outerRadius*o.outerRadius)return 0;if(a<=o.innerRadius*o.innerRadius)return o.innerDamage;const c=(Math.sqrt(a)-o.innerRadius)/(o.outerRadius-o.innerRadius);return"EXPONENTIAL"===o.falloff?o.innerDamage*Math.pow(1-c,2):o.innerDamage-c*(o.innerDamage-o.outerDamage)}function Ne(e,t,s){const o=Ae.getState().applyDamage;if(!s||0===s.length||!Te[e])return;const r=Te[e],n=r.outerRadius*r.outerRadius,i=s.filter((e=>{if(!e||!e.position)return!1;const s=t.x-e.position.x,o=t.y-e.position.y,r=t.z-e.position.z;return s*s+o*o+r*r<=1.1*n}));if(0===i.length)return;const a=(s,r)=>{const n=Math.min(s+r,i.length);for(let a=s;a<n;a++){const s=i[a];if(s.userData&&s.userData.vehicleId)Le(s,e,t,o);else if("function"==typeof s.takeDamage){const o=_e(e,t,s.position);o>0&&s.takeDamage(o)}}n<i.length&&setTimeout((()=>{a(n,r)}),0)};a(0,10)}function Le(e,t,s,o){const r=function(e,t){const s=ke[t.type],o=ve[s];if(!o)return null;const r=o.hitboxSize,n=new I(t.position.x||0,t.position.y||0,t.position.z||0),i=(new y).makeRotationFromEuler(new G(t.rotation.x||0,t.rotation.y||0,t.rotation.z||0)),a=new I(.75*r.x,.75*r.y,.75*r.z);if(new E((new I).copy(n).sub(a),(new I).copy(n).add(a)).containsPoint(e)){const t=e.clone().sub(n),o=(new y).copy(i).invert();let a;return t.applyMatrix4(o),a="TANK"===s?t.y>.3*r.y?"turret":t.y<.3*-r.y?"tracks":t.z>.3*r.z?"front":t.z<.3*-r.z?"rear":"body":"IFV"===s?t.y>.3*r.y?"turret":t.y<.3*-r.y?"wheels":t.z>.3*r.z?"front":t.z<.3*-r.z?"rear":"body":"CIVILIAN_TRUCK"===s||"MILITARY_TRUCK"===s?t.z>.2*r.z?"cabin":t.z<.2*-r.z?"cargo":t.y<.3*-r.y?"wheels":t.z>0&&t.y>0?"engine":"body":"CAR"===s?t.z>.3*r.z?"engine":t.z<.3*-r.z?"rear":t.y<.3*-r.y?"wheels":t.z>0?"cabin":"body":"body",{hit:!0,location:a,position:e.clone(),distanceFromCenter:t.length()}}return null}(s,{position:e.position,rotation:e.rotation,type:e.userData.vehicleType||"car_a"}),n=_e(t,s,e.position);n<=0||o(e.userData.vehicleId,n,r?r.location:"body",t)}function $e(e){switch(e){case Ge:return"Anti-Tank Mine";case Ee:return"RPG";case ze:return"Mortar";case Pe:return"Dart";case Ce:return"Grenade";case Fe:return"Shotgun";case Re:return"Kamikaze";default:return"Unknown Weapon"}}function Oe(e){const t=e.hitbox||{width:1.33,height:1.33,depth:4},s=t.width/2;t.height;const o=t.depth/2,r=e.rotation.y||0,n=Math.abs(Math.sin(r))>.7,i=n?o:s,a=n?s:o,c=new I(e.position.x-i,e.position.y,e.position.z-a),l=new I(e.position.x+i,e.position.y+t.height,e.position.z+a);return new E(c,l)}function He(e,t){if(t.containsPoint(e.start)||t.containsPoint(e.end))return!0;const s=(new I).subVectors(e.end,e.start).normalize(),o=e.start.distanceTo(e.end),r=new C(e.start,s),n=new I;if(r.intersectBox(t,n)){return e.start.distanceTo(n)<=o}return!1}function Be(e,t){if(!e||!e.position||!t)return null;if(!e.previousPosition)return e.previousPosition=e.position.clone(),null;const s=function(e,t){const s=(t,o=[])=>{if(!t.visible||!t.userData)return o;if(t.userData.vehicleId||t.userData.isVehiclePart){if((new E).setFromObject(t).containsPoint(e)){let s="body",r=t;if(t.userData.isVehiclePart&&t.userData.partType){s=t.userData.partType;let e=t.parent;for(;e&&!e.userData.vehicleId;)e=e.parent;e&&(r=e)}o.push({vehicle:r,position:e.clone(),hitLocation:s})}}if(t.children&&t.children.length>0)for(let e of t.children)s(e,o);return o},o=[];return t.children.forEach((e=>{s(e,o)})),o.length>0?o[0]:null}(e.position,t);if(s)return s;const o=(new I).subVectors(e.position,e.previousPosition).normalize(),r=e.previousPosition.distanceTo(e.position),n=Math.max(r,5),i=(new I).copy(e.position).add(e.previousPosition).multiplyScalar(.5),a=new z(e.previousPosition,o,0,1.1*r);a.params.Line.threshold=.2,a.params.Points.threshold=.2;const c=(e,t=[])=>{if(!e.visible||!e.userData)return t;if(e.position){if(e.position.distanceToSquared(i)>n*n*1.5)return t}if((e.userData.vehicleId||e.userData.isVehiclePart||e.userData.type&&e.name&&(e.name.includes("vehicle")||e.name.includes("car")||e.name.includes("truck")||e.name.includes("tank")))&&t.push(e),e.children&&e.children.length>0)for(let s of e.children)c(s,t);return t},l=[];if(t.children.forEach((e=>{c(e,l)})),0===l.length)return null;for(const j of l){if(!j.userData.vehicleId&&!j.userData.isVehicle)continue;const t=Oe({position:j.position,rotation:j.rotation,hitbox:j.userData.hitbox});if(He(new P(e.previousPosition,e.position),t)||t.containsPoint(e.position))return{vehicle:j,position:e.position.clone(),hitLocation:"body"}}const d=a.intersectObjects(l,!0);if(0===d.length)return null;const h=d[0],u=h.object,m=h.point;let p=u,x="body",g=u;for(;g&&!g.userData.vehicleId;)g.userData.isVehiclePart&&g.userData.partType&&(x=g.userData.partType),g=g.parent,g&&g.userData.vehicleId&&(p=g);u.userData.vehicleId&&(p=u),u.userData.isVehiclePart&&u.userData.partType&&(x=u.userData.partType);const f=p.userData.vehicleId;return p.userData.vehicleType,f?{vehicle:p,position:m,hitLocation:x}:null}const Ve={sphere:new M(1,16,16),smallSphere:new M(1,8,8),debris:new F(1,1,1)},Ue={fireballBase:new g({transparent:!0,emissive:new T(16777215)}),debrisBase:new g({transparent:!0}),smokeBase:new g({transparent:!0}),flashBase:new R({color:16777215,transparent:!0})},Ke={[Ge]:{fireballColor:new T(16729344),smokeColor:new T(2236962),debrisColor:new T(7829367),dustColor:new T(10061926),lightIntensity:2.5,lightColor:16733440},[Ee]:{fireballColor:new T(16737095),smokeColor:new T(3355443),debrisColor:new T(7829367),dustColor:new T(8943462),lightIntensity:3,lightColor:16724736},[ze]:{fireballColor:new T(11674146),smokeColor:new T(1118481),debrisColor:new T(5592405),dustColor:new T(7824981),lightIntensity:2.5,lightColor:14492194},[Pe]:{fireballColor:new T(8190976),smokeColor:new T(10070681),debrisColor:new T(11206570),dustColor:new T(11189162),lightIntensity:1.5,lightColor:8978176},[Ce]:{fireballColor:new T(16766720),smokeColor:new T(5592405),debrisColor:new T(10066329),dustColor:new T(10061943),lightIntensity:2,lightColor:16755200},[Fe]:{fireballColor:new T(16777130),smokeColor:new T(14540253),debrisColor:new T(14540253),dustColor:new T(13421755),lightIntensity:1,lightColor:16777130},[Re]:{fireballColor:new T(16711680),smokeColor:new T(2236962),debrisColor:new T(6710886),dustColor:new T(10061926),lightIntensity:3.5,lightColor:16716032},default:{fireballColor:new T(16729344),smokeColor:new T(3355443),debrisColor:new T(8947848),dustColor:new T(11180424),lightIntensity:2,lightColor:16742144}},Ye="debris",Xe="smoke",We="dust",qe="shockwave",Ze=.02,Qe=.01,Je=2,et=20,tt=60,st=50,ot=15,rt=10,nt={_pool:[],get:function(){return this._pool.length>0?this._pool.pop().set(0,0,0):new I(0,0,0)},release:function(e){this._pool.push(e)}};function it({position:s,radius:o,type:r,duration:n=30,onComplete:i,secondaryEffects:a={}}){const c=u.useRef(),[l,d]=u.useState(0),[h,m]=u.useState(.1),[p,x]=u.useState(1),[g,f]=u.useState(n),j=u.useRef(0),y=u.useRef(0),w=u.useRef(.1),M=u.useMemo((()=>{const e=Ke[r]||Ke.default,t=Ue.fireballBase.clone();t.color=e.fireballColor.clone(),t.emissive=e.fireballColor.clone();const s=Ue.debrisBase.clone();s.color=e.debrisColor.clone(),s.emissive=e.debrisColor.clone();const o=Ue.smokeBase.clone();o.color=e.smokeColor.clone();const n=Ue.smokeBase.clone();return n.color=e.dustColor.clone(),{fireball:t,debris:s,smoke:o,dust:n,flash:Ue.flashBase.clone()}}),[r]),b=u.useMemo((()=>Ke[r]||Ke.default),[r]),S=u.useMemo((()=>{const e=a.debris||{count:Math.floor(5*o),size:.7},t=a.smoke||{volume:1,duration:1};return function(e,t,s,o,r,n,i){const a=[],c=2*Math.PI;for(let l=0;l<e;l++){const e=Math.random()*c,t=.01+.03*Math.random(),o=(.05+.15*Math.random())*s,n=Math.floor(r*(.7+.3*Math.random())),i=nt.get().set(Math.cos(e)*t*(.5+Math.random()),.01+.03*Math.random(),Math.sin(e)*t*(.5+Math.random()));a.push({active:!1,spawnDelay:Math.floor(3*Math.random()),position:nt.get(),velocity:i,rotation:nt.get().set(0,0,0),rotationSpeed:nt.get().set(.1*(Math.random()-.5),.1*(Math.random()-.5),.1*(Math.random()-.5)),size:o,originalSize:o,type:Ye,opacity:0,targetOpacity:.7+.3*Math.random(),life:n,initialLife:n})}for(let l=0;l<t;l++){const e=Math.random()*c,t=Math.random()*o*.8,s=.003+.007*Math.random(),n=.2+.4*Math.random(),l=Math.floor(r*(.8+.4*Math.random())*i);a.push({active:!1,spawnDelay:3+Math.floor(5*Math.random()),position:nt.get().set(Math.cos(e)*t*.2,.2+.3*Math.random(),Math.sin(e)*t*.2),velocity:nt.get().set(Math.cos(e)*s*.5,.005+.01*Math.random(),Math.sin(e)*s*.5),rotation:nt.get().set(0,0,0),rotationSpeed:nt.get().set(.02*(Math.random()-.5),.02*(Math.random()-.5),.02*(Math.random()-.5)),size:n,originalSize:n,type:Xe,opacity:0,targetOpacity:.4+.2*Math.random(),life:l,initialLife:l})}if(n.shockwave){const e=Math.min(rt,Math.max(8,3*o));for(let t=0;t<e;t++){const s=t/e*c,o=Math.floor(.4*r);a.push({active:!1,spawnDelay:0,position:nt.get().set(0,.05,0),velocity:nt.get().set(0,0,0),rotation:nt.get().set(Math.PI/2,0,s),rotationSpeed:nt.get().set(0,0,0),angle:s,size:.2,originalSize:.2,type:qe,opacity:0,targetOpacity:.6,life:o,initialLife:o})}}if(n.dustCloud){const e=Math.min(ot,Math.floor(4*o));for(let t=0;t<e;t++){const e=Math.random()*c,t=.3*o+Math.random()*o*.5,s=.002+.005*Math.random(),n=.3+.5*Math.random(),i=Math.floor(.6*r+Math.random()*r*.4);a.push({active:!1,spawnDelay:5+Math.floor(7*Math.random()),position:nt.get().set(0,0,0),velocity:nt.get().set(Math.cos(e)*s*t,.001+.004*Math.random(),Math.sin(e)*s*t),rotation:nt.get().set(0,0,0),rotationSpeed:nt.get().set(0,.02*(Math.random()-.5),0),size:n,originalSize:n,type:We,opacity:0,targetOpacity:.3+.2*Math.random(),life:i,initialLife:i})}}return a}(Math.min(tt,Math.floor(e.count)),Math.min(st,Math.floor(8*o*t.volume)),e.size,o,n,a,t.duration)}),[o,n,a]);u.useEffect((()=>()=>{Object.values(M).forEach((e=>e.dispose()))}),[M]),e((()=>{if(!c.current||g<=0)return void(g<=0&&i&&i());if(j.current++,o<Je&&j.current%2!=0)return;const e=1-g/n;if(Math.abs(e-y.current)>Ze&&(y.current=e,d(e),k(M,e)),h<o){const t=Math.min(1,2*e),s=.2*(o*Math.min(1,1.2*t)-w.current),r=w.current+Math.max(.05,s);Math.abs(r-w.current)>Ze&&(w.current=r,m(r))}if((e<.4?1!==p:p>Qe)&&x(e<.4?1:Math.max(0,p-1/(.6*n))),function(e){const t=et,s=e.length;for(let o=0;o<s;o+=t){const r=Math.min(o+t,s);for(let t=o;t<r;t++){const s=e[t];if(!s.active){s.spawnDelay--,s.spawnDelay<=0&&(s.active=!0);continue}if(s.life<=0)continue;const o=1-s.life/s.initialLife;switch(s.opacity<s.targetOpacity&&(s.opacity=Math.min(s.targetOpacity,s.opacity+s.targetOpacity/10)),s.type){case qe:lt(s,o);break;case We:dt(s,o);break;case Xe:ht(s,o);break;default:ut(s,o)}s.life--}}}(S),f((e=>e-1)),g<=1&&i)try{i()}catch(t){console.error("Error in explosion onComplete callback:",t)}})),u.useEffect((()=>{m(.1),w.current=.1,x(1),f(n),d(0),y.current=0,j.current=0,function(e){for(let t of e)if(t.opacity=0,t.active=0===t.spawnDelay,t.life=t.initialLife,t.position.set(0,0,0),t.type===qe)t.position.set(0,.05,0);else if(t.type===Xe){const e=Math.random()*Math.PI*2,s=.2*Math.random();t.position.set(Math.cos(e)*s,.2+.3*Math.random(),Math.sin(e)*s)}}(S),k(M,0)}),[s,n,S,M]);const v=u.useMemo((()=>{const e={[Ye]:[],[Xe]:[],[We]:[],[qe]:[]};if(Math.abs(l-y.current)<.05)return e;for(const t of S)t.active&&t.life>0&&t.opacity>Qe&&e[t.type].push(t);return e}),[S,l,y]);function k(e,t){e.fireball.opacity=p,e.fireball.emissiveIntensity=2*(1-.7*t),e.flash.opacity=Math.max(0,1-t/.2)}return t.jsxs("group",{ref:c,position:[s.x,s.y,s.z],children:[l<.2&&t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[1.2*h,16,16]}),t.jsx("primitive",{object:M.flash,attach:"material"})]}),t.jsxs("mesh",{scale:[h,h,h],children:[t.jsx("primitive",{attach:"geometry",object:Ve.sphere}),t.jsx("primitive",{object:M.fireball,attach:"material"})]}),Object.entries(v).map((([e,s])=>t.jsx(at,{type:e,particles:s,materials:M,progress:l},e))),l<.7&&t.jsx("pointLight",{color:b.lightColor,intensity:b.lightIntensity*(1-Math.pow(l,1.5))*20,distance:15*o,decay:2})]})}function at({type:e,particles:s,materials:o,progress:r}){if(0===s.length)return null;let n,i=0;switch(e){case Ye:n=o.debris,i=1*(1-r);break;case Xe:n=o.smoke;break;case We:n=o.dust;break;case qe:n=o.dust,i=.5*(1-r);break;default:n=o.debris}return n.emissiveIntensity=i,t.jsx(t.Fragment,{children:s.map(((s,o)=>t.jsxs("mesh",{position:s.position.toArray(),rotation:s.rotation.toArray(),scale:[s.size,s.size,s.size],children:[t.jsx("primitive",{attach:"geometry",object:ct(e)}),t.jsx("meshStandardMaterial",{color:n.color,transparent:!0,opacity:s.opacity,emissive:n.color,emissiveIntensity:i})]},`${e}-${o}`)))})}function ct(e){return e===Ye?Ve.debris:Ve.smallSphere}function lt(e,t){const s=3*t;e.position.x=Math.cos(e.angle)*s,e.position.z=Math.sin(e.angle)*s,t>.7&&(e.opacity=Math.max(0,e.targetOpacity*(1-(t-.7)/.3))),e.size=.1+.4*t}function dt(e,t){e.position.add(e.velocity),e.size=e.originalSize*(1+.8*t),e.rotation.y+=e.rotationSpeed.y,t>.6&&(e.opacity=e.targetOpacity*Math.max(0,1-(t-.6)/.4))}function ht(e,t){e.position.add(e.velocity);const s=t<.3?4e-4*(1-t/.3):0;e.velocity.y+=s-2e-4,e.size=e.originalSize*(1+2*t),t>.6&&(e.opacity=e.targetOpacity*Math.max(0,1-(t-.6)/.4)),e.rotation.x+=e.rotationSpeed.x,e.rotation.y+=e.rotationSpeed.y,e.rotation.z+=e.rotationSpeed.z}function ut(e,t){e.position.add(e.velocity),e.velocity.y-=.002,e.position.y<.05&&e.velocity.y<0&&(e.velocity.y*=-.3,e.velocity.x*=.8,e.velocity.z*=.8),t>.7&&(e.opacity=e.targetOpacity*Math.max(0,1-(t-.7)/.3));const{rotationSpeed:s,rotation:o}=e;o.x+=s.x,o.y+=s.y,o.z+=s.z}function mt(){const[e,o]=u.useState([]),{scene:r}=s(),n=u.useRef(new Map),i=u.useRef(new Map),a=u.useRef(0),c=u.useRef(new Map);u.useEffect((()=>{const e=()=>{const e=new Map,t=s=>{(s.userData&&(s.userData.vehicleId||s.userData.isVehiclePart||s.userData.parentVehicleId||s.userData.vehicleType)||s.isMesh)&&e.set(s.id,s),s.children&&s.children.length>0&&s.children.forEach(t)};r.children.forEach(t),n.current=e};e();const t=setInterval(e,2e3);return()=>{clearInterval(t)}}),[r]),u.useEffect((()=>{const e=e=>{const{position:t,weaponType:s}=e.detail;if(s===Fe){const e=Date.now();if(e-a.current<50)return;a.current=e;if((window.currentFps||60)<20&&Math.random()>.5)return;const o=1.5*Te[s].outerRadius,r=`${Math.floor(t.x)},${Math.floor(t.y)},${Math.floor(t.z)}`;let n=[];if(c.current.has(r)&&e-c.current.get(r).timestamp<200)n=c.current.get(r).objects;else if(n=l(t,o),c.current.set(r,{objects:n,timestamp:e}),c.current.size>20){const e=Array.from(c.current.keys())[0];c.current.delete(e)}return void(n.length>0&&(window.requestIdleCallback?window.requestIdleCallback((()=>{Ne(s,t,n)})):requestAnimationFrame((()=>{Ne(s,t,n)}))))}const r=function(e,t){var s,o,r,n;const i=window.performance&&window.performance.now?Math.min(1,60/(window.currentFps||60)):1,a=Te[e];if(e===Fe){const s=window.currentFps||60;if(s<25)return{position:t.clone(),type:e,noVisual:!0,startTime:Date.now()};const o=s<45?Math.min(.4,60/(window.currentFps||60)):.8;return{position:t.clone(),radius:a.outerRadius/4*o,duration:1,type:e,startTime:Date.now()}}const c=a.visualEffect,l=Math.floor(((null==(s=c.secondaryEffects.debris)?void 0:s.count)||0)*i),d=((null==(o=c.secondaryEffects.smoke)?void 0:o.volume)||0)*i;return{position:t.clone(),radius:c.radius*i,duration:c.duration,color:c.color,intensity:c.intensity*i,shape:c.shape||"SPHERE",coneAngle:c.coneAngle,secondaryEffects:{debris:{count:l,size:(null==(r=c.secondaryEffects.debris)?void 0:r.size)||0},smoke:{volume:d,duration:(null==(n=c.secondaryEffects.smoke)?void 0:n.duration)||0},shockwave:c.secondaryEffects.shockwave&&i>.7,dustCloud:c.secondaryEffects.dustCloud&&i>.7,energyField:c.secondaryEffects.energyField&&i>.8,fragments:c.secondaryEffects.fragments&&i>.7,muzzleFlash:c.secondaryEffects.muzzleFlash,tracer:c.secondaryEffects.tracer},type:e,startTime:Date.now(),quality:i}}(s,t),n=6*r.radius,d=l(t,n);d.length>0&&requestAnimationFrame((()=>{Ne(s,t,d)}));const h=`explosion-${Date.now().toString(36)}-${Math.random().toString(36).substr(2,5)}`;i.current.set(h,Date.now()),o((e=>[...e,{...r,id:h}]))};return window.addEventListener("weapon-impact",e),()=>{window.removeEventListener("weapon-impact",e)}}),[r]),u.useEffect((()=>{const e=setInterval((()=>{const e=Date.now();let t=!1;i.current.forEach(((s,o)=>{e-s>5e3&&(i.current.delete(o),t=!0)})),t&&o((e=>{const t=Array.from(i.current.keys());return e.filter((e=>t.includes(e.id)))}))}),1e3);return()=>clearInterval(e)}),[]);const l=(e,t)=>{const s=[],o=e.clone(),n=t*t,i=e=>{if(!e.position)return;const t=new I;e.getWorldPosition(t);const r=t.x-o.x,a=t.y-o.y,c=t.z-o.z;if(r*r+a*a+c*c<=n&&s.push(e),e.children&&e.children.length>0)for(const s of e.children)i(s)};return r.children.forEach(i),s};return t.jsx(t.Fragment,{children:e.map((e=>t.jsx(it,{position:e.position,radius:e.radius,type:e.type,duration:e.duration,secondaryEffects:e.secondaryEffects,onComplete:()=>{return t=e.id,i.current.delete(t),void o((e=>e.filter((e=>e.id!==t))));var t}},e.id)))})}function pt(e,t){const s=new CustomEvent("weapon-impact",{detail:{position:e,weaponType:t}});window.dispatchEvent(s)}function xt(){const[e,t]=u.useState([]);return m.useEffect((()=>{const e=e=>{};return window.addEventListener("damage-dealt",e),()=>{window.removeEventListener("damage-dealt",e)}}),[]),null}function gt({position:s,direction:o,onComplete:r,isImpact:n}){const[i,a]=u.useState(n?5:8),c=u.useRef(),l=u.useRef([]);u.useEffect((()=>{const e=[],t=window.currentFps||60,s=t<30?.2:t<40?.4:t<50?.6:.8,o=n?.5:1,i=Math.max(1,Math.floor(6*s*o));for(let r=0;r<i;r++){const t=Math.random()*Math.PI*2,s=.3*Math.random();e.push({position:new I(Math.cos(t)*s,Math.sin(t)*s,-.5-.5*Math.random()),size:.05+.1*Math.random(),opacity:.7+.3*Math.random(),color:new T(.9+.1*Math.random(),.7+.2*Math.random(),.2+.2*Math.random())})}if(t>40&&!n){const t=Math.max(1,Math.floor(3*s));for(let s=0;s<t;s++){const t=.2*Math.random(),s=.5+1*Math.random(),o=Math.random()*Math.PI*2;e.push({position:new I(Math.cos(o)*t,Math.sin(o)*t,-s),size:.03+.05*Math.random(),opacity:.5+.3*Math.random(),color:new T(.8,.8,.8)})}}l.current=e;const a=setTimeout((()=>{r&&r()}),n?100:150);return()=>clearTimeout(a)}),[r,n]),e((()=>{i<=0||a((e=>e-1))}));const d=u.useMemo((()=>{if(!o)return[0,0,0];const e=new I(0,0,-1),t=(new I).copy(o).normalize(),s=(new _).setFromUnitVectors(e,t),r=(new G).setFromQuaternion(s);return[r.x,r.y,r.z]}),[o]);if(i<=0)return null;const h=i/(n?5:8);return(window.currentFps||60)<30?t.jsxs("group",{ref:c,position:[s.x,s.y,s.z],rotation:d,children:[t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.2,6,6]}),t.jsx("meshBasicMaterial",{color:16768392,transparent:!0,opacity:.8*h})]}),t.jsx("pointLight",{color:16768392,intensity:4*h,distance:2,decay:2})]}):t.jsxs("group",{ref:c,position:[s.x,s.y,s.z],rotation:d,children:[t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.2,6,6]})," ",t.jsx("meshBasicMaterial",{color:16768392,transparent:!0,opacity:.8*h})]}),!n&&t.jsxs("mesh",{position:[0,0,-.1],children:[t.jsx("coneGeometry",{args:[.3,.6,6]})," ",t.jsx("meshBasicMaterial",{color:16777130,transparent:!0,opacity:.6*h})]}),l.current.map(((e,s)=>t.jsxs("mesh",{position:e.position.toArray(),children:[t.jsx("sphereGeometry",{args:[e.size,4,4]})," ",t.jsx("meshBasicMaterial",{color:e.color,transparent:!0,opacity:e.opacity*h})]},s))),t.jsx("pointLight",{color:16768392,intensity:n?3*h:5*h,distance:n?2:3,decay:2})]})}function ft(){const[e,s]=u.useState([]),o=u.useRef([]),r=u.useRef(!1),n=u.useRef(0),i=()=>{if(r.current||0===o.current.length)return;r.current=!0;const e=window.currentFps||60,t=e<30?1:e<45?2:3,n=o.current.slice(0,t);o.current=o.current.slice(t),s((e=>[...e,...n])),o.current.length>0?setTimeout((()=>{r.current=!1,i()}),0):r.current=!1},a=e=>{o.current.push(e),r.current||i()};u.useEffect((()=>{const e=e=>{const{position:t,direction:s,weaponType:o}=e.detail;if(o!==Fe)return;const r=Date.now(),i=window.lowFpsWarning?150:50;if(r-n.current<i)return void console.log("Throttled shotgun effect");n.current=r;const c=`flash-${Date.now().toString(36)}-${Math.random().toString(36).substr(2,5)}`;a({id:c,position:t,direction:s||new I(0,0,-1)})};window.addEventListener("shotgun-fire",e);const t=e=>{const{position:t,weaponType:s,direction:o}=e.detail;if(s!==Fe)return;const r=Date.now(),i=window.lowFpsWarning?200:100;if(r-n.current<i)return;if(window.currentFps<25&&Math.random()<.7)return;const c=`impact-${Date.now().toString(36)}-${Math.random().toString(36).substr(2,5)}`;a({id:c,position:t,direction:o||new I(0,0,-1),isImpact:!0})};window.addEventListener("weapon-impact",t);const r=()=>{console.log("Persistent low FPS detected - reducing shotgun effect quality"),o.current=[],s((e=>e.length>3?e.slice(0,3):e))};return window.addEventListener("persistentLowFps",r),()=>{window.removeEventListener("shotgun-fire",e),window.removeEventListener("weapon-impact",t),window.removeEventListener("persistentLowFps",r)}}),[]);return t.jsx(t.Fragment,{children:e.map((e=>t.jsx(gt,{position:e.position,direction:e.direction,onComplete:()=>{return t=e.id,void s((e=>e.filter((e=>e.id!==t))));var t},isImpact:e.isImpact},e.id)))})}const jt={[Fe]:16,[Ce]:3,[Pe]:3};function yt(){const o=u.useRef();u.useRef(new I(0,0,0));const n=u.useRef(new I(0,0,0)),i=u.useRef([]),a=u.useRef(new G(0,0,0,"YXZ")),[c,l]=u.useState([0,10,0]),[d,h]=u.useState(!1),[m,p]=u.useState(0),[x,g]=u.useState(12),[f,j]=u.useState(6),[y,w]=u.useState(9),[M,b]=u.useState(!1),[S,v]=u.useState(!1),[k,A]=u.useState(!1),D=u.useRef({[Fe]:[],[Ce]:[],[Pe]:[]}),[E,z]=u.useState([]),{camera:P,scene:C}=s(),[F,R]=r(),[T,L]=u.useState(!1),[$,O]=u.useState(!0);u.useEffect((()=>{Object.entries(jt).forEach((([e,t])=>{for(let s=0;s<t;s++)D.current[e].push({id:`${e}-${s}`,position:new I,previousPosition:new I,direction:new I,type:e,speed:0,life:0,active:!1,gravity:0})}))}),[]);const H=.05,B=e=>{const t=D.current[e],s=t.find((e=>!e.active));if(s)return s.active=!0,s;if(console.warn(`Pool exhausted for ${e} projectiles`),t.length<25){const s={id:`${e}-${t.length}`,position:new I,previousPosition:new I,direction:new I,type:e,speed:0,life:0,active:!0,gravity:0};return t.push(s),s}return null},V=e=>{const t=D.current[e.type].find((t=>t.id===e.id));t&&(t.active=!1,t.life=0)},U=u.useCallback((()=>{if(x<=0||M)return;console.log("Firing shotgun!");const e=x-1;g(e),b(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:se,weaponType:"shotgunAmmo",ammoCount:Number(e)}}));const t=o.current.rotation.y,s=new I(-Math.sin(t),0,-Math.cos(t));!function(e,t){const s=new CustomEvent("shotgun-fire",{detail:{position:e,direction:t,weaponType:Fe}});window.dispatchEvent(s)}(o.current.position.clone().add(s.clone().multiplyScalar(1)),s);const r=window.currentFps||60,n=r<30?1:r<45?2:3;for(let i=0;i<n;i++){const e=1===n?.1:.2,t=new I((Math.random()-.5)*e,(Math.random()-.5)*(.5*e),(Math.random()-.5)*e),r=s.clone().add(t).normalize(),i=B(Fe);i&&(i.position.copy(o.current.position).add(r.clone().multiplyScalar(1.5)),i.previousPosition||(i.previousPosition=new I),i.previousPosition.copy(i.position),i.direction.copy(r),i.speed=1+.2*Math.random(),i.life=25,z((e=>[...e,i])))}setTimeout((()=>{b(!1)}),800)}),[x,M]);u.useEffect((()=>(P.position.set(0,15,20),P.lookAt(0,10,0),o.current&&(o.current.rotation.order="YXZ",o.current.rotation.x=a.current.x,o.current.rotation.y=a.current.y,o.current.rotation.z=a.current.z),F((e=>e),(e=>{const{forward:t,backward:s,left:o,right:r,up:n,down:i,strafeLeft:a,strafeRight:c}=e;t||s||o||r||n||i||a||c?(h(!0),p(1)):p(.5)})))),[P,F]),u.useEffect((()=>{const e=e=>{switch(e.button){case 0:U();break;case 2:(()=>{if(f<=0||S)return;console.log("Dropping grenade!");const e=f-1;j(e),v(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:se,weaponType:"grenadeAmmo",ammoCount:Number(e)}}));const t=o.current.position;console.log("Drone position:",t.x,t.y,t.z);const s=B(Ce);s.position.set(t.x,t.y-.5,t.z),s.previousPosition||(s.previousPosition=new I),s.previousPosition.copy(s.position),s.direction.set(0,-1,0),s.speed=.4,s.life=70,s.gravity=.005,z((e=>[...e,s])),setTimeout((()=>{v(!1)}),1200)})()}},t=e=>{switch(e.key){case"c":case"C":(()=>{if(y<=0||k)return;console.log("Dropping dart!");const e=y-1;w(e),A(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:se,weaponType:"dartAmmo",ammoCount:Number(e)}}));const t=o.current.position,s=B(Pe);s.position.set(t.x,t.y-.5,t.z),s.previousPosition||(s.previousPosition=new I),s.previousPosition.copy(s.position),s.direction.set(0,-1,0),s.speed=.6,s.life=60,s.gravity=.008,z((e=>[...e,s])),console.log("Projectiles after adding dart:",E.length+1),setTimeout((()=>{A(!1)}),1e3)})();break;case"v":case"V":L((e=>!e))}},s=e=>{e.preventDefault()};return window.addEventListener("mousedown",e),window.addEventListener("keydown",t),window.addEventListener("contextmenu",s),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("keydown",t),window.removeEventListener("contextmenu",s)}}),[x,f,y,M,S,k]);const K=(e,t)=>{console.log(`Weapon impact: ${t} at position [${e.x.toFixed(2)}, ${e.y.toFixed(2)}, ${e.z.toFixed(2)}]`);const s={x:e.x,y:e.y,z:e.z};setTimeout((()=>{pt(new I(s.x,s.y,s.z),t)}),0)};return e((()=>{z((e=>{if(0===e.length)return e;const t=[];for(const s of e){if(s.life<=0){K(s.position,s.type),V(s);continue}if(s.position.y<=.1){K(s.position,s.type),V(s);continue}const e=Be(s,C);e?(K(e.position,s.type),V(s)):(s.previousPosition||(s.previousPosition=new I),s.previousPosition.copy(s.position),s.position.add(s.direction.clone().multiplyScalar(s.speed)),s.gravity&&(s.direction.y-=s.gravity),s.life--,t.push(s))}return t}))})),e(((e,t)=>{if(!o.current)return;const{forward:s,backward:r,left:i,right:a,up:c,down:d,strafeLeft:h,strafeRight:u,shift:m}=R(),p=o.current.rotation.y,x=new I(-Math.sin(p),0,-Math.cos(p)),g=new I(Math.cos(p),0,-Math.sin(p));if(s&&(n.current.add(x.clone().multiplyScalar(.1)),n.current.y-=.005),r&&(n.current.add(x.clone().multiplyScalar(-.05)),n.current.y+=.004),i&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y+.12,.2)),a&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y-.12,.2)),h&&n.current.add(g.clone().multiplyScalar(-.04)),u&&n.current.add(g.clone().multiplyScalar(.04)),c)n.current.y+=H;else if(d){const e=m?1.5*H:H;n.current.y-=e}else n.current.y-=.004;n.current.multiplyScalar(.98);n.current.length()>1.5&&n.current.normalize().multiplyScalar(1.5),o.current.position.add(n.current),o.current.position.y<1&&(o.current.position.y=1,n.current.y=0);let f=0,j=0;s&&(f=-.3),r&&(f=.3),h&&(j=.2),u&&(j=-.2);const y=o.current.rotation.y,w=new _;w.setFromEuler(o.current.rotation);const M=new G(f,y,j,"YXZ"),b=new _;b.setFromEuler(M);const S=(new _).copy(w);S.slerp(b,.1),o.current.setRotationFromQuaternion(S);const v=new I(o.current.position.x,o.current.position.y,o.current.position.z);if(T)P.position.set(o.current.position.x,o.current.position.y-3,o.current.position.z),P.lookAt(o.current.position.x,0,o.current.position.z);else{const e=new I(25*Math.sin(p),8,25*Math.cos(p));P.position.copy(v).add(e),P.lookAt(o.current.position.x,o.current.position.y+.5,o.current.position.z)}l([o.current.position.x,o.current.position.y,o.current.position.z])})),t.jsxs(t.Fragment,{children:[t.jsxs("group",{ref:o,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.8,.35,2]}),t.jsx("meshStandardMaterial",{color:"#1d3557",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[.4,0,0],rotation:[0,0,Math.PI/4],children:[t.jsx("boxGeometry",{args:[.25,.35,2]}),t.jsx("meshStandardMaterial",{color:"#2a4568",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[-.4,0,0],rotation:[0,0,-Math.PI/4],children:[t.jsx("boxGeometry",{args:[.25,.35,2]}),t.jsx("meshStandardMaterial",{color:"#2a4568",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,1],rotation:[Math.PI/4,0,0],children:[t.jsx("boxGeometry",{args:[.8,.25,.25]}),t.jsx("meshStandardMaterial",{color:"#2a4568",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,-1],rotation:[-Math.PI/4,0,0],children:[t.jsx("boxGeometry",{args:[.8,.25,.25]}),t.jsx("meshStandardMaterial",{color:"#2a4568",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,position:[0,0,0],rotation:[0,Math.PI/4,0],children:[t.jsx("boxGeometry",{args:[3,.08,.1]}),t.jsx("meshStandardMaterial",{color:"#e63946",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{castShadow:!0,position:[0,0,0],rotation:[0,-Math.PI/4,0],children:[t.jsx("boxGeometry",{args:[3,.08,.1]}),t.jsx("meshStandardMaterial",{color:"#e63946",metalness:.4,roughness:.6})]}),t.jsx(Mt,{position:[.6,-.3,.6]}),t.jsx(Mt,{position:[-.6,-.3,.6]}),t.jsx(Mt,{position:[.6,-.3,-.6]}),t.jsx(Mt,{position:[-.6,-.3,-.6]}),t.jsx(wt,{position:[1.1,0,1.1],index:0,propRef:e=>i.current[0]=e,active:d,speed:m}),t.jsx(wt,{position:[-1.1,0,1.1],index:1,propRef:e=>i.current[1]=e,active:d,speed:m,counterClockwise:!0}),t.jsx(wt,{position:[1.1,0,-1.1],index:2,propRef:e=>i.current[2]=e,active:d,speed:m,counterClockwise:!0}),t.jsx(wt,{position:[-1.1,0,-1.1],index:3,propRef:e=>i.current[3]=e,active:d,speed:m}),t.jsxs("group",{position:[0,-.3,-1],rotation:[Math.PI/2,0,Math.PI],children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[-.25,0,-.2],children:[t.jsx("cylinderGeometry",{args:[.15,.15,2.4,12]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.8,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[.25,0,-.2],children:[t.jsx("cylinderGeometry",{args:[.15,.15,2.4,12]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.8,roughness:.2})]})]}),t.jsxs("group",{position:[0,-.35,1],rotation:[-Math.PI/2,0,0],children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,.15],children:[t.jsx("boxGeometry",{args:[1,.5,.3]}),t.jsx("meshStandardMaterial",{color:"#4a5568",metalness:.6,roughness:.3})]}),[...Array(4)].map(((e,s)=>t.jsxs("mesh",{position:[.22*(s-1.5),0,0],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.08,.08,.3,10]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.4})]},s))),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,.15,.15],children:[t.jsx("boxGeometry",{args:[1,.08,.08]}),t.jsx("meshStandardMaterial",{color:"#e63946",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,-.15,.15],children:[t.jsx("boxGeometry",{args:[1,.08,.08]}),t.jsx("meshStandardMaterial",{color:"#e63946",metalness:.6,roughness:.4})]})]}),t.jsxs("group",{position:[0,-.4,0],rotation:[-Math.PI/2,0,0],children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,.1],children:[t.jsx("boxGeometry",{args:[.8,.25,.2]}),t.jsx("meshStandardMaterial",{color:"#4a5568",metalness:.6,roughness:.3})]}),[...Array(5)].map(((e,s)=>t.jsxs("mesh",{position:[.15*(s-2),0,0],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.03,.03,.15,8]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.4})]},s))),t.jsxs("mesh",{position:[0,.15,.1],children:[t.jsx("boxGeometry",{args:[.2,.1,.1]}),t.jsx("meshStandardMaterial",{color:"#ff5733",emissive:"#ff5733",emissiveIntensity:.5})]})]})]}),t.jsx(bt,{projectiles:E})]})}function wt({position:s,index:o,propRef:r,active:n=!0,speed:i=1,counterClockwise:a=!1}){u.useRef();const c=u.useRef(),l=a?-1:1;return e((()=>{c.current&&n&&(c.current.rotation.y+=.5*i*l),r&&r(c.current)})),t.jsxs("group",{position:s,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.15,.18,.2,12]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.3})]}),t.jsxs("mesh",{castShadow:!0,position:[0,.12,0],children:[t.jsx("cylinderGeometry",{args:[.12,.12,.05,12]}),t.jsx("meshStandardMaterial",{color:"#8d99ae",metalness:.8,roughness:.2})]}),t.jsxs("group",{ref:c,position:[0,.15,0],children:[t.jsxs("mesh",{castShadow:!0,children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.6,.02,-.1,.6,-.02,.1,0,0,0,.6,-.02,.1,1.2,0,0,0,0,0,1.2,0,0,.6,.02,-.1,.6,.02,-.1,1.2,0,0,.6,-.02,.1])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{castShadow:!0,rotation:[0,Math.PI,0],children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.6,.02,-.1,.6,-.02,.1,0,0,0,.6,-.02,.1,1.2,0,0,0,0,0,1.2,0,0,.6,.02,-.1,.6,.02,-.1,1.2,0,0,.6,-.02,.1])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.2})]})]})]})}function Mt({position:e}){return t.jsxs("group",{position:e,children:[t.jsxs("mesh",{castShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.04,.04,.6,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[0,-.35,0],children:[t.jsx("sphereGeometry",{args:[.08,8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.4,roughness:.6})]})]})}function bt({projectiles:s}){const o=u.useMemo((()=>({[Fe]:new M(.05,3,3),[Ce]:(new L).add(new $(new S(.15,.15,.23,8),new g({color:"#4d7c0f",metalness:.6,roughness:.3})),new $(new S(.14,.15,.06,8),new g({color:"#3f6212",metalness:.7,roughness:.4})).translateY(.145),new $(new O(.03,.007,6,6),new g({color:"#a3a3a3",metalness:.8,roughness:.2})).translateY(.17).translateX(.09).rotateX(Math.PI/2)),[Pe]:(new L).add(new $(new S(.08,.08,.35,6),new g({color:"#8b5cf6",metalness:.6,roughness:.3})),new $(new k(.08,.12,6),new g({color:"#7c3aed",metalness:.7,roughness:.4})).translateY(-.23),...[0,1,2,3].map((e=>new $(new F(.025,.13,.09),new g({color:"#a78bfa",metalness:.5,roughness:.5})).translateY(.14).rotateY(e*Math.PI/2)))).rotateX(Math.PI)})),[]),r=m.memo((({projectile:s})=>{const[r,n]=u.useState([0,0,0]);return e((()=>{s.type===Ce?n([r[0]+.03,r[1]+.02,r[2]+.01]):s.type===Pe&&(s.speed,n([.05*Math.sin(.005*Date.now()),r[1]+.01,.05*Math.cos(.005*Date.now())]))})),s.type===Fe?t.jsx("mesh",{position:[s.position.x,s.position.y,s.position.z],geometry:o[s.type],material:new R({color:"gray"})}):t.jsx("group",{position:[s.position.x,s.position.y,s.position.z],rotation:r,children:t.jsx("primitive",{object:o[s.type].clone()})})})),n=u.useMemo((()=>{const e={[Fe]:[],[Ce]:[],[Pe]:[]};return s.forEach((t=>{e[t.type]&&e[t.type].push(t)})),e}),[s]);return t.jsx(t.Fragment,{children:Object.entries(n).map((([e,s])=>s.map((e=>t.jsx(r,{projectile:e},e.id)))))})}function St({shotgunAmmo:e,grenadeAmmo:s,dartAmmo:o,showHUD:r}){return r?t.jsxs("div",{className:"weapon-hud grenadier-hud",children:[t.jsx("h2",{children:"GRENADIER DRONE"}),t.jsxs("div",{className:"weapon-list",children:[t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["SHOTGUN [",e,"]"]}),t.jsx("span",{className:"weapon-key",children:"LMB"})]}),t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["GRENADE [",s,"]"]}),t.jsx("span",{className:"weapon-key",children:"RMB"})]}),t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["DART [",o,"]"]}),t.jsx("span",{className:"weapon-key",children:"C"})]})]}),t.jsx("div",{className:"view-toggle",children:t.jsx("span",{children:"CAMERA VIEW TOGGLE: V"})})]}):null}function vt(){const o=u.useRef();u.useRef(new I(0,0,0));const n=u.useRef(new I(0,0,0)),i=u.useRef([]),a=u.useRef(new I(0,10,0)),c=u.useRef(!1),l=u.useRef({x:0,y:0}),{isFirstPerson:d,toggleFirstPerson:h}=ce(),m=u.useRef(new G(0,0,0,"YXZ")),[p,x]=u.useState([0,10,0]),[g,f]=u.useState(!1),[j,y]=u.useState(0),{camera:w,scene:M,gl:b}=s(),[S,v]=r(),k=.06,A=e=>{d&&(l.current.x=e.clientX/window.innerWidth*2-1,l.current.y=-e.clientY/window.innerHeight*2+1)};return u.useEffect((()=>{const e=e=>{"KeyV"===e.code&&h()};return window.addEventListener("keydown",e),window.addEventListener("mousemove",A),()=>{window.removeEventListener("keydown",e),window.removeEventListener("mousemove",A)}}),[h]),u.useEffect((()=>(w.position.set(0,15,20),w.lookAt(0,10,0),o.current&&(o.current.rotation.order="YXZ",o.current.rotation.x=m.current.x,o.current.rotation.y=m.current.y,o.current.rotation.z=m.current.z),S((e=>e),(e=>{const{forward:t,backward:s,left:o,right:r,up:n,down:i,strafeLeft:a,strafeRight:c}=e;t||s||o||r||n||i||a||c?(f(!0),y(1)):y(.5)})))),[w,S]),e(((e,t)=>{if(!o.current||c.current)return;a.current.copy(o.current.position);const{forward:s,backward:r,left:i,right:h,up:u,down:m,strafeLeft:p,strafeRight:g,shift:f}=v(),j=o.current.rotation.y,y=new I(-Math.sin(j),0,-Math.cos(j)),b=new I(Math.cos(j),0,-Math.sin(j));if(s&&(n.current.add(y.clone().multiplyScalar(.1)),n.current.y-=.02),r&&(n.current.add(y.clone().multiplyScalar(-.05)),n.current.y+=.016),d){const e=j-.15*l.current.x;o.current.rotation.y=N.lerp(o.current.rotation.y,e,.15);const t=Math.max(-.4,Math.min(.4,.4*l.current.y));o.current.rotation.x=N.lerp(o.current.rotation.x,t,.15)}else i&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y+.24,.2)),h&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y-.24,.2));if(p&&n.current.add(b.clone().multiplyScalar(-.04)),g&&n.current.add(b.clone().multiplyScalar(.04)),u)n.current.y+=k;else if(m){const e=f?.09:k;n.current.y-=e}else n.current.y-=.003;n.current.multiplyScalar(.98);if(n.current.length()>3&&n.current.normalize().multiplyScalar(3),o.current.position.add(n.current),o.current.position.y<1&&(o.current.position.y=1,n.current.y=0),M&&o.current){const e=Be({position:o.current.position.clone(),previousPosition:a.current.clone()},M);if(e)return S=e.position,void(c.current||(c.current=!0,console.log("Kamikaze drone collided with vehicle!"),pt(S,Re),o.current&&(o.current.visible=!1),setTimeout((()=>{o.current&&(o.current.position.set(0,10,0),o.current.visible=!0,c.current=!1,n.current.set(0,0,0),x([0,10,0]),a.current.set(0,10,0))}),3e3)))}var S;let A=0,D=0;s&&(A=-.3),r&&(A=.3),p&&(D=.2),g&&(D=-.2);const E=o.current.rotation.y,z=new _;z.setFromEuler(o.current.rotation);const P=new G(A,E,D,"YXZ"),C=new _;C.setFromEuler(P);const F=(new _).copy(z);F.slerp(C,.1),o.current.setRotationFromQuaternion(F);const R=new I(o.current.position.x,o.current.position.y,o.current.position.z);if(d){const e=new I(0,.2,0),t=new I(-Math.sin(j),.5*o.current.rotation.x,-Math.cos(j)).normalize();w.position.copy(R).add(e),w.lookAt(w.position.x+t.x,w.position.y+t.y,w.position.z+t.z)}else{const e=15,t=6,s=new I(Math.sin(j)*e,t,Math.cos(j)*e);w.position.copy(R).add(s),w.lookAt(o.current.position.x,o.current.position.y+.5,o.current.position.z)}x([o.current.position.x,o.current.position.y,o.current.position.z])})),t.jsxs("group",{ref:o,position:p,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.3,.1,.7]}),t.jsx("meshStandardMaterial",{color:"#ff3300",metalness:.7,roughness:.2})]}),t.jsxs("mesh",{castShadow:!0,position:[0,0,0],rotation:[0,Math.PI/4,0],children:[t.jsx("boxGeometry",{args:[1.414,.03,.05]}),t.jsx("meshStandardMaterial",{color:"#4a4a4a",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{castShadow:!0,position:[0,0,0],rotation:[0,-Math.PI/4,0],children:[t.jsx("boxGeometry",{args:[1.414,.03,.05]}),t.jsx("meshStandardMaterial",{color:"#4a4a4a",metalness:.4,roughness:.6})]}),t.jsx(At,{position:[.1,-.1,.4]}),t.jsx(At,{position:[-.1,-.1,.4]}),t.jsx(At,{position:[.1,-.1,-.4]}),t.jsx(At,{position:[-.1,-.1,-.4]}),t.jsx(kt,{position:[.5,0,.5],index:0,propRef:e=>i.current[0]=e,active:g,speed:j}),t.jsx(kt,{position:[-.5,0,.5],index:1,propRef:e=>i.current[1]=e,active:g,speed:j,counterClockwise:!0}),t.jsx(kt,{position:[.5,0,-.5],index:2,propRef:e=>i.current[2]=e,active:g,speed:j,counterClockwise:!0}),t.jsx(kt,{position:[-.5,0,-.5],index:3,propRef:e=>i.current[3]=e,active:g,speed:j}),t.jsxs("mesh",{position:[0,.16,0],children:[t.jsx("boxGeometry",{args:[.25,.2,.35]}),t.jsx("meshStandardMaterial",{color:"#0000ff"})]}),t.jsxs("group",{children:[t.jsxs("mesh",{position:[0,-.2,0],rotation:[Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.15,.25,1.2,8]}),t.jsx("meshStandardMaterial",{color:"#004d00",metalness:.7,roughness:.5})]}),t.jsxs("mesh",{position:[0,-.2,-.8],rotation:[-Math.PI/2,0,0],children:[t.jsx("coneGeometry",{args:[.25,.5,8]}),t.jsx("meshStandardMaterial",{color:"#2e7d32",metalness:.7,roughness:.5})]})]})]})}function kt({position:s,index:o,propRef:r,active:n=!0,speed:i=1,counterClockwise:a=!1}){const c=u.useRef(),l=a?-1:1;return e((()=>{c.current&&n&&(c.current.rotation.y+=.5*i*l),r&&r(c.current)})),t.jsxs("group",{position:s,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.05,.07,.1,12]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.3})]}),t.jsxs("mesh",{castShadow:!0,position:[0,.05,0],children:[t.jsx("cylinderGeometry",{args:[.05,.05,.02,12]}),t.jsx("meshStandardMaterial",{color:"#8d99ae",metalness:.8,roughness:.2})]}),t.jsxs("group",{ref:c,position:[0,.1,0],children:[t.jsxs("mesh",{castShadow:!0,children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.15,.02,-.025,.15,-.02,.025,0,0,0,.15,-.02,.025,.3,0,0,0,0,0,.3,0,0,.15,.02,-.025,.15,.02,-.025,.3,0,0,.15,-.02,.025])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{castShadow:!0,rotation:[0,Math.PI,0],children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.15,.02,-.025,.15,-.02,.025,0,0,0,.15,-.02,.025,.3,0,0,0,0,0,.3,0,0,.15,.02,-.025,.15,.02,-.025,.3,0,0,.15,-.02,.025])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.04,8,8]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.2})]})]})]})}function At({position:e}){return t.jsxs("mesh",{castShadow:!0,position:e,children:[t.jsx("cylinderGeometry",{args:[.02,.02,.3,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]})}function It({showHUD:e}){const{isFirstPerson:s,toggleFirstPerson:o}=ce();return e?t.jsxs("div",{className:"drone-hud kamikaze-hud",children:[t.jsx("button",{className:"first-person-toggle "+(s?"active":""),onClick:o,children:s?"Exit First Person":"First Person View"}),s&&t.jsx("div",{className:"crosshair",children:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[t.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"white"}),t.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"10",stroke:"white",strokeWidth:"1.25"}),t.jsx("line",{x1:"12",y1:"14",x2:"12",y2:"20",stroke:"white",strokeWidth:"1.25"}),t.jsx("line",{x1:"4",y1:"12",x2:"10",y2:"12",stroke:"white",strokeWidth:"1.25"}),t.jsx("line",{x1:"14",y1:"12",x2:"20",y2:"12",stroke:"white",strokeWidth:"1.25"})]})}),s&&t.jsx("div",{className:"fpv-indicator",children:"KAMIKAZE - FIRST PERSON VIEW"})]}):null}const Dt={[Ge]:3,[ze]:3,[Ee]:3};function Gt(){const o=u.useRef();u.useRef(new I(0,0,0));const n=u.useRef(new I(0,0,0)),i=u.useRef([]),a=u.useRef(new G(0,0,0,"YXZ")),[c,l]=u.useState([0,10,0]),[d,h]=u.useState(!1),[m,p]=u.useState(0),[x,g]=u.useState(!0),[f,j]=u.useState(3),[y,w]=u.useState(5),[M,b]=u.useState(4),[S,v]=u.useState(!1),[k,A]=u.useState(!1),[D,E]=u.useState(!1),z=u.useRef({[Ge]:[],[ze]:[],[Ee]:[]}),[P,C]=u.useState([]),{camera:F,scene:R}=s(),[T,L]=r(),[$,O]=u.useState(!1);u.useEffect((()=>{Object.entries(Dt).forEach((([e,t])=>{for(let s=0;s<t;s++)z.current[e].push({id:`${e}-${s}`,position:new I,previousPosition:new I,direction:new I,type:e,speed:0,life:0,active:!1,gravity:0})}))}),[]);const H=e=>{const t=z.current[e],s=t.find((e=>!e.active));if(s)return s.active=!0,s;console.warn(`Pool exhausted for ${e} projectiles`);const o={id:`${e}-${t.length}`,position:new I,previousPosition:new I,direction:new I,type:e,speed:0,life:0,active:!0,gravity:0};return t.push(o),o},B=e=>{const t=z.current[e.type].find((t=>t.id===e.id));t&&(t.active=!1,t.life=0)},V=.04;u.useEffect((()=>(F.position.set(0,15,20),F.lookAt(0,10,0),o.current&&(o.current.rotation.order="YXZ",o.current.rotation.x=a.current.x,o.current.rotation.y=a.current.y,o.current.rotation.z=a.current.z),T((e=>e),(e=>{const{forward:t,backward:s,left:o,right:r,up:n,down:i,strafeLeft:a,strafeRight:c}=e;t||s||o||r||n||i||a||c?(h(!0),p(1)):p(.5)})))),[F,T]),u.useEffect((()=>{const e=e=>{switch(e.button){case 0:if(f>0&&!S){console.log("Dropping mine");const e=f-1;j(e),v(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:re,weaponType:"mineAmmo",ammoCount:Number(e)}}));const t=H(Ge);t.position.set(o.current.position.x,o.current.position.y-.5,o.current.position.z),t.previousPosition||(t.previousPosition=new I),t.previousPosition.copy(t.position),t.direction.set(0,-1,0),t.speed=.5,t.life=80,t.gravity=.01,C((e=>[...e,t])),setTimeout((()=>v(!1)),1e3)}break;case 2:if(y>0&&!k){console.log("Dropping mortar");const e=y-1;w(e),A(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:re,weaponType:"mortarAmmo",ammoCount:Number(e)}}));const t=H(ze);t.position.set(o.current.position.x,o.current.position.y-.5,o.current.position.z),t.previousPosition||(t.previousPosition=new I),t.previousPosition.copy(t.position),t.direction.set(0,-1,0),t.speed=.5,t.life=60,t.gravity=.006,C((e=>[...e,t])),setTimeout((()=>A(!1)),1e3)}}},t=e=>{if("c"===e.key||"C"===e.key){if(M>0&&!D){console.log("Dropping RPG");const e=M-1;b(e),E(!0),window.dispatchEvent(new CustomEvent("ammoUpdate",{detail:{droneType:re,weaponType:"rpgAmmo",ammoCount:Number(e)}}));const t=H(Ee);t.position.set(o.current.position.x,o.current.position.y-.5,o.current.position.z),t.previousPosition||(t.previousPosition=new I),t.previousPosition.copy(t.position),t.direction.set(0,-1,0),t.speed=.6,t.life=40,t.gravity=.008,C((e=>[...e,t])),setTimeout((()=>E(!1)),1e3)}}else"v"!==e.key&&"V"!==e.key||O((e=>!e))},s=e=>{e.preventDefault()};return window.addEventListener("mousedown",e),window.addEventListener("keydown",t),window.addEventListener("contextmenu",s),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("keydown",t),window.removeEventListener("contextmenu",s)}}),[f,y,M,S,k,D]);const U=(e,t)=>{console.log(`Weapon impact: ${t} at position [${e.x.toFixed(2)}, ${e.y.toFixed(2)}, ${e.z.toFixed(2)}]`);const s={x:e.x,y:e.y,z:e.z};setTimeout((()=>{pt(new I(s.x,s.y,s.z),t)}),0)};return e((()=>{C((e=>{const t=[];for(const s of e){if(s.life<=0){U(s.position,s.type),B(s);continue}if(s.position.y<=.1){U(s.position,s.type),B(s);continue}const e=Be(s,R);e?(U(e.position,s.type),B(s)):(s.previousPosition||(s.previousPosition=new I),s.previousPosition.copy(s.position),s.position.add(s.direction.clone().multiplyScalar(s.speed)),s.gravity&&(s.direction.y-=s.gravity),s.life--,t.push(s))}return t}))})),e(((e,t)=>{if(!o.current)return;const{forward:s,backward:r,left:i,right:a,up:c,down:d,strafeLeft:h,strafeRight:u,shift:m}=L(),p=o.current.rotation.y,x=new I(-Math.sin(p),0,-Math.cos(p)),g=new I(Math.cos(p),0,-Math.sin(p));if(s&&n.current.add(x.clone().multiplyScalar(.12)),r&&(n.current.add(x.clone().multiplyScalar(-.06)),n.current.y+=.012),i&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y+.12,.2)),a&&(o.current.rotation.y=N.lerp(o.current.rotation.y,o.current.rotation.y-.12,.2)),h&&n.current.add(g.clone().multiplyScalar(-.05)),u&&n.current.add(g.clone().multiplyScalar(.05)),c)n.current.y+=V;else if(d){const e=m?.06:V;n.current.y-=e}else n.current.y-=.003;n.current.multiplyScalar(.97);n.current.length()>1&&n.current.normalize().multiplyScalar(1),o.current.position.add(n.current),o.current.position.y<1&&(o.current.position.y=1,n.current.y=0);let f=0,j=0;s&&(f=-.3),r&&(f=.3),h&&(j=.2),u&&(j=-.2);const y=o.current.rotation.y,w=new _;w.setFromEuler(o.current.rotation);const M=new G(f,y,j,"YXZ"),b=new _;b.setFromEuler(M);const S=(new _).copy(w);S.slerp(b,.1),o.current.setRotationFromQuaternion(S);const v=new I(o.current.position.x,o.current.position.y,o.current.position.z);if($)F.position.set(o.current.position.x,o.current.position.y-3,o.current.position.z),F.lookAt(o.current.position.x,0,o.current.position.z);else{const e=new I(20*Math.sin(p),9,20*Math.cos(p));F.position.copy(v).add(e),F.lookAt(o.current.position.x,o.current.position.y+.1,o.current.position.z)}l([o.current.position.x,o.current.position.y,o.current.position.z])})),t.jsxs(t.Fragment,{children:[t.jsxs("group",{ref:o,position:c,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,position:[0,0,0],children:[t.jsx("cylinderGeometry",{args:[.6,.6,.2,6]}),t.jsx("meshStandardMaterial",{color:"#4a00e0",metalness:.8,roughness:.1})]}),[...Array(6)].map(((e,s)=>{const o=Math.PI*s/3;return t.jsx("group",{children:t.jsxs("group",{rotation:[0,o,0],children:[t.jsxs("mesh",{castShadow:!0,position:[.75,0,0],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.04,.04,1.5,8]}),t.jsx("meshStandardMaterial",{color:"#121212",metalness:.6,roughness:.3})]}),t.jsx("group",{position:[1.5,0,0],children:t.jsx(zt,{position:[0,0,0],index:s,propRef:e=>i.current[s]=e,active:d,speed:m,counterClockwise:s%2==1,scale:.75},`motor-${s}`)})]})},s)})),t.jsxs("group",{position:[.5,-.2,0],rotation:[0,Math.PI/2,0],children:[t.jsxs("mesh",{castShadow:!0,position:[0,-.2,0],children:[t.jsx("cylinderGeometry",{args:[.05,.05,.4,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[0,-.4,0],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.04,.04,.8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.5,roughness:.5})]}),t.jsxs("mesh",{castShadow:!0,position:[-.35,-.3,0],rotation:[0,0,Math.PI/6],children:[t.jsx("cylinderGeometry",{args:[.03,.03,.3,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[.35,-.3,0],rotation:[0,0,-Math.PI/6],children:[t.jsx("cylinderGeometry",{args:[.03,.03,.3,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[-.4,-.45,0],children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{castShadow:!0,position:[.4,-.45,0],children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.4,roughness:.6})]})]}),t.jsxs("group",{position:[-.5,-.2,0],rotation:[0,-Math.PI/2,0],children:[t.jsxs("mesh",{castShadow:!0,position:[0,-.2,0],children:[t.jsx("cylinderGeometry",{args:[.05,.05,.4,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[0,-.4,0],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.04,.04,.8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.5,roughness:.5})]}),t.jsxs("mesh",{castShadow:!0,position:[-.35,-.3,0],rotation:[0,0,Math.PI/6],children:[t.jsx("cylinderGeometry",{args:[.03,.03,.3,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[.35,-.3,0],rotation:[0,0,-Math.PI/6],children:[t.jsx("cylinderGeometry",{args:[.03,.03,.3,8]}),t.jsx("meshStandardMaterial",{color:"#64748b",metalness:.6,roughness:.4})]}),t.jsxs("mesh",{castShadow:!0,position:[-.4,-.45,0],children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{castShadow:!0,position:[.4,-.45,0],children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#475569",metalness:.4,roughness:.6})]})]}),t.jsxs("group",{position:[0,-.3,0],children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.5,.5,.2,12]}),t.jsx("meshStandardMaterial",{color:"#3d3d3d",metalness:.8,roughness:.3})]}),[...Array(3)].map(((e,s)=>t.jsxs("mesh",{position:[.25*Math.sin(2*Math.PI*s/3),-.1,.25*Math.cos(2*Math.PI*s/3)],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.15,.15,.05,12]}),t.jsx("meshStandardMaterial",{color:"#151515",metalness:.7,roughness:.3})]},s)))]}),t.jsxs("group",{position:[-.4,.2,0],children:[[...Array(5)].map(((e,s)=>t.jsxs("mesh",{position:[0,.15*(s-2),0],rotation:[0,0,Math.PI/2],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.08,.1,.3,8]}),t.jsx("meshStandardMaterial",{color:"#3a3a3a",metalness:.7,roughness:.4})]},s))),[...Array(5)].map(((e,s)=>t.jsxs("mesh",{position:[-.2,.15*(s-2),0],rotation:[0,0,Math.PI/2],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.06,.08,.15,8]}),t.jsx("meshStandardMaterial",{color:"#626262",metalness:.7,roughness:.3})]},s)))]}),t.jsxs("group",{position:[.4,.2,0],children:[[...Array(4)].map(((e,s)=>t.jsxs("mesh",{position:[0,.18*(s-1.5),0],rotation:[0,0,-Math.PI/2],castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.1,.12,.4,8]}),t.jsx("meshStandardMaterial",{color:"#3a3a3a",metalness:.7,roughness:.4})]},s))),[...Array(4)].map(((e,s)=>t.jsxs("mesh",{position:[.25,.18*(s-1.5),0],rotation:[0,0,-Math.PI/2],castShadow:!0,receiveShadow:!0,children:[t.jsx("coneGeometry",{args:[.1,.3,8]}),t.jsx("meshStandardMaterial",{color:"#626262",metalness:.7,roughness:.3})]},s)))]})]}),t.jsx(Et,{projectiles:P})]})}function Et({projectiles:s}){const o=u.useMemo((()=>({[Ge]:(new L).add(new $(new S(.3,.3,.11,8),new g({color:"#3a3a3a",metalness:.7,roughness:.3})),new $(new S(.075,.075,.08,6),new g({color:"#111111",metalness:.7,roughness:.3})).translateY(.09)),[ze]:(new L).add(new $(new S(.12,.12,.3,8),new g({color:"#4a5568",metalness:.6,roughness:.3})),new $(new k(.12,.18,8),new g({color:"#2d3748",metalness:.7,roughness:.4})).translateY(-.24)).rotateX(Math.PI),[Ee]:(new L).add(new $(new S(.09,.09,.38,8),new g({color:"#2c5e1a",metalness:.6,roughness:.3})),new $(new k(.15,.23,8),new g({color:"#1e4212",metalness:.7,roughness:.4})).translateY(-.3),new $(new F(.03,.06,.15),new g({color:"#3a6e27",metalness:.5,roughness:.5})).translateY(.11).translateZ(.12)).rotateX(Math.PI)})),[]),r=m.memo((({projectile:s})=>{const[r,n]=u.useState([0,0,0]);return e((()=>{s.type===Ge?n([0,r[1]+.02,0]):s.type===ze?n([r[0]+.03,0,0]):s.type===Ee&&n([.05*Math.sin(.01*Date.now()),0,0])})),t.jsx("group",{position:[s.position.x,s.position.y,s.position.z],rotation:r,children:t.jsx("primitive",{object:o[s.type].clone()})})}));return t.jsx(t.Fragment,{children:s.map((e=>t.jsx(r,{projectile:e},e.id)))})}function zt({position:s,index:o,propRef:r,active:n=!0,speed:i=1,counterClockwise:a=!1,scale:c=1}){u.useRef();const l=u.useRef(),d=a?-1:1;return e((()=>{l.current&&n&&(l.current.rotation.y+=.5*i*d),r&&r(l.current)})),t.jsxs("group",{position:s,scale:c,children:[t.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[t.jsx("cylinderGeometry",{args:[.15,.18,.2,12]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.3})]}),t.jsxs("mesh",{castShadow:!0,position:[0,.12,0],children:[t.jsx("cylinderGeometry",{args:[.12,.12,.05,12]}),t.jsx("meshStandardMaterial",{color:"#8d99ae",metalness:.8,roughness:.2})]}),t.jsxs("group",{ref:l,position:[0,.15,0],children:[t.jsxs("mesh",{castShadow:!0,children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.45,.015,-.075,.45,-.015,.075,0,0,0,.45,-.015,.075,.9,0,0,0,0,0,.9,0,0,.45,.015,-.075,.45,.015,-.075,.9,0,0,.45,-.015,.075])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{castShadow:!0,rotation:[0,Math.PI,0],children:[t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.5,roughness:.6}),t.jsxs("bufferGeometry",{children:[t.jsx("bufferAttribute",{attach:"attributes-position",count:12,itemSize:3,array:new Float32Array([0,0,0,.45,.015,-.075,.45,-.015,.075,0,0,0,.45,-.015,.075,.9,0,0,0,0,0,.9,0,0,.45,.015,-.075,.45,.015,-.075,.9,0,0,.45,-.015,.075])}),t.jsx("bufferAttribute",{attach:"attributes-normal",count:12,itemSize:3,array:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0])})]})]}),t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[.06,8,8]}),t.jsx("meshStandardMaterial",{color:"#2b2d42",metalness:.7,roughness:.2})]})]})]})}function Pt({mineAmmo:e,mortarAmmo:s,rpgAmmo:o,showHUD:r}){return r?t.jsxs("div",{className:"weapon-hud bomber-hud",children:[t.jsx("h2",{children:"BOMBER DRONE"}),t.jsxs("div",{className:"weapon-list",children:[t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["MINE [",e,"]"]}),t.jsx("span",{className:"weapon-key",children:"LMB"})]}),t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["MORTAR [",s,"]"]}),t.jsx("span",{className:"weapon-key",children:"RMB"})]}),t.jsxs("div",{className:"weapon-item",children:[t.jsxs("span",{className:"weapon-name",children:["RPG [",o,"]"]}),t.jsx("span",{className:"weapon-key",children:"C"})]})]}),t.jsx("div",{className:"view-toggle",children:t.jsx("span",{children:"CAMERA VIEW TOGGLE: V"})})]}):null}function Ct({world:e}){const{currentDrone:s}=ae();switch(s){case te:return t.jsx(Se,{world:e});case oe:return t.jsx(vt,{});case re:return t.jsx(Gt,{});default:return t.jsx(yt,{})}}const Ft=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.55,0],children:[t.jsx("boxGeometry",{args:[3.4,.9,6]}),t.jsx("meshStandardMaterial",{color:"#4B5320",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.2,0],children:[t.jsx("boxGeometry",{args:[3.5,.4,6.1]}),t.jsx("meshStandardMaterial",{color:"#485320",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.05,0],children:[t.jsx("boxGeometry",{args:[3.2,.2,5.8]}),t.jsx("meshStandardMaterial",{color:"#4D5522",metalness:.5,roughness:.6})]}),t.jsxs("group",{position:[-1.9,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.9],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.45,.45,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.91],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.395,.395,.62,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[2.15,1.5,.9,.3,-.3,-.9,-1.5,-2.15].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s)))]}),t.jsxs("group",{position:[1.9,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.9],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.45,.45,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.91],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.395,.395,.62,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[2.15,1.5,.9,.3,-.3,-.9,-1.5,-2.15].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s+14)))]}),t.jsxs("mesh",{position:[1.9,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,6.3]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-1.9,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,6.3]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.15,-.5],children:[t.jsx("cylinderGeometry",{args:[1.4,1.4,.22,24]}),t.jsx("meshStandardMaterial",{color:"#4B5320",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.6,-.5],children:[t.jsx("boxGeometry",{args:[2.4,.77,2.86]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.6,-1.8],rotation:[-Math.PI/6,0,0],children:[t.jsx("boxGeometry",{args:[2.2,.77,.88]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{position:[-.6,2.05,-.2],children:[t.jsx("cylinderGeometry",{args:[.385,.385,.11,24]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.5,roughness:.6})]}),t.jsxs("group",{position:[0,1.6,-.5],children:[t.jsxs("mesh",{position:[0,0,-1.32],children:[t.jsx("boxGeometry",{args:[1.55,.88,.66]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,0,-2.64],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.18,.18,6.05,16]}),t.jsx("meshStandardMaterial",{color:"#2A2A2A",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,0,-1.98],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.22,.22,1.32,16]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.4,roughness:.7})]})]}),[-1.35,-.8,-.25,.25,.8,1.35].map(((e,s)=>t.jsxs("mesh",{position:[e,.75,2.8],rotation:[0,0,0],children:[t.jsx("boxGeometry",{args:[.4,.3,.2]}),t.jsx("meshStandardMaterial",{color:"#5D6540",metalness:.3,roughness:.8})]},s+32))),t.jsxs("mesh",{position:[2.1,.4,0],children:[t.jsx("boxGeometry",{args:[.1,.6,5.8]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-2.1,.4,0],children:[t.jsx("boxGeometry",{args:[.1,.6,5.8]}),t.jsx("meshStandardMaterial",{color:"#4F5D2F",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[1.85,.5,0],children:[t.jsx("boxGeometry",{args:[.3,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#4A5128",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[-1.85,.5,0],children:[t.jsx("boxGeometry",{args:[.3,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#4A5128",metalness:.4,roughness:.7})]})]}),Rt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.55,0],children:[t.jsx("boxGeometry",{args:[3.4,.9,6]}),t.jsx("meshStandardMaterial",{color:"#3B4A32",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.2,0],children:[t.jsx("boxGeometry",{args:[3.5,.4,6.1]}),t.jsx("meshStandardMaterial",{color:"#323D2A",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.05,0],children:[t.jsx("boxGeometry",{args:[3.2,.2,5.8]}),t.jsx("meshStandardMaterial",{color:"#41503A",metalness:.5,roughness:.6})]}),t.jsxs("group",{position:[-1.9,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.9],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.45,.45,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.91],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.395,.395,.62,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[2.15,1.5,.9,.3,-.3,-.9,-1.5,-2.15].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s)))]}),t.jsxs("group",{position:[1.9,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,6.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.9],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.45,.45,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.91],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.395,.395,.62,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[2.15,1.5,.9,.3,-.3,-.9,-1.5,-2.15].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s+14)))]}),t.jsxs("mesh",{position:[1.9,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,6.3]}),t.jsx("meshStandardMaterial",{color:"#41503A",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-1.9,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,6.3]}),t.jsx("meshStandardMaterial",{color:"#41503A",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.5,-.2],rotation:[0,0,0],children:[t.jsx("boxGeometry",{args:[2.6,.6,3]}),t.jsx("meshStandardMaterial",{color:"#445139",metalness:.5,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.5,-1.6],rotation:[-Math.PI/6,0,0],children:[t.jsx("boxGeometry",{args:[2.4,.6,.8]}),t.jsx("meshStandardMaterial",{color:"#465339",metalness:.5,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.5,1.4],children:[t.jsx("boxGeometry",{args:[2.4,.5,.3]}),t.jsx("meshStandardMaterial",{color:"#404D39",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[-.6,1.85,-.5],children:[t.jsx("cylinderGeometry",{args:[.4,.4,.15,16]}),t.jsx("meshStandardMaterial",{color:"#394431",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.5,-1.9],children:[t.jsx("boxGeometry",{args:[1.3,.7,.6]}),t.jsx("meshStandardMaterial",{color:"#3D4935",metalness:.5,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.5,-3.8],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.18,.18,3,16]}),t.jsx("meshStandardMaterial",{color:"#2A2A2A",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,1.5,-2.8],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.22,.22,1.2,16]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.4,roughness:.7})]})]}),Tt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.4,.4],children:[t.jsx("boxGeometry",{args:[2.4,.6,5]}),t.jsx("meshStandardMaterial",{color:"#485142",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.2,.4],children:[t.jsx("boxGeometry",{args:[2.5,.4,3]}),t.jsx("meshStandardMaterial",{color:"#445029",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.5,-2],rotation:[-Math.PI/4,0,0],children:[t.jsx("boxGeometry",{args:[2.2,.7,.8]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.9,.8],children:[t.jsx("boxGeometry",{args:[2.2,.6,4.4]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.3,roughness:.6})]}),t.jsxs("group",{position:[-1.3,.3,.4],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,5.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.5],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.35,.35,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.5],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.32,.32,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[1.8,.9,0,-.9,-1.8].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s)))]}),t.jsxs("group",{position:[1.3,.3,.4],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,5.2]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.5],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.35,.35,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.5],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.32,.32,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[1.8,.9,0,-.9,-1.8].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s+14)))]}),t.jsxs("mesh",{position:[1.3,.65,.4],children:[t.jsx("boxGeometry",{args:[.7,.1,5.3]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-1.3,.65,.4],children:[t.jsx("boxGeometry",{args:[.7,.1,5.3]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.2,-.4],children:[t.jsx("cylinderGeometry",{args:[.9,.9,.15,24]}),t.jsx("meshStandardMaterial",{color:"#424739",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.5,-.4],children:[t.jsx("boxGeometry",{args:[1.8,.5,1.6]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.5,-1.1],rotation:[-Math.PI/6,0,0],children:[t.jsx("boxGeometry",{args:[1.6,.5,.6]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.4,roughness:.6})]}),t.jsxs("mesh",{position:[-.5,1.8,-.4],children:[t.jsx("cylinderGeometry",{args:[.28,.28,.08,24]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.5,roughness:.6})]}),t.jsxs("group",{position:[0,1.5,-.4],children:[t.jsxs("mesh",{position:[0,0,-.8],children:[t.jsx("boxGeometry",{args:[1,.6,.4]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,0,-2],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.12,.12,2.4,16]}),t.jsx("meshStandardMaterial",{color:"#2A2A2A",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,0,-1.4],rotation:[-Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.15,.15,1.2,16]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.4,roughness:.7})]})]}),t.jsxs("mesh",{position:[1.2,.7,.8],children:[t.jsx("boxGeometry",{args:[.1,.8,3.8]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-1.2,.7,.8],children:[t.jsx("boxGeometry",{args:[.1,.8,3.8]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[0,.9,2.2],children:[t.jsx("boxGeometry",{args:[2.2,.8,1.6]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.3,roughness:.6})]})]}),_t=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.35,0],children:[t.jsx("boxGeometry",{args:[2.4,.6,4.4]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.55,2],rotation:[Math.PI/5,0,0],children:[t.jsx("boxGeometry",{args:[2.4,.8,.8]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,.8,.2],children:[t.jsx("boxGeometry",{args:[2.2,.5,3.6]}),t.jsx("meshStandardMaterial",{color:"#515749",metalness:.3,roughness:.6})]}),t.jsxs("group",{position:[-1.3,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,4.4]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.1],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.35,.35,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.1],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.32,.32,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[1.4,.7,0,-.7,-1.4].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s)))]}),t.jsxs("group",{position:[1.3,.3,0],children:[t.jsxs("mesh",{position:[0,0,0],children:[t.jsx("boxGeometry",{args:[.6,.6,4.4]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.3,roughness:.8})]}),t.jsxs("mesh",{position:[0,0,-2.1],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.35,.35,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),t.jsxs("mesh",{position:[0,0,2.1],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.32,.32,.65,16]}),t.jsx("meshStandardMaterial",{color:"#1A1A1A",metalness:.5,roughness:.7})]}),[1.4,.7,0,-.7,-1.4].map(((e,s)=>t.jsxs("mesh",{position:[0,-.15,e],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.3,.3,.65,16]}),t.jsx("meshStandardMaterial",{color:"#202020",metalness:.5,roughness:.6})]},s+14)))]}),t.jsxs("mesh",{position:[1.3,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,4.5]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[-1.3,.65,0],children:[t.jsx("boxGeometry",{args:[.7,.1,4.5]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.3,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.05,-.6],children:[t.jsx("cylinderGeometry",{args:[1.1,1.1,.15,32]}),t.jsx("meshStandardMaterial",{color:"#3F4438",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.4,-.6],children:[t.jsx("boxGeometry",{args:[1.8,.6,2]}),t.jsx("meshStandardMaterial",{color:"#4A5144",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[0,1.4,-1.5],rotation:[Math.PI/8,0,0],children:[t.jsx("boxGeometry",{args:[1.8,.6,.8]}),t.jsx("meshStandardMaterial",{color:"#4D5446",metalness:.4,roughness:.7})]}),t.jsxs("mesh",{position:[-.5,1.7,-.4],children:[t.jsx("cylinderGeometry",{args:[.28,.28,.08,24]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A",metalness:.5,roughness:.6})]}),t.jsxs("mesh",{position:[0,1.4,-2.4],rotation:[Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.15,.15,2.2,24]}),t.jsx("meshStandardMaterial",{color:"#252525",metalness:.6,roughness:.5})]}),t.jsxs("mesh",{position:[0,1.4,-1.8],rotation:[Math.PI/2,0,0],children:[t.jsx("cylinderGeometry",{args:[.18,.18,1,24]}),t.jsx("meshStandardMaterial",{color:"#303030",metalness:.4,roughness:.8})]}),t.jsxs("mesh",{position:[0,1,1],children:[t.jsx("boxGeometry",{args:[2,.4,1.8]}),t.jsx("meshStandardMaterial",{color:"#485142",metalness:.4,roughness:.7})]})]}),Nt=(new g({color:"#222"}),new g({color:"#444"}),new g({color:"#4d5d28"}),new g({color:"#3498DB"}),new g({color:"#9B59B6"}),new g({color:"#FFFFFF",emissive:"#FFFFCC",emissiveIntensity:.5})),Lt=new g({color:"#87CEEB",transparent:!0,opacity:.7}),$t=e=>t.jsxs("group",{...e,children:[t.jsxs("group",{position:[0,.75,-2.2],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2,1.3,1.8]}),t.jsx("meshStandardMaterial",{color:"#778899"})]}),t.jsxs("mesh",{position:[0,.3,-.9],children:[t.jsx("boxGeometry",{args:[1.6,.4,.1]}),t.jsx("meshStandardMaterial",{...Lt})]}),t.jsxs("mesh",{position:[0,-.3,-.95],children:[t.jsx("boxGeometry",{args:[1.2,.2,.05]}),t.jsx("meshStandardMaterial",{...Nt})]})]}),t.jsxs("group",{position:[0,.85,.8],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2.2,1.5,3.8]}),t.jsx("meshStandardMaterial",{color:"#A9A9A9"})]}),t.jsxs("mesh",{position:[0,-.4,0],children:[t.jsx("boxGeometry",{args:[2.25,.1,3.85]}),t.jsx("meshStandardMaterial",{color:"#CBD5E0"})," "]})]}),[{pos:[-1,.4,-2.2]},{pos:[1,.4,-2.2]},{pos:[-1.1,.4,.6]},{pos:[1.1,.4,.6]},{pos:[-1.1,.4,2]},{pos:[1.1,.4,2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.4,.4,.22,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s))),t.jsxs("mesh",{position:[0,0,0],visible:!1,name:"body",children:[t.jsx("boxGeometry",{args:[2.2,1.5,5]}),t.jsx("meshStandardMaterial",{color:"red",wireframe:!0,opacity:.1,transparent:!0})]})]}),Ot=e=>t.jsxs("group",{...e,children:[t.jsxs("group",{position:[0,.75,-2.2],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2,1.3,1.8]}),t.jsx("meshStandardMaterial",{color:"#708090"})]}),t.jsxs("mesh",{position:[0,.3,-.9],children:[t.jsx("boxGeometry",{args:[1.6,.4,.1]}),t.jsx("meshStandardMaterial",{...Lt})]}),t.jsxs("mesh",{position:[0,-.3,-.95],children:[t.jsx("boxGeometry",{args:[1.2,.2,.05]}),t.jsx("meshStandardMaterial",{...Nt})]})]}),t.jsxs("group",{position:[0,.85,.8],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2.2,1.5,3.8]}),t.jsx("meshStandardMaterial",{color:"#696969"})]}),t.jsxs("mesh",{position:[0,-.4,0],children:[t.jsx("boxGeometry",{args:[2.25,.1,3.85]}),t.jsx("meshStandardMaterial",{color:"#CBD5E0"})," "]})]}),[{pos:[-1,.4,-2.2]},{pos:[1,.4,-2.2]},{pos:[-1.1,.4,.6]},{pos:[1.1,.4,.6]},{pos:[-1.1,.4,2]},{pos:[1.1,.4,2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.4,.4,.22,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s))),t.jsxs("mesh",{position:[0,0,0],visible:!1,name:"body",children:[t.jsx("boxGeometry",{args:[2.2,1.5,5]}),t.jsx("meshStandardMaterial",{color:"red",wireframe:!0,opacity:.1,transparent:!0})]})]}),Ht=e=>t.jsxs("group",{...e,children:[t.jsxs("group",{position:[0,.75,-2.2],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2,1.3,1.8]}),t.jsx("meshStandardMaterial",{color:"#7D7D7D"})," "]}),t.jsxs("mesh",{position:[0,.3,-.9],children:[t.jsx("boxGeometry",{args:[1.6,.4,.1]}),t.jsx("meshStandardMaterial",{...Lt})]}),t.jsxs("mesh",{position:[0,-.3,-.95],children:[t.jsx("boxGeometry",{args:[1.2,.2,.05]}),t.jsx("meshStandardMaterial",{...Nt})]})]}),t.jsxs("group",{position:[0,.85,.8],children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[2.2,1.5,3.8]}),t.jsx("meshStandardMaterial",{color:"#2C5282"})," "]}),t.jsxs("mesh",{position:[0,-.4,0],children:[t.jsx("boxGeometry",{args:[2.25,.1,3.85]}),t.jsx("meshStandardMaterial",{color:"#CBD5E0"})," "]})]}),[{pos:[-1,.4,-2.2]},{pos:[1,.4,-2.2]},{pos:[-1.1,.4,.6]},{pos:[1.1,.4,.6]},{pos:[-1.1,.4,2]},{pos:[1.1,.4,2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.4,.4,.22,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s))),t.jsxs("mesh",{position:[0,0,0],visible:!1,name:"body",children:[t.jsx("boxGeometry",{args:[2.2,1.5,5]}),t.jsx("meshStandardMaterial",{color:"red",wireframe:!0,opacity:.1,transparent:!0})]})]}),Bt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.8,-2],children:[t.jsx("boxGeometry",{args:[1.8,1.4,1.8]}),t.jsx("meshStandardMaterial",{color:"#556B2F"})]}),t.jsxs("mesh",{position:[0,.8,.8],children:[t.jsx("boxGeometry",{args:[1.8,1.4,3.6]}),t.jsx("meshStandardMaterial",{color:"#556B2F"})]}),t.jsxs("mesh",{position:[0,1.51,-2],children:[t.jsx("boxGeometry",{args:[1.7,.25,1.7]}),t.jsx("meshStandardMaterial",{color:"#6B8E23"})]}),t.jsxs("mesh",{position:[0,1.51,.8],children:[t.jsx("boxGeometry",{args:[1.7,.25,3.5]}),t.jsx("meshStandardMaterial",{color:"#6B8E23"})]}),t.jsxs("mesh",{position:[-1,.8,-2],children:[t.jsx("boxGeometry",{args:[.15,1.2,1.8]}),t.jsx("meshStandardMaterial",{color:"#4d5d28"})]}),t.jsxs("mesh",{position:[1,.8,-2],children:[t.jsx("boxGeometry",{args:[.15,1.2,1.8]}),t.jsx("meshStandardMaterial",{color:"#4d5d28"})]}),t.jsxs("mesh",{position:[-1,.8,.8],children:[t.jsx("boxGeometry",{args:[.15,1.2,3.6]}),t.jsx("meshStandardMaterial",{color:"#4d5d28"})]}),t.jsxs("mesh",{position:[1,.8,.8],children:[t.jsx("boxGeometry",{args:[.15,1.2,3.6]}),t.jsx("meshStandardMaterial",{color:"#4d5d28"})]}),[{pos:[-.9,.4,-2]},{pos:[.9,.4,-2]},{pos:[-.9,.4,0]},{pos:[.9,.4,0]},{pos:[-.9,.4,1.6]},{pos:[.9,.4,1.6]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.35,.35,.25,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s)))]}),Vt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.7,-2.2],children:[t.jsx("boxGeometry",{args:[1.8,1.2,1.9]}),t.jsx("meshStandardMaterial",{color:"#4B5320"})," "]}),t.jsxs("mesh",{position:[0,.7,.9],children:[t.jsx("boxGeometry",{args:[1.8,1.2,3.8]}),t.jsx("meshStandardMaterial",{color:"#4B5320"})," "]}),t.jsxs("mesh",{position:[0,1.4,-2.2],children:[t.jsx("boxGeometry",{args:[1.9,.3,2]}),t.jsx("meshStandardMaterial",{color:"#5E6142"})," "]}),t.jsxs("mesh",{position:[0,1.4,.9],children:[t.jsx("boxGeometry",{args:[1.9,.3,3.9]}),t.jsx("meshStandardMaterial",{color:"#5E6142"})," "]}),t.jsxs("mesh",{position:[0,.5,-3.2],children:[t.jsx("boxGeometry",{args:[1.9,.6,.2]}),t.jsx("meshStandardMaterial",{color:"#3A3A3A"})," "]}),t.jsxs("mesh",{position:[-1,.8,-2.2],children:[t.jsx("boxGeometry",{args:[.2,.4,1.8]}),t.jsx("meshStandardMaterial",{color:"#3D3D29"})," "]}),t.jsxs("mesh",{position:[1,.8,-2.2],children:[t.jsx("boxGeometry",{args:[.2,.4,1.8]}),t.jsx("meshStandardMaterial",{color:"#3D3D29"})," "]}),t.jsxs("mesh",{position:[-1,.8,.9],children:[t.jsx("boxGeometry",{args:[.2,.4,3.6]}),t.jsx("meshStandardMaterial",{color:"#3D3D29"})," "]}),t.jsxs("mesh",{position:[1,.8,.9],children:[t.jsx("boxGeometry",{args:[.2,.4,3.6]}),t.jsx("meshStandardMaterial",{color:"#3D3D29"})," "]}),[{pos:[-.9,.4,-2.2]},{pos:[.9,.4,-2.2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.36,.36,.25,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s))),[{pos:[-.9,.4,.6]},{pos:[.9,.4,.6]},{pos:[-.9,.4,2]},{pos:[.9,.4,2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.36,.36,.25,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s+2)))]}),Ut=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.75,-2],children:[t.jsx("boxGeometry",{args:[1.8,1.1,1.8]}),t.jsx("meshStandardMaterial",{color:"#5D5D3C"})," "]}),t.jsxs("mesh",{position:[0,.75,.8],children:[t.jsx("boxGeometry",{args:[1.8,1.1,3.6]}),t.jsx("meshStandardMaterial",{color:"#5D5D3C"})," "]}),t.jsxs("mesh",{position:[0,1.45,-2],children:[t.jsx("boxGeometry",{args:[1.9,.3,1.9]}),t.jsx("meshStandardMaterial",{color:"#6E7B58"})," "]}),t.jsxs("mesh",{position:[0,1.45,.8],children:[t.jsx("boxGeometry",{args:[1.9,.3,3.7]}),t.jsx("meshStandardMaterial",{color:"#6E7B58"})," "]}),t.jsxs("mesh",{position:[-1,.7,-2],children:[t.jsx("boxGeometry",{args:[.2,.5,1.6]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),t.jsxs("mesh",{position:[1,.7,-2],children:[t.jsx("boxGeometry",{args:[.2,.5,1.6]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),t.jsxs("mesh",{position:[-1,.7,0],children:[t.jsx("boxGeometry",{args:[.2,.5,1.8]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),t.jsxs("mesh",{position:[1,.7,0],children:[t.jsx("boxGeometry",{args:[.2,.5,1.8]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),t.jsxs("mesh",{position:[-1,.7,1.8],children:[t.jsx("boxGeometry",{args:[.2,.5,1.8]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),t.jsxs("mesh",{position:[1,.7,1.8],children:[t.jsx("boxGeometry",{args:[.2,.5,1.8]}),t.jsx("meshStandardMaterial",{color:"#515141"})," "]}),[{pos:[-.9,.4,-2]},{pos:[.9,.4,-2]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.33,.33,.25,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s))),[{pos:[-.9,.4,0]},{pos:[.9,.4,0]},{pos:[-.9,.4,1.8]},{pos:[.9,.4,1.8]}].map(((e,s)=>t.jsxs("mesh",{position:e.pos,rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.33,.33,.25,8]}),t.jsx("meshStandardMaterial",{color:"#222"})]},s+2)))]}),Kt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.41,0],children:[t.jsx("boxGeometry",{args:[1.8,.81,3.6]}),t.jsx("meshStandardMaterial",{color:"#0000CD"})]}),t.jsxs("mesh",{position:[0,.54,-1.71],children:[t.jsx("boxGeometry",{args:[1.62,.18,.09]}),t.jsx("meshStandardMaterial",{color:"#333"})]}),[-.72,.72].map(((e,s)=>t.jsxs("mesh",{position:[e,.61,-1.8],children:[t.jsx("boxGeometry",{args:[.35,.18,.08]}),t.jsx("meshStandardMaterial",{color:"#FFFACD",emissive:"#FFFF66"})]},`hl-${s}`))),[-.95,.95].map(((e,s)=>[-1.35,1.35].map(((o,r)=>t.jsxs("mesh",{position:[e,.22,o],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.25,.25,.14,24]}),t.jsx("meshStandardMaterial",{color:"#222"})]},`${s}-${r}`)))))]}),Yt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.45,0],children:[t.jsx("boxGeometry",{args:[1.98,.9,3.78]}),t.jsx("meshStandardMaterial",{color:"#1E90FF"})]}),t.jsxs("mesh",{position:[0,.39,-1.89],children:[t.jsx("boxGeometry",{args:[1.3,.15,.08]}),t.jsx("meshStandardMaterial",{color:"#333"})]}),t.jsxs("mesh",{position:[0,.81,0],children:[t.jsx("boxGeometry",{args:[1.8,.09,.09]}),t.jsx("meshStandardMaterial",{color:"#FF4500"})]}),[-1.05,1.05].map(((e,s)=>[-1.4,1.4].map(((o,r)=>t.jsxs("mesh",{position:[e,.25,o],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.27,.27,.15,24]}),t.jsx("meshStandardMaterial",{color:"#222"})]},`${s}-${r}`))))),[-.72,.72].map(((e,s)=>t.jsxs("mesh",{position:[e,.66,-1.89],children:[t.jsx("boxGeometry",{args:[.35,.18,.08]}),t.jsx("meshStandardMaterial",{color:"#FFFACD",emissive:"#FFFF66"})]},`hlb-${s}`)))]}),Xt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.41,0],children:[t.jsx("boxGeometry",{args:[1.62,.72,3.42]}),t.jsx("meshStandardMaterial",{color:"#FFD700"})]}),t.jsxs("mesh",{position:[0,.36,-1.76],children:[t.jsx("boxGeometry",{args:[1.44,.09,.27]}),t.jsx("meshStandardMaterial",{color:"#333"})]}),t.jsxs("mesh",{position:[0,.72,1.71],rotation:[-.2,0,0],children:[t.jsx("boxGeometry",{args:[.9,.09,.36]}),t.jsx("meshStandardMaterial",{color:"#333"})]}),[-.9,.9].map(((e,s)=>[-1.3,1.3].map(((o,r)=>t.jsxs("mesh",{position:[e,.22,o],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.25,.25,.14,24]}),t.jsx("meshStandardMaterial",{color:"#222"})]},`${s}-${r}`))))),[-.62,.62].map(((e,s)=>t.jsxs("mesh",{position:[e,.61,-1.8],children:[t.jsx("boxGeometry",{args:[.35,.18,.08]}),t.jsx("meshStandardMaterial",{color:"#FFFACD",emissive:"#FFFF66"})]},`hlc-${s}`)))]}),Wt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.45,0],children:[t.jsx("boxGeometry",{args:[1.8,.97,3.6]}),t.jsx("meshStandardMaterial",{color:"#1A4731"})]}),[-.75,.75].map(((e,s)=>t.jsxs("mesh",{position:[e,.94,0],children:[t.jsx("boxGeometry",{args:[.09,.09,3]}),t.jsx("meshStandardMaterial",{color:"#444"})]},`rail-${s}`))),[-.98,.98].map(((e,s)=>[-1.35,1.35].map(((o,r)=>t.jsxs("mesh",{position:[e,.28,o],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.28,.28,.16,24]}),t.jsx("meshStandardMaterial",{color:"#111"})]},`${s}-${r}`))))),[-.72,.72].map(((e,s)=>t.jsxs("mesh",{position:[e,.61,-1.8],children:[t.jsx("boxGeometry",{args:[.35,.18,.08]}),t.jsx("meshStandardMaterial",{color:"#FFFACD",emissive:"#FFFF66"})]},`hld-${s}`)))]}),qt=e=>t.jsxs("group",{...e,children:[t.jsxs("mesh",{position:[0,.29,0],children:[t.jsx("boxGeometry",{args:[1.89,.51,3.78]}),t.jsx("meshStandardMaterial",{color:"#8B0000"})]}),t.jsxs("mesh",{position:[0,.51,-.72],rotation:[.4,0,0],children:[t.jsx("boxGeometry",{args:[1.8,.59,.09]}),t.jsx("meshStandardMaterial",{color:"#87CEEB",transparent:!0,opacity:.7})]}),t.jsxs("mesh",{position:[0,.36,-1.35],children:[t.jsx("boxGeometry",{args:[.72,.07,.72]}),t.jsx("meshStandardMaterial",{color:"#111"})]}),[-.98,.98].map(((e,s)=>[-1.4,1.4].map(((o,r)=>t.jsxs("mesh",{position:[e,.21,o],rotation:[0,0,Math.PI/2],children:[t.jsx("cylinderGeometry",{args:[.22,.22,.12,24]}),t.jsx("meshStandardMaterial",{color:"#222"})]},`${s}-${r}`))))),[-.72,.72].map(((e,s)=>t.jsxs("mesh",{position:[e,.41,-1.88],children:[t.jsx("boxGeometry",{args:[.35,.16,.05]}),t.jsx("meshStandardMaterial",{color:"#FFFACD",emissive:"#FFFF66"})]},`hle-${s}`))),[-.36,.36].map(((e,s)=>t.jsxs("mesh",{position:[e,.22,1.89],children:[t.jsx("cylinderGeometry",{args:[.09,.09,.27,12],rotation:[Math.PI/2,0,0]}),t.jsx("meshStandardMaterial",{color:"#444"})]},`exh-${s}`)))]}),Zt={tank_a:Ft,tank_b:Rt,ifv_a:Tt,ifv_b:_t,civilian_truck_1:$t,civilian_truck_2:Ot,civilian_truck_3:Ht,military_truck_1:Bt,military_truck_2:Vt,military_truck_3:Ut,car_a:Kt,car_b:Yt,car_c:Xt,car_d:Wt,car_e:qt},Qt=(e,s)=>m.forwardRef(((o,r)=>{const{id:n,...i}=o,{initVehicle:a,getVehicleHealth:c}=Ae(),l=n||`vehicle-${s}-${Math.floor(1e4*Math.random())}`;u.useEffect((()=>{a(l,s)}),[l,s]);const d=c(l);if(!d)return t.jsx(e,{...i,ref:r});if(d.isDestroyed)return null;const h={...i};if(d.isDead){if(h.position){const[e,t,s]=h.position;h.position=[e,t-.15,s]}if(h.rotation){const[e,t,s]=h.rotation;h.rotation=[e+(.2*Math.random()-.1),t,s+(.2*Math.random()-.1)]}}return t.jsx("group",{ref:r,children:t.jsx(e,{...h,userData:{vehicleId:l,vehicleType:s,health:d.currentHealth,maxHealth:d.maxHealth,isDead:d.isDead,isDestroyed:d.isDestroyed,mobilityFactor:d.mobilityFactor,canMove:d.healthPercentage>.5}})})})),Jt={tank_a:Qt(Ft,"tank_a"),tank_b:Qt(Rt,"tank_b"),ifv_a:Qt(Tt,"ifv_a"),ifv_b:Qt(_t,"ifv_b"),civilian_truck_1:Qt($t,"civilian_truck_1"),civilian_truck_2:Qt(Ot,"civilian_truck_2"),civilian_truck_3:Qt(Ht,"civilian_truck_3"),military_truck_1:Qt(Bt,"military_truck_1"),military_truck_2:Qt(Vt,"military_truck_2"),military_truck_3:Qt(Ut,"military_truck_3"),car_a:Qt(Kt,"car_a"),car_b:Qt(Yt,"car_b"),car_c:Qt(Xt,"car_c"),car_d:Qt(Wt,"car_d"),car_e:Qt(qt,"car_e")},es=.216,ts=.3,ss=.31104,os="fast",rs="slow",ns=60,is=Math.max(28.8,60),as=1*Math.max(28.8,ns),cs=45,ls=2e3,ds=[{id:"combo1",vehicles:[{type:"military_truck",count:1},{type:"ifv",count:2},{type:"tank",count:3}]},{id:"combo2",vehicles:[{type:"military_truck",count:2},{type:"ifv",count:3},{type:"tank",count:1}]},{id:"combo3",vehicles:[{type:"military_truck",count:2},{type:"ifv",count:2},{type:"tank",count:2}]},{id:"combo4",vehicles:[{type:"military_truck",count:1},{type:"ifv",count:4},{type:"tank",count:1}]}],hs=new I;new G;class us{constructor(){this.pool=[],this.inUse=new Set}get(){let e=this.pool.pop();return e||(e={position:new I,hitbox:{width:1,height:1,depth:3}}),this.inUse.add(e),e}release(e){this.inUse.has(e)&&(this.inUse.delete(e),this.pool.push(e))}releaseAll(){this.inUse.forEach((e=>{this.pool.push(e)})),this.inUse.clear()}}function ms(e){return e[Math.floor(Math.random()*e.length)]}function ps(e){const t=Object.keys(Zt);let s=[];return"tank"===e?s=t.filter((e=>e.includes("tank_"))):"ifv"===e?s=t.filter((e=>e.includes("ifv_"))):"military_truck"===e?s=t.filter((e=>e.includes("military_truck_"))):"car"===e?s=t.filter((e=>e.includes("car_"))):"civilian_truck"===e&&(s=t.filter((e=>e.includes("civilian_truck_")))),s.length>0?ms(s):null}function xs(e){return e.includes("car_")||e.includes("civilian_truck_")}function gs(){const[o,r]=u.useState([]),n=u.useRef(!1),i=u.useRef({}),a=u.useRef([]),c=u.useRef(new us),l=u.useRef(new Map),d=u.useRef(new Map),h=Ae(),p=h.getVehicleHealth,x=u.useRef(new Map),g=u.useMemo((()=>({right:new G(0,-Math.PI/2,0),left:new G(0,Math.PI/2,0)})),[]),{currentMapType:f}=B(),j=u.useMemo((()=>"half-width"===f?Y:{width:K,height:K}),[f]);u.useEffect((()=>{if(n.current)return;n.current=!0;const e=[];return[-150,150].forEach((t=>{const s=[{z:t-33,direction:-1,type:os},{z:t-11,direction:-1,type:rs},{z:t+11,direction:1,type:rs},{z:t+33,direction:1,type:os}],o=s.filter((e=>e.type===os)),r=s.filter((e=>e.type===rs));o.forEach((s=>{const o=ms(ds),r=`column-${t}-${s.z}`,n=Math.random()*(.7*j.width)-.35*j.width;let i=s.direction>0?-j.width/2+100+n:j.width/2-100+n,a=0;for(const c of o.vehicles)for(let o=0;o<c.count;o++){const n=ps(c.type);if(!n)continue;const l=`${r}-${c.type}-${o}`,d=xs(n)?ss:es,h=xs(n)?.432:ts;e.push({id:l,type:n,columnId:r,columnPosition:a,position:new I(i,.3,s.z+(.2*Math.random()-.1)),rotation:s.direction>0?g.right:g.left,speed:d+Math.random()*(h-d),direction:s.direction,lane:s.z,road:t,laneType:s.type,isInColumn:!0,hitbox:{width:1.33,height:1.33,depth:4}}),"tank"===c.type?i+=55*s.direction:"ifv"===c.type?i+=45*s.direction:i+=40*s.direction,a++}})),r.forEach((s=>{const o=`${Math.floor(-j.width/2/100)}-${t}-${s.direction}`;let r=4;l.current.has(o)&&(r=Math.floor(.5*r),console.log(`Congestion detected in section ${o}, reducing spawns to ${r}`));const n=[];for(let i=0;i<r;i++){const o=Math.random()<.7?ps("car"):ps("civilian_truck");if(!o)continue;const a=j.width/r,c=90,l=Math.max(a,c);let d=-j.width/2+i*l+Math.random()*(.6*l);const h=.5*Math.random()-.25;let u=s.z+h,m=!1,p=0;const x=5;for(;p<x;){m=!1;for(const e of n){const t=Math.abs(e.x-d),o=Math.abs(e.z-u);if(t<ns&&o<2){m=!0,d+=s.direction>0?ns:-60;const e=.8*Math.random()-.4;u=s.z+e;break}}if(!m)break;p++}if(m)continue;n.push({x:d,z:u});const f=`vehicle-${t}-${s.z}-${i}`;let y;y=o.includes("car_")?{width:2,height:1,depth:4}:"civilian_truck_1"===o?{width:2.4,height:1.5,depth:6.5}:o.includes("civilian_truck_")?{width:2.2,height:1.5,depth:5}:{width:2,height:1.2,depth:4.5},e.push({id:f,type:o,position:new I(d,.3,u),rotation:s.direction>0?g.right:g.left,speed:ss+.12096000000000001*Math.random(),direction:s.direction,lane:s.z,road:t,laneType:s.type,isInColumn:!1,hitbox:y,jamCounter:0})}}))})),e.forEach((e=>{x.current.set(e.id,e)})),r(e),()=>{c.current.releaseAll(),a.current.forEach((e=>{clearTimeout(e)})),Object.values(i.current).forEach((e=>{e&&clearTimeout(e)}))}}),[g,l.current,j]),u.useEffect((()=>{const e=setInterval((()=>{a.current.length>100&&(a.current=a.current.slice(-100))}),3e4),t=setInterval((()=>{r((e=>{const t=-j.width/2-150,s=j.width/2+150,o=[{min:86,max:214},{min:-214,max:-86}];return e.filter((e=>{if(e.isRemoved||e.isInColumn)return!0;const r=e.position.x>=t&&e.position.x<=s,n=o.some((t=>e.position.z>=t.min&&e.position.z<=t.max));if(!r||!n){if(console.log(`Removing vehicle ${e.id} that drifted too far from the road`),!e.isInColumn)return!1;const t=setTimeout((()=>{h.respawnVehicle(e.id)}),0);return a.current.push(t),!1}return!0}))}))}),1e4);return()=>{clearInterval(e),clearInterval(t)}}),[j]),u.useMemo((()=>({})),[]);const y=u.useRef(new Map);function w(e,t){const s=[],o=ms(ds),r=`column-${Math.random().toString(36).substring(2,9)}`,n=Math.random()*(.7*j.width)-.35*j.width,i=t>0?-j.width/2+100+n:j.width/2-100+n,a=Math.abs(e)<X?-150:150;let l=i,d=0;for(const h of o.vehicles)for(let o=0;o<h.count;o++){const n=ps(h.type);if(!n)continue;const i=`${r}-${h.type}-${o}`,u=c.current.get();u.id=i,u.type=n,u.columnId=r,u.columnPosition=d,u.position.set(l,.3,e+(.2*Math.random()-.1)),u.rotation=t>0?g.right:g.left,u.speed=es+.08399999999999999*Math.random()*.5,u.direction=t,u.lane=e,u.road=a,u.laneType=os,u.isInColumn=!0,u.hitbox={width:1.33,height:1.33,depth:4},s.push(u),"tank"===h.type?l+=55*t:"ifv"===h.type?l+=45*t:l+=40*t,d++}return s}e(((e,t)=>{const s=Date.now();r((e=>{s%3e3<16&&(l.current=(e=>{const t=new Map,s=new Map,o=new Set,r=new Set;return e.forEach((e=>{if(e.isInColumn&&e.columnId){const t=p(e.id);t&&t.isDead?o.add(e.columnId):r.add(e.columnId)}})),r.forEach((e=>{o.delete(e)})),e.forEach((e=>{const t=p(e.id);if(t&&t.isDead)return;const o=`${Math.floor(e.position.x/100)}-${e.road}-${e.direction}`;s.has(o)||s.set(o,[]),s.get(o).push(e)})),s.forEach(((e,s)=>{let r=0;const[n,i,a]=s.split("-");let c=!1;e.forEach((e=>{e.speed<.05&&r++,e.isInColumn&&o.has(e.columnId)&&(c=!0)})),c||r>=3&&t.set(s,{stoppedCount:r,totalVehicles:e.length,lastDetectedTime:Date.now()})})),t})(e)),x.current.clear(),e.forEach((e=>{x.current.set(e.id,e)}));const o=new Set,n=new Map,c=new Map,d=new Map,u=(e,t,s=is)=>{const o=`${Math.floor(e.position.x/10)}-${e.lane}-${e.direction}`,r=`${Math.floor((e.position.x+10*e.direction)/10)}-${e.lane}-${e.direction}`,n=`${Math.floor((e.position.x+20*e.direction)/10)}-${e.lane}-${e.direction}`,i=`${Math.floor((e.position.x+30*e.direction)/10)}-${e.lane}-${e.direction}`,a=[y.current.get(o)||[],y.current.get(r)||[],y.current.get(n)||[],y.current.get(i)||[]];if(!e.isInColumn){const t=22,s=e.lane+t,o=e.lane-t,r=e.type&&e.type.includes("car_"),n=r?1.8:3.5,i=`${Math.floor(e.position.x/10)}-${s}-${e.direction}`,c=`${Math.floor(e.position.x/10)}-${o}-${e.direction}`,l=`${Math.floor((e.position.x+10*e.direction)/10)}-${s}-${e.direction}`,d=`${Math.floor((e.position.x+10*e.direction)/10)}-${o}-${e.direction}`,h=[...y.current.get(i)||[],...y.current.get(c)||[],...y.current.get(l)||[],...y.current.get(d)||[]];r||a.push(...h),e.adjacentLaneVehicles=h,e.adjacentLaneZThreshold=n}let c=1/0,l=!1;if(a.flat().filter((t=>t.id!==e.id&&Math.abs(t.road-e.road)<.5&&t.direction===e.direction)).forEach((t=>{const o=p(t.id);if(o&&o.isDead&&o.isDestroyed)return;if(Math.abs(t.position.z-e.position.z)<(e.isInColumn?2:3.5))if(e.direction>0&&t.direction>0){if(t.position.x>e.position.x){const o=t.position.x-e.position.x;o<s&&(l=!0,c=Math.min(c,o))}}else if(e.direction<0&&t.direction<0&&t.position.x<e.position.x){const o=e.position.x-t.position.x;o<s&&(l=!0,c=Math.min(c,o))}})),!e.isInColumn&&e.type&&e.type.includes("car_")&&e.adjacentLaneVehicles){const t=e.adjacentLaneZThreshold||1.8;e.adjacentLaneVehicles.forEach((o=>{const r=p(o.id);if(r&&r.isDead&&r.isDestroyed)return;if(o.isInColumn){if(Math.abs(o.position.z-e.position.z)>=t)return}if(Math.abs(o.position.z-e.position.z)<t)if(e.direction>0&&o.direction>0){if(o.position.x>e.position.x){const t=o.position.x-e.position.x;t<.7*s&&(l=!0,c=Math.min(c,t))}}else if(e.direction<0&&o.direction<0&&o.position.x<e.position.x){const t=e.position.x-o.position.x;t<.7*s&&(l=!0,c=Math.min(c,t))}})),delete e.adjacentLaneVehicles,delete e.adjacentLaneZThreshold}return e.distanceToNext=l?c:1/0,l};var m;m=e,y.current.clear(),m.forEach((e=>{const t=`${Math.floor(e.position.x/10)}-${e.lane}-${e.direction}`;y.current.has(t)||y.current.set(t,[]),y.current.get(t).push(e)})),e.forEach((e=>{if(e.isInColumn&&e.columnId){o.add(e.columnId);const t=p(e.id);if(t&&t.isDead){if(n.set(e.id,e),e.hasNotifiedColumn||d.set(e.columnId,s),!e.clearingStarted){const t=setTimeout((()=>{r((t=>{const o=e.columnId;return t.map((t=>t.id===e.id?{...t,clearingStarted:!0,clearingTime:s,hasNotifiedColumn:!0}:t.columnId===o?{...t,columnHasDestroyed:!0,lastDestroyedTime:s}:t))}))}),0);a.current.push(t)}if(!e.markedForRemoval&&e.clearingStarted&&t.isDestroyed){const t=setTimeout((()=>{r((t=>t.map((t=>t.id===e.id?{...t,markedForRemoval:!0}:t))))}),ls);a.current.push(t)}}}}));const g=e.filter((e=>{if(e.isInColumn){const t=p(e.id);if(t&&t.isDead&&t.isDestroyed&&e.markedForRemoval){const t=`${e.columnId}-${e.columnPosition}`;c.set(t,{x:e.position.x,lane:e.lane,road:e.road,columnId:e.columnId,columnPosition:e.columnPosition,direction:e.direction,clearingTime:s});const o=setTimeout((()=>{r((t=>t.map((t=>t.columnId===e.columnId?{...t,columnHasRemoval:!0,lastRemovalTime:s}:t))))}),0);return a.current.push(o),!1}}return!0})),f=new Map;g.forEach((e=>{e.isInColumn&&e.columnId&&(f.has(e.columnId)||f.set(e.columnId,[]),f.get(e.columnId).push(e))}));const M=g.map((e=>{if(e.isInColumn)return e;const o=p(e.id);if(o&&o.isDead)return e;const r=o?o.mobilityFactor:1,n=e.speed*r;let i=n;if(e.isInColumn){const t=u(e,0,cs),s=u(e,0,ns),o=u(e,0,as);if(t)i=0;else if(s){const t=Math.max(0,e.distanceToNext-cs)/15;i=n*Math.max(.02,Math.min(.1,.1*t))}else if(o){const t=Math.max(0,e.distanceToNext-ns)/(as-ns);i=n*Math.max(.2,Math.min(.8,t))}}else{e.jamCounter||(e.jamCounter=0),e.lastJamCheck||(e.lastJamCheck=s),s-e.lastJamCheck>500&&(e.speed<.05?e.jamCounter++:e.jamCounter=Math.max(0,e.jamCounter-2),e.lastJamCheck=s);const t=e.jamCounter>5,o=u(e,0,cs),r=u(e,0,ns),a=u(e,0,as);let c;if(e.previousSpeed||(e.previousSpeed=e.speed),o)c=0;else if(r){const t=Math.max(0,e.distanceToNext-cs)/15;c=n*Math.max(.02,Math.min(.1,.1*t))}else if(a){const t=Math.max(0,e.distanceToNext-ns)/(as-ns);c=n*Math.max(.2,Math.min(.8,t))}else c=n,t&&e.distanceToNext>1.5*as&&(c*=1.1);const l=c>e.speed?.08:.25;i=e.speed+(c-e.speed)*l,e.previousSpeed=i}const a=Math.min(Math.abs(i-e.speed),.01),c=i>e.speed?e.speed+a:e.speed-a,l=e.position.x+c*e.direction*t*60;return e.direction>0&&l>j.width/2?(hs.set(-j.width/2,.3,e.position.z),e.position.copy(hs),{...e,speed:e.speed}):e.direction<0&&l<-j.width/2?(hs.set(j.width/2,.3,e.position.z),e.position.copy(hs),{...e,speed:e.speed}):(hs.set(l,e.position.y,e.position.z),{...e,position:hs.clone(),speed:c})}));M.forEach((e=>{x.current.set(e.id,e)})),f.forEach(((e,o)=>{if(e.sort(((e,t)=>e.columnPosition-t.columnPosition)),0===e.length)return;let n=0,c=e[n],l=p(c.id);for(;n<e.length-1&&l&&l.isDead;)n++,c=e[n],l=p(c.id);if(l&&l.isDead){let t=!1,s=-1;for(let o=0;o<e.length;o++){const r=p(e[o].id);if(!r||!r.isDead){s=o,t=!0;break}}t?(n=s,c=e[n],l=p(c.id)):c=e[0]}let d=null,h=null,m=!1;for(const t of e){const e=p(t.id);if(!e||!e.isDead){d=t,h=e,m=!0;break}}let x=.216;if(m){const e=h?h.mobilityFactor:1;x=d.speed*e}const g=e.filter((e=>{const t=p(e.id);return!(t&&t.isDead)}));let f=!1,y=null;const b=new Map;for(const t of e){const e=p(t.id);if(e&&e.isDead)if(f=!0,b.set(t.columnPosition,t),t.wasMarkedDestroyed)t.clearingTime&&(!y||t.clearingTime>y)&&(y=t.clearingTime);else{y=s;const e=M.findIndex((e=>e.id===t.id));-1!==e&&(M[e]={...M[e],wasMarkedDestroyed:!0,clearingTime:s})}}f&&y&&e.forEach((e=>{const t=M.findIndex((t=>t.id===e.id));-1!==t&&(M[t]={...M[t],columnHasDestroyed:!0,lastDestroyedTime:y})}));const S=g.reduce(((e,t)=>d.direction>0?t.position.x>e.position.x?t:e:t.position.x<e.position.x?t:e),g[0]||e[0]),v=u(S,0,cs),k=u(S,0,ns),A=u(S,0,as);if(v)x=0;else if(k){const e=(S.distanceToNext-cs)/15;x*=Math.max(.05,.1*e)}else if(A){const e=(S.distanceToNext-ns)/(as-ns);x*=Math.max(.3,e)}f&&!v&&(x=Math.max(x,es));const I=Math.min(Math.abs(x-(m?d.speed:es)),.01),D=x>(m?d.speed:es)?(m?d.speed:es)+I:(m?d.speed:es)-I;e.forEach((e=>{const o=M.findIndex((t=>t.id===e.id));if(-1===o)return;const r=p(e.id);if(r&&r.isDead)return;const n=f&&y&&s-y<ls;let i=!1;for(const[t,a]of b.entries())if(e.direction>0&&a.position.x>e.position.x||e.direction<0&&a.position.x<e.position.x){if((a.clearingTime?s-a.clearingTime:0)<ls){i=!0;break}}if(n&&i)hs.set(e.position.x,e.position.y,e.position.z),M[o]={...e,position:hs.clone(),speed:0,columnHasDestroyed:f,lastDestroyedTime:y,waitingForVehicleAhead:!0};else{const s=e.waitingForVehicleAhead?1.2:1,r=D*e.direction*t*60*s;hs.set(e.position.x+r,e.position.y,e.position.z),M[o]={...e,position:hs.clone(),speed:D*s,columnHasDestroyed:f,lastDestroyedTime:y,waitingForVehicleAhead:!1}}}));const G=S.position.x+D*S.direction*t*60;(S.direction>0&&G>j.width/2||S.direction<0&&G<-j.width/2)&&(e.forEach((e=>{const t=M.findIndex((t=>t.id===e.id));-1!==t&&(M[t]={...e,isRemoved:!0})})),function(e,t){const s=`${e}-${t}`;if(!i.current[s]){const o=setTimeout((()=>{i.current[s]=null,r((s=>[...s,...w(e,t)]))}),7e3);i.current[s]=o,a.current.push(o)}}(S.lane,S.direction))}));const b=M.filter((e=>{if(!e)return!1;if(e.isRemoved)return!1;if(e.isInColumn)return!0;const t=p(e.id);if(t&&t.isDead&&t.isDestroyed){if(!e.isInColumn)return!1;const t=Math.random()*(.4*j.width),s=e.direction>0?-j.width/2+t:j.width/2+t,o=M.filter((t=>t&&t.id!==e.id&&t.direction===e.direction&&t.lane===e.lane&&t.road===e.road&&(e.direction>0&&t.position.x>s&&t.position.x<s+150||e.direction<0&&t.position.x<s&&t.position.x>s-150))).length>0?e.direction>0?-150:150:0,r={...e,position:new I(s+o,.3,e.position.z),speed:es+.08399999999999999*Math.random()},n=setTimeout((()=>{h.respawnVehicle(e.id)}),0);return a.current.push(n),r}return!0})).filter(Boolean),S=[];return S.length>0&&b.push(...S),b}))}));const{camera:M}=s();e((()=>{const e=M.position;d.current.forEach(((t,s)=>{if(t&&t.current){const s=t.current.position,o=new I(s.x,s.y,s.z).distanceTo(e);t.current.visible=o<1200}}))}));const b=u.useMemo((()=>{const e=new Set(o.map((e=>e.id)));return d.current.forEach(((t,s)=>{e.has(s)||d.current.delete(s)})),o.filter((e=>{const t=-j.width/2-50,s=j.width/2+50,o=[{min:101,max:199},{min:-199,max:-101}],r=e.position.x>=t&&e.position.x<=s,n=o.some((t=>e.position.z>=t.min&&e.position.z<=t.max));return r&&n})).map((e=>{var s,o,r;p(e.id);const n=Jt[e.type];d.current.has(e.id)||d.current.set(e.id,m.createRef());const i=d.current.get(e.id);return t.jsxs("group",{ref:i,position:[e.position.x,e.position.y,e.position.z],rotation:[e.rotation.x,e.rotation.y,e.rotation.z],userData:{vehicleId:e.id,vehicleType:e.type,isVehicle:!0,isInColumn:e.isInColumn,columnId:e.columnId,hitbox:{width:(null==(s=e.hitbox)?void 0:s.width)||1,height:(null==(o=e.hitbox)?void 0:o.height)||1,depth:(null==(r=e.hitbox)?void 0:r.depth)||3}},name:`vehicle-${e.id}`,children:[t.jsx(n,{id:e.id,scale:[4,4,4],userData:{vehicleId:e.id,vehicleType:e.type,isVehicle:!0}}),!1]},e.id)}))}),[o,p,j]);return t.jsx(t.Fragment,{children:b})}const fs=({onSelectVehicle:e})=>{const{scene:t,camera:o,gl:r,raycaster:n}=s();return u.useEffect((()=>{const s=s=>{const i=r.domElement.getBoundingClientRect(),a=(s.clientX-i.left)/i.width*2-1,c=-(s.clientY-i.top)/i.height*2+1;n.setFromCamera({x:a,y:c},o);const l=n.intersectObjects(t.children,!0);let d=!1;for(let t=0;t<l.length;t++){let s=l[t].object;for(;s;){if(s.userData&&s.userData.vehicleId){e(s.userData.vehicleId),d=!0;break}s=s.parent}if(d)break}},i=r.domElement;return i.addEventListener("click",s),()=>{i.removeEventListener("click",s)}}),[t,o,r,n,e]),null};function js(){const{scene:e,camera:o}=s();u.useEffect((()=>(e.fog=new H("#b5d3e7",85e-5),o.position.set(0,20,100),o.updateProjectionMatrix(),()=>{})),[e,o]);const r=u.useMemo((()=>({distance:45e4,sunPosition:[0,1,0],inclination:.5,azimuth:.25})),[]);return t.jsxs(t.Fragment,{children:[t.jsx(c,{preset:"sunset"}),t.jsx(l,{distance:r.distance,sunPosition:r.sunPosition,inclination:r.inclination,azimuth:r.azimuth}),t.jsx("directionalLight",{position:[50,50,25],intensity:1.5,"shadow-mapSize":[2048,2048],"shadow-camera-left":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-bottom":-1e3,"shadow-camera-near":.1,"shadow-camera-far":2e3}),t.jsx("ambientLight",{intensity:.2}),t.jsx(U,{}),t.jsx(q,{mapType:"original"}),t.jsx(ee,{}),t.jsx(gs,{}),t.jsx(Ct,{}),t.jsx(mt,{}),t.jsx(ft,{}),t.jsx(xt,{}),t.jsx(fs,{})]})}const ys=205;function ws(){const s=2e3,o=u.useMemo((()=>{const e=Math.ceil(10);return{x:e,z:e}}),[s]),r=u.useMemo((()=>({x:Math.floor(200/o.x),z:Math.floor(200/o.z)})),[o]),n=u.useMemo((()=>{const e=new x(ys,ys,r.x,r.z),t=e.attributes.position.array;for(let s=0;s<t.length;s+=3){const e=t[s],o=t[s+2],r=Math.sin(.05*e)*Math.cos(.05*o)*2,n=Math.sin(.1*e+.3)*Math.sin(.1*o+.1)*1.5,i=Math.cos(.2*e+1.1)*Math.sin(.15*o+.5)*1;t[s+1]=r+n+i}return e.computeVertexNormals(),e}),[r]),i=u.useMemo((()=>new g({color:"#DEB887",roughness:.9,metalness:.05,flatShading:!1})),[]),a=u.useRef(),c=u.useMemo((()=>new f),[]),l=u.useMemo((()=>{const e=[];for(let t=0;t<o.x;t++)for(let s=0;s<o.z;s++)e.push({position:[200*t-1e3+100,0,200*s-1e3+100],rotation:[-Math.PI/2,0,0]});return e}),[s,o]);return e((()=>{if(a.current)return l.forEach(((e,t)=>{const[s,o,r]=e.position,[n,i,l]=e.rotation;c.position.set(s,o,r),c.rotation.set(n,i,l),c.updateMatrix(),a.current.setMatrixAt(t,c.matrix)})),a.current.instanceMatrix.needsUpdate=!0,null}),[l]),t.jsx("instancedMesh",{ref:a,args:[n,i,l.length],receiveShadow:!0})}const Ms={PINE:"pine",OAK:"oak",PALM:"palm",BIRCH:"birch"};class bs{constructor(e,t){this.bounds=e,this.dimensions=t,this.cells={}}getCell(e){const{min:t,max:s}=this.bounds;return{x:Math.floor((e.x-t.x)/(s.x-t.x)*this.dimensions.x),z:Math.floor((e.z-t.z)/(s.z-t.z)*this.dimensions.z)}}getCellKey(e){return`${e.x},${e.z}`}insert(e,t){const s=this.getCell(e),o=this.getCellKey(s);this.cells[o]||(this.cells[o]=[]),this.cells[o].push({position:e,object:t})}query(e,t){const s=[],o=this.getCell(e),r=Math.ceil(t/Math.min((this.bounds.max.x-this.bounds.min.x)/this.dimensions.x,(this.bounds.max.z-this.bounds.min.z)/this.dimensions.z));for(let n=-r;n<=r;n++)for(let i=-r;i<=r;i++){const r={x:o.x+n,z:o.z+i},a=this.getCellKey(r);if(this.cells[a])for(const o of this.cells[a]){const r=o.position.x-e.x,n=o.position.z-e.z;Math.sqrt(r*r+n*n)<=t&&s.push(o.object)}}return s}}function Ss(e){const t=1e4*Math.sin(e);return t-Math.floor(t)}function vs(){const o=2e3,r=1e3,n=1e3,{trees:i,rocks:a,bushes:c,cacti:l,largeBush:d}=u.useMemo((()=>{const e=new bs({min:{x:-1e3,z:-1e3},max:{x:r,z:n}},{x:20,z:20}),t=(e,t)=>Math.abs(t-150)<70||Math.abs(t+150)<70,s={pine:[],oak:[],palm:[],birch:[]},i=[],a=[],c=[],l=(s,o,r)=>{if(t(0,o))return!1;if(Math.abs(o-150)<80||Math.abs(o+150)<80)return!1;const n={x:s,z:o};return 0===e.query(n,r).length},d=(t,d,h,u,m)=>{for(let p=0;p<u;p++){const t=54321+h+p,u=Ss(1.1*t),x=Ss(2.3*t),g=Ss(3.7*t),f=Ss(4.5*t),j=Math.floor(4*Ss(5.9*t)),y=u*o-r,w=x*o-n;if(!l(y,w,m))continue;const M=1.2+g*(1.8-1.2),b=f*Math.PI*2;new I(y,0,w);const S={position:[y,0,w],scale:M,rotation:b,type:j};if("tree"===d){const e=Object.values(Ms)[j];s[e].push(S)}else"rock"===d?i.push(S):"bush"===d?a.push(S):"cactus"===d&&c.push(S);e.insert({x:y,z:w},S)}};d(0,"tree",0,80,12),d(0,"rock",1e4,300,4),d(0,"bush",2e4,100,4),d(0,"cactus",3e4,150,12);const h=536474196,u=Ss(h)*o-r,m=Ss(536474296)*o-n;let p=null;return t(0,m)||(p={position:[u,0,m],scale:4,rotation:Ss(536474396)*Math.PI*2}),{trees:s,rocks:i,bushes:a,cacti:c,largeBush:p}}),[r,n,o]),{camera:h}=s(),m={pine:{trunk:u.useRef(),foliage:u.useRef()},oak:{trunk:u.useRef(),foliage:u.useRef()},palm:{trunk:u.useRef(),foliage:u.useRef()},birch:{trunk:u.useRef(),foliage:u.useRef()}},p=u.useRef(),x=u.useRef(),D=u.useRef(),G=u.useRef();u.useMemo((()=>new j),[]),u.useMemo((()=>new y),[]);const E=u.useMemo((()=>new f),[]),z=u.useMemo((()=>({pine:{trunk:new g({color:"#8B4513",roughness:.9,flatShading:!0}),foliage:new g({color:"#8B8B65",roughness:.8,flatShading:!0})},oak:{trunk:new g({color:"#654321",roughness:.9,flatShading:!0}),foliage:new g({color:"#9B9B65",roughness:.8,flatShading:!0})},palm:{trunk:new g({color:"#A0522D",roughness:.8,flatShading:!0}),foliage:new g({color:"#A8C27D",roughness:.9,flatShading:!0})},birch:{trunk:new g({color:"#F5F5DC",roughness:.7,flatShading:!0}),foliage:new g({color:"#D3D3A4",roughness:.8,flatShading:!0})}})),[]),P=u.useMemo((()=>new g({color:"#B8860B",roughness:1,flatShading:!0})),[]),C=u.useMemo((()=>new g({color:"#8B8B6A",roughness:.9,flatShading:!0})),[]),F=u.useMemo((()=>new g({color:"#4C7F50",roughness:.8,flatShading:!0})),[]),R=u.useMemo((()=>new w(1,0)),[]),T=u.useMemo((()=>new M(2,6,4)),[]),_=u.useMemo((()=>new S(.8,1.2,5,8,4)),[]),N=u.useMemo((()=>({pine:{trunkHeight:4.8,trunkRadius:.75,foliageOffset:4.8},oak:{trunkHeight:4.5,trunkRadius:.975,foliageOffset:3},palm:{trunkHeight:7.5,trunkRadius:.525,foliageOffset:7.5},birch:{trunkHeight:6.75,trunkRadius:.4875,foliageOffset:4.5}})),[]),L=u.useMemo((()=>({highDetail:{pine:{trunk:new S(.6,.75,4.8,8,3),foliage:new k(3,9.6,8,4)},oak:{trunk:new S(.9,1.05,4.5,10,4),foliage:new M(3.75,12,10)},palm:{trunk:new S(.45,.6,7.5,8,5),foliage:new v(3.75,1)},birch:{trunk:new S(.45,.53,6.75,9,4),foliage:new b(3,2)}},lowDetail:{pine:{trunk:new S(.6,.75,4.8,4,1),foliage:new k(3,9.6,5,1)},oak:{trunk:new S(.9,1.05,4.5,6,1),foliage:new M(3.75,6,4)},palm:{trunk:new S(.45,.6,7.5,4,1),foliage:new v(3.75,0)},birch:{trunk:new S(.45,.53,6.75,5,1),foliage:new b(3,0)}}})),[]);return u.useEffect((()=>{if(Object.entries(i).forEach((([e,t])=>{if(!t.length)return;const{trunkHeight:s,trunkRadius:o,foliageOffset:r}=N[e],n=m[e].trunk;n.current&&t.length>0&&(t.forEach(((e,t)=>{const[o,r,i]=e.position,a=e.scale,c=s*a/2;E.position.set(o,c,i),E.rotation.set(0,e.rotation,0),E.scale.set(a,a,a),E.updateMatrix(),n.current.setMatrixAt(t,E.matrix)})),n.current.instanceMatrix.needsUpdate=!0,n.current.computeBoundingSphere(),n.current.boundingSphere&&(n.current.boundingSphere.radius*=1.5));const i=m[e].foliage;i.current&&t.length>0&&(t.forEach(((t,s)=>{const[o,n,a]=t.position,c=t.scale,l=r*c;let d;switch(e){case"pine":d=l+4.8*c;break;case"birch":d=l+2.25*c;break;default:d=l+1.5*c}E.position.set(o,d,a),E.rotation.set(0,t.rotation,0),E.scale.setScalar(c),E.updateMatrix(),i.current.setMatrixAt(s,E.matrix)})),i.current.instanceMatrix.needsUpdate=!0,i.current.computeBoundingSphere(),i.current.boundingSphere&&(i.current.boundingSphere.radius*=1.5))})),p.current&&a.length>0&&(a.forEach(((e,t)=>{const[s,o,r]=e.position,n=e.scale,i=.5*n;E.position.set(s,i,r),E.rotation.set(0,e.rotation,0),E.scale.setScalar(n),E.updateMatrix(),p.current.setMatrixAt(t,E.matrix)})),p.current.instanceMatrix.needsUpdate=!0,p.current.computeBoundingSphere(),p.current.boundingSphere&&(p.current.boundingSphere.radius*=1.5)),x.current&&c.length>0&&(c.forEach(((e,t)=>{const[s,o,r]=e.position,n=e.scale,i=2*n*.5;E.position.set(s,i,r),E.rotation.set(0,e.rotation,0),E.scale.setScalar(n),E.updateMatrix(),x.current.setMatrixAt(t,E.matrix)})),x.current.instanceMatrix.needsUpdate=!0,x.current.computeBoundingSphere(),x.current.boundingSphere&&(x.current.boundingSphere.radius*=1.5)),D.current&&l.length>0&&(l.forEach(((e,t)=>{const[s,o,r]=e.position,n=e.scale,i=2.5*n;E.position.set(s,i,r),E.rotation.set(0,e.rotation,0),E.scale.setScalar(n),E.updateMatrix(),D.current.setMatrixAt(t,E.matrix)})),D.current.instanceMatrix.needsUpdate=!0,D.current.computeBoundingSphere(),D.current.boundingSphere&&(D.current.boundingSphere.radius*=1.5)),G.current&&d){const[e,t,s]=d.position,o=d.scale,r=2*o*.5;E.position.set(e,r,s),E.rotation.set(0,d.rotation,0),E.scale.setScalar(o),E.updateMatrix(),G.current.matrix.copy(E.matrix),G.current.matrixAutoUpdate=!1,G.current.boundingSphere||(G.current.boundingSphere=new A(new I(e,r,s),2*o))}}),[i,a,c,l,d,N,E]),e((({camera:e})=>{const t=e.position,s=1e3;if(Object.entries(m).forEach((([e,o])=>{if(!(o.trunk.current&&o.trunk.current.boundingSphere&&o.foliage.current&&o.foliage.current.boundingSphere))return;const r=o.trunk.current.boundingSphere.center.distanceTo(t),n=o.foliage.current.boundingSphere.center.distanceTo(t);o.trunk.current.visible=r<s,o.foliage.current.visible=n<s})),p.current&&p.current.boundingSphere){const e=p.current.boundingSphere.center.distanceTo(t);p.current.visible=e<s}if(x.current&&x.current.boundingSphere){const e=x.current.boundingSphere.center.distanceTo(t);x.current.visible=e<s}if(D.current&&D.current.boundingSphere){const e=D.current.boundingSphere.center.distanceTo(t);D.current.visible=e<s}if(G.current&&G.current.boundingSphere){const e=G.current.boundingSphere.center.distanceTo(t);G.current.visible=e<s}})),t.jsxs("group",{children:[Object.entries(i).map((([e,s])=>{if(!s.length)return null;const o=L.highDetail[e],r=z[e];return t.jsxs("group",{children:[t.jsxs("instancedMesh",{ref:m[e].trunk,args:[null,null,s.length],frustumCulled:!0,children:[t.jsx("primitive",{object:o.trunk}),t.jsx("primitive",{object:r.trunk})]}),t.jsxs("instancedMesh",{ref:m[e].foliage,args:[null,null,s.length],frustumCulled:!0,children:[t.jsx("primitive",{object:o.foliage}),t.jsx("primitive",{object:r.foliage})]})]},e)})),t.jsx("instancedMesh",{ref:p,args:[R,P,a.length],frustumCulled:!0}),t.jsx("instancedMesh",{ref:x,args:[T,C,c.length],frustumCulled:!0}),t.jsx("instancedMesh",{ref:D,args:[_,F,l.length],frustumCulled:!0}),d&&t.jsxs("mesh",{ref:G,frustumCulled:!0,children:[t.jsx("sphereGeometry",{args:[2,10,8]}),t.jsx("meshStandardMaterial",{color:"#8B8B6A",roughness:.9,metalness:.05,flatShading:!0})]})]})}function ks(){const{scene:e,camera:o}=s();u.useEffect((()=>(e.fog=new H("#e6d9c9",9e-4),o.position.set(0,25,90),o.updateProjectionMatrix(),()=>{})),[e,o]);const r=u.useMemo((()=>({distance:45e4,sunPosition:[.5,.8,0],inclination:.6,azimuth:.35})),[]);return t.jsxs(t.Fragment,{children:[t.jsx(c,{preset:"sunset"}),t.jsx(l,{distance:r.distance,sunPosition:r.sunPosition,inclination:r.inclination,azimuth:r.azimuth}),t.jsx("directionalLight",{position:[50,50,25],intensity:1.8,"shadow-mapSize":[2048,2048],"shadow-camera-left":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-bottom":-1e3,"shadow-camera-near":.1,"shadow-camera-far":2e3}),t.jsx("ambientLight",{intensity:.15}),t.jsx(ws,{}),t.jsx(q,{mapType:"desert"}),t.jsx(vs,{}),t.jsx(gs,{}),t.jsx(Ct,{}),t.jsx(mt,{}),t.jsx(ft,{}),t.jsx(xt,{}),t.jsx(fs,{})]})}const As=()=>{const{currentMapType:e}=B();return t.jsx(t.Fragment,{children:"desert"===e?t.jsx(ks,{}):t.jsx(js,{})})};function Is({onSelectVehicle:e}){return t.jsxs(t.Fragment,{children:[t.jsx(As,{}),t.jsx(fs,{onSelectVehicle:e})]})}function Ds(){const{currentDrone:e,switchDrone:s}=ae(),[o]=r();return u.useEffect((()=>o((e=>{e[fe]&&s(se),e[je]&&s(oe),e[ye]&&s(re),e[we]&&s(te)}))),[o,s]),t.jsxs("div",{className:"drone-selector",children:[t.jsx("div",{className:"selector-heading",children:"Select Drone"}),t.jsxs("div",{className:"selector-options",children:[t.jsxs("button",{className:"selector-button "+(e===se?"active":""),onClick:()=>s(se),children:[t.jsx("div",{className:"icon grenadier",children:""}),t.jsx("div",{children:"Grenadier"}),t.jsx("div",{className:"key-hint",children:"1"})]}),t.jsxs("button",{className:"selector-button "+(e===oe?"active":""),onClick:()=>s(oe),children:[t.jsx("div",{className:"icon kamikaze",children:""}),t.jsx("div",{children:"Kamikaze"}),t.jsx("div",{className:"key-hint",children:"2"})]}),t.jsxs("button",{className:"selector-button "+(e===re?"active":""),onClick:()=>s(re),children:[t.jsx("div",{className:"icon bomber",children:""}),t.jsx("div",{children:"Bomber"}),t.jsx("div",{className:"key-hint",children:"3"})]}),t.jsxs("button",{className:"selector-button "+(e===te?"active":""),onClick:()=>s(te),children:[t.jsx("div",{className:"icon player",children:""}),t.jsx("div",{children:"Player"}),t.jsx("div",{className:"key-hint",children:"4"})]})]})]})}const Gs=({selectedVehicleId:e})=>{const[s,o]=u.useState(null),r=Ae((e=>e.getVehicleHealth));if(u.useEffect((()=>{if(!e)return void o(null);s();const t=setInterval(s,500);return()=>clearInterval(t);function s(){const t=r(e);o(t)}}),[e,r]),!s)return null;const n=Math.floor(s.currentHealth/s.maxHealth*100);return t.jsxs("div",{className:"vehicle-health-hud",children:[t.jsxs("h3",{children:["Vehicle Status: ",s.type.replace(/_/g," ").toUpperCase()]}),t.jsxs("div",{className:"health-bar-container",children:[t.jsxs("div",{className:"health-bar-label",children:["Health: ",n,"%"]}),t.jsx("div",{className:"health-bar-outer",children:t.jsx("div",{className:"health-bar-inner",style:{width:`${n}%`,backgroundColor:n>70?"#44ff44":n>40?"#ffff44":n>20?"#ff8844":"#ff4444"}})}),t.jsxs("div",{className:"health-status",children:["Status: ",s.isDead?"DESTROYED":s.isCritical?"CRITICAL":n<60?"DAMAGED":"OPERATIONAL"]})]}),s.mobilityFactor<1&&t.jsxs("div",{className:"mobility-info",children:["Mobility: ",Math.floor(100*s.mobilityFactor),"%"]}),s.visualEffects.length>0&&t.jsxs("div",{className:"damage-effects",children:["Active Effects: ",s.visualEffects.join(", ")]}),s.damageLog.length>0&&t.jsxs("div",{className:"damage-log",children:[t.jsx("h4",{children:"Recent Damage:"}),t.jsx("ul",{children:s.damageLog.slice(-3).map(((e,s)=>t.jsxs("li",{children:[e.weaponType?$e(e.weaponType):"Unknown"," -",Math.floor(e.finalDamage)," damage",e.hitLocation&&` (${e.hitLocation})`]},s)))})]})]})};function Es(){const{currentDrone:e}=ae(),s=[{key:"W",action:"Move Forward"},{key:"S",action:"Move Backward"},{key:"A",action:"Strafe Left"},{key:"D",action:"Strafe Right"},{key:"Q",action:"Turn Left"},{key:"E",action:"Turn Right"},{key:"SPACE",action:"Move Up"},{key:"SHIFT",action:"Move Down"},{key:"1",action:"Select Grenadier"},{key:"2",action:"Select Kamikaze"},{key:"3",action:"Select Bomber"},...{[oe]:[{key:"V",action:"Toggle First Person View"},{key:"MOUSE",action:"Control Direction (in FPV)"}],[se]:[],[re]:[]}[e]||[]];return t.jsxs("div",{className:"controls-list",children:[t.jsx("div",{className:"controls-heading",children:"Controls"}),t.jsx("div",{className:"controls-items",children:s.map(((e,s)=>t.jsxs("div",{className:"control-item",children:[t.jsx("span",{className:"key",children:e.key}),t.jsx("span",{className:"action",children:e.action})]},s)))})]})}function zs(){const{currentDrone:e}=ae(),s=!0,[o,r]=u.useState({mineAmmo:3,mortarAmmo:5,rpgAmmo:4}),[n,i]=u.useState({shotgunAmmo:12,grenadeAmmo:6,dartAmmo:9});switch(u.useEffect((()=>{const e=e=>{const{droneType:t,weaponType:s,ammoCount:o}=e.detail;t===re?r((e=>({...e,[s]:o}))):t===se&&i((e=>({...e,[s]:o})))};return window.addEventListener("ammoUpdate",e),()=>{window.removeEventListener("ammoUpdate",e)}}),[]),e){case re:return t.jsx(Pt,{mineAmmo:o.mineAmmo,mortarAmmo:o.mortarAmmo,rpgAmmo:o.rpgAmmo,showHUD:s});case se:return t.jsx(St,{shotgunAmmo:n.shotgunAmmo,grenadeAmmo:n.grenadeAmmo,dartAmmo:n.dartAmmo,showHUD:s});case oe:return t.jsx(It,{showHUD:s});default:return null}}const Ps=()=>{const{currentMapType:e,setMapType:s}=B();return t.jsxs("div",{className:"map-selector",children:[t.jsx("button",{className:"map-button "+("original"===e?"active":""),onClick:()=>s("original"),children:"Original Map"}),t.jsx("button",{className:"map-button "+("desert"===e?"active":""),onClick:()=>s("desert"),children:"Desert Map"})]})};function Cs(){const[e,s]=u.useState(null),o={shadows:!0,camera:{position:[0,20,100],fov:50},dpr:[.75,1],onPointerMissed:()=>s(null)};return t.jsx("div",{style:{width:"100%",height:"100vh"},children:t.jsxs(be,{children:[t.jsxs(d,{...o,children:[t.jsx("color",{attach:"background",args:["#87CEEB"]}),t.jsx("fog",{attach:"fog",args:["#87CEEB",100,1e3]}),t.jsx(u.Suspense,{fallback:null,children:t.jsx(Is,{onSelectVehicle:s})}),!1]}),t.jsxs("div",{className:"ui-layer",children:[t.jsx(Es,{}),t.jsx(Ds,{}),t.jsx(Ps,{}),t.jsx(Gs,{selectedVehicleId:e}),t.jsx(zs,{})]})]})})}h.createRoot(document.getElementById("root")).render(t.jsx(m.StrictMode,{children:t.jsx(ie,{children:t.jsx(Cs,{})})}));
//# sourceMappingURL=index-IaYM6-T7.js.map
